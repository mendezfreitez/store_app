{"remainingRequest":"C:\\Users\\icald\\VueJS\\store_app\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\icald\\VueJS\\store_app\\src\\editor\\js\\fabric.js","dependencies":[{"path":"C:\\Users\\icald\\VueJS\\store_app\\src\\editor\\js\\fabric.js","mtime":1516260752000},{"path":"C:\\Users\\icald\\VueJS\\store_app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\icald\\VueJS\\store_app\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmV2ZXJ5Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb21lIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5jb25zdHJ1Y3RvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC50by1qc29uIik7Cgp2YXIgX3R5cGVvZiA9IHJlcXVpcmUoIkM6L1VzZXJzL2ljYWxkL1Z1ZUpTL3N0b3JlX2FwcC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YiKTsKCi8qIGJ1aWxkOiBgbm9kZSBidWlsZC5qcyBtb2R1bGVzPUFMTGAgKi8KCi8qISBGYWJyaWMuanMgQ29weXJpZ2h0IDIwMDgtMjAxMiwgUHJpbnRpbyAoSnVyaXkgWmF5dHNldiwgTWF4aW0gQ2hlcm55YWspICovCnZhciBmYWJyaWMgPSBmYWJyaWMgfHwgewogIHZlcnNpb246ICIwLjkuMTMiCn07CgppZiAodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcpIHsKICBleHBvcnRzLmZhYnJpYyA9IGZhYnJpYzsKfQoKaWYgKHR5cGVvZiBkb2N1bWVudCAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnKSB7CiAgZmFicmljLmRvY3VtZW50ID0gZG9jdW1lbnQ7CiAgZmFicmljLndpbmRvdyA9IHdpbmRvdzsKfSBlbHNlIHsKICAvLyBhc3N1bWUgd2UncmUgcnVubmluZyB1bmRlciBub2RlLmpzIHdoZW4gZG9jdW1lbnQvd2luZG93IGFyZSBub3QgcHJlc2VudAogIGZhYnJpYy5kb2N1bWVudCA9IHJlcXVpcmUoImpzZG9tIikuanNkb20oIjwhRE9DVFlQRSBodG1sPjxodG1sPjxoZWFkPjwvaGVhZD48Ym9keT48L2JvZHk+PC9odG1sPiIpOwogIGZhYnJpYy53aW5kb3cgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlV2luZG93KCk7Cn0KLyoqCiAqIFRydWUgd2hlbiBpbiBlbnZpcm9ubWVudCB0aGF0IHN1cHBvcnRzIHRvdWNoIGV2ZW50cwogKiBAcHJvcGVydHkgaXNUb3VjaFN1cHBvcnRlZAogKiBAdHlwZSBib29sZWFuCiAqLwoKCmZhYnJpYy5pc1RvdWNoU3VwcG9ydGVkID0gIm9udG91Y2hzdGFydCIgaW4gZmFicmljLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKLyoqCiAqIFRydWUgd2hlbiBpbiBlbnZpcm9ubWVudCB0aGF0J3MgcHJvYmFibHkgTm9kZS5qcwogKiBAcHJvcGVydHkgaXNMaWtlbHlOb2RlCiAqIEB0eXBlIGJvb2xlYW4KICovCgpmYWJyaWMuaXNMaWtlbHlOb2RlID0gdHlwZW9mIEJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCc7Ci8qIQogKiBDb3B5cmlnaHQgKGMpIDIwMDkgU2ltbyBLaW5udW5lbi4KICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKi8KCnZhciBDdWZvbiA9IGZ1bmN0aW9uICgpIHsKICB2YXIgYXBpID0gZnVuY3Rpb24gYXBpKCkgewogICAgcmV0dXJuIGFwaS5yZXBsYWNlLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgfTsKCiAgdmFyIERPTSA9IGFwaS5ET00gPSB7CiAgICByZWFkeTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgY29tcGxldGUgPSBmYWxzZSwKICAgICAgICAgIHJlYWR5U3RhdHVzID0gewogICAgICAgIGxvYWRlZDogMSwKICAgICAgICBjb21wbGV0ZTogMQogICAgICB9OwoKICAgICAgdmFyIHF1ZXVlID0gW10sCiAgICAgICAgICBwZXJmb3JtID0gZnVuY3Rpb24gcGVyZm9ybSgpIHsKICAgICAgICBpZiAoY29tcGxldGUpIHJldHVybjsKICAgICAgICBjb21wbGV0ZSA9IHRydWU7CgogICAgICAgIGZvciAodmFyIGZuOyBmbiA9IHF1ZXVlLnNoaWZ0KCk7IGZuKCkpIHsKICAgICAgICAgIDsKICAgICAgICB9CiAgICAgIH07IC8vIEdlY2tvLCBPcGVyYSwgV2ViS2l0IHIyNjEwMSsKCgogICAgICBpZiAoZmFicmljLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgICBmYWJyaWMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIHBlcmZvcm0sIGZhbHNlKTsKICAgICAgICBmYWJyaWMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BhZ2VzaG93JywgcGVyZm9ybSwgZmFsc2UpOyAvLyBGb3IgY2FjaGVkIEdlY2tvIHBhZ2VzCiAgICAgIH0gLy8gT2xkIFdlYktpdCwgSW50ZXJuZXQgRXhwbG9yZXIKCgogICAgICBpZiAoIWZhYnJpYy53aW5kb3cub3BlcmEgJiYgZmFicmljLmRvY3VtZW50LnJlYWR5U3RhdGUpIChmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVhZHlTdGF0dXNbZmFicmljLmRvY3VtZW50LnJlYWR5U3RhdGVdID8gcGVyZm9ybSgpIDogc2V0VGltZW91dChhcmd1bWVudHMuY2FsbGVlLCAxMCk7CiAgICAgIH0pKCk7IC8vIEludGVybmV0IEV4cGxvcmVyCgogICAgICBpZiAoZmFicmljLmRvY3VtZW50LnJlYWR5U3RhdGUgJiYgZmFicmljLmRvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQpIChmdW5jdGlvbiAoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZhYnJpYy5kb2N1bWVudC5ib2R5LmRvU2Nyb2xsKCdsZWZ0Jyk7CiAgICAgICAgICBwZXJmb3JtKCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgc2V0VGltZW91dChhcmd1bWVudHMuY2FsbGVlLCAxKTsKICAgICAgICB9CiAgICAgIH0pKCk7CiAgICAgIGFkZEV2ZW50KGZhYnJpYy53aW5kb3csICdsb2FkJywgcGVyZm9ybSk7IC8vIEZhbGxiYWNrCgogICAgICByZXR1cm4gZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSBwZXJmb3JtKCk7ZWxzZSBjb21wbGV0ZSA/IGxpc3RlbmVyKCkgOiBxdWV1ZS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfTsKICAgIH0oKQogIH07CiAgdmFyIENTUyA9IGFwaS5DU1MgPSB7CiAgICBTaXplOiBmdW5jdGlvbiBTaXplKHZhbHVlLCBiYXNlKSB7CiAgICAgIHRoaXMudmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsKICAgICAgdGhpcy51bml0ID0gU3RyaW5nKHZhbHVlKS5tYXRjaCgvW2EteiVdKiQvKVswXSB8fCAncHgnOwoKICAgICAgdGhpcy5jb252ZXJ0ID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIC8gYmFzZSAqIHRoaXMudmFsdWU7CiAgICAgIH07CgogICAgICB0aGlzLmNvbnZlcnRGcm9tID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIC8gdGhpcy52YWx1ZSAqIGJhc2U7CiAgICAgIH07CgogICAgICB0aGlzLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlICsgdGhpcy51bml0OwogICAgICB9OwogICAgfSwKICAgIGdldFN0eWxlOiBmdW5jdGlvbiBnZXRTdHlsZShlbCkgewogICAgICByZXR1cm4gbmV3IFN0eWxlKGVsLnN0eWxlKTsKICAgICAgLyoKICAgICAgdmFyIHZpZXcgPSBkb2N1bWVudC5kZWZhdWx0VmlldzsKICAgICAgaWYgKHZpZXcgJiYgdmlldy5nZXRDb21wdXRlZFN0eWxlKSByZXR1cm4gbmV3IFN0eWxlKHZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbCwgbnVsbCkpOwogICAgICBpZiAoZWwuY3VycmVudFN0eWxlKSByZXR1cm4gbmV3IFN0eWxlKGVsLmN1cnJlbnRTdHlsZSk7CiAgICAgIHJldHVybiBuZXcgU3R5bGUoZWwuc3R5bGUpOwogICAgICAqLwogICAgfSwKICAgIHF1b3RlZExpc3Q6IGNhY2hlZChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgLy8gZG9lc24ndCB3b3JrIHByb3Blcmx5IHdpdGggZW1wdHkgcXVvdGVkIHN0cmluZ3MgKCIiKSwgYnV0CiAgICAgIC8vIGl0J3Mgbm90IHdvcnRoIHRoZSBleHRyYSBjb2RlLgogICAgICB2YXIgbGlzdCA9IFtdLAogICAgICAgICAgcmUgPSAvXHMqKChbIiddKShbXHNcU10qP1teXFxdKVwyfFteLF0rKVxzKi9nLAogICAgICAgICAgbWF0Y2g7CgogICAgICB3aGlsZSAobWF0Y2ggPSByZS5leGVjKHZhbHVlKSkgewogICAgICAgIGxpc3QucHVzaChtYXRjaFszXSB8fCBtYXRjaFsxXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBsaXN0OwogICAgfSksCiAgICByZWFkeTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgY29tcGxldGUgPSBmYWxzZTsKCiAgICAgIHZhciBxdWV1ZSA9IFtdLAogICAgICAgICAgcGVyZm9ybSA9IGZ1bmN0aW9uIHBlcmZvcm0oKSB7CiAgICAgICAgY29tcGxldGUgPSB0cnVlOwoKICAgICAgICBmb3IgKHZhciBmbjsgZm4gPSBxdWV1ZS5zaGlmdCgpOyBmbigpKSB7CiAgICAgICAgICA7CiAgICAgICAgfQogICAgICB9OyAvLyBTYWZhcmkgMiBkb2VzIG5vdCBpbmNsdWRlIDxzdHlsZT4gZWxlbWVudHMgaW4gZG9jdW1lbnQuc3R5bGVTaGVldHMuCiAgICAgIC8vIFNhZmFyaSAyIGFsc28gZG9lcyBub3Qgc3VwcG9ydCBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLgoKCiAgICAgIHZhciBzdHlsZUVsZW1lbnRzID0gT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZSA/IGVsZW1lbnRzQnlUYWdOYW1lKCdzdHlsZScpIDogewogICAgICAgIGxlbmd0aDogMAogICAgICB9OwogICAgICB2YXIgbGlua0VsZW1lbnRzID0gZWxlbWVudHNCeVRhZ05hbWUoJ2xpbmsnKTsKICAgICAgRE9NLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBUaGVzZSBjaGVja3MgYXJlIGFjdHVhbGx5IG9ubHkgbmVlZGVkIGZvciBXZWJLaXQtYmFzZWQgYnJvd3NlcnMsIGJ1dCBkb24ndCByZWFsbHkgaHVydCBvdGhlciBicm93c2Vycy4KICAgICAgICB2YXIgbGlua1N0eWxlcyA9IDAsCiAgICAgICAgICAgIGxpbms7CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGlua0VsZW1lbnRzLmxlbmd0aDsgbGluayA9IGxpbmtFbGVtZW50c1tpXSwgaSA8IGw7ICsraSkgewogICAgICAgICAgLy8gV2ViS2l0IGRvZXMgbm90IGxvYWQgYWx0ZXJuYXRlIHN0eWxlc2hlZXRzLgogICAgICAgICAgaWYgKCFsaW5rLmRpc2FibGVkICYmIGxpbmsucmVsLnRvTG93ZXJDYXNlKCkgPT0gJ3N0eWxlc2hlZXQnKSArK2xpbmtTdHlsZXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmFicmljLmRvY3VtZW50LnN0eWxlU2hlZXRzLmxlbmd0aCA+PSBzdHlsZUVsZW1lbnRzLmxlbmd0aCArIGxpbmtTdHlsZXMpIHBlcmZvcm0oKTtlbHNlIHNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwgMTApOwogICAgICB9KTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIGlmIChjb21wbGV0ZSkgbGlzdGVuZXIoKTtlbHNlIHF1ZXVlLnB1c2gobGlzdGVuZXIpOwogICAgICB9OwogICAgfSgpLAogICAgc3VwcG9ydHM6IGZ1bmN0aW9uIHN1cHBvcnRzKHByb3BlcnR5LCB2YWx1ZSkgewogICAgICB2YXIgY2hlY2tlciA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJykuc3R5bGU7CiAgICAgIGlmIChjaGVja2VyW3Byb3BlcnR5XSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZmFsc2U7CiAgICAgIGNoZWNrZXJbcHJvcGVydHldID0gdmFsdWU7CiAgICAgIHJldHVybiBjaGVja2VyW3Byb3BlcnR5XSA9PT0gdmFsdWU7CiAgICB9LAogICAgdGV4dEFsaWduOiBmdW5jdGlvbiB0ZXh0QWxpZ24od29yZCwgc3R5bGUsIHBvc2l0aW9uLCB3b3JkQ291bnQpIHsKICAgICAgaWYgKHN0eWxlLmdldCgndGV4dEFsaWduJykgPT0gJ3JpZ2h0JykgewogICAgICAgIGlmIChwb3NpdGlvbiA+IDApIHdvcmQgPSAnICcgKyB3b3JkOwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgd29yZENvdW50IC0gMSkgd29yZCArPSAnICc7CgogICAgICByZXR1cm4gd29yZDsKICAgIH0sCiAgICB0ZXh0RGVjb3JhdGlvbjogZnVuY3Rpb24gdGV4dERlY29yYXRpb24oZWwsIHN0eWxlKSB7CiAgICAgIGlmICghc3R5bGUpIHN0eWxlID0gdGhpcy5nZXRTdHlsZShlbCk7CiAgICAgIHZhciB0eXBlcyA9IHsKICAgICAgICB1bmRlcmxpbmU6IG51bGwsCiAgICAgICAgb3ZlcmxpbmU6IG51bGwsCiAgICAgICAgJ2xpbmUtdGhyb3VnaCc6IG51bGwKICAgICAgfTsKCiAgICAgIGZvciAodmFyIHNlYXJjaCA9IGVsOyBzZWFyY2gucGFyZW50Tm9kZSAmJiBzZWFyY2gucGFyZW50Tm9kZS5ub2RlVHlwZSA9PSAxOykgewogICAgICAgIHZhciBmb3VuZEFsbCA9IHRydWU7CgogICAgICAgIGZvciAodmFyIHR5cGUgaW4gdHlwZXMpIHsKICAgICAgICAgIGlmICh0eXBlc1t0eXBlXSkgY29udGludWU7CiAgICAgICAgICBpZiAoc3R5bGUuZ2V0KCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YodHlwZSkgIT0gLTEpIHR5cGVzW3R5cGVdID0gc3R5bGUuZ2V0KCdjb2xvcicpOwogICAgICAgICAgZm91bmRBbGwgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChmb3VuZEFsbCkgYnJlYWs7IC8vIHRoaXMgaXMgcmF0aGVyIHVubGlrZWx5IHRvIGhhcHBlbgoKICAgICAgICBzdHlsZSA9IHRoaXMuZ2V0U3R5bGUoc2VhcmNoID0gc2VhcmNoLnBhcmVudE5vZGUpOwogICAgICB9CgogICAgICByZXR1cm4gdHlwZXM7CiAgICB9LAogICAgdGV4dFNoYWRvdzogY2FjaGVkKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT0gJ25vbmUnKSByZXR1cm4gbnVsbDsKICAgICAgdmFyIHNoYWRvd3MgPSBbXSwKICAgICAgICAgIGN1cnJlbnRTaGFkb3cgPSB7fSwKICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgIG9mZkNvdW50ID0gMDsKICAgICAgdmFyIHJlID0gLygjW2EtZjAtOV0rfFthLXpdK1woLio/XCl8W2Etel0rKXwoLT9bXGQuXStbYS16JV0qKXwsL2lnOwoKICAgICAgd2hpbGUgKHJlc3VsdCA9IHJlLmV4ZWModmFsdWUpKSB7CiAgICAgICAgaWYgKHJlc3VsdFswXSA9PSAnLCcpIHsKICAgICAgICAgIHNoYWRvd3MucHVzaChjdXJyZW50U2hhZG93KTsKICAgICAgICAgIGN1cnJlbnRTaGFkb3cgPSB7fSwgb2ZmQ291bnQgPSAwOwogICAgICAgIH0gZWxzZSBpZiAocmVzdWx0WzFdKSB7CiAgICAgICAgICBjdXJyZW50U2hhZG93LmNvbG9yID0gcmVzdWx0WzFdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdXJyZW50U2hhZG93W1snb2ZmWCcsICdvZmZZJywgJ2JsdXInXVtvZmZDb3VudCsrXV0gPSByZXN1bHRbMl07CiAgICAgICAgfQogICAgICB9CgogICAgICBzaGFkb3dzLnB1c2goY3VycmVudFNoYWRvdyk7CiAgICAgIHJldHVybiBzaGFkb3dzOwogICAgfSksCiAgICBjb2xvcjogY2FjaGVkKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICB2YXIgcGFyc2VkID0ge307CiAgICAgIHBhcnNlZC5jb2xvciA9IHZhbHVlLnJlcGxhY2UoL15yZ2JhXCgoLio/KSxccyooW1xkLl0rKVwpLywgZnVuY3Rpb24gKCQwLCAkMSwgJDIpIHsKICAgICAgICBwYXJzZWQub3BhY2l0eSA9IHBhcnNlRmxvYXQoJDIpOwogICAgICAgIHJldHVybiAncmdiKCcgKyAkMSArICcpJzsKICAgICAgfSk7CiAgICAgIHJldHVybiBwYXJzZWQ7CiAgICB9KSwKICAgIHRleHRUcmFuc2Zvcm06IGZ1bmN0aW9uIHRleHRUcmFuc2Zvcm0odGV4dCwgc3R5bGUpIHsKICAgICAgcmV0dXJuIHRleHRbewogICAgICAgIHVwcGVyY2FzZTogJ3RvVXBwZXJDYXNlJywKICAgICAgICBsb3dlcmNhc2U6ICd0b0xvd2VyQ2FzZScKICAgICAgfVtzdHlsZS5nZXQoJ3RleHRUcmFuc2Zvcm0nKV0gfHwgJ3RvU3RyaW5nJ10oKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBGb250KGRhdGEpIHsKICAgIHZhciBmYWNlID0gdGhpcy5mYWNlID0gZGF0YS5mYWNlOwogICAgdGhpcy5nbHlwaHMgPSBkYXRhLmdseXBoczsKICAgIHRoaXMudyA9IGRhdGEudzsKICAgIHRoaXMuYmFzZVNpemUgPSBwYXJzZUludChmYWNlWyd1bml0cy1wZXItZW0nXSwgMTApOwogICAgdGhpcy5mYW1pbHkgPSBmYWNlWydmb250LWZhbWlseSddLnRvTG93ZXJDYXNlKCk7CiAgICB0aGlzLndlaWdodCA9IGZhY2VbJ2ZvbnQtd2VpZ2h0J107CiAgICB0aGlzLnN0eWxlID0gZmFjZVsnZm9udC1zdHlsZSddIHx8ICdub3JtYWwnOwoKICAgIHRoaXMudmlld0JveCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHBhcnRzID0gZmFjZS5iYm94LnNwbGl0KC9ccysvKTsKICAgICAgdmFyIGJveCA9IHsKICAgICAgICBtaW5YOiBwYXJzZUludChwYXJ0c1swXSwgMTApLAogICAgICAgIG1pblk6IHBhcnNlSW50KHBhcnRzWzFdLCAxMCksCiAgICAgICAgbWF4WDogcGFyc2VJbnQocGFydHNbMl0sIDEwKSwKICAgICAgICBtYXhZOiBwYXJzZUludChwYXJ0c1szXSwgMTApCiAgICAgIH07CiAgICAgIGJveC53aWR0aCA9IGJveC5tYXhYIC0gYm94Lm1pblgsIGJveC5oZWlnaHQgPSBib3gubWF4WSAtIGJveC5taW5ZOwoKICAgICAgYm94LnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBbdGhpcy5taW5YLCB0aGlzLm1pblksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XS5qb2luKCcgJyk7CiAgICAgIH07CgogICAgICByZXR1cm4gYm94OwogICAgfSgpOwoKICAgIHRoaXMuYXNjZW50ID0gLXBhcnNlSW50KGZhY2UuYXNjZW50LCAxMCk7CiAgICB0aGlzLmRlc2NlbnQgPSAtcGFyc2VJbnQoZmFjZS5kZXNjZW50LCAxMCk7CiAgICB0aGlzLmhlaWdodCA9IC10aGlzLmFzY2VudCArIHRoaXMuZGVzY2VudDsKICB9CgogIGZ1bmN0aW9uIEZvbnRGYW1pbHkoKSB7CiAgICB2YXIgc3R5bGVzID0ge30sCiAgICAgICAgbWFwcGluZyA9IHsKICAgICAgb2JsaXF1ZTogJ2l0YWxpYycsCiAgICAgIGl0YWxpYzogJ29ibGlxdWUnCiAgICB9OwoKICAgIHRoaXMuYWRkID0gZnVuY3Rpb24gKGZvbnQpIHsKICAgICAgKHN0eWxlc1tmb250LnN0eWxlXSB8fCAoc3R5bGVzW2ZvbnQuc3R5bGVdID0ge30pKVtmb250LndlaWdodF0gPSBmb250OwogICAgfTsKCiAgICB0aGlzLmdldCA9IGZ1bmN0aW9uIChzdHlsZSwgd2VpZ2h0KSB7CiAgICAgIHZhciB3ZWlnaHRzID0gc3R5bGVzW3N0eWxlXSB8fCBzdHlsZXNbbWFwcGluZ1tzdHlsZV1dIHx8IHN0eWxlcy5ub3JtYWwgfHwgc3R5bGVzLml0YWxpYyB8fCBzdHlsZXMub2JsaXF1ZTsKICAgICAgaWYgKCF3ZWlnaHRzKSByZXR1cm4gbnVsbDsgLy8gd2UgZG9uJ3QgaGF2ZSB0byB3b3JyeSBhYm91dCAiYm9sZGVyIiBhbmQgImxpZ2h0ZXIiCiAgICAgIC8vIGJlY2F1c2UgSUUncyBjdXJyZW50U3R5bGUgcmV0dXJucyBhIG51bWVyaWMgdmFsdWUgZm9yIGl0LAogICAgICAvLyBhbmQgb3RoZXIgYnJvd3NlcnMgdXNlIHRoZSBjb21wdXRlZCB2YWx1ZSBhbnl3YXkKCiAgICAgIHdlaWdodCA9IHsKICAgICAgICBub3JtYWw6IDQwMCwKICAgICAgICBib2xkOiA3MDAKICAgICAgfVt3ZWlnaHRdIHx8IHBhcnNlSW50KHdlaWdodCwgMTApOwogICAgICBpZiAod2VpZ2h0c1t3ZWlnaHRdKSByZXR1cm4gd2VpZ2h0c1t3ZWlnaHRdOyAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9mb250cy5odG1sI3Byb3BkZWYtZm9udC13ZWlnaHQKICAgICAgLy8gR2Vja28gdXNlcyB4OTkveDAxIGZvciBsaWdodGVyL2JvbGRlcgoKICAgICAgdmFyIHVwID0gewogICAgICAgIDE6IDEsCiAgICAgICAgOTk6IDAKICAgICAgfVt3ZWlnaHQgJSAxMDBdLAogICAgICAgICAgYWx0cyA9IFtdLAogICAgICAgICAgbWluLAogICAgICAgICAgbWF4OwogICAgICBpZiAodXAgPT09IHVuZGVmaW5lZCkgdXAgPSB3ZWlnaHQgPiA0MDA7CiAgICAgIGlmICh3ZWlnaHQgPT0gNTAwKSB3ZWlnaHQgPSA0MDA7CgogICAgICBmb3IgKHZhciBhbHQgaW4gd2VpZ2h0cykgewogICAgICAgIGFsdCA9IHBhcnNlSW50KGFsdCwgMTApOwogICAgICAgIGlmICghbWluIHx8IGFsdCA8IG1pbikgbWluID0gYWx0OwogICAgICAgIGlmICghbWF4IHx8IGFsdCA+IG1heCkgbWF4ID0gYWx0OwogICAgICAgIGFsdHMucHVzaChhbHQpOwogICAgICB9CgogICAgICBpZiAod2VpZ2h0IDwgbWluKSB3ZWlnaHQgPSBtaW47CiAgICAgIGlmICh3ZWlnaHQgPiBtYXgpIHdlaWdodCA9IG1heDsKICAgICAgYWx0cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuICh1cCA/IGEgPiB3ZWlnaHQgJiYgYiA+IHdlaWdodCA/IGEgPCBiIDogYSA+IGIgOiBhIDwgd2VpZ2h0ICYmIGIgPCB3ZWlnaHQgPyBhID4gYiA6IGEgPCBiKSA/IC0xIDogMTsKICAgICAgfSk7CiAgICAgIHJldHVybiB3ZWlnaHRzW2FsdHNbMF1dOwogICAgfTsKICB9CgogIGZ1bmN0aW9uIEhvdmVySGFuZGxlcigpIHsKICAgIGZ1bmN0aW9uIGNvbnRhaW5zKG5vZGUsIGFub3RoZXJOb2RlKSB7CiAgICAgIGlmIChub2RlLmNvbnRhaW5zKSByZXR1cm4gbm9kZS5jb250YWlucyhhbm90aGVyTm9kZSk7CiAgICAgIHJldHVybiBub2RlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGFub3RoZXJOb2RlKSAmIDE2OwogICAgfQoKICAgIGZ1bmN0aW9uIG9uT3Zlck91dChlKSB7CiAgICAgIHZhciByZWxhdGVkID0gZS5yZWxhdGVkVGFyZ2V0OwogICAgICBpZiAoIXJlbGF0ZWQgfHwgY29udGFpbnModGhpcywgcmVsYXRlZCkpIHJldHVybjsKICAgICAgdHJpZ2dlcih0aGlzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbkVudGVyTGVhdmUoZSkgewogICAgICB0cmlnZ2VyKHRoaXMpOwogICAgfQoKICAgIGZ1bmN0aW9uIHRyaWdnZXIoZWwpIHsKICAgICAgLy8gQSB0aW1lb3V0IGlzIG5lZWRlZCBzbyB0aGF0IHRoZSBldmVudCBjYW4gYWN0dWFsbHkgImhhcHBlbiIKICAgICAgLy8gYmVmb3JlIHJlcGxhY2UgaXMgdHJpZ2dlcmVkLiBUaGlzIGVuc3VyZXMgdGhhdCBzdHlsZXMgYXJlIHVwCiAgICAgIC8vIHRvIGRhdGUuCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGFwaS5yZXBsYWNlKGVsLCBzaGFyZWRTdG9yYWdlLmdldChlbCkub3B0aW9ucywgdHJ1ZSk7CiAgICAgIH0sIDEwKTsKICAgIH0KCiAgICB0aGlzLmF0dGFjaCA9IGZ1bmN0aW9uIChlbCkgewogICAgICBpZiAoZWwub25tb3VzZWVudGVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICBhZGRFdmVudChlbCwgJ21vdXNlb3ZlcicsIG9uT3Zlck91dCk7CiAgICAgICAgYWRkRXZlbnQoZWwsICdtb3VzZW91dCcsIG9uT3Zlck91dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWRkRXZlbnQoZWwsICdtb3VzZWVudGVyJywgb25FbnRlckxlYXZlKTsKICAgICAgICBhZGRFdmVudChlbCwgJ21vdXNlbGVhdmUnLCBvbkVudGVyTGVhdmUpOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gU3RvcmFnZSgpIHsKICAgIHZhciBtYXAgPSB7fSwKICAgICAgICBhdCA9IDA7CgogICAgZnVuY3Rpb24gaWRlbnRpZnkoZWwpIHsKICAgICAgcmV0dXJuIGVsLmN1ZmlkIHx8IChlbC5jdWZpZCA9ICsrYXQpOwogICAgfQoKICAgIHRoaXMuZ2V0ID0gZnVuY3Rpb24gKGVsKSB7CiAgICAgIHZhciBpZCA9IGlkZW50aWZ5KGVsKTsKICAgICAgcmV0dXJuIG1hcFtpZF0gfHwgKG1hcFtpZF0gPSB7fSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gU3R5bGUoc3R5bGUpIHsKICAgIHZhciBjdXN0b20gPSB7fSwKICAgICAgICBzaXplcyA9IHt9OwoKICAgIHRoaXMuZ2V0ID0gZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBjdXN0b21bcHJvcGVydHldICE9IHVuZGVmaW5lZCA/IGN1c3RvbVtwcm9wZXJ0eV0gOiBzdHlsZVtwcm9wZXJ0eV07CiAgICB9OwoKICAgIHRoaXMuZ2V0U2l6ZSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSwgYmFzZSkgewogICAgICByZXR1cm4gc2l6ZXNbcHJvcGVydHldIHx8IChzaXplc1twcm9wZXJ0eV0gPSBuZXcgQ1NTLlNpemUodGhpcy5nZXQocHJvcGVydHkpLCBiYXNlKSk7CiAgICB9OwoKICAgIHRoaXMuZXh0ZW5kID0gZnVuY3Rpb24gKHN0eWxlcykgewogICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdHlsZXMpIHsKICAgICAgICBjdXN0b21bcHJvcGVydHldID0gc3R5bGVzW3Byb3BlcnR5XTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gYWRkRXZlbnQoZWwsIHR5cGUsIGxpc3RlbmVyKSB7CiAgICBpZiAoZWwuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICBlbC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBmYWxzZSk7CiAgICB9IGVsc2UgaWYgKGVsLmF0dGFjaEV2ZW50KSB7CiAgICAgIGVsLmF0dGFjaEV2ZW50KCdvbicgKyB0eXBlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGxpc3RlbmVyLmNhbGwoZWwsIGZhYnJpYy53aW5kb3cuZXZlbnQpOwogICAgICB9KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGF0dGFjaChlbCwgb3B0aW9ucykgewogICAgdmFyIHN0b3JhZ2UgPSBzaGFyZWRTdG9yYWdlLmdldChlbCk7CiAgICBpZiAoc3RvcmFnZS5vcHRpb25zKSByZXR1cm4gZWw7CgogICAgaWYgKG9wdGlvbnMuaG92ZXIgJiYgb3B0aW9ucy5ob3ZlcmFibGVzW2VsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSB7CiAgICAgIGhvdmVySGFuZGxlci5hdHRhY2goZWwpOwogICAgfQoKICAgIHN0b3JhZ2Uub3B0aW9ucyA9IG9wdGlvbnM7CiAgICByZXR1cm4gZWw7CiAgfQoKICBmdW5jdGlvbiBjYWNoZWQoZnVuKSB7CiAgICB2YXIgY2FjaGUgPSB7fTsKICAgIHJldHVybiBmdW5jdGlvbiAoa2V5KSB7CiAgICAgIGlmICghY2FjaGUuaGFzT3duUHJvcGVydHkoa2V5KSkgY2FjaGVba2V5XSA9IGZ1bi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gY2FjaGVba2V5XTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBnZXRGb250KGVsLCBzdHlsZSkgewogICAgaWYgKCFzdHlsZSkgc3R5bGUgPSBDU1MuZ2V0U3R5bGUoZWwpOwogICAgdmFyIGZhbWlsaWVzID0gQ1NTLnF1b3RlZExpc3Qoc3R5bGUuZ2V0KCdmb250RmFtaWx5JykudG9Mb3dlckNhc2UoKSksCiAgICAgICAgZmFtaWx5OwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gZmFtaWxpZXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgIGZhbWlseSA9IGZhbWlsaWVzW2ldOwogICAgICBpZiAoZm9udHNbZmFtaWx5XSkgcmV0dXJuIGZvbnRzW2ZhbWlseV0uZ2V0KHN0eWxlLmdldCgnZm9udFN0eWxlJyksIHN0eWxlLmdldCgnZm9udFdlaWdodCcpKTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZ1bmN0aW9uIGVsZW1lbnRzQnlUYWdOYW1lKHF1ZXJ5KSB7CiAgICByZXR1cm4gZmFicmljLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKHF1ZXJ5KTsKICB9CgogIGZ1bmN0aW9uIG1lcmdlKCkgewogICAgdmFyIG1lcmdlZCA9IHt9LAogICAgICAgIGtleTsKCiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgZm9yIChrZXkgaW4gYXJndW1lbnRzW2ldKSB7CiAgICAgICAgbWVyZ2VkW2tleV0gPSBhcmd1bWVudHNbaV1ba2V5XTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBtZXJnZWQ7CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzKGZvbnQsIHRleHQsIHN0eWxlLCBvcHRpb25zLCBub2RlLCBlbCkgewogICAgdmFyIHNlcGFyYXRlID0gb3B0aW9ucy5zZXBhcmF0ZTsKICAgIGlmIChzZXBhcmF0ZSA9PSAnbm9uZScpIHJldHVybiBlbmdpbmVzW29wdGlvbnMuZW5naW5lXS5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgdmFyIGZyYWdtZW50ID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKICAgICAgICBwcm9jZXNzZWQ7CiAgICB2YXIgcGFydHMgPSB0ZXh0LnNwbGl0KHNlcGFyYXRvcnNbc2VwYXJhdGVdKSwKICAgICAgICBuZWVkc0FsaWduaW5nID0gc2VwYXJhdGUgPT0gJ3dvcmRzJzsKCiAgICBpZiAobmVlZHNBbGlnbmluZyAmJiBIQVNfQlJPS0VOX1JFR0VYUCkgewogICAgICAvLyBAdG9kbyBmaWd1cmUgb3V0IGEgYmV0dGVyIHdheSB0byBkbyB0aGlzCiAgICAgIGlmICgvXlxzLy50ZXN0KHRleHQpKSBwYXJ0cy51bnNoaWZ0KCcnKTsKICAgICAgaWYgKC9ccyQvLnRlc3QodGV4dCkpIHBhcnRzLnB1c2goJycpOwogICAgfQoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFydHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgIHByb2Nlc3NlZCA9IGVuZ2luZXNbb3B0aW9ucy5lbmdpbmVdKGZvbnQsIG5lZWRzQWxpZ25pbmcgPyBDU1MudGV4dEFsaWduKHBhcnRzW2ldLCBzdHlsZSwgaSwgbCkgOiBwYXJ0c1tpXSwgc3R5bGUsIG9wdGlvbnMsIG5vZGUsIGVsLCBpIDwgbCAtIDEpOwogICAgICBpZiAocHJvY2Vzc2VkKSBmcmFnbWVudC5hcHBlbmRDaGlsZChwcm9jZXNzZWQpOwogICAgfQoKICAgIHJldHVybiBmcmFnbWVudDsKICB9CgogIGZ1bmN0aW9uIHJlcGxhY2VFbGVtZW50KGVsLCBvcHRpb25zKSB7CiAgICB2YXIgZm9udCwgc3R5bGUsIG5leHROb2RlLCByZWRyYXc7CgogICAgZm9yICh2YXIgbm9kZSA9IGF0dGFjaChlbCwgb3B0aW9ucykuZmlyc3RDaGlsZDsgbm9kZTsgbm9kZSA9IG5leHROb2RlKSB7CiAgICAgIG5leHROb2RlID0gbm9kZS5uZXh0U2libGluZzsKICAgICAgcmVkcmF3ID0gZmFsc2U7CgogICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSB7CiAgICAgICAgaWYgKCFub2RlLmZpcnN0Q2hpbGQpIGNvbnRpbnVlOwoKICAgICAgICBpZiAoIS9jdWZvbi8udGVzdChub2RlLmNsYXNzTmFtZSkpIHsKICAgICAgICAgIGFyZ3VtZW50cy5jYWxsZWUobm9kZSwgb3B0aW9ucyk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgcmVkcmF3ID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKCFzdHlsZSkgc3R5bGUgPSBDU1MuZ2V0U3R5bGUoZWwpLmV4dGVuZChvcHRpb25zKTsKICAgICAgaWYgKCFmb250KSBmb250ID0gZ2V0Rm9udChlbCwgc3R5bGUpOwogICAgICBpZiAoIWZvbnQpIGNvbnRpbnVlOwoKICAgICAgaWYgKHJlZHJhdykgewogICAgICAgIGVuZ2luZXNbb3B0aW9ucy5lbmdpbmVdKGZvbnQsIG51bGwsIHN0eWxlLCBvcHRpb25zLCBub2RlLCBlbCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciB0ZXh0ID0gbm9kZS5kYXRhOyAvL2ZvciBzb21lIHJlYXNvbiwgdGhlIGNhcnJpYWdlIHJldHVybiBpcyBub3Qgc3RyaXBwZWQgYnkgSUUgYnV0ICJcbiIgaXMsIHNvIGxldCdzIGtlZXAgXHIgYXMgYSBuZXcgbGluZSBtYXJrZXIuLi4KCiAgICAgIGlmICh0eXBlb2YgR192bWxDYW52YXNNYW5hZ2VyICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXHIvZywgIlxuIik7CiAgICAgIH0KCiAgICAgIGlmICh0ZXh0ID09PSAnJykgY29udGludWU7CiAgICAgIHZhciBwcm9jZXNzZWQgPSBwcm9jZXNzKGZvbnQsIHRleHQsIHN0eWxlLCBvcHRpb25zLCBub2RlLCBlbCk7CiAgICAgIGlmIChwcm9jZXNzZWQpIG5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQocHJvY2Vzc2VkLCBub2RlKTtlbHNlIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTsKICAgIH0KICB9CgogIHZhciBIQVNfQlJPS0VOX1JFR0VYUCA9ICcgJy5zcGxpdCgvXHMrLykubGVuZ3RoID09IDA7CiAgdmFyIHNoYXJlZFN0b3JhZ2UgPSBuZXcgU3RvcmFnZSgpOwogIHZhciBob3ZlckhhbmRsZXIgPSBuZXcgSG92ZXJIYW5kbGVyKCk7CiAgdmFyIHJlcGxhY2VIaXN0b3J5ID0gW107CiAgdmFyIGVuZ2luZXMgPSB7fSwKICAgICAgZm9udHMgPSB7fSwKICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7CiAgICBlbmdpbmU6IG51bGwsCiAgICAvL2ZvbnRTY2FsZTogMSwKICAgIC8vZm9udFNjYWxpbmc6IGZhbHNlLAogICAgaG92ZXI6IGZhbHNlLAogICAgaG92ZXJhYmxlczogewogICAgICBhOiB0cnVlCiAgICB9LAogICAgcHJpbnRhYmxlOiB0cnVlLAogICAgLy9yb3RhdGlvbjogMCwKICAgIC8vc2VsZWN0YWJsZTogZmFsc2UsCiAgICBzZWxlY3RvcjogZmFicmljLndpbmRvdy5TaXp6bGUgfHwgZmFicmljLndpbmRvdy5qUXVlcnkgJiYgZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgIHJldHVybiBqUXVlcnkocXVlcnkpOwogICAgfSAvLyBhdm9pZCBub0NvbmZsaWN0IGlzc3VlcwogICAgfHwgZmFicmljLndpbmRvdy5kb2pvICYmIGRvam8ucXVlcnkgfHwgZmFicmljLndpbmRvdy4kJCAmJiBmdW5jdGlvbiAocXVlcnkpIHsKICAgICAgcmV0dXJuICQkKHF1ZXJ5KTsKICAgIH0gfHwgZmFicmljLndpbmRvdy4kICYmIGZ1bmN0aW9uIChxdWVyeSkgewogICAgICByZXR1cm4gJChxdWVyeSk7CiAgICB9IHx8IGZhYnJpYy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsICYmIGZ1bmN0aW9uIChxdWVyeSkgewogICAgICByZXR1cm4gZmFicmljLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwocXVlcnkpOwogICAgfSB8fCBlbGVtZW50c0J5VGFnTmFtZSwKICAgIHNlcGFyYXRlOiAnd29yZHMnLAogICAgLy8gJ25vbmUnIGFuZCAnY2hhcmFjdGVycycgYXJlIGFsc28gYWNjZXB0ZWQKICAgIHRleHRTaGFkb3c6ICdub25lJwogIH07CiAgdmFyIHNlcGFyYXRvcnMgPSB7CiAgICB3b3JkczogL1xzKy8sCiAgICBjaGFyYWN0ZXJzOiAnJwogIH07CgogIGFwaS5ub3cgPSBmdW5jdGlvbiAoKSB7CiAgICBET00ucmVhZHkoKTsKICAgIHJldHVybiBhcGk7CiAgfTsKCiAgYXBpLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY3VycmVudEhpc3RvcnkgPSByZXBsYWNlSGlzdG9yeS5zcGxpY2UoMCwgcmVwbGFjZUhpc3RvcnkubGVuZ3RoKTsKCiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGN1cnJlbnRIaXN0b3J5Lmxlbmd0aDsgaSA8IGw7ICsraSkgewogICAgICBhcGkucmVwbGFjZS5hcHBseShudWxsLCBjdXJyZW50SGlzdG9yeVtpXSk7CiAgICB9CgogICAgcmV0dXJuIGFwaTsKICB9OwoKICBhcGkucmVnaXN0ZXJFbmdpbmUgPSBmdW5jdGlvbiAoaWQsIGVuZ2luZSkgewogICAgaWYgKCFlbmdpbmUpIHJldHVybiBhcGk7CiAgICBlbmdpbmVzW2lkXSA9IGVuZ2luZTsKICAgIHJldHVybiBhcGkuc2V0KCdlbmdpbmUnLCBpZCk7CiAgfTsKCiAgYXBpLnJlZ2lzdGVyRm9udCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgZm9udCA9IG5ldyBGb250KGRhdGEpLAogICAgICAgIGZhbWlseSA9IGZvbnQuZmFtaWx5OwogICAgaWYgKCFmb250c1tmYW1pbHldKSBmb250c1tmYW1pbHldID0gbmV3IEZvbnRGYW1pbHkoKTsKICAgIGZvbnRzW2ZhbWlseV0uYWRkKGZvbnQpOwogICAgcmV0dXJuIGFwaS5zZXQoJ2ZvbnRGYW1pbHknLCAnIicgKyBmYW1pbHkgKyAnIicpOwogIH07CgogIGFwaS5yZXBsYWNlID0gZnVuY3Rpb24gKGVsZW1lbnRzLCBvcHRpb25zLCBpZ25vcmVIaXN0b3J5KSB7CiAgICBvcHRpb25zID0gbWVyZ2UoZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpOwogICAgaWYgKCFvcHRpb25zLmVuZ2luZSkgcmV0dXJuIGFwaTsgLy8gdGhlcmUncyBubyBicm93c2VyIHN1cHBvcnQgc28gd2UnbGwganVzdCBzdG9wIGhlcmUKCiAgICBpZiAodHlwZW9mIG9wdGlvbnMudGV4dFNoYWRvdyA9PSAnc3RyaW5nJyAmJiBvcHRpb25zLnRleHRTaGFkb3cpIG9wdGlvbnMudGV4dFNoYWRvdyA9IENTUy50ZXh0U2hhZG93KG9wdGlvbnMudGV4dFNoYWRvdyk7CiAgICBpZiAoIWlnbm9yZUhpc3RvcnkpIHJlcGxhY2VIaXN0b3J5LnB1c2goYXJndW1lbnRzKTsKICAgIGlmIChlbGVtZW50cy5ub2RlVHlwZSB8fCB0eXBlb2YgZWxlbWVudHMgPT0gJ3N0cmluZycpIGVsZW1lbnRzID0gW2VsZW1lbnRzXTsKICAgIENTUy5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgICAgdmFyIGVsID0gZWxlbWVudHNbaV07CiAgICAgICAgaWYgKHR5cGVvZiBlbCA9PSAnc3RyaW5nJykgYXBpLnJlcGxhY2Uob3B0aW9ucy5zZWxlY3RvcihlbCksIG9wdGlvbnMsIHRydWUpO2Vsc2UgcmVwbGFjZUVsZW1lbnQoZWwsIG9wdGlvbnMpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBhcGk7CiAgfTsKCiAgYXBpLnJlcGxhY2VFbGVtZW50ID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7CiAgICBvcHRpb25zID0gbWVyZ2UoZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpOwogICAgaWYgKHR5cGVvZiBvcHRpb25zLnRleHRTaGFkb3cgPT0gJ3N0cmluZycgJiYgb3B0aW9ucy50ZXh0U2hhZG93KSBvcHRpb25zLnRleHRTaGFkb3cgPSBDU1MudGV4dFNoYWRvdyhvcHRpb25zLnRleHRTaGFkb3cpOwogICAgcmV0dXJuIHJlcGxhY2VFbGVtZW50KGVsLCBvcHRpb25zKTsKICB9OyAvLyA9PT4KCgogIGFwaS5lbmdpbmVzID0gZW5naW5lczsKICBhcGkuZm9udHMgPSBmb250czsKCiAgYXBpLmdldE9wdGlvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gbWVyZ2UoZGVmYXVsdE9wdGlvbnMpOwogIH07IC8vIDw9PQoKCiAgYXBpLnNldCA9IGZ1bmN0aW9uIChvcHRpb24sIHZhbHVlKSB7CiAgICBkZWZhdWx0T3B0aW9uc1tvcHRpb25dID0gdmFsdWU7CiAgICByZXR1cm4gYXBpOwogIH07CgogIHJldHVybiBhcGk7Cn0oKTsKCkN1Zm9uLnJlZ2lzdGVyRW5naW5lKCdjYW52YXMnLCBmdW5jdGlvbiAoKSB7CiAgLy8gU2FmYXJpIDIgZG9lc24ndCBzdXBwb3J0IC5hcHBseSgpIG9uIG5hdGl2ZSBtZXRob2RzCiAgdmFyIEhBU19JTkxJTkVfQkxPQ0sgPSBDdWZvbi5DU1Muc3VwcG9ydHMoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7IC8vIEZpcmVmb3ggMiB3LyBub24tc3RyaWN0IGRvY3R5cGUgKGFsbW9zdCBzdGFuZGFyZHMgbW9kZSkKCiAgdmFyIEhBU19CUk9LRU5fTElORUhFSUdIVCA9ICFIQVNfSU5MSU5FX0JMT0NLICYmIChmYWJyaWMuZG9jdW1lbnQuY29tcGF0TW9kZSA9PSAnQmFja0NvbXBhdCcgfHwgL2ZyYW1lc2V0fHRyYW5zaXRpb25hbC9pLnRlc3QoZmFicmljLmRvY3VtZW50LmRvY3R5cGUucHVibGljSWQpKTsKICB2YXIgc3R5bGVTaGVldCA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogIHN0eWxlU2hlZXQudHlwZSA9ICd0ZXh0L2Nzcyc7CiAgdmFyIHRleHROb2RlID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcuY3Vmb24tY2FudmFze3RleHQtaW5kZW50OjB9JyArICdAbWVkaWEgc2NyZWVuLHByb2plY3Rpb257JyArICcuY3Vmb24tY2FudmFze2Rpc3BsYXk6aW5saW5lO2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO3ZlcnRpY2FsLWFsaWduOm1pZGRsZScgKyAoSEFTX0JST0tFTl9MSU5FSEVJR0hUID8gJycgOiAnO2ZvbnQtc2l6ZToxcHg7bGluZS1oZWlnaHQ6MXB4JykgKyAnfS5jdWZvbi1jYW52YXMgLmN1Zm9uLWFsdHtkaXNwbGF5Oi1tb3otaW5saW5lLWJveDtkaXNwbGF5OmlubGluZS1ibG9jazt3aWR0aDowO2hlaWdodDowO292ZXJmbG93OmhpZGRlbn0nICsgKEhBU19JTkxJTkVfQkxPQ0sgPyAnLmN1Zm9uLWNhbnZhcyBjYW52YXN7cG9zaXRpb246cmVsYXRpdmV9JyA6ICcuY3Vmb24tY2FudmFzIGNhbnZhc3twb3NpdGlvbjphYnNvbHV0ZX0nKSArICd9JyArICdAbWVkaWEgcHJpbnR7JyArICcuY3Vmb24tY2FudmFze3BhZGRpbmc6MCAhaW1wb3J0YW50fScgKyAnLmN1Zm9uLWNhbnZhcyBjYW52YXN7ZGlzcGxheTpub25lfScgKyAnLmN1Zm9uLWNhbnZhcyAuY3Vmb24tYWx0e2Rpc3BsYXk6aW5saW5lfScgKyAnfScpOwoKICB0cnkgewogICAgc3R5bGVTaGVldC5hcHBlbmRDaGlsZCh0ZXh0Tm9kZSk7CiAgfSBjYXRjaCAoZSkgewogICAgLy9JRTgtIGNhbid0IGRvIHRoaXMuLi4KICAgIHN0eWxlU2hlZXQuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQvY3NzIik7CiAgICBzdHlsZVNoZWV0LnN0eWxlU2hlZXQuY3NzVGV4dCA9IHRleHROb2RlLmRhdGE7CiAgfQoKICBmYWJyaWMuZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzdHlsZVNoZWV0KTsKCiAgZnVuY3Rpb24gZ2VuZXJhdGVGcm9tVk1MKHBhdGgsIGNvbnRleHQpIHsKICAgIHZhciBhdFggPSAwLAogICAgICAgIGF0WSA9IDA7CiAgICB2YXIgY29kZSA9IFtdLAogICAgICAgIHJlID0gLyhbbXJ2eGVdKShbXmEtel0qKS9nLAogICAgICAgIG1hdGNoOwoKICAgIGdlbmVyYXRlOiBmb3IgKHZhciBpID0gMDsgbWF0Y2ggPSByZS5leGVjKHBhdGgpOyArK2kpIHsKICAgICAgdmFyIGMgPSBtYXRjaFsyXS5zcGxpdCgnLCcpOwoKICAgICAgc3dpdGNoIChtYXRjaFsxXSkgewogICAgICAgIGNhc2UgJ3YnOgogICAgICAgICAgY29kZVtpXSA9IHsKICAgICAgICAgICAgbTogJ2JlemllckN1cnZlVG8nLAogICAgICAgICAgICBhOiBbYXRYICsgfn5jWzBdLCBhdFkgKyB+fmNbMV0sIGF0WCArIH5+Y1syXSwgYXRZICsgfn5jWzNdLCBhdFggKz0gfn5jWzRdLCBhdFkgKz0gfn5jWzVdXQogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdyJzoKICAgICAgICAgIGNvZGVbaV0gPSB7CiAgICAgICAgICAgIG06ICdsaW5lVG8nLAogICAgICAgICAgICBhOiBbYXRYICs9IH5+Y1swXSwgYXRZICs9IH5+Y1sxXV0KICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnbSc6CiAgICAgICAgICBjb2RlW2ldID0gewogICAgICAgICAgICBtOiAnbW92ZVRvJywKICAgICAgICAgICAgYTogW2F0WCA9IH5+Y1swXSwgYXRZID0gfn5jWzFdXQogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICd4JzoKICAgICAgICAgIGNvZGVbaV0gPSB7CiAgICAgICAgICAgIG06ICdjbG9zZVBhdGgnLAogICAgICAgICAgICBhOiBbXQogICAgICAgICAgfTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdlJzoKICAgICAgICAgIGJyZWFrIGdlbmVyYXRlOwogICAgICB9CgogICAgICBjb250ZXh0W2NvZGVbaV0ubV0uYXBwbHkoY29udGV4dCwgY29kZVtpXS5hKTsKICAgIH0KCiAgICByZXR1cm4gY29kZTsKICB9CgogIGZ1bmN0aW9uIGludGVycHJldChjb2RlLCBjb250ZXh0KSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNvZGUubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgIHZhciBsaW5lID0gY29kZVtpXTsKICAgICAgY29udGV4dFtsaW5lLm1dLmFwcGx5KGNvbnRleHQsIGxpbmUuYSk7CiAgICB9CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gKGZvbnQsIHRleHQsIHN0eWxlLCBvcHRpb25zLCBub2RlLCBlbCkgewogICAgdmFyIHJlZHJhdyA9IHRleHQgPT09IG51bGw7CiAgICB2YXIgdmlld0JveCA9IGZvbnQudmlld0JveDsKICAgIHZhciBzaXplID0gc3R5bGUuZ2V0U2l6ZSgnZm9udFNpemUnLCBmb250LmJhc2VTaXplKTsKICAgIHZhciBsZXR0ZXJTcGFjaW5nID0gc3R5bGUuZ2V0KCdsZXR0ZXJTcGFjaW5nJyk7CiAgICBsZXR0ZXJTcGFjaW5nID0gbGV0dGVyU3BhY2luZyA9PSAnbm9ybWFsJyA/IDAgOiBzaXplLmNvbnZlcnRGcm9tKHBhcnNlSW50KGxldHRlclNwYWNpbmcsIDEwKSk7CiAgICB2YXIgZXhwYW5kVG9wID0gMCwKICAgICAgICBleHBhbmRSaWdodCA9IDAsCiAgICAgICAgZXhwYW5kQm90dG9tID0gMCwKICAgICAgICBleHBhbmRMZWZ0ID0gMDsKICAgIHZhciBzaGFkb3dzID0gb3B0aW9ucy50ZXh0U2hhZG93LAogICAgICAgIHNoYWRvd09mZnNldHMgPSBbXTsKICAgIEN1Zm9uLnRleHRPcHRpb25zLnNoYWRvd09mZnNldHMgPSBbXTsKICAgIEN1Zm9uLnRleHRPcHRpb25zLnNoYWRvd3MgPSBudWxsOwoKICAgIGlmIChzaGFkb3dzKSB7CiAgICAgIEN1Zm9uLnRleHRPcHRpb25zLnNoYWRvd3MgPSBzaGFkb3dzOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzaGFkb3dzLmxlbmd0aDsgaSA8IGw7ICsraSkgewogICAgICAgIHZhciBzaGFkb3cgPSBzaGFkb3dzW2ldOwogICAgICAgIHZhciB4ID0gc2l6ZS5jb252ZXJ0RnJvbShwYXJzZUZsb2F0KHNoYWRvdy5vZmZYKSk7CiAgICAgICAgdmFyIHkgPSBzaXplLmNvbnZlcnRGcm9tKHBhcnNlRmxvYXQoc2hhZG93Lm9mZlkpKTsKICAgICAgICBzaGFkb3dPZmZzZXRzW2ldID0gW3gsIHldOyAvL2lmICh5IDwgZXhwYW5kVG9wKSBleHBhbmRUb3AgPSB5OwogICAgICAgIC8vaWYgKHggPiBleHBhbmRSaWdodCkgZXhwYW5kUmlnaHQgPSB4OwogICAgICAgIC8vaWYgKHkgPiBleHBhbmRCb3R0b20pIGV4cGFuZEJvdHRvbSA9IHk7CiAgICAgICAgLy9pZiAoeCA8IGV4cGFuZExlZnQpIGV4cGFuZExlZnQgPSB4OwogICAgICB9CiAgICB9CgogICAgdmFyIGNoYXJzID0gQ3Vmb24uQ1NTLnRleHRUcmFuc2Zvcm0ocmVkcmF3ID8gbm9kZS5hbHQgOiB0ZXh0LCBzdHlsZSkuc3BsaXQoJycpOwogICAgdmFyIHdpZHRoID0gMCwKICAgICAgICBsYXN0V2lkdGggPSBudWxsOwogICAgdmFyIG1heFdpZHRoID0gMCwKICAgICAgICBsaW5lcyA9IDEsCiAgICAgICAgbGluZVdpZHRocyA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2hhcnMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgIGlmIChjaGFyc1tpXSA9PT0gJ1xuJykgewogICAgICAgIGxpbmVzKys7CgogICAgICAgIGlmICh3aWR0aCA+IG1heFdpZHRoKSB7CiAgICAgICAgICBtYXhXaWR0aCA9IHdpZHRoOwogICAgICAgIH0KCiAgICAgICAgbGluZVdpZHRocy5wdXNoKHdpZHRoKTsKICAgICAgICB3aWR0aCA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciBnbHlwaCA9IGZvbnQuZ2x5cGhzW2NoYXJzW2ldXSB8fCBmb250Lm1pc3NpbmdHbHlwaDsKICAgICAgaWYgKCFnbHlwaCkgY29udGludWU7CiAgICAgIHdpZHRoICs9IGxhc3RXaWR0aCA9IE51bWJlcihnbHlwaC53IHx8IGZvbnQudykgKyBsZXR0ZXJTcGFjaW5nOwogICAgfQoKICAgIGxpbmVXaWR0aHMucHVzaCh3aWR0aCk7CiAgICB3aWR0aCA9IE1hdGgubWF4KG1heFdpZHRoLCB3aWR0aCk7CiAgICB2YXIgbGluZU9mZnNldHMgPSBbXTsKCiAgICBmb3IgKHZhciBpID0gbGluZVdpZHRocy5sZW5ndGg7IGktLTspIHsKICAgICAgbGluZU9mZnNldHNbaV0gPSB3aWR0aCAtIGxpbmVXaWR0aHNbaV07CiAgICB9CgogICAgaWYgKGxhc3RXaWR0aCA9PT0gbnVsbCkgcmV0dXJuIG51bGw7IC8vIHRoZXJlJ3Mgbm90aGluZyB0byByZW5kZXIKCiAgICBleHBhbmRSaWdodCArPSB2aWV3Qm94LndpZHRoIC0gbGFzdFdpZHRoOwogICAgZXhwYW5kTGVmdCArPSB2aWV3Qm94Lm1pblg7CiAgICB2YXIgd3JhcHBlciwgY2FudmFzOwoKICAgIGlmIChyZWRyYXcpIHsKICAgICAgd3JhcHBlciA9IG5vZGU7CiAgICAgIGNhbnZhcyA9IG5vZGUuZmlyc3RDaGlsZDsKICAgIH0gZWxzZSB7CiAgICAgIHdyYXBwZXIgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICB3cmFwcGVyLmNsYXNzTmFtZSA9ICdjdWZvbiBjdWZvbi1jYW52YXMnOwogICAgICB3cmFwcGVyLmFsdCA9IHRleHQ7CiAgICAgIGNhbnZhcyA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChjYW52YXMpOwoKICAgICAgaWYgKG9wdGlvbnMucHJpbnRhYmxlKSB7CiAgICAgICAgdmFyIHByaW50ID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICBwcmludC5jbGFzc05hbWUgPSAnY3Vmb24tYWx0JzsKICAgICAgICBwcmludC5hcHBlbmRDaGlsZChmYWJyaWMuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOwogICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQocHJpbnQpOwogICAgICB9CiAgICB9CgogICAgdmFyIHdTdHlsZSA9IHdyYXBwZXIuc3R5bGU7CiAgICB2YXIgY1N0eWxlID0gY2FudmFzLnN0eWxlIHx8IHt9OwogICAgdmFyIGhlaWdodCA9IHNpemUuY29udmVydCh2aWV3Qm94LmhlaWdodCAtIGV4cGFuZFRvcCArIGV4cGFuZEJvdHRvbSk7CiAgICB2YXIgcm91bmRlZEhlaWdodCA9IE1hdGguY2VpbChoZWlnaHQpOwogICAgdmFyIHJvdW5kaW5nRmFjdG9yID0gcm91bmRlZEhlaWdodCAvIGhlaWdodDsKICAgIGNhbnZhcy53aWR0aCA9IE1hdGguY2VpbChzaXplLmNvbnZlcnQod2lkdGggKyBleHBhbmRSaWdodCAtIGV4cGFuZExlZnQpICogcm91bmRpbmdGYWN0b3IpOwogICAgY2FudmFzLmhlaWdodCA9IHJvdW5kZWRIZWlnaHQ7CiAgICBleHBhbmRUb3AgKz0gdmlld0JveC5taW5ZOwogICAgY1N0eWxlLnRvcCA9IE1hdGgucm91bmQoc2l6ZS5jb252ZXJ0KGV4cGFuZFRvcCAtIGZvbnQuYXNjZW50KSkgKyAncHgnOwogICAgY1N0eWxlLmxlZnQgPSBNYXRoLnJvdW5kKHNpemUuY29udmVydChleHBhbmRMZWZ0KSkgKyAncHgnOwoKICAgIHZhciBfd2lkdGggPSBNYXRoLmNlaWwoc2l6ZS5jb252ZXJ0KHdpZHRoICogcm91bmRpbmdGYWN0b3IpKTsKCiAgICB2YXIgd3JhcHBlcldpZHRoID0gX3dpZHRoICsgJ3B4JzsKCiAgICB2YXIgX2hlaWdodCA9IHNpemUuY29udmVydChmb250LmhlaWdodCk7CgogICAgdmFyIHRvdGFsTGluZUhlaWdodCA9IChvcHRpb25zLmxpbmVIZWlnaHQgLSAxKSAqIHNpemUuY29udmVydCgtZm9udC5hc2NlbnQgLyA1KSAqIChsaW5lcyAtIDEpOwogICAgQ3Vmb24udGV4dE9wdGlvbnMud2lkdGggPSBfd2lkdGg7CiAgICBDdWZvbi50ZXh0T3B0aW9ucy5oZWlnaHQgPSBfaGVpZ2h0ICogbGluZXMgKyB0b3RhbExpbmVIZWlnaHQ7CiAgICBDdWZvbi50ZXh0T3B0aW9ucy5saW5lcyA9IGxpbmVzOwogICAgQ3Vmb24udGV4dE9wdGlvbnMudG90YWxMaW5lSGVpZ2h0ID0gdG90YWxMaW5lSGVpZ2h0OwoKICAgIGlmIChIQVNfSU5MSU5FX0JMT0NLKSB7CiAgICAgIHdTdHlsZS53aWR0aCA9IHdyYXBwZXJXaWR0aDsKICAgICAgd1N0eWxlLmhlaWdodCA9IF9oZWlnaHQgKyAncHgnOwogICAgfSBlbHNlIHsKICAgICAgd1N0eWxlLnBhZGRpbmdMZWZ0ID0gd3JhcHBlcldpZHRoOwogICAgICB3U3R5bGUucGFkZGluZ0JvdHRvbSA9IF9oZWlnaHQgLSAxICsgJ3B4JzsKICAgIH0KCiAgICB2YXIgZyA9IEN1Zm9uLnRleHRPcHRpb25zLmNvbnRleHQgfHwgY2FudmFzLmdldENvbnRleHQoJzJkJyksCiAgICAgICAgc2NhbGUgPSByb3VuZGVkSGVpZ2h0IC8gdmlld0JveC5oZWlnaHQ7CiAgICBDdWZvbi50ZXh0T3B0aW9ucy5mb250QXNjZW50ID0gZm9udC5hc2NlbnQgKiBzY2FsZTsKICAgIEN1Zm9uLnRleHRPcHRpb25zLmJvdW5kYXJpZXMgPSBudWxsOwoKICAgIGZvciAodmFyIG9mZnNldHMgPSBDdWZvbi50ZXh0T3B0aW9ucy5zaGFkb3dPZmZzZXRzLCBpID0gc2hhZG93T2Zmc2V0cy5sZW5ndGg7IGktLTspIHsKICAgICAgb2Zmc2V0c1tpXSA9IFtzaGFkb3dPZmZzZXRzW2ldWzBdICogc2NhbGUsIHNoYWRvd09mZnNldHNbaV1bMV0gKiBzY2FsZV07CiAgICB9CgogICAgZy5zYXZlKCk7CiAgICBnLnNjYWxlKHNjYWxlLCBzY2FsZSk7CiAgICBnLnRyYW5zbGF0ZSggLy8gd2UncmUgYXQgdGhlIGNlbnRlciBvZiBhbiBvYmplY3QgYW5kIG5lZWQgdG8ganVtcCB0byB0aGUgdG9wIGxlZnQgY29ybmVyCiAgICAvLyB3aGVyZSBmaXJzdCBjaGFyYWN0ZXIgaXMgdG8gYmUgZHJhd24KICAgIC1leHBhbmRMZWZ0IC0gMSAvIHNjYWxlICogY2FudmFzLndpZHRoIC8gMiArIChDdWZvbi5mb250c1tmb250LmZhbWlseV0ub2Zmc2V0TGVmdCB8fCAwKSwgLWV4cGFuZFRvcCAtIEN1Zm9uLnRleHRPcHRpb25zLmhlaWdodCAvIHNjYWxlIC8gMiArIChDdWZvbi5mb250c1tmb250LmZhbWlseV0ub2Zmc2V0VG9wIHx8IDApKTsKICAgIGcubGluZVdpZHRoID0gZm9udC5mYWNlWyd1bmRlcmxpbmUtdGhpY2tuZXNzJ107CiAgICBnLnNhdmUoKTsKCiAgICBmdW5jdGlvbiBsaW5lKHksIGNvbG9yKSB7CiAgICAgIGcuc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgICAgZy5iZWdpblBhdGgoKTsKICAgICAgZy5tb3ZlVG8oMCwgeSk7CiAgICAgIGcubGluZVRvKHdpZHRoLCB5KTsKICAgICAgZy5zdHJva2UoKTsKICAgIH0KCiAgICB2YXIgdGV4dERlY29yYXRpb24gPSBDdWZvbi5nZXRUZXh0RGVjb3JhdGlvbihvcHRpb25zKSwKICAgICAgICBpc0l0YWxpYyA9IG9wdGlvbnMuZm9udFN0eWxlID09PSAnaXRhbGljJzsKCiAgICBmdW5jdGlvbiByZW5kZXJCYWNrZ3JvdW5kKCkgewogICAgICBnLnNhdmUoKTsKICAgICAgZy5maWxsU3R5bGUgPSBvcHRpb25zLmJhY2tncm91bmRDb2xvcjsKICAgICAgdmFyIGxlZnQgPSAwLAogICAgICAgICAgbGluZU51bSA9IDAsCiAgICAgICAgICBib3VuZGFyaWVzID0gW3sKICAgICAgICBsZWZ0OiAwCiAgICAgIH1dOwoKICAgICAgaWYgKG9wdGlvbnMudGV4dEFsaWduID09PSAncmlnaHQnKSB7CiAgICAgICAgZy50cmFuc2xhdGUobGluZU9mZnNldHNbbGluZU51bV0sIDApOwogICAgICAgIGJvdW5kYXJpZXNbMF0ubGVmdCA9IGxpbmVPZmZzZXRzW2xpbmVOdW1dICogc2NhbGU7CiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy50ZXh0QWxpZ24gPT09ICdjZW50ZXInKSB7CiAgICAgICAgZy50cmFuc2xhdGUobGluZU9mZnNldHNbbGluZU51bV0gLyAyLCAwKTsKICAgICAgICBib3VuZGFyaWVzWzBdLmxlZnQgPSBsaW5lT2Zmc2V0c1tsaW5lTnVtXSAvIDIgKiBzY2FsZTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGFycy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICBpZiAoY2hhcnNbaV0gPT09ICdcbicpIHsKICAgICAgICAgIGxpbmVOdW0rKzsKICAgICAgICAgIHZhciB0b3BPZmZzZXQgPSAtZm9udC5hc2NlbnQgLSBmb250LmFzY2VudCAvIDUgKiBvcHRpb25zLmxpbmVIZWlnaHQ7CiAgICAgICAgICB2YXIgYm91bmRhcnkgPSBib3VuZGFyaWVzW2JvdW5kYXJpZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICB2YXIgbmV4dEJvdW5kYXJ5ID0gewogICAgICAgICAgICBsZWZ0OiAwCiAgICAgICAgICB9OwogICAgICAgICAgYm91bmRhcnkud2lkdGggPSBsZWZ0ICogc2NhbGU7CiAgICAgICAgICBib3VuZGFyeS5oZWlnaHQgPSAoLWZvbnQuYXNjZW50ICsgZm9udC5kZXNjZW50KSAqIHNjYWxlOwoKICAgICAgICAgIGlmIChvcHRpb25zLnRleHRBbGlnbiA9PT0gJ3JpZ2h0JykgewogICAgICAgICAgICBnLnRyYW5zbGF0ZSgtd2lkdGgsIHRvcE9mZnNldCk7CiAgICAgICAgICAgIGcudHJhbnNsYXRlKGxpbmVPZmZzZXRzW2xpbmVOdW1dLCAwKTsKICAgICAgICAgICAgbmV4dEJvdW5kYXJ5LmxlZnQgPSBsaW5lT2Zmc2V0c1tsaW5lTnVtXSAqIHNjYWxlOwogICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnRleHRBbGlnbiA9PT0gJ2NlbnRlcicpIHsKICAgICAgICAgICAgLy8gb2Zmc2V0IHRvIHRoZSBzdGFydCBvZiB0ZXh0IGluIHByZXZpb3VzIGxpbmUgQU5EIGhhbGYgb2YgaXRzIG9mZnNldAogICAgICAgICAgICAvLyAoZXNzZW50aWFsbHkgbW92aW5nIGNhcmV0IHRvIHRoZSBsZWZ0IGVkZ2Ugb2YgYm91bmRpbmcgYm94KQogICAgICAgICAgICBnLnRyYW5zbGF0ZSgtbGVmdCAtIGxpbmVPZmZzZXRzW2xpbmVOdW0gLSAxXSAvIDIsIHRvcE9mZnNldCk7CiAgICAgICAgICAgIGcudHJhbnNsYXRlKGxpbmVPZmZzZXRzW2xpbmVOdW1dIC8gMiwgMCk7CiAgICAgICAgICAgIG5leHRCb3VuZGFyeS5sZWZ0ID0gbGluZU9mZnNldHNbbGluZU51bV0gLyAyICogc2NhbGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBnLnRyYW5zbGF0ZSgtbGVmdCwgdG9wT2Zmc2V0KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qIHB1c2ggbmV4dCBib3VuZGFyeSAoZm9yIHRoZSBuZXh0IGxpbmUpICovCgoKICAgICAgICAgIGJvdW5kYXJpZXMucHVzaChuZXh0Qm91bmRhcnkpOwogICAgICAgICAgbGVmdCA9IDA7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHZhciBnbHlwaCA9IGZvbnQuZ2x5cGhzW2NoYXJzW2ldXSB8fCBmb250Lm1pc3NpbmdHbHlwaDsKICAgICAgICBpZiAoIWdseXBoKSBjb250aW51ZTsKICAgICAgICB2YXIgY2hhcldpZHRoID0gTnVtYmVyKGdseXBoLncgfHwgZm9udC53KSArIGxldHRlclNwYWNpbmc7IC8vIG9ubHkgZHJhdyBiYWNrZ3JvdW5kIHdoZW4gdGhlcmUncyBzb21lIGtpbmQgb2YgdmFsdWUKCiAgICAgICAgaWYgKG9wdGlvbnMuYmFja2dyb3VuZENvbG9yKSB7CiAgICAgICAgICBnLnNhdmUoKTsKICAgICAgICAgIGcudHJhbnNsYXRlKDAsIGZvbnQuYXNjZW50KTsKICAgICAgICAgIGcuZmlsbFJlY3QoMCwgMCwgY2hhcldpZHRoICsgMTAsIC1mb250LmFzY2VudCArIGZvbnQuZGVzY2VudCk7CiAgICAgICAgICBnLnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGcudHJhbnNsYXRlKGNoYXJXaWR0aCwgMCk7CiAgICAgICAgbGVmdCArPSBjaGFyV2lkdGg7CgogICAgICAgIGlmIChpID09IGwgLSAxKSB7CiAgICAgICAgICBib3VuZGFyaWVzW2JvdW5kYXJpZXMubGVuZ3RoIC0gMV0ud2lkdGggPSBsZWZ0ICogc2NhbGU7CiAgICAgICAgICBib3VuZGFyaWVzW2JvdW5kYXJpZXMubGVuZ3RoIC0gMV0uaGVpZ2h0ID0gKC1mb250LmFzY2VudCArIGZvbnQuZGVzY2VudCkgKiBzY2FsZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGcucmVzdG9yZSgpOwogICAgICBDdWZvbi50ZXh0T3B0aW9ucy5ib3VuZGFyaWVzID0gYm91bmRhcmllczsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXJUZXh0KGNvbG9yKSB7CiAgICAgIGcuZmlsbFN0eWxlID0gY29sb3IgfHwgQ3Vmb24udGV4dE9wdGlvbnMuY29sb3IgfHwgc3R5bGUuZ2V0KCdjb2xvcicpOwogICAgICB2YXIgbGVmdCA9IDAsCiAgICAgICAgICBsaW5lTnVtID0gMDsKCiAgICAgIGlmIChvcHRpb25zLnRleHRBbGlnbiA9PT0gJ3JpZ2h0JykgewogICAgICAgIGcudHJhbnNsYXRlKGxpbmVPZmZzZXRzW2xpbmVOdW1dLCAwKTsKICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnRleHRBbGlnbiA9PT0gJ2NlbnRlcicpIHsKICAgICAgICBnLnRyYW5zbGF0ZShsaW5lT2Zmc2V0c1tsaW5lTnVtXSAvIDIsIDApOwogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNoYXJzLmxlbmd0aDsgaSA8IGw7ICsraSkgewogICAgICAgIGlmIChjaGFyc1tpXSA9PT0gJ1xuJykgewogICAgICAgICAgbGluZU51bSsrOwogICAgICAgICAgdmFyIHRvcE9mZnNldCA9IC1mb250LmFzY2VudCAtIGZvbnQuYXNjZW50IC8gNSAqIG9wdGlvbnMubGluZUhlaWdodDsKCiAgICAgICAgICBpZiAob3B0aW9ucy50ZXh0QWxpZ24gPT09ICdyaWdodCcpIHsKICAgICAgICAgICAgZy50cmFuc2xhdGUoLXdpZHRoLCB0b3BPZmZzZXQpOwogICAgICAgICAgICBnLnRyYW5zbGF0ZShsaW5lT2Zmc2V0c1tsaW5lTnVtXSwgMCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMudGV4dEFsaWduID09PSAnY2VudGVyJykgewogICAgICAgICAgICAvLyBvZmZzZXQgdG8gdGhlIHN0YXJ0IG9mIHRleHQgaW4gcHJldmlvdXMgbGluZSBBTkQgaGFsZiBvZiBpdHMgb2Zmc2V0CiAgICAgICAgICAgIC8vIChlc3NlbnRpYWxseSBtb3ZpbmcgY2FyZXQgdG8gdGhlIGxlZnQgZWRnZSBvZiBib3VuZGluZyBib3gpCiAgICAgICAgICAgIGcudHJhbnNsYXRlKC1sZWZ0IC0gbGluZU9mZnNldHNbbGluZU51bSAtIDFdIC8gMiwgdG9wT2Zmc2V0KTsKICAgICAgICAgICAgZy50cmFuc2xhdGUobGluZU9mZnNldHNbbGluZU51bV0gLyAyLCAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGcudHJhbnNsYXRlKC1sZWZ0LCB0b3BPZmZzZXQpOwogICAgICAgICAgfQoKICAgICAgICAgIGxlZnQgPSAwOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgZ2x5cGggPSBmb250LmdseXBoc1tjaGFyc1tpXV0gfHwgZm9udC5taXNzaW5nR2x5cGg7CiAgICAgICAgaWYgKCFnbHlwaCkgY29udGludWU7CiAgICAgICAgdmFyIGNoYXJXaWR0aCA9IE51bWJlcihnbHlwaC53IHx8IGZvbnQudykgKyBsZXR0ZXJTcGFjaW5nOwoKICAgICAgICBpZiAodGV4dERlY29yYXRpb24pIHsKICAgICAgICAgIGcuc2F2ZSgpOwogICAgICAgICAgZy5zdHJva2VTdHlsZSA9IGcuZmlsbFN0eWxlOyAvLyBhZGQgMnggbW9yZSB0aGlja25lc3Mg4oCUIGNsb3NlciB0byBTVkcgcmVuZGVyaW5nCgogICAgICAgICAgZy5saW5lV2lkdGggKz0gZy5saW5lV2lkdGg7CiAgICAgICAgICBnLmJlZ2luUGF0aCgpOwoKICAgICAgICAgIGlmICh0ZXh0RGVjb3JhdGlvbi51bmRlcmxpbmUpIHsKICAgICAgICAgICAgZy5tb3ZlVG8oMCwgLWZvbnQuZmFjZVsndW5kZXJsaW5lLXBvc2l0aW9uJ10gKyAwLjUpOwogICAgICAgICAgICBnLmxpbmVUbyhjaGFyV2lkdGgsIC1mb250LmZhY2VbJ3VuZGVybGluZS1wb3NpdGlvbiddICsgMC41KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGV4dERlY29yYXRpb24ub3ZlcmxpbmUpIHsKICAgICAgICAgICAgZy5tb3ZlVG8oMCwgZm9udC5hc2NlbnQgKyAwLjUpOwogICAgICAgICAgICBnLmxpbmVUbyhjaGFyV2lkdGgsIGZvbnQuYXNjZW50ICsgMC41KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGV4dERlY29yYXRpb25bJ2xpbmUtdGhyb3VnaCddKSB7CiAgICAgICAgICAgIGcubW92ZVRvKDAsIC1mb250LmRlc2NlbnQgKyAwLjUpOwogICAgICAgICAgICBnLmxpbmVUbyhjaGFyV2lkdGgsIC1mb250LmRlc2NlbnQgKyAwLjUpOwogICAgICAgICAgfQoKICAgICAgICAgIGcuc3Ryb2tlKCk7CiAgICAgICAgICBnLnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc0l0YWxpYykgewogICAgICAgICAgZy5zYXZlKCk7CiAgICAgICAgICBnLnRyYW5zZm9ybSgxLCAwLCAtMC4yNSwgMSwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICBnLmJlZ2luUGF0aCgpOwoKICAgICAgICBpZiAoZ2x5cGguZCkgewogICAgICAgICAgaWYgKGdseXBoLmNvZGUpIGludGVycHJldChnbHlwaC5jb2RlLCBnKTtlbHNlIGdseXBoLmNvZGUgPSBnZW5lcmF0ZUZyb21WTUwoJ20nICsgZ2x5cGguZCwgZyk7CiAgICAgICAgfQoKICAgICAgICBnLmZpbGwoKTsKCiAgICAgICAgaWYgKG9wdGlvbnMuc3Ryb2tlU3R5bGUpIHsKICAgICAgICAgIGcuY2xvc2VQYXRoKCk7CiAgICAgICAgICBnLnNhdmUoKTsKICAgICAgICAgIGcubGluZVdpZHRoID0gb3B0aW9ucy5zdHJva2VXaWR0aDsKICAgICAgICAgIGcuc3Ryb2tlU3R5bGUgPSBvcHRpb25zLnN0cm9rZVN0eWxlOwogICAgICAgICAgZy5zdHJva2UoKTsKICAgICAgICAgIGcucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzSXRhbGljKSB7CiAgICAgICAgICBnLnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGcudHJhbnNsYXRlKGNoYXJXaWR0aCwgMCk7CiAgICAgICAgbGVmdCArPSBjaGFyV2lkdGg7CiAgICAgIH0KICAgIH0KCiAgICBnLnNhdmUoKTsKICAgIHJlbmRlckJhY2tncm91bmQoKTsKCiAgICBpZiAoc2hhZG93cykgewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHNoYWRvd3MubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgICAgdmFyIHNoYWRvdyA9IHNoYWRvd3NbaV07CiAgICAgICAgZy5zYXZlKCk7CiAgICAgICAgZy50cmFuc2xhdGUuYXBwbHkoZywgc2hhZG93T2Zmc2V0c1tpXSk7CiAgICAgICAgcmVuZGVyVGV4dChzaGFkb3cuY29sb3IpOwogICAgICAgIGcucmVzdG9yZSgpOwogICAgICB9CiAgICB9CgogICAgcmVuZGVyVGV4dCgpOwogICAgZy5yZXN0b3JlKCk7CiAgICBnLnJlc3RvcmUoKTsKICAgIGcucmVzdG9yZSgpOwogICAgcmV0dXJuIHdyYXBwZXI7CiAgfTsKfSgpKTsKQ3Vmb24ucmVnaXN0ZXJFbmdpbmUoJ3ZtbCcsIGZ1bmN0aW9uICgpIHsKICBpZiAoIWZhYnJpYy5kb2N1bWVudC5uYW1lc3BhY2VzKSByZXR1cm47CiAgdmFyIGNhbnZhc0VsID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogIGlmIChjYW52YXNFbCAmJiBjYW52YXNFbC5nZXRDb250ZXh0ICYmIGNhbnZhc0VsLmdldENvbnRleHQuYXBwbHkpIHJldHVybjsKCiAgaWYgKGZhYnJpYy5kb2N1bWVudC5uYW1lc3BhY2VzLmN2bWwgPT0gbnVsbCkgewogICAgZmFicmljLmRvY3VtZW50Lm5hbWVzcGFjZXMuYWRkKCdjdm1sJywgJ3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206dm1sJyk7CiAgfQoKICB2YXIgY2hlY2sgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY3ZtbDpzaGFwZScpOwogIGNoZWNrLnN0eWxlLmJlaGF2aW9yID0gJ3VybCgjZGVmYXVsdCNWTUwpJzsKICBpZiAoIWNoZWNrLmNvb3Jkc2l6ZSkgcmV0dXJuOyAvLyBWTUwgaXNuJ3Qgc3VwcG9ydGVkCgogIGNoZWNrID0gbnVsbDsKICBmYWJyaWMuZG9jdW1lbnQud3JpdGUoJzxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+JyArICcuY3Vmb24tdm1sLWNhbnZhc3t0ZXh0LWluZGVudDowfScgKyAnQG1lZGlhIHNjcmVlbnsnICsgJ2N2bWxcXDpzaGFwZSxjdm1sXFw6c2hhZG93e2JlaGF2aW9yOnVybCgjZGVmYXVsdCNWTUwpO2Rpc3BsYXk6YmxvY2s7YW50aWFsaWFzOnRydWU7cG9zaXRpb246YWJzb2x1dGV9JyArICcuY3Vmb24tdm1sLWNhbnZhc3twb3NpdGlvbjphYnNvbHV0ZTt0ZXh0LWFsaWduOmxlZnR9JyArICcuY3Vmb24tdm1se2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO3ZlcnRpY2FsLWFsaWduOm1pZGRsZX0nICsgJy5jdWZvbi12bWwgLmN1Zm9uLWFsdHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMDAwMGluO2ZvbnQtc2l6ZToxcHh9JyArICdhIC5jdWZvbi12bWx7Y3Vyc29yOnBvaW50ZXJ9JyArICd9JyArICdAbWVkaWEgcHJpbnR7JyArICcuY3Vmb24tdm1sICp7ZGlzcGxheTpub25lfScgKyAnLmN1Zm9uLXZtbCAuY3Vmb24tYWx0e2Rpc3BsYXk6aW5saW5lfScgKyAnfScgKyAnPC9zdHlsZT4nKTsKCiAgZnVuY3Rpb24gZ2V0Rm9udFNpemVJblBpeGVscyhlbCwgdmFsdWUpIHsKICAgIHJldHVybiBnZXRTaXplSW5QaXhlbHMoZWwsIC8oPzplbXxleHwlKSQvaS50ZXN0KHZhbHVlKSA/ICcxZW0nIDogdmFsdWUpOwogIH0gLy8gT3JpZ2luYWwgYnkgRGVhZCBFZHdhcmRzLgogIC8vIENvbWJpbmVkIHdpdGggZ2V0Rm9udFNpemVJblBpeGVscyBpdCBhbHNvIHdvcmtzIHdpdGggcmVsYXRpdmUgdW5pdHMuCgoKICBmdW5jdGlvbiBnZXRTaXplSW5QaXhlbHMoZWwsIHZhbHVlKSB7CiAgICBpZiAoL3B4JC9pLnRlc3QodmFsdWUpKSByZXR1cm4gcGFyc2VGbG9hdCh2YWx1ZSk7CiAgICB2YXIgc3R5bGUgPSBlbC5zdHlsZS5sZWZ0LAogICAgICAgIHJ1bnRpbWVTdHlsZSA9IGVsLnJ1bnRpbWVTdHlsZS5sZWZ0OwogICAgZWwucnVudGltZVN0eWxlLmxlZnQgPSBlbC5jdXJyZW50U3R5bGUubGVmdDsKICAgIGVsLnN0eWxlLmxlZnQgPSB2YWx1ZTsKICAgIHZhciByZXN1bHQgPSBlbC5zdHlsZS5waXhlbExlZnQ7CiAgICBlbC5zdHlsZS5sZWZ0ID0gc3R5bGU7CiAgICBlbC5ydW50aW1lU3R5bGUubGVmdCA9IHJ1bnRpbWVTdHlsZTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gKGZvbnQsIHRleHQsIHN0eWxlLCBvcHRpb25zLCBub2RlLCBlbCwgaGFzTmV4dCkgewogICAgdmFyIHJlZHJhdyA9IHRleHQgPT09IG51bGw7CiAgICBpZiAocmVkcmF3KSB0ZXh0ID0gbm9kZS5hbHQ7IC8vIEB0b2RvIHdvcmQtc3BhY2luZywgdGV4dC1kZWNvcmF0aW9uCgogICAgdmFyIHZpZXdCb3ggPSBmb250LnZpZXdCb3g7CiAgICB2YXIgc2l6ZSA9IHN0eWxlLmNvbXB1dGVkRm9udFNpemUgfHwgKHN0eWxlLmNvbXB1dGVkRm9udFNpemUgPSBuZXcgQ3Vmb24uQ1NTLlNpemUoZ2V0Rm9udFNpemVJblBpeGVscyhlbCwgc3R5bGUuZ2V0KCdmb250U2l6ZScpKSArICdweCcsIGZvbnQuYmFzZVNpemUpKTsKICAgIHZhciBsZXR0ZXJTcGFjaW5nID0gc3R5bGUuY29tcHV0ZWRMU3BhY2luZzsKCiAgICBpZiAobGV0dGVyU3BhY2luZyA9PSB1bmRlZmluZWQpIHsKICAgICAgbGV0dGVyU3BhY2luZyA9IHN0eWxlLmdldCgnbGV0dGVyU3BhY2luZycpOwogICAgICBzdHlsZS5jb21wdXRlZExTcGFjaW5nID0gbGV0dGVyU3BhY2luZyA9IGxldHRlclNwYWNpbmcgPT0gJ25vcm1hbCcgPyAwIDogfn5zaXplLmNvbnZlcnRGcm9tKGdldFNpemVJblBpeGVscyhlbCwgbGV0dGVyU3BhY2luZykpOwogICAgfQoKICAgIHZhciB3cmFwcGVyLCBjYW52YXM7CgogICAgaWYgKHJlZHJhdykgewogICAgICB3cmFwcGVyID0gbm9kZTsKICAgICAgY2FudmFzID0gbm9kZS5maXJzdENoaWxkOwogICAgfSBlbHNlIHsKICAgICAgd3JhcHBlciA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gJ2N1Zm9uIGN1Zm9uLXZtbCc7CiAgICAgIHdyYXBwZXIuYWx0ID0gdGV4dDsKICAgICAgY2FudmFzID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgY2FudmFzLmNsYXNzTmFtZSA9ICdjdWZvbi12bWwtY2FudmFzJzsKICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChjYW52YXMpOwoKICAgICAgaWYgKG9wdGlvbnMucHJpbnRhYmxlKSB7CiAgICAgICAgdmFyIHByaW50ID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgICBwcmludC5jbGFzc05hbWUgPSAnY3Vmb24tYWx0JzsKICAgICAgICBwcmludC5hcHBlbmRDaGlsZChmYWJyaWMuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOwogICAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQocHJpbnQpOwogICAgICB9IC8vIGllNiwgZm9yIHNvbWUgcmVhc29uLCBoYXMgdHJvdWJsZSByZW5kZXJpbmcgdGhlIGxhc3QgVk1MIGVsZW1lbnQgaW4gdGhlIGRvY3VtZW50LgogICAgICAvLyB3ZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBpbmplY3RpbmcgYSBkdW1teSBlbGVtZW50IHdoZXJlIG5lZWRlZC4KICAgICAgLy8gQHRvZG8gZmluZCBhIGJldHRlciBzb2x1dGlvbgoKCiAgICAgIGlmICghaGFzTmV4dCkgd3JhcHBlci5hcHBlbmRDaGlsZChmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY3ZtbDpzaGFwZScpKTsKICAgIH0KCiAgICB2YXIgd1N0eWxlID0gd3JhcHBlci5zdHlsZTsKICAgIHZhciBjU3R5bGUgPSBjYW52YXMuc3R5bGU7CiAgICB2YXIgaGVpZ2h0ID0gc2l6ZS5jb252ZXJ0KHZpZXdCb3guaGVpZ2h0KSwKICAgICAgICByb3VuZGVkSGVpZ2h0ID0gTWF0aC5jZWlsKGhlaWdodCk7CiAgICB2YXIgcm91bmRpbmdGYWN0b3IgPSByb3VuZGVkSGVpZ2h0IC8gaGVpZ2h0OwogICAgdmFyIG1pblggPSB2aWV3Qm94Lm1pblgsCiAgICAgICAgbWluWSA9IHZpZXdCb3gubWluWTsKICAgIGNTdHlsZS5oZWlnaHQgPSByb3VuZGVkSGVpZ2h0OwogICAgY1N0eWxlLnRvcCA9IE1hdGgucm91bmQoc2l6ZS5jb252ZXJ0KG1pblkgLSBmb250LmFzY2VudCkpOwogICAgY1N0eWxlLmxlZnQgPSBNYXRoLnJvdW5kKHNpemUuY29udmVydChtaW5YKSk7CiAgICB3U3R5bGUuaGVpZ2h0ID0gc2l6ZS5jb252ZXJ0KGZvbnQuaGVpZ2h0KSArICdweCc7CiAgICB2YXIgdGV4dERlY29yYXRpb24gPSBDdWZvbi5nZXRUZXh0RGVjb3JhdGlvbihvcHRpb25zKTsKICAgIHZhciBjb2xvciA9IHN0eWxlLmdldCgnY29sb3InKTsKICAgIHZhciBjaGFycyA9IEN1Zm9uLkNTUy50ZXh0VHJhbnNmb3JtKHRleHQsIHN0eWxlKS5zcGxpdCgnJyk7CiAgICB2YXIgd2lkdGggPSAwLAogICAgICAgIG9mZnNldFggPSAwLAogICAgICAgIGFkdmFuY2UgPSBudWxsOwogICAgdmFyIGdseXBoLAogICAgICAgIHNoYXBlLAogICAgICAgIHNoYWRvd3MgPSBvcHRpb25zLnRleHRTaGFkb3c7IC8vIHByZS1jYWxjdWxhdGUgd2lkdGgKCiAgICBmb3IgKHZhciBpID0gMCwgayA9IDAsIGwgPSBjaGFycy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgZ2x5cGggPSBmb250LmdseXBoc1tjaGFyc1tpXV0gfHwgZm9udC5taXNzaW5nR2x5cGg7CiAgICAgIGlmIChnbHlwaCkgd2lkdGggKz0gYWR2YW5jZSA9IH5+KGdseXBoLncgfHwgZm9udC53KSArIGxldHRlclNwYWNpbmc7CiAgICB9CgogICAgaWYgKGFkdmFuY2UgPT09IG51bGwpIHJldHVybiBudWxsOwogICAgdmFyIGZ1bGxXaWR0aCA9IC1taW5YICsgd2lkdGggKyAodmlld0JveC53aWR0aCAtIGFkdmFuY2UpOwogICAgdmFyIHNoYXBlV2lkdGggPSBzaXplLmNvbnZlcnQoZnVsbFdpZHRoICogcm91bmRpbmdGYWN0b3IpLAogICAgICAgIHJvdW5kZWRTaGFwZVdpZHRoID0gTWF0aC5yb3VuZChzaGFwZVdpZHRoKTsKICAgIHZhciBjb29yZFNpemUgPSBmdWxsV2lkdGggKyAnLCcgKyB2aWV3Qm94LmhlaWdodCwKICAgICAgICBjb29yZE9yaWdpbjsKICAgIHZhciBzdHJldGNoID0gJ3InICsgY29vcmRTaXplICsgJ25zbmYnOwoKICAgIGZvciAoaSA9IDA7IGkgPCBsOyArK2kpIHsKICAgICAgZ2x5cGggPSBmb250LmdseXBoc1tjaGFyc1tpXV0gfHwgZm9udC5taXNzaW5nR2x5cGg7CiAgICAgIGlmICghZ2x5cGgpIGNvbnRpbnVlOwoKICAgICAgaWYgKHJlZHJhdykgewogICAgICAgIC8vIHNvbWUgZ2x5cGhzIG1heSBiZSBtaXNzaW5nIHNvIHdlIGNhbid0IHVzZSBpCiAgICAgICAgc2hhcGUgPSBjYW52YXMuY2hpbGROb2Rlc1trXTsKICAgICAgICBpZiAoc2hhcGUuZmlyc3RDaGlsZCkgc2hhcGUucmVtb3ZlQ2hpbGQoc2hhcGUuZmlyc3RDaGlsZCk7IC8vIHNoYWRvdwogICAgICB9IGVsc2UgewogICAgICAgIHNoYXBlID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2N2bWw6c2hhcGUnKTsKICAgICAgICBjYW52YXMuYXBwZW5kQ2hpbGQoc2hhcGUpOwogICAgICB9CgogICAgICBzaGFwZS5zdHJva2VkID0gJ2YnOwogICAgICBzaGFwZS5jb29yZHNpemUgPSBjb29yZFNpemU7CiAgICAgIHNoYXBlLmNvb3Jkb3JpZ2luID0gY29vcmRPcmlnaW4gPSBtaW5YIC0gb2Zmc2V0WCArICcsJyArIG1pblk7CiAgICAgIHNoYXBlLnBhdGggPSAoZ2x5cGguZCA/ICdtJyArIGdseXBoLmQgKyAneGUnIDogJycpICsgJ20nICsgY29vcmRPcmlnaW4gKyBzdHJldGNoOwogICAgICBzaGFwZS5maWxsY29sb3IgPSBjb2xvcjsgLy8gaXQncyBpbXBvcnRhbnQgdG8gbm90IHNldCB0b3AvbGVmdCBvciBJRTggd2lsbCBncmluZCB0byBhIGhhbHQKCiAgICAgIHZhciBzU3R5bGUgPSBzaGFwZS5zdHlsZTsKICAgICAgc1N0eWxlLndpZHRoID0gcm91bmRlZFNoYXBlV2lkdGg7CiAgICAgIHNTdHlsZS5oZWlnaHQgPSByb3VuZGVkSGVpZ2h0OwoKICAgICAgaWYgKHNoYWRvd3MpIHsKICAgICAgICAvLyBkdWUgdG8gdGhlIGxpbWl0YXRpb25zIG9mIHRoZSBWTUwgc2hhZG93IGVsZW1lbnQgdGhlcmUKICAgICAgICAvLyBjYW4gb25seSBiZSB0d28gdmlzaWJsZSBzaGFkb3dzLiBvcGFjaXR5IGlzIHNoYXJlZAogICAgICAgIC8vIGZvciBhbGwgc2hhZG93cy4KICAgICAgICB2YXIgc2hhZG93MSA9IHNoYWRvd3NbMF0sCiAgICAgICAgICAgIHNoYWRvdzIgPSBzaGFkb3dzWzFdOwogICAgICAgIHZhciBjb2xvcjEgPSBDdWZvbi5DU1MuY29sb3Ioc2hhZG93MS5jb2xvciksCiAgICAgICAgICAgIGNvbG9yMjsKICAgICAgICB2YXIgc2hhZG93ID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2N2bWw6c2hhZG93Jyk7CiAgICAgICAgc2hhZG93Lm9uID0gJ3QnOwogICAgICAgIHNoYWRvdy5jb2xvciA9IGNvbG9yMS5jb2xvcjsKICAgICAgICBzaGFkb3cub2Zmc2V0ID0gc2hhZG93MS5vZmZYICsgJywnICsgc2hhZG93MS5vZmZZOwoKICAgICAgICBpZiAoc2hhZG93MikgewogICAgICAgICAgY29sb3IyID0gQ3Vmb24uQ1NTLmNvbG9yKHNoYWRvdzIuY29sb3IpOwogICAgICAgICAgc2hhZG93LnR5cGUgPSAnZG91YmxlJzsKICAgICAgICAgIHNoYWRvdy5jb2xvcjIgPSBjb2xvcjIuY29sb3I7CiAgICAgICAgICBzaGFkb3cub2Zmc2V0MiA9IHNoYWRvdzIub2ZmWCArICcsJyArIHNoYWRvdzIub2ZmWTsKICAgICAgICB9CgogICAgICAgIHNoYWRvdy5vcGFjaXR5ID0gY29sb3IxLm9wYWNpdHkgfHwgY29sb3IyICYmIGNvbG9yMi5vcGFjaXR5IHx8IDE7CiAgICAgICAgc2hhcGUuYXBwZW5kQ2hpbGQoc2hhZG93KTsKICAgICAgfQoKICAgICAgb2Zmc2V0WCArPSB+fihnbHlwaC53IHx8IGZvbnQudykgKyBsZXR0ZXJTcGFjaW5nOwogICAgICArK2s7CiAgICB9CgogICAgd1N0eWxlLndpZHRoID0gTWF0aC5tYXgoTWF0aC5jZWlsKHNpemUuY29udmVydCh3aWR0aCAqIHJvdW5kaW5nRmFjdG9yKSksIDApOwogICAgcmV0dXJuIHdyYXBwZXI7CiAgfTsKfSgpKTsKCkN1Zm9uLmdldFRleHREZWNvcmF0aW9uID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICByZXR1cm4gewogICAgdW5kZXJsaW5lOiBvcHRpb25zLnRleHREZWNvcmF0aW9uID09PSAndW5kZXJsaW5lJywKICAgIG92ZXJsaW5lOiBvcHRpb25zLnRleHREZWNvcmF0aW9uID09PSAnb3ZlcmxpbmUnLAogICAgJ2xpbmUtdGhyb3VnaCc6IG9wdGlvbnMudGV4dERlY29yYXRpb24gPT09ICdsaW5lLXRocm91Z2gnCiAgfTsKfTsKCmlmICh0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJykgewogIGV4cG9ydHMuQ3Vmb24gPSBDdWZvbjsKfQovKgogICAganNvbjIuanMKICAgIDIwMTEtMTAtMTkKCiAgICBQdWJsaWMgRG9tYWluLgoKICAgIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KCiAgICBTZWUgaHR0cDovL3d3dy5KU09OLm9yZy9qcy5odG1sCgoKICAgIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiAgICBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogICAgVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KICAgIE5PVCBDT05UUk9MLgoKCiAgICBUaGlzIGZpbGUgY3JlYXRlcyBhIGdsb2JhbCBKU09OIG9iamVjdCBjb250YWluaW5nIHR3byBtZXRob2RzOiBzdHJpbmdpZnkKICAgIGFuZCBwYXJzZS4KCiAgICAgICAgSlNPTi5zdHJpbmdpZnkodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkKICAgICAgICAgICAgdmFsdWUgICAgICAgYW55IEphdmFTY3JpcHQgdmFsdWUsIHVzdWFsbHkgYW4gb2JqZWN0IG9yIGFycmF5LgoKICAgICAgICAgICAgcmVwbGFjZXIgICAgYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgZGV0ZXJtaW5lcyBob3cgb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyBhcmUgc3RyaW5naWZpZWQgZm9yIG9iamVjdHMuIEl0IGNhbiBiZSBhCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MuCgogICAgICAgICAgICBzcGFjZSAgICAgICBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBzcGVjaWZpZXMgdGhlIGluZGVudGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIG9mIG5lc3RlZCBzdHJ1Y3R1cmVzLiBJZiBpdCBpcyBvbWl0dGVkLCB0aGUgdGV4dCB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgIGJlIHBhY2tlZCB3aXRob3V0IGV4dHJhIHdoaXRlc3BhY2UuIElmIGl0IGlzIGEgbnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICBpdCB3aWxsIHNwZWNpZnkgdGhlIG51bWJlciBvZiBzcGFjZXMgdG8gaW5kZW50IGF0IGVhY2gKICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWwuIElmIGl0IGlzIGEgc3RyaW5nIChzdWNoIGFzICdcdCcgb3IgJyZuYnNwOycpLAogICAgICAgICAgICAgICAgICAgICAgICBpdCBjb250YWlucyB0aGUgY2hhcmFjdGVycyB1c2VkIHRvIGluZGVudCBhdCBlYWNoIGxldmVsLgoKICAgICAgICAgICAgVGhpcyBtZXRob2QgcHJvZHVjZXMgYSBKU09OIHRleHQgZnJvbSBhIEphdmFTY3JpcHQgdmFsdWUuCgogICAgICAgICAgICBXaGVuIGFuIG9iamVjdCB2YWx1ZSBpcyBmb3VuZCwgaWYgdGhlIG9iamVjdCBjb250YWlucyBhIHRvSlNPTgogICAgICAgICAgICBtZXRob2QsIGl0cyB0b0pTT04gbWV0aG9kIHdpbGwgYmUgY2FsbGVkIGFuZCB0aGUgcmVzdWx0IHdpbGwgYmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuIEEgdG9KU09OIG1ldGhvZCBkb2VzIG5vdCBzZXJpYWxpemU6IGl0IHJldHVybnMgdGhlCiAgICAgICAgICAgIHZhbHVlIHJlcHJlc2VudGVkIGJ5IHRoZSBuYW1lL3ZhbHVlIHBhaXIgdGhhdCBzaG91bGQgYmUgc2VyaWFsaXplZCwKICAgICAgICAgICAgb3IgdW5kZWZpbmVkIGlmIG5vdGhpbmcgc2hvdWxkIGJlIHNlcmlhbGl6ZWQuIFRoZSB0b0pTT04gbWV0aG9kCiAgICAgICAgICAgIHdpbGwgYmUgcGFzc2VkIHRoZSBrZXkgYXNzb2NpYXRlZCB3aXRoIHRoZSB2YWx1ZSwgYW5kIHRoaXMgd2lsbCBiZQogICAgICAgICAgICBib3VuZCB0byB0aGUgdmFsdWUKCiAgICAgICAgICAgIEZvciBleGFtcGxlLCB0aGlzIHdvdWxkIHNlcmlhbGl6ZSBEYXRlcyBhcyBJU08gc3RyaW5ncy4KCiAgICAgICAgICAgICAgICBEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZihuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFVUQ0Z1bGxZZWFyKCkgICArICctJyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENEYXRlKCkpICAgICAgKyAnVCcgKwogICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ0hvdXJzKCkpICAgICArICc6JyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDTWludXRlcygpKSAgICsgJzonICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENTZWNvbmRzKCkpICAgKyAnWic7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgWW91IGNhbiBwcm92aWRlIGFuIG9wdGlvbmFsIHJlcGxhY2VyIG1ldGhvZC4gSXQgd2lsbCBiZSBwYXNzZWQgdGhlCiAgICAgICAgICAgIGtleSBhbmQgdmFsdWUgb2YgZWFjaCBtZW1iZXIsIHdpdGggdGhpcyBib3VuZCB0byB0aGUgY29udGFpbmluZwogICAgICAgICAgICBvYmplY3QuIFRoZSB2YWx1ZSB0aGF0IGlzIHJldHVybmVkIGZyb20geW91ciBtZXRob2Qgd2lsbCBiZQogICAgICAgICAgICBzZXJpYWxpemVkLiBJZiB5b3VyIG1ldGhvZCByZXR1cm5zIHVuZGVmaW5lZCwgdGhlbiB0aGUgbWVtYmVyIHdpbGwKICAgICAgICAgICAgYmUgZXhjbHVkZWQgZnJvbSB0aGUgc2VyaWFsaXphdGlvbi4KCiAgICAgICAgICAgIElmIHRoZSByZXBsYWNlciBwYXJhbWV0ZXIgaXMgYW4gYXJyYXkgb2Ygc3RyaW5ncywgdGhlbiBpdCB3aWxsIGJlCiAgICAgICAgICAgIHVzZWQgdG8gc2VsZWN0IHRoZSBtZW1iZXJzIHRvIGJlIHNlcmlhbGl6ZWQuIEl0IGZpbHRlcnMgdGhlIHJlc3VsdHMKICAgICAgICAgICAgc3VjaCB0aGF0IG9ubHkgbWVtYmVycyB3aXRoIGtleXMgbGlzdGVkIGluIHRoZSByZXBsYWNlciBhcnJheSBhcmUKICAgICAgICAgICAgc3RyaW5naWZpZWQuCgogICAgICAgICAgICBWYWx1ZXMgdGhhdCBkbyBub3QgaGF2ZSBKU09OIHJlcHJlc2VudGF0aW9ucywgc3VjaCBhcyB1bmRlZmluZWQgb3IKICAgICAgICAgICAgZnVuY3Rpb25zLCB3aWxsIG5vdCBiZSBzZXJpYWxpemVkLiBTdWNoIHZhbHVlcyBpbiBvYmplY3RzIHdpbGwgYmUKICAgICAgICAgICAgZHJvcHBlZDsgaW4gYXJyYXlzIHRoZXkgd2lsbCBiZSByZXBsYWNlZCB3aXRoIG51bGwuIFlvdSBjYW4gdXNlCiAgICAgICAgICAgIGEgcmVwbGFjZXIgZnVuY3Rpb24gdG8gcmVwbGFjZSB0aG9zZSB3aXRoIEpTT04gdmFsdWVzLgogICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1bmRlZmluZWQpIHJldHVybnMgdW5kZWZpbmVkLgoKICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHNwYWNlIHBhcmFtZXRlciBwcm9kdWNlcyBhIHN0cmluZ2lmaWNhdGlvbiBvZiB0aGUKICAgICAgICAgICAgdmFsdWUgdGhhdCBpcyBmaWxsZWQgd2l0aCBsaW5lIGJyZWFrcyBhbmQgaW5kZW50YXRpb24gdG8gbWFrZSBpdAogICAgICAgICAgICBlYXNpZXIgdG8gcmVhZC4KCiAgICAgICAgICAgIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBub24tZW1wdHkgc3RyaW5nLCB0aGVuIHRoYXQgc3RyaW5nIHdpbGwKICAgICAgICAgICAgYmUgdXNlZCBmb3IgaW5kZW50YXRpb24uIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIHRoZW4KICAgICAgICAgICAgdGhlIGluZGVudGF0aW9uIHdpbGwgYmUgdGhhdCBtYW55IHNwYWNlcy4KCiAgICAgICAgICAgIEV4YW1wbGU6CgogICAgICAgICAgICB0ZXh0ID0gSlNPTi5zdHJpbmdpZnkoWydlJywge3BsdXJpYnVzOiAndW51bSd9XSk7CiAgICAgICAgICAgIC8vIHRleHQgaXMgJ1siZSIseyJwbHVyaWJ1cyI6InVudW0ifV0nCgoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFsnZScsIHtwbHVyaWJ1czogJ3VudW0nfV0sIG51bGwsICdcdCcpOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbXG5cdCJlIixcblx0e1xuXHRcdCJwbHVyaWJ1cyI6ICJ1bnVtIlxuXHR9XG5dJwoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFtuZXcgRGF0ZSgpXSwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2tleV0gaW5zdGFuY2VvZiBEYXRlID8KICAgICAgICAgICAgICAgICAgICAnRGF0ZSgnICsgdGhpc1trZXldICsgJyknIDogdmFsdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbIkRhdGUoLS0tY3VycmVudCB0aW1lLS0tKSJdJwoKCiAgICAgICAgSlNPTi5wYXJzZSh0ZXh0LCByZXZpdmVyKQogICAgICAgICAgICBUaGlzIG1ldGhvZCBwYXJzZXMgYSBKU09OIHRleHQgdG8gcHJvZHVjZSBhbiBvYmplY3Qgb3IgYXJyYXkuCiAgICAgICAgICAgIEl0IGNhbiB0aHJvdyBhIFN5bnRheEVycm9yIGV4Y2VwdGlvbi4KCiAgICAgICAgICAgIFRoZSBvcHRpb25hbCByZXZpdmVyIHBhcmFtZXRlciBpcyBhIGZ1bmN0aW9uIHRoYXQgY2FuIGZpbHRlciBhbmQKICAgICAgICAgICAgdHJhbnNmb3JtIHRoZSByZXN1bHRzLiBJdCByZWNlaXZlcyBlYWNoIG9mIHRoZSBrZXlzIGFuZCB2YWx1ZXMsCiAgICAgICAgICAgIGFuZCBpdHMgcmV0dXJuIHZhbHVlIGlzIHVzZWQgaW5zdGVhZCBvZiB0aGUgb3JpZ2luYWwgdmFsdWUuCiAgICAgICAgICAgIElmIGl0IHJldHVybnMgd2hhdCBpdCByZWNlaXZlZCwgdGhlbiB0aGUgc3RydWN0dXJlIGlzIG5vdCBtb2RpZmllZC4KICAgICAgICAgICAgSWYgaXQgcmV0dXJucyB1bmRlZmluZWQgdGhlbiB0aGUgbWVtYmVyIGlzIGRlbGV0ZWQuCgogICAgICAgICAgICBFeGFtcGxlOgoKICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHRleHQuIFZhbHVlcyB0aGF0IGxvb2sgbGlrZSBJU08gZGF0ZSBzdHJpbmdzIHdpbGwKICAgICAgICAgICAgLy8gYmUgY29udmVydGVkIHRvIERhdGUgb2JqZWN0cy4KCiAgICAgICAgICAgIG15RGF0YSA9IEpTT04ucGFyc2UodGV4dCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBhID0KL14oXGR7NH0pLShcZHsyfSktKFxkezJ9KVQoXGR7Mn0pOihcZHsyfSk6KFxkezJ9KD86XC5cZCopPylaJC8uZXhlYyh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKCthWzFdLCArYVsyXSAtIDEsICthWzNdLCArYVs0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICthWzVdLCArYVs2XSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKCdbIkRhdGUoMDkvMDkvMjAwMSkiXScsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKDAsIDUpID09PSAnRGF0ZSgnICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnNsaWNlKC0xKSA9PT0gJyknKSB7CiAgICAgICAgICAgICAgICAgICAgZCA9IG5ldyBEYXRlKHZhbHVlLnNsaWNlKDUsIC0xKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9KTsKCgogICAgVGhpcyBpcyBhIHJlZmVyZW5jZSBpbXBsZW1lbnRhdGlvbi4gWW91IGFyZSBmcmVlIHRvIGNvcHksIG1vZGlmeSwgb3IKICAgIHJlZGlzdHJpYnV0ZS4KKi8KCi8qanNsaW50IGV2aWw6IHRydWUsIHJlZ2V4cDogdHJ1ZSAqLwoKLyptZW1iZXJzICIiLCAiXGIiLCAiXHQiLCAiXG4iLCAiXGYiLCAiXHIiLCAiXCIiLCBKU09OLCAiXFwiLCBhcHBseSwKICAgIGNhbGwsIGNoYXJDb2RlQXQsIGdldFVUQ0RhdGUsIGdldFVUQ0Z1bGxZZWFyLCBnZXRVVENIb3VycywKICAgIGdldFVUQ01pbnV0ZXMsIGdldFVUQ01vbnRoLCBnZXRVVENTZWNvbmRzLCBoYXNPd25Qcm9wZXJ0eSwgam9pbiwKICAgIGxhc3RJbmRleCwgbGVuZ3RoLCBwYXJzZSwgcHJvdG90eXBlLCBwdXNoLCByZXBsYWNlLCBzbGljZSwgc3RyaW5naWZ5LAogICAgdGVzdCwgdG9KU09OLCB0b1N0cmluZywgdmFsdWVPZgoqLwovLyBDcmVhdGUgYSBKU09OIG9iamVjdCBvbmx5IGlmIG9uZSBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LiBXZSBjcmVhdGUgdGhlCi8vIG1ldGhvZHMgaW4gYSBjbG9zdXJlIHRvIGF2b2lkIGNyZWF0aW5nIGdsb2JhbCB2YXJpYWJsZXMuCgoKdmFyIEpTT047CgppZiAoIUpTT04pIHsKICBKU09OID0ge307Cn0KCihmdW5jdGlvbiAoKSB7CiAgJ3VzZSBzdHJpY3QnOwoKICBmdW5jdGlvbiBmKG4pIHsKICAgIC8vIEZvcm1hdCBpbnRlZ2VycyB0byBoYXZlIGF0IGxlYXN0IHR3byBkaWdpdHMuCiAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47CiAgfQoKICBpZiAodHlwZW9mIERhdGUucHJvdG90eXBlLnRvSlNPTiAhPT0gJ2Z1bmN0aW9uJykgewogICAgRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewogICAgICByZXR1cm4gaXNGaW5pdGUodGhpcy52YWx1ZU9mKCkpID8gdGhpcy5nZXRVVENGdWxsWWVhcigpICsgJy0nICsgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICctJyArIGYodGhpcy5nZXRVVENEYXRlKCkpICsgJ1QnICsgZih0aGlzLmdldFVUQ0hvdXJzKCkpICsgJzonICsgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgKyAnOicgKyBmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSArICdaJyA6IG51bGw7CiAgICB9OwoKICAgIFN0cmluZy5wcm90b3R5cGUudG9KU09OID0gTnVtYmVyLnByb3RvdHlwZS50b0pTT04gPSBCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlT2YoKTsKICAgIH07CiAgfQoKICB2YXIgY3ggPSAvW1x1MDAwMFx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLAogICAgICBlc2NhcGFibGUgPSAvW1xcXCJceDAwLVx4MWZceDdmLVx4OWZcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZywKICAgICAgZ2FwLAogICAgICBpbmRlbnQsCiAgICAgIG1ldGEgPSB7CiAgICAvLyB0YWJsZSBvZiBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9ucwogICAgJ1xiJzogJ1xcYicsCiAgICAnXHQnOiAnXFx0JywKICAgICdcbic6ICdcXG4nLAogICAgJ1xmJzogJ1xcZicsCiAgICAnXHInOiAnXFxyJywKICAgICciJzogJ1xcIicsCiAgICAnXFwnOiAnXFxcXCcKICB9LAogICAgICByZXA7CgogIGZ1bmN0aW9uIHF1b3RlKHN0cmluZykgewogICAgLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBubyBjb250cm9sIGNoYXJhY3RlcnMsIG5vIHF1b3RlIGNoYXJhY3RlcnMsIGFuZCBubwogICAgLy8gYmFja3NsYXNoIGNoYXJhY3RlcnMsIHRoZW4gd2UgY2FuIHNhZmVseSBzbGFwIHNvbWUgcXVvdGVzIGFyb3VuZCBpdC4KICAgIC8vIE90aGVyd2lzZSB3ZSBtdXN0IGFsc28gcmVwbGFjZSB0aGUgb2ZmZW5kaW5nIGNoYXJhY3RlcnMgd2l0aCBzYWZlIGVzY2FwZQogICAgLy8gc2VxdWVuY2VzLgogICAgZXNjYXBhYmxlLmxhc3RJbmRleCA9IDA7CiAgICByZXR1cm4gZXNjYXBhYmxlLnRlc3Qoc3RyaW5nKSA/ICciJyArIHN0cmluZy5yZXBsYWNlKGVzY2FwYWJsZSwgZnVuY3Rpb24gKGEpIHsKICAgICAgdmFyIGMgPSBtZXRhW2FdOwogICAgICByZXR1cm4gdHlwZW9mIGMgPT09ICdzdHJpbmcnID8gYyA6ICJcXHUiICsgKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKICAgIH0pICsgJyInIDogJyInICsgc3RyaW5nICsgJyInOwogIH0KCiAgZnVuY3Rpb24gc3RyKGtleSwgaG9sZGVyKSB7CiAgICAvLyBQcm9kdWNlIGEgc3RyaW5nIGZyb20gaG9sZGVyW2tleV0uCiAgICB2YXIgaSwKICAgICAgICAvLyBUaGUgbG9vcCBjb3VudGVyLgogICAgaywKICAgICAgICAvLyBUaGUgbWVtYmVyIGtleS4KICAgIHYsCiAgICAgICAgLy8gVGhlIG1lbWJlciB2YWx1ZS4KICAgIGxlbmd0aCwKICAgICAgICBtaW5kID0gZ2FwLAogICAgICAgIHBhcnRpYWwsCiAgICAgICAgdmFsdWUgPSBob2xkZXJba2V5XTsgLy8gSWYgdGhlIHZhbHVlIGhhcyBhIHRvSlNPTiBtZXRob2QsIGNhbGwgaXQgdG8gb2J0YWluIGEgcmVwbGFjZW1lbnQgdmFsdWUuCgogICAgaWYgKHZhbHVlICYmIF90eXBlb2YodmFsdWUpID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdmFsdWUudG9KU09OID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHZhbHVlID0gdmFsdWUudG9KU09OKGtleSk7CiAgICB9IC8vIElmIHdlIHdlcmUgY2FsbGVkIHdpdGggYSByZXBsYWNlciBmdW5jdGlvbiwgdGhlbiBjYWxsIHRoZSByZXBsYWNlciB0bwogICAgLy8gb2J0YWluIGEgcmVwbGFjZW1lbnQgdmFsdWUuCgoKICAgIGlmICh0eXBlb2YgcmVwID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHZhbHVlID0gcmVwLmNhbGwoaG9sZGVyLCBrZXksIHZhbHVlKTsKICAgIH0gLy8gV2hhdCBoYXBwZW5zIG5leHQgZGVwZW5kcyBvbiB0aGUgdmFsdWUncyB0eXBlLgoKCiAgICBzd2l0Y2ggKF90eXBlb2YodmFsdWUpKSB7CiAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgcmV0dXJuIHF1b3RlKHZhbHVlKTsKCiAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCiAgICAgICAgcmV0dXJuIGlzRmluaXRlKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiAnbnVsbCc7CgogICAgICBjYXNlICdib29sZWFuJzoKICAgICAgY2FzZSAnbnVsbCc6CiAgICAgICAgLy8gSWYgdGhlIHZhbHVlIGlzIGEgYm9vbGVhbiBvciBudWxsLCBjb252ZXJ0IGl0IHRvIGEgc3RyaW5nLiBOb3RlOgogICAgICAgIC8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCiAgICAgICAgLy8gdGhlIHJlbW90ZSBjaGFuY2UgdGhhdCB0aGlzIGdldHMgZml4ZWQgc29tZWRheS4KICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsKICAgICAgLy8gSWYgdGhlIHR5cGUgaXMgJ29iamVjdCcsIHdlIG1pZ2h0IGJlIGRlYWxpbmcgd2l0aCBhbiBvYmplY3Qgb3IgYW4gYXJyYXkgb3IKICAgICAgLy8gbnVsbC4KCiAgICAgIGNhc2UgJ29iamVjdCc6CiAgICAgICAgLy8gRHVlIHRvIGEgc3BlY2lmaWNhdGlvbiBibHVuZGVyIGluIEVDTUFTY3JpcHQsIHR5cGVvZiBudWxsIGlzICdvYmplY3QnLAogICAgICAgIC8vIHNvIHdhdGNoIG91dCBmb3IgdGhhdCBjYXNlLgogICAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAgIHJldHVybiAnbnVsbCc7CiAgICAgICAgfSAvLyBNYWtlIGFuIGFycmF5IHRvIGhvbGQgdGhlIHBhcnRpYWwgcmVzdWx0cyBvZiBzdHJpbmdpZnlpbmcgdGhpcyBvYmplY3QgdmFsdWUuCgoKICAgICAgICBnYXAgKz0gaW5kZW50OwogICAgICAgIHBhcnRpYWwgPSBbXTsgLy8gSXMgdGhlIHZhbHVlIGFuIGFycmF5PwoKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseSh2YWx1ZSkgPT09ICdbb2JqZWN0IEFycmF5XScpIHsKICAgICAgICAgIC8vIFRoZSB2YWx1ZSBpcyBhbiBhcnJheS4gU3RyaW5naWZ5IGV2ZXJ5IGVsZW1lbnQuIFVzZSBudWxsIGFzIGEgcGxhY2Vob2xkZXIKICAgICAgICAgIC8vIGZvciBub24tSlNPTiB2YWx1ZXMuCiAgICAgICAgICBsZW5ndGggPSB2YWx1ZS5sZW5ndGg7CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgIHBhcnRpYWxbaV0gPSBzdHIoaSwgdmFsdWUpIHx8ICdudWxsJzsKICAgICAgICAgIH0gLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KICAgICAgICAgIC8vIGJyYWNrZXRzLgoKCiAgICAgICAgICB2ID0gcGFydGlhbC5sZW5ndGggPT09IDAgPyAnW10nIDogZ2FwID8gJ1tcbicgKyBnYXAgKyBwYXJ0aWFsLmpvaW4oJyxcbicgKyBnYXApICsgJ1xuJyArIG1pbmQgKyAnXScgOiAnWycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICddJzsKICAgICAgICAgIGdhcCA9IG1pbmQ7CiAgICAgICAgICByZXR1cm4gdjsKICAgICAgICB9IC8vIElmIHRoZSByZXBsYWNlciBpcyBhbiBhcnJheSwgdXNlIGl0IHRvIHNlbGVjdCB0aGUgbWVtYmVycyB0byBiZSBzdHJpbmdpZmllZC4KCgogICAgICAgIGlmIChyZXAgJiYgX3R5cGVvZihyZXApID09PSAnb2JqZWN0JykgewogICAgICAgICAgbGVuZ3RoID0gcmVwLmxlbmd0aDsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXBbaV0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgayA9IHJlcFtpXTsKICAgICAgICAgICAgICB2ID0gc3RyKGssIHZhbHVlKTsKCiAgICAgICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgICAgIHBhcnRpYWwucHVzaChxdW90ZShrKSArIChnYXAgPyAnOiAnIDogJzonKSArIHYpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBPdGhlcndpc2UsIGl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGtleXMgaW4gdGhlIG9iamVjdC4KICAgICAgICAgIGZvciAoayBpbiB2YWx1ZSkgewogICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewogICAgICAgICAgICAgIHYgPSBzdHIoaywgdmFsdWUpOwoKICAgICAgICAgICAgICBpZiAodikgewogICAgICAgICAgICAgICAgcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBKb2luIGFsbCBvZiB0aGUgbWVtYmVyIHRleHRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsCiAgICAgICAgLy8gYW5kIHdyYXAgdGhlbSBpbiBicmFjZXMuCgoKICAgICAgICB2ID0gcGFydGlhbC5sZW5ndGggPT09IDAgPyAne30nIDogZ2FwID8gJ3tcbicgKyBnYXAgKyBwYXJ0aWFsLmpvaW4oJyxcbicgKyBnYXApICsgJ1xuJyArIG1pbmQgKyAnfScgOiAneycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICd9JzsKICAgICAgICBnYXAgPSBtaW5kOwogICAgICAgIHJldHVybiB2OwogICAgfQogIH0gLy8gSWYgdGhlIEpTT04gb2JqZWN0IGRvZXMgbm90IHlldCBoYXZlIGEgc3RyaW5naWZ5IG1ldGhvZCwgZ2l2ZSBpdCBvbmUuCgoKICBpZiAodHlwZW9mIEpTT04uc3RyaW5naWZ5ICE9PSAnZnVuY3Rpb24nKSB7CiAgICBKU09OLnN0cmluZ2lmeSA9IGZ1bmN0aW9uICh2YWx1ZSwgcmVwbGFjZXIsIHNwYWNlKSB7CiAgICAgIC8vIFRoZSBzdHJpbmdpZnkgbWV0aG9kIHRha2VzIGEgdmFsdWUgYW5kIGFuIG9wdGlvbmFsIHJlcGxhY2VyLCBhbmQgYW4gb3B0aW9uYWwKICAgICAgLy8gc3BhY2UgcGFyYW1ldGVyLCBhbmQgcmV0dXJucyBhIEpTT04gdGV4dC4gVGhlIHJlcGxhY2VyIGNhbiBiZSBhIGZ1bmN0aW9uCiAgICAgIC8vIHRoYXQgY2FuIHJlcGxhY2UgdmFsdWVzLCBvciBhbiBhcnJheSBvZiBzdHJpbmdzIHRoYXQgd2lsbCBzZWxlY3QgdGhlIGtleXMuCiAgICAgIC8vIEEgZGVmYXVsdCByZXBsYWNlciBtZXRob2QgY2FuIGJlIHByb3ZpZGVkLiBVc2Ugb2YgdGhlIHNwYWNlIHBhcmFtZXRlciBjYW4KICAgICAgLy8gcHJvZHVjZSB0ZXh0IHRoYXQgaXMgbW9yZSBlYXNpbHkgcmVhZGFibGUuCiAgICAgIHZhciBpOwogICAgICBnYXAgPSAnJzsKICAgICAgaW5kZW50ID0gJyc7IC8vIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBudW1iZXIsIG1ha2UgYW4gaW5kZW50IHN0cmluZyBjb250YWluaW5nIHRoYXQKICAgICAgLy8gbWFueSBzcGFjZXMuCgogICAgICBpZiAodHlwZW9mIHNwYWNlID09PSAnbnVtYmVyJykgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGFjZTsgaSArPSAxKSB7CiAgICAgICAgICBpbmRlbnQgKz0gJyAnOwogICAgICAgIH0gLy8gSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIHN0cmluZywgaXQgd2lsbCBiZSB1c2VkIGFzIHRoZSBpbmRlbnQgc3RyaW5nLgoKICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc3BhY2UgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgaW5kZW50ID0gc3BhY2U7CiAgICAgIH0gLy8gSWYgdGhlcmUgaXMgYSByZXBsYWNlciwgaXQgbXVzdCBiZSBhIGZ1bmN0aW9uIG9yIGFuIGFycmF5LgogICAgICAvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yLgoKCiAgICAgIHJlcCA9IHJlcGxhY2VyOwoKICAgICAgaWYgKHJlcGxhY2VyICYmIHR5cGVvZiByZXBsYWNlciAhPT0gJ2Z1bmN0aW9uJyAmJiAoX3R5cGVvZihyZXBsYWNlcikgIT09ICdvYmplY3QnIHx8IHR5cGVvZiByZXBsYWNlci5sZW5ndGggIT09ICdudW1iZXInKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignSlNPTi5zdHJpbmdpZnknKTsKICAgICAgfSAvLyBNYWtlIGEgZmFrZSByb290IG9iamVjdCBjb250YWluaW5nIG91ciB2YWx1ZSB1bmRlciB0aGUga2V5IG9mICcnLgogICAgICAvLyBSZXR1cm4gdGhlIHJlc3VsdCBvZiBzdHJpbmdpZnlpbmcgdGhlIHZhbHVlLgoKCiAgICAgIHJldHVybiBzdHIoJycsIHsKICAgICAgICAnJzogdmFsdWUKICAgICAgfSk7CiAgICB9OwogIH0gLy8gSWYgdGhlIEpTT04gb2JqZWN0IGRvZXMgbm90IHlldCBoYXZlIGEgcGFyc2UgbWV0aG9kLCBnaXZlIGl0IG9uZS4KCgogIGlmICh0eXBlb2YgSlNPTi5wYXJzZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgSlNPTi5wYXJzZSA9IGZ1bmN0aW9uICh0ZXh0LCByZXZpdmVyKSB7CiAgICAgIC8vIFRoZSBwYXJzZSBtZXRob2QgdGFrZXMgYSB0ZXh0IGFuZCBhbiBvcHRpb25hbCByZXZpdmVyIGZ1bmN0aW9uLCBhbmQgcmV0dXJucwogICAgICAvLyBhIEphdmFTY3JpcHQgdmFsdWUgaWYgdGhlIHRleHQgaXMgYSB2YWxpZCBKU09OIHRleHQuCiAgICAgIHZhciBqOwoKICAgICAgZnVuY3Rpb24gd2Fsayhob2xkZXIsIGtleSkgewogICAgICAgIC8vIFRoZSB3YWxrIG1ldGhvZCBpcyB1c2VkIHRvIHJlY3Vyc2l2ZWx5IHdhbGsgdGhlIHJlc3VsdGluZyBzdHJ1Y3R1cmUgc28KICAgICAgICAvLyB0aGF0IG1vZGlmaWNhdGlvbnMgY2FuIGJlIG1hZGUuCiAgICAgICAgdmFyIGssCiAgICAgICAgICAgIHYsCiAgICAgICAgICAgIHZhbHVlID0gaG9sZGVyW2tleV07CgogICAgICAgIGlmICh2YWx1ZSAmJiBfdHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIGZvciAoayBpbiB2YWx1ZSkgewogICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewogICAgICAgICAgICAgIHYgPSB3YWxrKHZhbHVlLCBrKTsKCiAgICAgICAgICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdmFsdWVba10gPSB2OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZWxldGUgdmFsdWVba107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV2aXZlci5jYWxsKGhvbGRlciwga2V5LCB2YWx1ZSk7CiAgICAgIH0gLy8gUGFyc2luZyBoYXBwZW5zIGluIGZvdXIgc3RhZ2VzLiBJbiB0aGUgZmlyc3Qgc3RhZ2UsIHdlIHJlcGxhY2UgY2VydGFpbgogICAgICAvLyBVbmljb2RlIGNoYXJhY3RlcnMgd2l0aCBlc2NhcGUgc2VxdWVuY2VzLiBKYXZhU2NyaXB0IGhhbmRsZXMgbWFueSBjaGFyYWN0ZXJzCiAgICAgIC8vIGluY29ycmVjdGx5LCBlaXRoZXIgc2lsZW50bHkgZGVsZXRpbmcgdGhlbSwgb3IgdHJlYXRpbmcgdGhlbSBhcyBsaW5lIGVuZGluZ3MuCgoKICAgICAgdGV4dCA9IFN0cmluZyh0ZXh0KTsKICAgICAgY3gubGFzdEluZGV4ID0gMDsKCiAgICAgIGlmIChjeC50ZXN0KHRleHQpKSB7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZShjeCwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiAiXFx1IiArICgnMDAwMCcgKyBhLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7CiAgICAgICAgfSk7CiAgICAgIH0gLy8gSW4gdGhlIHNlY29uZCBzdGFnZSwgd2UgcnVuIHRoZSB0ZXh0IGFnYWluc3QgcmVndWxhciBleHByZXNzaW9ucyB0aGF0IGxvb2sKICAgICAgLy8gZm9yIG5vbi1KU09OIHBhdHRlcm5zLiBXZSBhcmUgZXNwZWNpYWxseSBjb25jZXJuZWQgd2l0aCAnKCknIGFuZCAnbmV3JwogICAgICAvLyBiZWNhdXNlIHRoZXkgY2FuIGNhdXNlIGludm9jYXRpb24sIGFuZCAnPScgYmVjYXVzZSBpdCBjYW4gY2F1c2UgbXV0YXRpb24uCiAgICAgIC8vIEJ1dCBqdXN0IHRvIGJlIHNhZmUsIHdlIHdhbnQgdG8gcmVqZWN0IGFsbCB1bmV4cGVjdGVkIGZvcm1zLgogICAgICAvLyBXZSBzcGxpdCB0aGUgc2Vjb25kIHN0YWdlIGludG8gNCByZWdleHAgb3BlcmF0aW9ucyBpbiBvcmRlciB0byB3b3JrIGFyb3VuZAogICAgICAvLyBjcmlwcGxpbmcgaW5lZmZpY2llbmNpZXMgaW4gSUUncyBhbmQgU2FmYXJpJ3MgcmVnZXhwIGVuZ2luZXMuIEZpcnN0IHdlCiAgICAgIC8vIHJlcGxhY2UgdGhlIEpTT04gYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKICAgICAgLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAogICAgICAvLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSwKICAgICAgLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKICAgICAgLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgoKICAgICAgaWYgKC9eW1xdLDp7fVxzXSokLy50ZXN0KHRleHQucmVwbGFjZSgvXFwoPzpbIlxcXC9iZm5ydF18dVswLTlhLWZBLUZdezR9KS9nLCAnQCcpLnJlcGxhY2UoLyJbXiJcXFxuXHJdKiJ8dHJ1ZXxmYWxzZXxudWxsfC0/XGQrKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy9nLCAnXScpLnJlcGxhY2UoLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywgJycpKSkgewogICAgICAgIC8vIEluIHRoZSB0aGlyZCBzdGFnZSB3ZSB1c2UgdGhlIGV2YWwgZnVuY3Rpb24gdG8gY29tcGlsZSB0aGUgdGV4dCBpbnRvIGEKICAgICAgICAvLyBKYXZhU2NyaXB0IHN0cnVjdHVyZS4gVGhlICd7JyBvcGVyYXRvciBpcyBzdWJqZWN0IHRvIGEgc3ludGFjdGljIGFtYmlndWl0eQogICAgICAgIC8vIGluIEphdmFTY3JpcHQ6IGl0IGNhbiBiZWdpbiBhIGJsb2NrIG9yIGFuIG9iamVjdCBsaXRlcmFsLiBXZSB3cmFwIHRoZSB0ZXh0CiAgICAgICAgLy8gaW4gcGFyZW5zIHRvIGVsaW1pbmF0ZSB0aGUgYW1iaWd1aXR5LgogICAgICAgIGogPSBldmFsKCcoJyArIHRleHQgKyAnKScpOyAvLyBJbiB0aGUgb3B0aW9uYWwgZm91cnRoIHN0YWdlLCB3ZSByZWN1cnNpdmVseSB3YWxrIHRoZSBuZXcgc3RydWN0dXJlLCBwYXNzaW5nCiAgICAgICAgLy8gZWFjaCBuYW1lL3ZhbHVlIHBhaXIgdG8gYSByZXZpdmVyIGZ1bmN0aW9uIGZvciBwb3NzaWJsZSB0cmFuc2Zvcm1hdGlvbi4KCiAgICAgICAgcmV0dXJuIHR5cGVvZiByZXZpdmVyID09PSAnZnVuY3Rpb24nID8gd2Fsayh7CiAgICAgICAgICAnJzogagogICAgICAgIH0sICcnKSA6IGo7CiAgICAgIH0gLy8gSWYgdGhlIHRleHQgaXMgbm90IEpTT04gcGFyc2VhYmxlLCB0aGVuIGEgU3ludGF4RXJyb3IgaXMgdGhyb3duLgoKCiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignSlNPTi5wYXJzZScpOwogICAgfTsKICB9Cn0pKCk7Ci8qKgogKiBXcmFwcGVyIGFyb3VuZCBgY29uc29sZS5sb2dgICh3aGVuIGF2YWlsYWJsZSkKICogQG1ldGhvZCBsb2cKICogQHBhcmFtIHtBbnl9IFZhbHVlcyB0byBsb2cKICovCgoKZmFicmljLmxvZyA9IGZ1bmN0aW9uICgpIHt9OwovKioKICogV3JhcHBlciBhcm91bmQgYGNvbnNvbGUud2FybmAgKHdoZW4gYXZhaWxhYmxlKQogKiBAbWV0aG9kIHdhcm4KICogQHBhcmFtIHtBbnl9IFZhbHVlcyB0byBsb2cgYXMgYSB3YXJuaW5nCiAqLwoKCmZhYnJpYy53YXJuID0gZnVuY3Rpb24gKCkge307CgppZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgaWYgKHR5cGVvZiBjb25zb2xlLmxvZyAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS5sb2cuYXBwbHkpIHsKICAgIGZhYnJpYy5sb2cgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpOwogICAgfTsKICB9CgogIGlmICh0eXBlb2YgY29uc29sZS53YXJuICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLndhcm4uYXBwbHkpIHsKICAgIGZhYnJpYy53YXJuID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gY29uc29sZS53YXJuLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0KfQovKioKICogQG5hbWVzcGFjZQogKi8KCgpmYWJyaWMuT2JzZXJ2YWJsZSA9IHsKICAvKioKICAgKiBPYnNlcnZlcyBzcGVjaWZpZWQgZXZlbnQKICAgKiBAbWV0aG9kIG9ic2VydmUKICAgKiBAZGVwcmFjYXRlZCBTaW5jZSAwLjguMzQuIFVzZSBgb25gIGluc3RlYWQuCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIKICAgKi8KICBvYnNlcnZlOiBmdW5jdGlvbiBvYnNlcnZlKGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzID0ge307CiAgICB9IC8vIG9uZSBvYmplY3Qgd2l0aCBrZXkvdmFsdWUgcGFpcnMgd2FzIHBhc3NlZAoKCiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICBmb3IgKHZhciBwcm9wIGluIGV2ZW50TmFtZSkgewogICAgICAgIHRoaXMub24ocHJvcCwgZXZlbnROYW1lW3Byb3BdKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkgewogICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdID0gW107CiAgICAgIH0KCiAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnB1c2goaGFuZGxlcik7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogU3RvcHMgZXZlbnQgb2JzZXJ2aW5nIGZvciBhIHBhcnRpY3VsYXIgZXZlbnQgaGFuZGxlcgogICAqIEBtZXRob2Qgc3RvcE9ic2VydmluZwogICAqIEBkZXByYWNhdGVkIFNpbmNlIDAuOC4zNC4gVXNlIGBvZmZgIGluc3RlYWQuCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIKICAgKi8KICBzdG9wT2JzZXJ2aW5nOiBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nKGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHsKICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzID0ge307CiAgICB9CgogICAgaWYgKHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdKSB7CiAgICAgIGZhYnJpYy51dGlsLnJlbW92ZUZyb21BcnJheSh0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSwgaGFuZGxlcik7CiAgICB9CiAgfSwKCiAgLyoqCiAgICogRmlyZXMgZXZlbnQgd2l0aCBhbiBvcHRpb25hbCBvcHRpb25zIG9iamVjdAogICAqIEBtZXRob2QgZmlyZQogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWUKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICovCiAgZmlyZTogZnVuY3Rpb24gZmlyZShldmVudE5hbWUsIG9wdGlvbnMpIHsKICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7CiAgICAgIHRoaXMuX19ldmVudExpc3RlbmVycyA9IHt9OwogICAgfQoKICAgIHZhciBsaXN0ZW5lcnNGb3JFdmVudCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdOwogICAgaWYgKCFsaXN0ZW5lcnNGb3JFdmVudCkgcmV0dXJuOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAvLyBhdm9pZGluZyB0cnkvY2F0Y2ggZm9yIHBlcmYuIHJlYXNvbnMKICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0ob3B0aW9ucyB8fCB7fSk7CiAgICB9CiAgfQp9OwovKioKICogQWxpYXMgZm9yIG9ic2VydmUKICogQG1ldGhvZCBvYnNlcnZlCiAqIEBtZW1iZXJPZiBmYWJyaWMuT2JzZXJ2YWJsZQogKi8KCmZhYnJpYy5PYnNlcnZhYmxlLm9uID0gZmFicmljLk9ic2VydmFibGUub2JzZXJ2ZTsKLyoqCiAqIEFsaWFzIGZvciBzdG9wT2JzZXJ2aW5nCiAqIEBtZXRob2Qgb2ZmCiAqLwoKZmFicmljLk9ic2VydmFibGUub2ZmID0gZmFicmljLk9ic2VydmFibGUuc3RvcE9ic2VydmluZzsKCihmdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogQG5hbWVzcGFjZQogICAqLwogIGZhYnJpYy51dGlsID0ge307CiAgLyoqCiAgICogUmVtb3ZlcyB2YWx1ZSBmcm9tIGFuIGFycmF5LgogICAqIFByZXNlbmNlIG9mIHZhbHVlIChhbmQgaXRzIHBvc2l0aW9uIGluIGFuIGFycmF5KSBpcyBkZXRlcm1pbmVkIHZpYSBgQXJyYXkucHJvdG90eXBlLmluZGV4T2ZgCiAgICogQHN0YXRpYwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBtZXRob2QgcmVtb3ZlRnJvbUFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkKICAgKiBAcGFyYW0ge0FueX0gdmFsdWUKICAgKiBAcmV0dXJuIHtBcnJheX0gb3JpZ2luYWwgYXJyYXkKICAgKi8KCiAgZnVuY3Rpb24gcmVtb3ZlRnJvbUFycmF5KGFycmF5LCB2YWx1ZSkgewogICAgdmFyIGlkeCA9IGFycmF5LmluZGV4T2YodmFsdWUpOwoKICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgIGFycmF5LnNwbGljZShpZHgsIDEpOwogICAgfQoKICAgIHJldHVybiBhcnJheTsKICB9CgogIDsKICAvKioKICAgKiBSZXR1cm5zIHJhbmRvbSBudW1iZXIgYmV0d2VlbiAyIHNwZWNpZmllZCBvbmVzLgogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGdldFJhbmRvbUludAogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBwYXJhbSB7TnVtYmVyfSBtaW4gbG93ZXIgbGltaXQKICAgKiBAcGFyYW0ge051bWJlcn0gbWF4IHVwcGVyIGxpbWl0CiAgICogQHJldHVybiB7TnVtYmVyfSByYW5kb20gdmFsdWUgKGJldHdlZW4gbWluIGFuZCBtYXgpCiAgICovCgogIGZ1bmN0aW9uIGdldFJhbmRvbUludChtaW4sIG1heCkgewogICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47CiAgfQoKICB2YXIgUGlCeTE4MCA9IE1hdGguUEkgLyAxODA7CiAgLyoqCiAgICogVHJhbnNmb3JtcyBkZWdyZWVzIHRvIHJhZGlhbnMuCiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgZGVncmVlc1RvUmFkaWFucwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBwYXJhbSB7TnVtYmVyfSBkZWdyZWVzIHZhbHVlIGluIGRlZ3JlZXMKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IHZhbHVlIGluIHJhZGlhbnMKICAgKi8KCiAgZnVuY3Rpb24gZGVncmVlc1RvUmFkaWFucyhkZWdyZWVzKSB7CiAgICByZXR1cm4gZGVncmVlcyAqIFBpQnkxODA7CiAgfQogIC8qKgogICAqIEEgd3JhcHBlciBhcm91bmQgTnVtYmVyI3RvRml4ZWQsIHdoaWNoIGNvbnRyYXJ5IHRvIG5hdGl2ZSBtZXRob2QgcmV0dXJucyBudW1iZXIsIG5vdCBzdHJpbmcuCiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgdG9GaXhlZAogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBwYXJhbSB7TnVtYmVyIHwgU3RyaW5nfSBudW1iZXIgbnVtYmVyIHRvIG9wZXJhdGUgb24KICAgKiBAcGFyYW0ge051bWJlcn0gZnJhY3Rpb25EaWdpdHMgbnVtYmVyIG9mIGZyYWN0aW9uIGRpZ2l0cyB0byAibGVhdmUiCiAgICogQHJldHVybiB7TnVtYmVyfQogICAqLwoKCiAgZnVuY3Rpb24gdG9GaXhlZChudW1iZXIsIGZyYWN0aW9uRGlnaXRzKSB7CiAgICByZXR1cm4gcGFyc2VGbG9hdChOdW1iZXIobnVtYmVyKS50b0ZpeGVkKGZyYWN0aW9uRGlnaXRzKSk7CiAgfQogIC8qKgogICAqIEZ1bmN0aW9uIHdoaWNoIGFsd2F5cyByZXR1cm5zIGBmYWxzZWAuCiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgZmFsc2VGdW5jdGlvbgogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEByZXR1cm4ge0Jvb2xlYW59CiAgICovCgoKICBmdW5jdGlvbiBmYWxzZUZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICAvKioKICAgKiBDaGFuZ2VzIHZhbHVlIGZyb20gb25lIHRvIGFub3RoZXIgd2l0aGluIGNlcnRhaW4gcGVyaW9kIG9mIHRpbWUsIGludm9raW5nIGNhbGxiYWNrcyBhcyB2YWx1ZSBpcyBiZWluZyBjaGFuZ2VkLgogICAqIEBtZXRob2QgYW5pbWF0ZQogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gQW5pbWF0aW9uIG9wdGlvbnMKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb3B0aW9ucy5vbkNoYW5nZV0gQ2FsbGJhY2s7IGludm9rZWQgb24gZXZlcnkgdmFsdWUgY2hhbmdlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMub25Db21wbGV0ZV0gQ2FsbGJhY2s7IGludm9rZWQgd2hlbiB2YWx1ZSBjaGFuZ2UgaXMgY29tcGxldGVkCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLnN0YXJ0VmFsdWU9MF0gU3RhcnRpbmcgdmFsdWUKICAgKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuZW5kVmFsdWU9MTAwXSBFbmRpbmcgdmFsdWUKICAgKiBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuYnlWYWx1ZT0xMDBdIFZhbHVlIHRvIG1vZGlmeSB0aGUgcHJvcGVydHkgYnkKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb3B0aW9ucy5lYXNpbmddIEVhc2luZyBmdW5jdGlvbgogICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5kdXJhdGlvbj01MDBdIER1cmF0aW9uIG9mIGNoYW5nZQogICAqLwoKCiAgZnVuY3Rpb24gYW5pbWF0ZShvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgIHZhciBzdGFydCA9ICtuZXcgRGF0ZSgpLAogICAgICAgIGR1cmF0aW9uID0gb3B0aW9ucy5kdXJhdGlvbiB8fCA1MDAsCiAgICAgICAgZmluaXNoID0gc3RhcnQgKyBkdXJhdGlvbiwKICAgICAgICB0aW1lLAogICAgICAgIHBvcywKICAgICAgICBvbkNoYW5nZSA9IG9wdGlvbnMub25DaGFuZ2UgfHwgZnVuY3Rpb24gKCkge30sCiAgICAgICAgYWJvcnQgPSBvcHRpb25zLmFib3J0IHx8IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgICAgICBlYXNpbmcgPSBvcHRpb25zLmVhc2luZyB8fCBmdW5jdGlvbiAodCwgYiwgYywgZCkgewogICAgICByZXR1cm4gLWMgKiBNYXRoLmNvcyh0IC8gZCAqIChNYXRoLlBJIC8gMikpICsgYyArIGI7CiAgICB9LAogICAgICAgIHN0YXJ0VmFsdWUgPSAnc3RhcnRWYWx1ZScgaW4gb3B0aW9ucyA/IG9wdGlvbnMuc3RhcnRWYWx1ZSA6IDAsCiAgICAgICAgZW5kVmFsdWUgPSAnZW5kVmFsdWUnIGluIG9wdGlvbnMgPyBvcHRpb25zLmVuZFZhbHVlIDogMTAwOwoKICAgIGJ5VmFsdWUgPSBvcHRpb25zLmJ5VmFsdWUgfHwgZW5kVmFsdWUgLSBzdGFydFZhbHVlOwogICAgb3B0aW9ucy5vblN0YXJ0ICYmIG9wdGlvbnMub25TdGFydCgpOwoKICAgIChmdW5jdGlvbiB0aWNrKCkgewogICAgICB0aW1lID0gK25ldyBEYXRlKCk7CiAgICAgIGN1cnJlbnRUaW1lID0gdGltZSA+IGZpbmlzaCA/IGR1cmF0aW9uIDogdGltZSAtIHN0YXJ0OwogICAgICBvbkNoYW5nZShlYXNpbmcoY3VycmVudFRpbWUsIHN0YXJ0VmFsdWUsIGJ5VmFsdWUsIGR1cmF0aW9uKSk7CgogICAgICBpZiAodGltZSA+IGZpbmlzaCB8fCBhYm9ydCgpKSB7CiAgICAgICAgb3B0aW9ucy5vbkNvbXBsZXRlICYmIG9wdGlvbnMub25Db21wbGV0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmVxdWVzdEFuaW1GcmFtZSh0aWNrKTsKICAgIH0pKCk7CiAgfQoKICB2YXIgX3JlcXVlc3RBbmltRnJhbWUgPSBmYWJyaWMud2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmYWJyaWMud2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmYWJyaWMud2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmYWJyaWMud2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgZmFicmljLndpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbiAoY2FsbGJhY2ssIGVsZW1lbnQpIHsKICAgIGZhYnJpYy53aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTsKICB9OwogIC8qKgogICAgKiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgcG9seWZpbGwgYmFzZWQgb24gaHR0cDovL3BhdWxpcmlzaC5jb20vMjAxMS9yZXF1ZXN0YW5pbWF0aW9uZnJhbWUtZm9yLXNtYXJ0LWFuaW1hdGluZy8KICAgICogQG1ldGhvZCByZXF1ZXN0QW5pbUZyYW1lCiAgICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayB0byBpbnZva2UKICAgICogQHBhcmFtIHtET01FbGVtZW50fSBlbGVtZW50IG9wdGlvbmFsIEVsZW1lbnQgdG8gYXNzb2NpYXRlIHdpdGggYW5pbWF0aW9uCiAgICAqLwoKCiAgdmFyIHJlcXVlc3RBbmltRnJhbWUgPSBmdW5jdGlvbiByZXF1ZXN0QW5pbUZyYW1lKCkgewogICAgcmV0dXJuIF9yZXF1ZXN0QW5pbUZyYW1lLmFwcGx5KGZhYnJpYy53aW5kb3csIGFyZ3VtZW50cyk7CiAgfTsKICAvKioKICAgICogTG9hZHMgaW1hZ2UgZWxlbWVudCBmcm9tIGdpdmVuIHVybCBhbmQgcGFzc2VzIGl0IHRvIGEgY2FsbGJhY2sKICAgICogQG1ldGhvZCBsb2FkSW1hZ2UKICAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsCiAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVVJMIHJlcHJlc2VudGluZyBhbiBpbWFnZQogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjazsgaW52b2tlZCB3aXRoIGxvYWRlZCBpbWFnZQogICAgKiBAcGFyYW0ge0FueX0gY29udGV4dCBvcHRpb25hbCBDb250ZXh0IHRvIGludm9rZSBjYWxsYmFjayBpbgogICAgKi8KCgogIGZ1bmN0aW9uIGxvYWRJbWFnZSh1cmwsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICBpZiAodXJsKSB7CiAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgLyoqIEBpZ25vcmUgKi8KCiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChjb250ZXh0LCBpbWcpOwogICAgICAgIGltZyA9IGltZy5vbmxvYWQgPSBudWxsOwogICAgICB9OwoKICAgICAgaW1nLnNyYyA9IHVybDsKICAgIH0gZWxzZSB7CiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgdXJsKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGVubGl2ZW5PYmplY3RzKG9iamVjdHMsIGNhbGxiYWNrKSB7CiAgICBmdW5jdGlvbiBnZXRLbGFzcyh0eXBlKSB7CiAgICAgIHJldHVybiBmYWJyaWNbZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHR5cGUpKV07CiAgICB9CgogICAgZnVuY3Rpb24gb25Mb2FkZWQoKSB7CiAgICAgIGlmICgrK251bUxvYWRlZE9iamVjdHMgPT09IG51bVRvdGFsT2JqZWN0cykgewogICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgY2FsbGJhY2soZW5saXZlbmVkT2JqZWN0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIGVubGl2ZW5lZE9iamVjdHMgPSBbXSwKICAgICAgICBudW1Mb2FkZWRPYmplY3RzID0gMCwKICAgICAgICBudW1Ub3RhbE9iamVjdHMgPSBvYmplY3RzLmxlbmd0aDsKICAgIG9iamVjdHMuZm9yRWFjaChmdW5jdGlvbiAobywgaW5kZXgpIHsKICAgICAgaWYgKCFvLnR5cGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBrbGFzcyA9IGdldEtsYXNzKG8udHlwZSk7CgogICAgICBpZiAoa2xhc3MuYXN5bmMpIHsKICAgICAgICBrbGFzcy5mcm9tT2JqZWN0KG8sIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICBlbmxpdmVuZWRPYmplY3RzW2luZGV4XSA9IG87CiAgICAgICAgICBvbkxvYWRlZCgpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGVubGl2ZW5lZE9iamVjdHNbaW5kZXhdID0ga2xhc3MuZnJvbU9iamVjdChvKTsKICAgICAgICBvbkxvYWRlZCgpOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGdyb3VwU1ZHRWxlbWVudHMoZWxlbWVudHMsIG9wdGlvbnMsIHBhdGgpIHsKICAgIHZhciBvYmplY3QgPSBlbGVtZW50cy5sZW5ndGggPiAxID8gbmV3IGZhYnJpYy5QYXRoR3JvdXAoZWxlbWVudHMsIG9wdGlvbnMpIDogZWxlbWVudHNbMF07CgogICAgaWYgKHR5cGVvZiBwYXRoICE9PSAndW5kZWZpbmVkJykgewogICAgICBvYmplY3Quc2V0U291cmNlUGF0aChwYXRoKTsKICAgIH0KCiAgICByZXR1cm4gb2JqZWN0OwogIH0KCiAgZmFicmljLnV0aWwucmVtb3ZlRnJvbUFycmF5ID0gcmVtb3ZlRnJvbUFycmF5OwogIGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMgPSBkZWdyZWVzVG9SYWRpYW5zOwogIGZhYnJpYy51dGlsLnRvRml4ZWQgPSB0b0ZpeGVkOwogIGZhYnJpYy51dGlsLmdldFJhbmRvbUludCA9IGdldFJhbmRvbUludDsKICBmYWJyaWMudXRpbC5mYWxzZUZ1bmN0aW9uID0gZmFsc2VGdW5jdGlvbjsKICBmYWJyaWMudXRpbC5hbmltYXRlID0gYW5pbWF0ZTsKICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lID0gcmVxdWVzdEFuaW1GcmFtZTsKICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UgPSBsb2FkSW1hZ2U7CiAgZmFicmljLnV0aWwuZW5saXZlbk9iamVjdHMgPSBlbmxpdmVuT2JqZWN0czsKICBmYWJyaWMudXRpbC5ncm91cFNWR0VsZW1lbnRzID0gZ3JvdXBTVkdFbGVtZW50czsKfSkoKTsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwoKICBpZiAoIUFycmF5LnByb3RvdHlwZS5pbmRleE9mKSB7CiAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIChzZWFyY2hFbGVtZW50CiAgICAvKiwgZnJvbUluZGV4ICovCiAgICApIHsKICAgICAgaWYgKHRoaXMgPT09IHZvaWQgMCB8fCB0aGlzID09PSBudWxsKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICB9CgogICAgICB2YXIgdCA9IE9iamVjdCh0aGlzKSwKICAgICAgICAgIGxlbiA9IHQubGVuZ3RoID4+PiAwOwoKICAgICAgaWYgKGxlbiA9PT0gMCkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQoKICAgICAgdmFyIG4gPSAwOwoKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgbiA9IE51bWJlcihhcmd1bWVudHNbMV0pOwoKICAgICAgICBpZiAobiAhPT0gbikgewogICAgICAgICAgLy8gc2hvcnRjdXQgZm9yIHZlcmlmeWluZyBpZiBpdCdzIE5hTgogICAgICAgICAgbiA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChuICE9PSAwICYmIG4gIT09IDEgLyAwICYmIG4gIT09IC0oMSAvIDApKSB7CiAgICAgICAgICBuID0gKG4gPiAwIHx8IC0xKSAqIE1hdGguZmxvb3IoTWF0aC5hYnMobikpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG4gPj0gbGVuKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CgogICAgICB2YXIgayA9IG4gPj0gMCA/IG4gOiBNYXRoLm1heChsZW4gLSBNYXRoLmFicyhuKSwgMCk7CgogICAgICBmb3IgKDsgayA8IGxlbjsgaysrKSB7CiAgICAgICAgaWYgKGsgaW4gdCAmJiB0W2tdID09PSBzZWFyY2hFbGVtZW50KSB7CiAgICAgICAgICByZXR1cm4gazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAtMTsKICAgIH07CiAgfQoKICBpZiAoIUFycmF5LnByb3RvdHlwZS5mb3JFYWNoKSB7CiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uIChmbiwgY29udGV4dCkgewogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5sZW5ndGggPj4+IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChpIGluIHRoaXMpIHsKICAgICAgICAgIGZuLmNhbGwoY29udGV4dCwgdGhpc1tpXSwgaSwgdGhpcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0KCiAgaWYgKCFBcnJheS5wcm90b3R5cGUubWFwKSB7CiAgICBBcnJheS5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24gKGZuLCBjb250ZXh0KSB7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmxlbmd0aCA+Pj4gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGkgaW4gdGhpcykgewogICAgICAgICAgcmVzdWx0W2ldID0gZm4uY2FsbChjb250ZXh0LCB0aGlzW2ldLCBpLCB0aGlzKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH0KCiAgaWYgKCFBcnJheS5wcm90b3R5cGUuZXZlcnkpIHsKICAgIEFycmF5LnByb3RvdHlwZS5ldmVyeSA9IGZ1bmN0aW9uIChmbiwgY29udGV4dCkgewogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5sZW5ndGggPj4+IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChpIGluIHRoaXMgJiYgIWZuLmNhbGwoY29udGV4dCwgdGhpc1tpXSwgaSwgdGhpcykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKICB9CgogIGlmICghQXJyYXkucHJvdG90eXBlLnNvbWUpIHsKICAgIEFycmF5LnByb3RvdHlwZS5zb21lID0gZnVuY3Rpb24gKGZuLCBjb250ZXh0KSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmxlbmd0aCA+Pj4gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKGkgaW4gdGhpcyAmJiBmbi5jYWxsKGNvbnRleHQsIHRoaXNbaV0sIGksIHRoaXMpKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgfQoKICBpZiAoIUFycmF5LnByb3RvdHlwZS5maWx0ZXIpIHsKICAgIEFycmF5LnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbiAoZm4sIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IFtdLAogICAgICAgICAgdmFsOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMubGVuZ3RoID4+PiAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpZiAoaSBpbiB0aGlzKSB7CiAgICAgICAgICB2YWwgPSB0aGlzW2ldOyAvLyBpbiBjYXNlIGZuIG11dGF0ZXMgdGhpcwoKICAgICAgICAgIGlmIChmbi5jYWxsKGNvbnRleHQsIHZhbCwgaSwgdGhpcykpIHsKICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH0KCiAgaWYgKCFBcnJheS5wcm90b3R5cGUucmVkdWNlKSB7CiAgICBBcnJheS5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24gKGZuCiAgICAvKiwgaW5pdGlhbCovCiAgICApIHsKICAgICAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoID4+PiAwLAogICAgICAgICAgaSA9IDAsCiAgICAgICAgICBydjsKCiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgewogICAgICAgIHJ2ID0gYXJndW1lbnRzWzFdOwogICAgICB9IGVsc2UgewogICAgICAgIGRvIHsKICAgICAgICAgIGlmIChpIGluIHRoaXMpIHsKICAgICAgICAgICAgcnYgPSB0aGlzW2krK107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfSAvLyBpZiBhcnJheSBjb250YWlucyBubyB2YWx1ZXMsIG5vIGluaXRpYWwgdmFsdWUgdG8gcmV0dXJuCgoKICAgICAgICAgIGlmICgrK2kgPj0gbGVuKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgIH0KICAgICAgICB9IHdoaWxlICh0cnVlKTsKICAgICAgfQoKICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlmIChpIGluIHRoaXMpIHsKICAgICAgICAgIHJ2ID0gZm4uY2FsbChudWxsLCBydiwgdGhpc1tpXSwgaSwgdGhpcyk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcnY7CiAgICB9OwogIH0KICAvKioKICAgKiBJbnZva2VzIG1ldGhvZCBvbiBhbGwgaXRlbXMgaW4gYSBnaXZlbiBhcnJheQogICAqIEBtZXRob2QgaW52b2tlCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQXJyYXkgdG8gaXRlcmF0ZSBvdmVyCiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBOYW1lIG9mIGEgbWV0aG9kIHRvIGludm9rZQogICAqLwoKCiAgZnVuY3Rpb24gaW52b2tlKGFycmF5LCBtZXRob2QpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpLAogICAgICAgIHJlc3VsdCA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICByZXN1bHRbaV0gPSBhcmdzLmxlbmd0aCA/IGFycmF5W2ldW21ldGhvZF0uYXBwbHkoYXJyYXlbaV0sIGFyZ3MpIDogYXJyYXlbaV1bbWV0aG9kXS5jYWxsKGFycmF5W2ldKTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0OwogIH0KICAvKioKICAgKiBGaW5kcyBtYXhpbXVtIHZhbHVlIGluIGFycmF5IChub3QgbmVjZXNzYXJpbHkgImZpcnN0IiBvbmUpCiAgICogQG1ldGhvZCBtYXgKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwuYXJyYXkKICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBcnJheSB0byBpdGVyYXRlIG92ZXIKICAgKiBAcGFyYW0ge1N0cmluZ30gYnlQcm9wZXJ0eQogICAqLwoKCiAgZnVuY3Rpb24gbWF4KGFycmF5LCBieVByb3BlcnR5KSB7CiAgICBpZiAoIWFycmF5IHx8IGFycmF5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIHVuZGVmaW5lZDsKICAgIHZhciBpID0gYXJyYXkubGVuZ3RoIC0gMSwKICAgICAgICByZXN1bHQgPSBieVByb3BlcnR5ID8gYXJyYXlbaV1bYnlQcm9wZXJ0eV0gOiBhcnJheVtpXTsKCiAgICBpZiAoYnlQcm9wZXJ0eSkgewogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgaWYgKGFycmF5W2ldW2J5UHJvcGVydHldID49IHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0ID0gYXJyYXlbaV1bYnlQcm9wZXJ0eV07CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgaWYgKGFycmF5W2ldID49IHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0ID0gYXJyYXlbaV07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgLyoqCiAgICogRmluZHMgbWluaW11bSB2YWx1ZSBpbiBhcnJheSAobm90IG5lY2Vzc2FyaWx5ICJmaXJzdCIgb25lKQogICAqIEBtZXRob2QgbWluCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmFycmF5CiAgICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQXJyYXkgdG8gaXRlcmF0ZSBvdmVyCiAgICogQHBhcmFtIHtTdHJpbmd9IGJ5UHJvcGVydHkKICAgKi8KCgogIGZ1bmN0aW9uIG1pbihhcnJheSwgYnlQcm9wZXJ0eSkgewogICAgaWYgKCFhcnJheSB8fCBhcnJheS5sZW5ndGggPT09IDApIHJldHVybiB1bmRlZmluZWQ7CiAgICB2YXIgaSA9IGFycmF5Lmxlbmd0aCAtIDEsCiAgICAgICAgcmVzdWx0ID0gYnlQcm9wZXJ0eSA/IGFycmF5W2ldW2J5UHJvcGVydHldIDogYXJyYXlbaV07CgogICAgaWYgKGJ5UHJvcGVydHkpIHsKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGlmIChhcnJheVtpXVtieVByb3BlcnR5XSA8IHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0ID0gYXJyYXlbaV1bYnlQcm9wZXJ0eV07CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgaWYgKGFycmF5W2ldIDwgcmVzdWx0KSB7CiAgICAgICAgICByZXN1bHQgPSBhcnJheVtpXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzdWx0OwogIH0KICAvKiogQG5hbWVzcGFjZSAqLwoKCiAgZmFicmljLnV0aWwuYXJyYXkgPSB7CiAgICBpbnZva2U6IGludm9rZSwKICAgIG1pbjogbWluLAogICAgbWF4OiBtYXgKICB9Owp9KSgpOwoKKGZ1bmN0aW9uICgpIHsKICAvKioKICAgKiBDb3BpZXMgYWxsIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBvbmUgb2JqZWN0IHRvIGFub3RoZXIKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwub2JqZWN0CiAgICogQG1ldGhvZCBleHRlbmQKICAgKiBAcGFyYW0ge09iamVjdH0gZGVzdGluYXRpb24gV2hlcmUgdG8gY29weSB0bwogICAqIEBwYXJhbSB7T2JqZWN0fSBzb3VyY2UgV2hlcmUgdG8gY29weSBmcm9tCiAgICovCiAgZnVuY3Rpb24gZXh0ZW5kKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHsKICAgIC8vIEpTY3JpcHQgRG9udEVudW0gYnVnIGlzIG5vdCB0YWtlbiBjYXJlIG9mCiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHsKICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTsKICAgIH0KCiAgICByZXR1cm4gZGVzdGluYXRpb247CiAgfQogIC8qKgogICAqIENyZWF0ZXMgYW4gZW1wdHkgb2JqZWN0IGFuZCBjb3BpZXMgYWxsIGVudW1lcmFibGUgcHJvcGVydGllcyBvZiBhbm90aGVyIG9iamVjdCB0byBpdAogICAqIEBtZXRob2QgY2xvbmUKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwub2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY2xvbmUKICAgKi8KCgogIGZ1bmN0aW9uIGNsb25lKG9iamVjdCkgewogICAgcmV0dXJuIGV4dGVuZCh7fSwgb2JqZWN0KTsKICB9CiAgLyoqIEBuYW1lc3BhY2UgZmFicmljLnV0aWwub2JqZWN0ICovCgoKICBmYWJyaWMudXRpbC5vYmplY3QgPSB7CiAgICBleHRlbmQ6IGV4dGVuZCwKICAgIGNsb25lOiBjbG9uZQogIH07Cn0pKCk7CgooZnVuY3Rpb24gKCkgewogIGlmICghU3RyaW5nLnByb3RvdHlwZS50cmltKSB7CiAgICAvKioKICAgICAqIFRyaW1zIGEgc3RyaW5nIChyZW1vdmluZyB3aGl0ZXNwYWNlIGZyb20gdGhlIGJlZ2lubmluZyBhbmQgdGhlIGVuZCkKICAgICAqIEBtZXRob2QgdHJpbQogICAgICogQHNlZSA8YSBocmVmPSJodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9TdHJpbmcvVHJpbSI+U3RyaW5nI3RyaW0gb24gTUROPC9hPgogICAgICovCiAgICBTdHJpbmcucHJvdG90eXBlLnRyaW0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHRoaXMgdHJpbSBpcyBub3QgZnVsbHkgRVMzIG9yIEVTNSBjb21wbGlhbnQsIGJ1dCBpdCBzaG91bGQgY292ZXIgbW9zdCBjYXNlcyBmb3Igbm93CiAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL15bXHNceEEwXSsvLCAnJykucmVwbGFjZSgvW1xzXHhBMF0rJC8sICcnKTsKICAgIH07CiAgfQogIC8qKgogICAqIENhbWVsaXplcyBhIHN0cmluZwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5zdHJpbmcKICAgKiBAbWV0aG9kIGNhbWVsaXplCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZyBTdHJpbmcgdG8gY2FtZWxpemUKICAgKiBAcmV0dXJuIHtTdHJpbmd9IENhbWVsaXplZCB2ZXJzaW9uIG9mIGEgc3RyaW5nCiAgICovCgoKICBmdW5jdGlvbiBjYW1lbGl6ZShzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvLSsoLik/L2csIGZ1bmN0aW9uIChtYXRjaCwgY2hhcmFjdGVyKSB7CiAgICAgIHJldHVybiBjaGFyYWN0ZXIgPyBjaGFyYWN0ZXIudG9VcHBlckNhc2UoKSA6ICcnOwogICAgfSk7CiAgfQogIC8qKgogICAqIENhcGl0YWxpemVzIGEgc3RyaW5nCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLnN0cmluZwogICAqIEBtZXRob2QgY2FwaXRhbGl6ZQogICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgU3RyaW5nIHRvIGNhcGl0YWxpemUKICAgKiBAcmV0dXJuIHtTdHJpbmd9IENhcGl0YWxpemVkIHZlcnNpb24gb2YgYSBzdHJpbmcKICAgKi8KCgogIGZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCk7CiAgfQoKICBmdW5jdGlvbiBlc2NhcGVYbWwoc3RyaW5nKSB7CiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykucmVwbGFjZSgvJy9nLCAnJmFwb3M7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTsKICB9CiAgLyoqIEBuYW1lc3BhY2UgKi8KCgogIGZhYnJpYy51dGlsLnN0cmluZyA9IHsKICAgIGNhbWVsaXplOiBjYW1lbGl6ZSwKICAgIGNhcGl0YWxpemU6IGNhcGl0YWxpemUsCiAgICBlc2NhcGVYbWw6IGVzY2FwZVhtbAogIH07Cn0pKCk7CgooZnVuY3Rpb24gKCkgewogIHZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgICAgYXBwbHkgPSBGdW5jdGlvbi5wcm90b3R5cGUuYXBwbHksCiAgICAgIGR1bW15ID0gZnVuY3Rpb24gZHVtbXkoKSB7fTsKCiAgaWYgKCFGdW5jdGlvbi5wcm90b3R5cGUuYmluZCkgewogICAgLyoqCiAgICAgKiBDcm9zcy1icm93c2VyIGFwcHJveGltYXRpb24gb2YgRVM1IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kIChub3QgZnVsbHkgc3BlYyBjb25mb3JtaW5nKQogICAgICogQHNlZSA8YSBocmVmPSJodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9GdW5jdGlvbi9iaW5kIj5GdW5jdGlvbiNiaW5kIG9uIE1ETjwvYT4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0aGlzQXJnIE9iamVjdCB0byBiaW5kIGZ1bmN0aW9uIHRvCiAgICAgKiBAcGFyYW0ge0FueVtdfSBbLi4uXSBWYWx1ZXMgdG8gcGFzcyB0byBhIGJvdW5kIGZ1bmN0aW9uCiAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0KICAgICAqLwogICAgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAodGhpc0FyZykgewogICAgICB2YXIgZm4gPSB0aGlzLAogICAgICAgICAgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKICAgICAgICAgIGJvdW5kOwoKICAgICAgaWYgKGFyZ3MubGVuZ3RoKSB7CiAgICAgICAgYm91bmQgPSBmdW5jdGlvbiBib3VuZCgpIHsKICAgICAgICAgIHJldHVybiBhcHBseS5jYWxsKGZuLCB0aGlzIGluc3RhbmNlb2YgZHVtbXkgPyB0aGlzIDogdGhpc0FyZywgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBib3VuZCA9IGZ1bmN0aW9uIGJvdW5kKCkgewogICAgICAgICAgcmV0dXJuIGFwcGx5LmNhbGwoZm4sIHRoaXMgaW5zdGFuY2VvZiBkdW1teSA/IHRoaXMgOiB0aGlzQXJnLCBhcmd1bWVudHMpOwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIGR1bW15LnByb3RvdHlwZSA9IHRoaXMucHJvdG90eXBlOwogICAgICBib3VuZC5wcm90b3R5cGUgPSBuZXcgZHVtbXkoKTsKICAgICAgcmV0dXJuIGJvdW5kOwogICAgfTsKICB9Cn0pKCk7CgooZnVuY3Rpb24gKCkgewogIHZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgICAgZW1wdHlGdW5jdGlvbiA9IGZ1bmN0aW9uIGVtcHR5RnVuY3Rpb24oKSB7fTsKCiAgdmFyIElTX0RPTlRFTlVNX0JVR0dZID0gZnVuY3Rpb24gKCkgewogICAgZm9yICh2YXIgcCBpbiB7CiAgICAgIHRvU3RyaW5nOiAxCiAgICB9KSB7CiAgICAgIGlmIChwID09PSAndG9TdHJpbmcnKSByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfSgpOwogIC8qKiBAaWdub3JlICovCgoKICB2YXIgYWRkTWV0aG9kcyA9IGZ1bmN0aW9uIGFkZE1ldGhvZHMoa2xhc3MsIHNvdXJjZSwgcGFyZW50KSB7CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHsKICAgICAgaWYgKHByb3BlcnR5IGluIGtsYXNzLnByb3RvdHlwZSAmJiB0eXBlb2Yga2xhc3MucHJvdG90eXBlW3Byb3BlcnR5XSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAga2xhc3MucHJvdG90eXBlW3Byb3BlcnR5XSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHN1cGVyY2xhc3MgPSB0aGlzLmNvbnN0cnVjdG9yLnN1cGVyY2xhc3M7CiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3Iuc3VwZXJjbGFzcyA9IHBhcmVudDsKICAgICAgICAgICAgdmFyIHJldHVyblZhbHVlID0gc291cmNlW3Byb3BlcnR5XS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB0aGlzLmNvbnN0cnVjdG9yLnN1cGVyY2xhc3MgPSBzdXBlcmNsYXNzOwoKICAgICAgICAgICAgaWYgKHByb3BlcnR5ICE9PSAnaW5pdGlhbGl6ZScpIHsKICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgfShwcm9wZXJ0eSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAga2xhc3MucHJvdG90eXBlW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07CiAgICAgIH0KCiAgICAgIGlmIChJU19ET05URU5VTV9CVUdHWSkgewogICAgICAgIGlmIChzb3VyY2UudG9TdHJpbmcgIT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcpIHsKICAgICAgICAgIGtsYXNzLnByb3RvdHlwZS50b1N0cmluZyA9IHNvdXJjZS50b1N0cmluZzsKICAgICAgICB9CgogICAgICAgIGlmIChzb3VyY2UudmFsdWVPZiAhPT0gT2JqZWN0LnByb3RvdHlwZS52YWx1ZU9mKSB7CiAgICAgICAgICBrbGFzcy5wcm90b3R5cGUudmFsdWVPZiA9IHNvdXJjZS52YWx1ZU9mOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIGZ1bmN0aW9uIHN1YmNsYXNzKCkge30KCiAgOwogIC8qKgogICAqIEhlbHBlciBmb3IgY3JlYXRpb24gb2YgImNsYXNzZXMiCiAgICogQG1ldGhvZCBjcmVhdGVDbGFzcwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqLwoKICBmdW5jdGlvbiBjcmVhdGVDbGFzcygpIHsKICAgIHZhciBwYXJlbnQgPSBudWxsLAogICAgICAgIHByb3BlcnRpZXMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CgogICAgaWYgKHR5cGVvZiBwcm9wZXJ0aWVzWzBdID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHBhcmVudCA9IHByb3BlcnRpZXMuc2hpZnQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBrbGFzcygpIHsKICAgICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogICAga2xhc3Muc3VwZXJjbGFzcyA9IHBhcmVudDsKICAgIGtsYXNzLnN1YmNsYXNzZXMgPSBbXTsKCiAgICBpZiAocGFyZW50KSB7CiAgICAgIHN1YmNsYXNzLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICAgIGtsYXNzLnByb3RvdHlwZSA9IG5ldyBzdWJjbGFzcygpOwogICAgICBwYXJlbnQuc3ViY2xhc3Nlcy5wdXNoKGtsYXNzKTsKICAgIH0KCiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBhZGRNZXRob2RzKGtsYXNzLCBwcm9wZXJ0aWVzW2ldLCBwYXJlbnQpOwogICAgfQoKICAgIGlmICgha2xhc3MucHJvdG90eXBlLmluaXRpYWxpemUpIHsKICAgICAga2xhc3MucHJvdG90eXBlLmluaXRpYWxpemUgPSBlbXB0eUZ1bmN0aW9uOwogICAgfQoKICAgIGtsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGtsYXNzOwogICAgcmV0dXJuIGtsYXNzOwogIH0KCiAgZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MgPSBjcmVhdGVDbGFzczsKfSkoKTsKCihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgLyogRVZFTlQgSEFORExJTkcgKi8KICBmdW5jdGlvbiBhcmVIb3N0TWV0aG9kcyhvYmplY3QpIHsKICAgIHZhciBtZXRob2ROYW1lcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksCiAgICAgICAgdCwKICAgICAgICBpLAogICAgICAgIGxlbiA9IG1ldGhvZE5hbWVzLmxlbmd0aDsKCiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgdCA9IF90eXBlb2Yob2JqZWN0W21ldGhvZE5hbWVzW2ldXSk7CiAgICAgIGlmICghL14oPzpmdW5jdGlvbnxvYmplY3R8dW5rbm93bikkLy50ZXN0KHQpKSByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfQoKICB2YXIgZ2V0VW5pcXVlSWQgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodHlwZW9mIGZhYnJpYy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQudW5pcXVlSUQgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIHJldHVybiBlbGVtZW50LnVuaXF1ZUlEOwogICAgICB9OwogICAgfQoKICAgIHZhciB1aWQgPSAwOwogICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50Ll9fdW5pcXVlSUQgfHwgKGVsZW1lbnQuX191bmlxdWVJRCA9ICd1bmlxdWVJRF9fJyArIHVpZCsrKTsKICAgIH07CiAgfSgpOwogIC8qKiBAaWdub3JlICovCgoKICB2YXIgZ2V0RWxlbWVudCwgc2V0RWxlbWVudDsKCiAgKGZ1bmN0aW9uICgpIHsKICAgIHZhciBlbGVtZW50cyA9IHt9OwogICAgLyoqIEBpZ25vcmUgKi8KCiAgICBnZXRFbGVtZW50ID0gZnVuY3Rpb24gZ2V0RWxlbWVudCh1aWQpIHsKICAgICAgcmV0dXJuIGVsZW1lbnRzW3VpZF07CiAgICB9OwogICAgLyoqIEBpZ25vcmUgKi8KCgogICAgc2V0RWxlbWVudCA9IGZ1bmN0aW9uIHNldEVsZW1lbnQodWlkLCBlbGVtZW50KSB7CiAgICAgIGVsZW1lbnRzW3VpZF0gPSBlbGVtZW50OwogICAgfTsKICB9KSgpOwoKICBmdW5jdGlvbiBjcmVhdGVMaXN0ZW5lcih1aWQsIGhhbmRsZXIpIHsKICAgIHJldHVybiB7CiAgICAgIGhhbmRsZXI6IGhhbmRsZXIsCiAgICAgIHdyYXBwZWRIYW5kbGVyOiBjcmVhdGVXcmFwcGVkSGFuZGxlcih1aWQsIGhhbmRsZXIpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlV3JhcHBlZEhhbmRsZXIodWlkLCBoYW5kbGVyKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgaGFuZGxlci5jYWxsKGdldEVsZW1lbnQodWlkKSwgZSB8fCBmYWJyaWMud2luZG93LmV2ZW50KTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVEaXNwYXRjaGVyKHVpZCwgZXZlbnROYW1lKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGhhbmRsZXJzW3VpZF0gJiYgaGFuZGxlcnNbdWlkXVtldmVudE5hbWVdKSB7CiAgICAgICAgdmFyIGhhbmRsZXJzRm9yRXZlbnQgPSBoYW5kbGVyc1t1aWRdW2V2ZW50TmFtZV07CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBoYW5kbGVyc0ZvckV2ZW50Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBoYW5kbGVyc0ZvckV2ZW50W2ldLmNhbGwodGhpcywgZSB8fCBmYWJyaWMud2luZG93LmV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfQoKICB2YXIgc2hvdWxkVXNlQWRkTGlzdGVuZXJSZW1vdmVMaXN0ZW5lciA9IGFyZUhvc3RNZXRob2RzKGZhYnJpYy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsICdhZGRFdmVudExpc3RlbmVyJywgJ3JlbW92ZUV2ZW50TGlzdGVuZXInKSAmJiBhcmVIb3N0TWV0aG9kcyhmYWJyaWMud2luZG93LCAnYWRkRXZlbnRMaXN0ZW5lcicsICdyZW1vdmVFdmVudExpc3RlbmVyJyksCiAgICAgIHNob3VsZFVzZUF0dGFjaEV2ZW50RGV0YWNoRXZlbnQgPSBhcmVIb3N0TWV0aG9kcyhmYWJyaWMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCAnYXR0YWNoRXZlbnQnLCAnZGV0YWNoRXZlbnQnKSAmJiBhcmVIb3N0TWV0aG9kcyhmYWJyaWMud2luZG93LCAnYXR0YWNoRXZlbnQnLCAnZGV0YWNoRXZlbnQnKSwKICAgICAgLy8gSUUgYnJhbmNoCiAgbGlzdGVuZXJzID0ge30sCiAgICAgIC8vIERPTSBMMCBicmFuY2gKICBoYW5kbGVycyA9IHt9LAogICAgICBhZGRMaXN0ZW5lciwKICAgICAgcmVtb3ZlTGlzdGVuZXI7CgogIGlmIChzaG91bGRVc2VBZGRMaXN0ZW5lclJlbW92ZUxpc3RlbmVyKSB7CiAgICAvKiogQGlnbm9yZSAqLwogICAgYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlciwgZmFsc2UpOwogICAgfTsKICAgIC8qKiBAaWdub3JlICovCgoKICAgIHJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXIoZWxlbWVudCwgZXZlbnROYW1lLCBoYW5kbGVyKSB7CiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIsIGZhbHNlKTsKICAgIH07CiAgfSBlbHNlIGlmIChzaG91bGRVc2VBdHRhY2hFdmVudERldGFjaEV2ZW50KSB7CiAgICAvKiogQGlnbm9yZSAqLwogICAgYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgdmFyIHVpZCA9IGdldFVuaXF1ZUlkKGVsZW1lbnQpOwogICAgICBzZXRFbGVtZW50KHVpZCwgZWxlbWVudCk7CgogICAgICBpZiAoIWxpc3RlbmVyc1t1aWRdKSB7CiAgICAgICAgbGlzdGVuZXJzW3VpZF0gPSB7fTsKICAgICAgfQoKICAgICAgaWYgKCFsaXN0ZW5lcnNbdWlkXVtldmVudE5hbWVdKSB7CiAgICAgICAgbGlzdGVuZXJzW3VpZF1bZXZlbnROYW1lXSA9IFtdOwogICAgICB9CgogICAgICB2YXIgbGlzdGVuZXIgPSBjcmVhdGVMaXN0ZW5lcih1aWQsIGhhbmRsZXIpOwogICAgICBsaXN0ZW5lcnNbdWlkXVtldmVudE5hbWVdLnB1c2gobGlzdGVuZXIpOwogICAgICBlbGVtZW50LmF0dGFjaEV2ZW50KCdvbicgKyBldmVudE5hbWUsIGxpc3RlbmVyLndyYXBwZWRIYW5kbGVyKTsKICAgIH07CiAgICAvKiogQGlnbm9yZSAqLwoKCiAgICByZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgICB2YXIgdWlkID0gZ2V0VW5pcXVlSWQoZWxlbWVudCksCiAgICAgICAgICBsaXN0ZW5lcjsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdWlkXSAmJiBsaXN0ZW5lcnNbdWlkXVtldmVudE5hbWVdKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpc3RlbmVyc1t1aWRdW2V2ZW50TmFtZV0ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGxpc3RlbmVyID0gbGlzdGVuZXJzW3VpZF1bZXZlbnROYW1lXVtpXTsKCiAgICAgICAgICBpZiAobGlzdGVuZXIgJiYgbGlzdGVuZXIuaGFuZGxlciA9PT0gaGFuZGxlcikgewogICAgICAgICAgICBlbGVtZW50LmRldGFjaEV2ZW50KCdvbicgKyBldmVudE5hbWUsIGxpc3RlbmVyLndyYXBwZWRIYW5kbGVyKTsKICAgICAgICAgICAgbGlzdGVuZXJzW3VpZF1bZXZlbnROYW1lXVtpXSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0gZWxzZSB7CiAgICAvKiogQGlnbm9yZSAqLwogICAgYWRkTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgICAgdmFyIHVpZCA9IGdldFVuaXF1ZUlkKGVsZW1lbnQpOwoKICAgICAgaWYgKCFoYW5kbGVyc1t1aWRdKSB7CiAgICAgICAgaGFuZGxlcnNbdWlkXSA9IHt9OwogICAgICB9CgogICAgICBpZiAoIWhhbmRsZXJzW3VpZF1bZXZlbnROYW1lXSkgewogICAgICAgIGhhbmRsZXJzW3VpZF1bZXZlbnROYW1lXSA9IFtdOwogICAgICAgIHZhciBleGlzdGluZ0hhbmRsZXIgPSBlbGVtZW50WydvbicgKyBldmVudE5hbWVdOwoKICAgICAgICBpZiAoZXhpc3RpbmdIYW5kbGVyKSB7CiAgICAgICAgICBoYW5kbGVyc1t1aWRdW2V2ZW50TmFtZV0ucHVzaChleGlzdGluZ0hhbmRsZXIpOwogICAgICAgIH0KCiAgICAgICAgZWxlbWVudFsnb24nICsgZXZlbnROYW1lXSA9IGNyZWF0ZURpc3BhdGNoZXIodWlkLCBldmVudE5hbWUpOwogICAgICB9CgogICAgICBoYW5kbGVyc1t1aWRdW2V2ZW50TmFtZV0ucHVzaChoYW5kbGVyKTsKICAgIH07CiAgICAvKiogQGlnbm9yZSAqLwoKCiAgICByZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgICB2YXIgdWlkID0gZ2V0VW5pcXVlSWQoZWxlbWVudCk7CgogICAgICBpZiAoaGFuZGxlcnNbdWlkXSAmJiBoYW5kbGVyc1t1aWRdW2V2ZW50TmFtZV0pIHsKICAgICAgICB2YXIgaGFuZGxlcnNGb3JFdmVudCA9IGhhbmRsZXJzW3VpZF1bZXZlbnROYW1lXTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGhhbmRsZXJzRm9yRXZlbnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGlmIChoYW5kbGVyc0ZvckV2ZW50W2ldID09PSBoYW5kbGVyKSB7CiAgICAgICAgICAgIGhhbmRsZXJzRm9yRXZlbnQuc3BsaWNlKGksIDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CiAgLyoqCiAgICogQWRkcyBhbiBldmVudCBsaXN0ZW5lciB0byBhbiBlbGVtZW50CiAgICogQG10aG9kIGFkZExpc3RlbmVyCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsCiAgICogQGZ1bmN0aW9uCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyCiAgICovCgoKICBmYWJyaWMudXRpbC5hZGRMaXN0ZW5lciA9IGFkZExpc3RlbmVyOwogIC8qKgogICAqIFJlbW92ZXMgYW4gZXZlbnQgbGlzdGVuZXIgZnJvbSBhbiBlbGVtZW50CiAgICogQG10aG9kIHJlbW92ZUxpc3RlbmVyCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsCiAgICogQGZ1bmN0aW9uCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyCiAgICovCgogIGZhYnJpYy51dGlsLnJlbW92ZUxpc3RlbmVyID0gcmVtb3ZlTGlzdGVuZXI7CiAgLyoqCiAgICogQ3Jvc3MtYnJvd3NlciB3cmFwcGVyIGZvciBnZXR0aW5nIGV2ZW50J3MgY29vcmRpbmF0ZXMKICAgKiBAbWV0aG9kIGdldFBvaW50ZXIKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqLwoKICBmdW5jdGlvbiBnZXRQb2ludGVyKGV2ZW50KSB7CiAgICAvLyBUT0RPIChrYW5nYXgpOiB0aGlzIG1ldGhvZCBuZWVkcyBmaXhpbmcKICAgIHJldHVybiB7CiAgICAgIHg6IHBvaW50ZXJYKGV2ZW50KSwKICAgICAgeTogcG9pbnRlclkoZXZlbnQpCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gcG9pbnRlclgoZXZlbnQpIHsKICAgIHZhciBkb2NFbGVtZW50ID0gZmFicmljLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKICAgICAgICBib2R5ID0gZmFicmljLmRvY3VtZW50LmJvZHkgfHwgewogICAgICBzY3JvbGxMZWZ0OiAwCiAgICB9OyAvLyBsb29rcyBsaWtlIGluIElFICg8OSkgY2xpZW50WCBhdCBjZXJ0YWluIHBvaW50IChhcHBhcmVudGx5IHdoZW4gbW91c2V1cCBmaXJlcyBvbiBWTUwgZWxlbWVudCkKICAgIC8vIGlzIHJlcHJlc2VudGVkIGFzIENPTSBvYmplY3QsIHdpdGggYWxsIHRoZSBjb25zZXF1ZW5jZXMsIGxpa2UgInVua25vd24iIHR5cGUgYW5kIGVycm9yIG9uIFtbR2V0XV0KICAgIC8vIG5lZWQgdG8gaW52ZXN0aWdhdGUgbGF0ZXIKCiAgICByZXR1cm4gZXZlbnQucGFnZVggfHwgKHR5cGVvZiBldmVudC5jbGllbnRYICE9ICd1bmtub3duJyA/IGV2ZW50LmNsaWVudFggOiAwKSArIChkb2NFbGVtZW50LnNjcm9sbExlZnQgfHwgYm9keS5zY3JvbGxMZWZ0KSAtIChkb2NFbGVtZW50LmNsaWVudExlZnQgfHwgMCk7CiAgfQoKICBmdW5jdGlvbiBwb2ludGVyWShldmVudCkgewogICAgdmFyIGRvY0VsZW1lbnQgPSBmYWJyaWMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LAogICAgICAgIGJvZHkgPSBmYWJyaWMuZG9jdW1lbnQuYm9keSB8fCB7CiAgICAgIHNjcm9sbFRvcDogMAogICAgfTsKICAgIHJldHVybiBldmVudC5wYWdlWSB8fCAodHlwZW9mIGV2ZW50LmNsaWVudFkgIT0gJ3Vua25vd24nID8gZXZlbnQuY2xpZW50WSA6IDApICsgKGRvY0VsZW1lbnQuc2Nyb2xsVG9wIHx8IGJvZHkuc2Nyb2xsVG9wKSAtIChkb2NFbGVtZW50LmNsaWVudFRvcCB8fCAwKTsKICB9CgogIGlmIChmYWJyaWMuaXNUb3VjaFN1cHBvcnRlZCkgewogICAgcG9pbnRlclggPSBmdW5jdGlvbiBwb2ludGVyWChldmVudCkgewogICAgICByZXR1cm4gZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzWzBdICYmIGV2ZW50LnRvdWNoZXNbMF0ucGFnZVggfHwgZXZlbnQuY2xpZW50WDsKICAgIH07CgogICAgcG9pbnRlclkgPSBmdW5jdGlvbiBwb2ludGVyWShldmVudCkgewogICAgICByZXR1cm4gZXZlbnQudG91Y2hlcyAmJiBldmVudC50b3VjaGVzWzBdICYmIGV2ZW50LnRvdWNoZXNbMF0ucGFnZVkgfHwgZXZlbnQuY2xpZW50WTsKICAgIH07CiAgfQoKICBmYWJyaWMudXRpbC5nZXRQb2ludGVyID0gZ2V0UG9pbnRlcjsKICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy51dGlsLCBmYWJyaWMuT2JzZXJ2YWJsZSk7Cn0pKHRoaXMpOwoKKGZ1bmN0aW9uICgpIHsKICAvKioKICAgKiBDcm9zcy1icm93c2VyIHdyYXBwZXIgZm9yIHNldHRpbmcgZWxlbWVudCdzIHN0eWxlCiAgICogQG1ldGhvZCBzZXRTdHlsZQogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQKICAgKiBAcGFyYW0ge09iamVjdH0gc3R5bGVzCiAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9IEVsZW1lbnQgdGhhdCB3YXMgcGFzc2VkIGFzIGEgZmlyc3QgYXJndW1lbnQKICAgKi8KICBmdW5jdGlvbiBzZXRTdHlsZShlbGVtZW50LCBzdHlsZXMpIHsKICAgIHZhciBlbGVtZW50U3R5bGUgPSBlbGVtZW50LnN0eWxlLAogICAgICAgIG1hdGNoOwoKICAgIGlmICghZWxlbWVudFN0eWxlKSB7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQoKICAgIGlmICh0eXBlb2Ygc3R5bGVzID09PSAnc3RyaW5nJykgewogICAgICBlbGVtZW50LnN0eWxlLmNzc1RleHQgKz0gJzsnICsgc3R5bGVzOwogICAgICByZXR1cm4gc3R5bGVzLmluZGV4T2YoJ29wYWNpdHknKSA+IC0xID8gc2V0T3BhY2l0eShlbGVtZW50LCBzdHlsZXMubWF0Y2goL29wYWNpdHk6XHMqKFxkP1wuP1xkKikvKVsxXSkgOiBlbGVtZW50OwogICAgfQoKICAgIGZvciAodmFyIHByb3BlcnR5IGluIHN0eWxlcykgewogICAgICBpZiAocHJvcGVydHkgPT09ICdvcGFjaXR5JykgewogICAgICAgIHNldE9wYWNpdHkoZWxlbWVudCwgc3R5bGVzW3Byb3BlcnR5XSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG5vcm1hbGl6ZWRQcm9wZXJ0eSA9IHByb3BlcnR5ID09PSAnZmxvYXQnIHx8IHByb3BlcnR5ID09PSAnY3NzRmxvYXQnID8gdHlwZW9mIGVsZW1lbnRTdHlsZS5zdHlsZUZsb2F0ID09PSAndW5kZWZpbmVkJyA/ICdjc3NGbG9hdCcgOiAnc3R5bGVGbG9hdCcgOiBwcm9wZXJ0eTsKICAgICAgICBlbGVtZW50U3R5bGVbbm9ybWFsaXplZFByb3BlcnR5XSA9IHN0eWxlc1twcm9wZXJ0eV07CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZWxlbWVudDsKICB9CgogIHZhciBwYXJzZUVsID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAogICAgICBzdXBwb3J0c09wYWNpdHkgPSB0eXBlb2YgcGFyc2VFbC5zdHlsZS5vcGFjaXR5ID09PSAnc3RyaW5nJywKICAgICAgc3VwcG9ydHNGaWx0ZXJzID0gdHlwZW9mIHBhcnNlRWwuc3R5bGUuZmlsdGVyID09PSAnc3RyaW5nJywKICAgICAgdmlldyA9IGZhYnJpYy5kb2N1bWVudC5kZWZhdWx0VmlldywKICAgICAgc3VwcG9ydHNHQ1MgPSB2aWV3ICYmIHR5cGVvZiB2aWV3LmdldENvbXB1dGVkU3R5bGUgIT09ICd1bmRlZmluZWQnLAogICAgICByZU9wYWNpdHkgPSAvYWxwaGFccypcKFxzKm9wYWNpdHlccyo9XHMqKFteXCldKylcKS8sCgogIC8qKiBAaWdub3JlICovCiAgc2V0T3BhY2l0eSA9IGZ1bmN0aW9uIHNldE9wYWNpdHkoZWxlbWVudCkgewogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfTsKCiAgaWYgKHN1cHBvcnRzT3BhY2l0eSkgewogICAgLyoqIEBpZ25vcmUgKi8KICAgIHNldE9wYWNpdHkgPSBmdW5jdGlvbiBzZXRPcGFjaXR5KGVsZW1lbnQsIHZhbHVlKSB7CiAgICAgIGVsZW1lbnQuc3R5bGUub3BhY2l0eSA9IHZhbHVlOwogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH07CiAgfSBlbHNlIGlmIChzdXBwb3J0c0ZpbHRlcnMpIHsKICAgIC8qKiBAaWdub3JlICovCiAgICBzZXRPcGFjaXR5ID0gZnVuY3Rpb24gc2V0T3BhY2l0eShlbGVtZW50LCB2YWx1ZSkgewogICAgICB2YXIgZXMgPSBlbGVtZW50LnN0eWxlOwoKICAgICAgaWYgKGVsZW1lbnQuY3VycmVudFN0eWxlICYmICFlbGVtZW50LmN1cnJlbnRTdHlsZS5oYXNMYXlvdXQpIHsKICAgICAgICBlcy56b29tID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJlT3BhY2l0eS50ZXN0KGVzLmZpbHRlcikpIHsKICAgICAgICB2YWx1ZSA9IHZhbHVlID49IDAuOTk5OSA/ICcnIDogJ2FscGhhKG9wYWNpdHk9JyArIHZhbHVlICogMTAwICsgJyknOwogICAgICAgIGVzLmZpbHRlciA9IGVzLmZpbHRlci5yZXBsYWNlKHJlT3BhY2l0eSwgdmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIGVzLmZpbHRlciArPSAnIGFscGhhKG9wYWNpdHk9JyArIHZhbHVlICogMTAwICsgJyknOwogICAgICB9CgogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH07CiAgfQoKICBmYWJyaWMudXRpbC5zZXRTdHlsZSA9IHNldFN0eWxlOwp9KSgpOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgX3NsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogIC8qKgogICAqIFRha2VzIGlkIGFuZCByZXR1cm5zIGFuIGVsZW1lbnQgd2l0aCB0aGF0IGlkIChpZiBvbmUgZXhpc3RzIGluIGEgZG9jdW1lbnQpCiAgICogQG1ldGhvZCBnZXRCeUlkCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsCiAgICogQHBhcmFtIHtTdHJpbmd8SFRNTEVsZW1lbnR9IGlkCiAgICogQHJldHVybiB7SFRNTEVsZW1lbnR8bnVsbH0KICAgKi8KCiAgZnVuY3Rpb24gZ2V0QnlJZChpZCkgewogICAgcmV0dXJuIHR5cGVvZiBpZCA9PT0gJ3N0cmluZycgPyBmYWJyaWMuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpIDogaWQ7CiAgfQogIC8qKgogICAqIENvbnZlcnRzIGFuIGFycmF5LWxpa2Ugb2JqZWN0IChlLmcuIGFyZ3VtZW50cyBvciBOb2RlTGlzdCkgdG8gYW4gYXJyYXkKICAgKiBAbWV0aG9kIHRvQXJyYXkKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgKiBAcGFyYW0ge09iamVjdH0gYXJyYXlMaWtlCiAgICogQHJldHVybiB7QXJyYXl9CiAgICovCgoKICBmdW5jdGlvbiB0b0FycmF5KGFycmF5TGlrZSkgewogICAgcmV0dXJuIF9zbGljZS5jYWxsKGFycmF5TGlrZSwgMCk7CiAgfQoKICB0cnkgewogICAgdmFyIHNsaWNlQ2FuQ29udmVydE5vZGVsaXN0cyA9IHRvQXJyYXkoZmFicmljLmRvY3VtZW50LmNoaWxkTm9kZXMpIGluc3RhbmNlb2YgQXJyYXk7CiAgfSBjYXRjaCAoZXJyKSB7fQoKICBpZiAoIXNsaWNlQ2FuQ29udmVydE5vZGVsaXN0cykgewogICAgdG9BcnJheSA9IGZ1bmN0aW9uIHRvQXJyYXkoYXJyYXlMaWtlKSB7CiAgICAgIHZhciBhcnIgPSBuZXcgQXJyYXkoYXJyYXlMaWtlLmxlbmd0aCksCiAgICAgICAgICBpID0gYXJyYXlMaWtlLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBhcnJbaV0gPSBhcnJheUxpa2VbaV07CiAgICAgIH0KCiAgICAgIHJldHVybiBhcnI7CiAgICB9OwogIH0KICAvKioKICAgKiBDcmVhdGVzIHNwZWNpZmllZCBlbGVtZW50IHdpdGggc3BlY2lmaWVkIGF0dHJpYnV0ZXMKICAgKiBAbWV0aG9kIG1ha2VFbGVtZW50CiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsCiAgICogQHBhcmFtIHtTdHJpbmd9IHRhZ05hbWUgVHlwZSBvZiBhbiBlbGVtZW50IHRvIGNyZWF0ZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbYXR0cmlidXRlc10gQXR0cmlidXRlcyB0byBzZXQgb24gYW4gZWxlbWVudAogICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBOZXdseSBjcmVhdGVkIGVsZW1lbnQKICAgKi8KCgogIGZ1bmN0aW9uIG1ha2VFbGVtZW50KHRhZ05hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIHZhciBlbCA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwoKICAgIGZvciAodmFyIHByb3AgaW4gYXR0cmlidXRlcykgewogICAgICBpZiAocHJvcCA9PT0gJ2NsYXNzJykgewogICAgICAgIGVsLmNsYXNzTmFtZSA9IGF0dHJpYnV0ZXNbcHJvcF07CiAgICAgIH0gZWxzZSBpZiAocHJvcCA9PT0gJ2ZvcicpIHsKICAgICAgICBlbC5odG1sRm9yID0gYXR0cmlidXRlc1twcm9wXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUocHJvcCwgYXR0cmlidXRlc1twcm9wXSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZWw7CiAgfQogIC8qKgogICAqIEFkZHMgY2xhc3MgdG8gYW4gZWxlbWVudAogICAqIEBtZXRob2QgYWRkQ2xhc3MKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgdG8gYWRkIGNsYXNzIHRvCiAgICogQHBhcmFtIHtTdHJpbmd9IGNsYXNzTmFtZSBDbGFzcyB0byBhZGQgdG8gYW4gZWxlbWVudAogICAqLwoKCiAgZnVuY3Rpb24gYWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7CiAgICBpZiAoKCcgJyArIGVsZW1lbnQuY2xhc3NOYW1lICsgJyAnKS5pbmRleE9mKCcgJyArIGNsYXNzTmFtZSArICcgJykgPT09IC0xKSB7CiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lICs9IChlbGVtZW50LmNsYXNzTmFtZSA/ICcgJyA6ICcnKSArIGNsYXNzTmFtZTsKICAgIH0KICB9CiAgLyoqCiAgICogV3JhcHMgZWxlbWVudCB3aXRoIGFub3RoZXIgZWxlbWVudAogICAqIEBtZXRob2Qgd3JhcEVsZW1lbnQKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgdG8gd3JhcAogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8U3RyaW5nfSB3cmFwcGVyIEVsZW1lbnQgdG8gd3JhcCB3aXRoCiAgICogQHBhcmFtIHtPYmplY3R9IFthdHRyaWJ1dGVzXSBBdHRyaWJ1dGVzIHRvIHNldCBvbiBhIHdyYXBwZXIKICAgKiBAcmV0dXJuIHtIVE1MRWxlbWVudH0gd3JhcHBlcgogICAqLwoKCiAgZnVuY3Rpb24gd3JhcEVsZW1lbnQoZWxlbWVudCwgd3JhcHBlciwgYXR0cmlidXRlcykgewogICAgaWYgKHR5cGVvZiB3cmFwcGVyID09PSAnc3RyaW5nJykgewogICAgICB3cmFwcGVyID0gbWFrZUVsZW1lbnQod3JhcHBlciwgYXR0cmlidXRlcyk7CiAgICB9CgogICAgaWYgKGVsZW1lbnQucGFyZW50Tm9kZSkgewogICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHdyYXBwZXIsIGVsZW1lbnQpOwogICAgfQoKICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7CiAgICByZXR1cm4gd3JhcHBlcjsKICB9CiAgLyoqCiAgICogUmV0dXJucyBvZmZzZXQgZm9yIGEgZ2l2ZW4gZWxlbWVudAogICAqIEBtZXRob2QgZ2V0RWxlbWVudE9mZnNldAogICAqIEBmdW5jdGlvbgogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbAogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBnZXQgb2Zmc2V0IGZvcgogICAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IHdpdGggImxlZnQiIGFuZCAidG9wIiBwcm9wZXJ0aWVzCiAgICovCgoKICBmdW5jdGlvbiBnZXRFbGVtZW50T2Zmc2V0KGVsZW1lbnQpIHsKICAgIC8vIFRPRE8gKGthbmdheCk6IG5lZWQgdG8gZml4IHRoaXMgbWV0aG9kCiAgICB2YXIgdmFsdWVUID0gMCwKICAgICAgICB2YWx1ZUwgPSAwOwoKICAgIGRvIHsKICAgICAgdmFsdWVUICs9IGVsZW1lbnQub2Zmc2V0VG9wIHx8IDA7CiAgICAgIHZhbHVlTCArPSBlbGVtZW50Lm9mZnNldExlZnQgfHwgMDsKICAgICAgZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50OwogICAgfSB3aGlsZSAoZWxlbWVudCk7CgogICAgcmV0dXJuIHsKICAgICAgbGVmdDogdmFsdWVMLAogICAgICB0b3A6IHZhbHVlVAogICAgfTsKICB9CgogIChmdW5jdGlvbiAoKSB7CiAgICB2YXIgc3R5bGUgPSBmYWJyaWMuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlOwogICAgdmFyIHNlbGVjdFByb3AgPSAndXNlclNlbGVjdCcgaW4gc3R5bGUgPyAndXNlclNlbGVjdCcgOiAnTW96VXNlclNlbGVjdCcgaW4gc3R5bGUgPyAnTW96VXNlclNlbGVjdCcgOiAnV2Via2l0VXNlclNlbGVjdCcgaW4gc3R5bGUgPyAnV2Via2l0VXNlclNlbGVjdCcgOiAnS2h0bWxVc2VyU2VsZWN0JyBpbiBzdHlsZSA/ICdLaHRtbFVzZXJTZWxlY3QnIDogJyc7CiAgICAvKioKICAgICAqIE1ha2VzIGVsZW1lbnQgdW5zZWxlY3RhYmxlCiAgICAgKiBAbWV0aG9kIG1ha2VFbGVtZW50VW5zZWxlY3RhYmxlCiAgICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBtYWtlIHVuc2VsZWN0YWJsZQogICAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9IEVsZW1lbnQgdGhhdCB3YXMgcGFzc2VkIGluCiAgICAgKi8KCiAgICBmdW5jdGlvbiBtYWtlRWxlbWVudFVuc2VsZWN0YWJsZShlbGVtZW50KSB7CiAgICAgIGlmICh0eXBlb2YgZWxlbWVudC5vbnNlbGVjdHN0YXJ0ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGVsZW1lbnQub25zZWxlY3RzdGFydCA9IGZhYnJpYy51dGlsLmZhbHNlRnVuY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChzZWxlY3RQcm9wKSB7CiAgICAgICAgZWxlbWVudC5zdHlsZVtzZWxlY3RQcm9wXSA9ICdub25lJzsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZWxlbWVudC51bnNlbGVjdGFibGUgPT0gJ3N0cmluZycpIHsKICAgICAgICBlbGVtZW50LnVuc2VsZWN0YWJsZSA9ICdvbic7CiAgICAgIH0KCiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQogICAgLyoqCiAgICAgKiBNYWtlcyBlbGVtZW50IHNlbGVjdGFibGUKICAgICAqIEBtZXRob2QgbWFrZUVsZW1lbnRTZWxlY3RhYmxlCiAgICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBtYWtlIHNlbGVjdGFibGUKICAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBFbGVtZW50IHRoYXQgd2FzIHBhc3NlZCBpbgogICAgICovCgoKICAgIGZ1bmN0aW9uIG1ha2VFbGVtZW50U2VsZWN0YWJsZShlbGVtZW50KSB7CiAgICAgIGlmICh0eXBlb2YgZWxlbWVudC5vbnNlbGVjdHN0YXJ0ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIGVsZW1lbnQub25zZWxlY3RzdGFydCA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChzZWxlY3RQcm9wKSB7CiAgICAgICAgZWxlbWVudC5zdHlsZVtzZWxlY3RQcm9wXSA9ICcnOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlbGVtZW50LnVuc2VsZWN0YWJsZSA9PSAnc3RyaW5nJykgewogICAgICAgIGVsZW1lbnQudW5zZWxlY3RhYmxlID0gJyc7CiAgICAgIH0KCiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQoKICAgIGZhYnJpYy51dGlsLm1ha2VFbGVtZW50VW5zZWxlY3RhYmxlID0gbWFrZUVsZW1lbnRVbnNlbGVjdGFibGU7CiAgICBmYWJyaWMudXRpbC5tYWtlRWxlbWVudFNlbGVjdGFibGUgPSBtYWtlRWxlbWVudFNlbGVjdGFibGU7CiAgfSkoKTsKCiAgKGZ1bmN0aW9uICgpIHsKICAgIC8qKgogICAgICogSW5zZXJ0cyBhIHNjcmlwdCBlbGVtZW50IHdpdGggYSBnaXZlbiB1cmwgaW50byBhIGRvY3VtZW50OyBpbnZva2VzIGNhbGxiYWNrLCB3aGVuIHRoYXQgc2NyaXB0IGlzIGZpbmlzaGVkIGxvYWRpbmcKICAgICAqIEBtZXRob2QgZ2V0U2NyaXB0CiAgICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVVJMIG9mIGEgc2NyaXB0IHRvIGxvYWQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGV4ZWN1dGUgd2hlbiBzY3JpcHQgaXMgZmluaXNoZWQgbG9hZGluZwogICAgICovCiAgICBmdW5jdGlvbiBnZXRTY3JpcHQodXJsLCBjYWxsYmFjaykgewogICAgICB2YXIgaGVhZEVsID0gZmFicmljLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0sCiAgICAgICAgICBzY3JpcHRFbCA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSwKICAgICAgICAgIGxvYWRpbmcgPSB0cnVlOwogICAgICBzY3JpcHRFbC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7CiAgICAgIHNjcmlwdEVsLnNldEF0dHJpYnV0ZSgncnVuYXQnLCAnc2VydmVyJyk7CiAgICAgIC8qKiBAaWdub3JlICovCgogICAgICBzY3JpcHRFbC5vbmxvYWQgPQogICAgICAvKiogQGlnbm9yZSAqLwogICAgICBzY3JpcHRFbC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChsb2FkaW5nKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHRoaXMucmVhZHlTdGF0ZSA9PSAnc3RyaW5nJyAmJiB0aGlzLnJlYWR5U3RhdGUgIT09ICdsb2FkZWQnICYmIHRoaXMucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykgcmV0dXJuOwogICAgICAgICAgbG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgY2FsbGJhY2soZSB8fCBmYWJyaWMud2luZG93LmV2ZW50KTsKICAgICAgICAgIHNjcmlwdEVsID0gc2NyaXB0RWwub25sb2FkID0gc2NyaXB0RWwub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKICAgICAgICB9CiAgICAgIH07CgogICAgICBzY3JpcHRFbC5zcmMgPSB1cmw7CiAgICAgIGhlYWRFbC5hcHBlbmRDaGlsZChzY3JpcHRFbCk7IC8vIGNhdXNlcyBpc3N1ZSBpbiBPcGVyYQogICAgICAvLyBoZWFkRWwucmVtb3ZlQ2hpbGQoc2NyaXB0RWwpOwogICAgfQoKICAgIGZhYnJpYy51dGlsLmdldFNjcmlwdCA9IGdldFNjcmlwdDsKICB9KSgpOwoKICBmYWJyaWMudXRpbC5nZXRCeUlkID0gZ2V0QnlJZDsKICBmYWJyaWMudXRpbC50b0FycmF5ID0gdG9BcnJheTsKICBmYWJyaWMudXRpbC5tYWtlRWxlbWVudCA9IG1ha2VFbGVtZW50OwogIGZhYnJpYy51dGlsLmFkZENsYXNzID0gYWRkQ2xhc3M7CiAgZmFicmljLnV0aWwud3JhcEVsZW1lbnQgPSB3cmFwRWxlbWVudDsKICBmYWJyaWMudXRpbC5nZXRFbGVtZW50T2Zmc2V0ID0gZ2V0RWxlbWVudE9mZnNldDsKfSkoKTsKCihmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gYWRkUGFyYW1Ub1VybCh1cmwsIHBhcmFtKSB7CiAgICByZXR1cm4gdXJsICsgKC9cPy8udGVzdCh1cmwpID8gJyYnIDogJz8nKSArIHBhcmFtOwogIH0KCiAgdmFyIG1ha2VYSFIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZmFjdG9yaWVzID0gW2Z1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOwogICAgfSwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoIk1zeG1sMi5YTUxIVFRQIik7CiAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAuMy4wIik7CiAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIH1dOwoKICAgIGZvciAodmFyIGkgPSBmYWN0b3JpZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIHJlcSA9IGZhY3Rvcmllc1tpXSgpOwoKICAgICAgICBpZiAocmVxKSB7CiAgICAgICAgICByZXR1cm4gZmFjdG9yaWVzW2ldOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7fQogICAgfQogIH0oKTsKCiAgZnVuY3Rpb24gZW1wdHlGbigpIHt9CgogIDsKICAvKioKICAgKiBDcm9zcy1icm93c2VyIGFic3RyYWN0aW9uIGZvciBzZW5kaW5nIFhNTEh0dHBSZXF1ZXN0CiAgICogQG1ldGhvZCByZXF1ZXN0CiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsCiAgICogQHBhcmFtIHtTdHJpbmd9IHVybCBVUkwgdG8gc2VuZCBYTUxIdHRwUmVxdWVzdCB0bwogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QKICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMubWV0aG9kPSJHRVQiXQogICAqIEBwYXJhbSB7RnVuY3Rpb259IG9wdGlvbnMub25Db21wbGV0ZSBDYWxsYmFjayB0byBpbnZva2Ugd2hlbiByZXF1ZXN0IGlzIGNvbXBsZXRlZAogICAqIEByZXR1cm4ge1hNTEh0dHBSZXF1ZXN0fSByZXF1ZXN0CiAgICovCgogIGZ1bmN0aW9uIHJlcXVlc3QodXJsLCBvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgIHZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCA/IG9wdGlvbnMubWV0aG9kLnRvVXBwZXJDYXNlKCkgOiAnR0VUJywKICAgICAgICBvbkNvbXBsZXRlID0gb3B0aW9ucy5vbkNvbXBsZXRlIHx8IGZ1bmN0aW9uICgpIHt9LAogICAgICAgIHJlcXVlc3QgPSBtYWtlWEhSKCksCiAgICAgICAgYm9keTsKICAgIC8qKiBAaWdub3JlICovCgoKICAgIHJlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAocmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgb25Db21wbGV0ZShyZXF1ZXN0KTsKICAgICAgICByZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGVtcHR5Rm47CiAgICAgIH0KICAgIH07CgogICAgaWYgKG1ldGhvZCA9PT0gJ0dFVCcpIHsKICAgICAgYm9keSA9IG51bGw7CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMucGFyYW1ldGVycyA9PSAnc3RyaW5nJykgewogICAgICAgIHVybCA9IGFkZFBhcmFtVG9VcmwodXJsLCBvcHRpb25zLnBhcmFtZXRlcnMpOwogICAgICB9CiAgICB9CgogICAgcmVxdWVzdC5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTsKCiAgICBpZiAobWV0aG9kID09PSAnUE9TVCcgfHwgbWV0aG9kID09PSAnUFVUJykgewogICAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsKICAgIH0KCiAgICByZXF1ZXN0LnNlbmQoYm9keSk7CiAgICByZXR1cm4gcmVxdWVzdDsKICB9CgogIDsKICBmYWJyaWMudXRpbC5yZXF1ZXN0ID0gcmVxdWVzdDsKfSkoKTsKCihmdW5jdGlvbiAoKSB7CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlSW5RdWFkCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KICBmdW5jdGlvbiBlYXNlSW5RdWFkKHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiBjICogKHQgLz0gZCkgKiB0ICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlT3V0UXVhZAogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlT3V0UXVhZCh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gLWMgKiAodCAvPSBkKSAqICh0IC0gMikgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJbk91dFF1YWQKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwuZWFzZQogICAqLwoKCiAgZnVuY3Rpb24gZWFzZUluT3V0UXVhZCh0LCBiLCBjLCBkKSB7CiAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKyBiOwogICAgcmV0dXJuIC1jIC8gMiAqICgtLXQgKiAodCAtIDIpIC0gMSkgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJbkN1YmljCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJbkN1YmljKHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiBjICogKHQgLz0gZCkgKiB0ICogdCArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZU91dEN1YmljCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VPdXRDdWJpYyh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gYyAqICgodCA9IHQgLyBkIC0gMSkgKiB0ICogdCArIDEpICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlSW5PdXRDdWJpYwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5PdXRDdWJpYyh0LCBiLCBjLCBkKSB7CiAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKiB0ICsgYjsKICAgIHJldHVybiBjIC8gMiAqICgodCAtPSAyKSAqIHQgKiB0ICsgMikgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJblF1YXJ0CiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJblF1YXJ0KHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiBjICogKHQgLz0gZCkgKiB0ICogdCAqIHQgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VPdXRRdWFydAogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlT3V0UXVhcnQodCwgYiwgYywgZCkgewogICAgcmV0dXJuIC1jICogKCh0ID0gdCAvIGQgLSAxKSAqIHQgKiB0ICogdCAtIDEpICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlSW5PdXRRdWFydAogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5PdXRRdWFydCh0LCBiLCBjLCBkKSB7CiAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKiB0ICogdCArIGI7CiAgICByZXR1cm4gLWMgLyAyICogKCh0IC09IDIpICogdCAqIHQgKiB0IC0gMikgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJblF1aW50CiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJblF1aW50KHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiBjICogKHQgLz0gZCkgKiB0ICogdCAqIHQgKiB0ICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlT3V0UXVpbnQKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwuZWFzZQogICAqLwoKCiAgZnVuY3Rpb24gZWFzZU91dFF1aW50KHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiBjICogKCh0ID0gdCAvIGQgLSAxKSAqIHQgKiB0ICogdCAqIHQgKyAxKSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluT3V0UXVpbnQKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwuZWFzZQogICAqLwoKCiAgZnVuY3Rpb24gZWFzZUluT3V0UXVpbnQodCwgYiwgYywgZCkgewogICAgaWYgKCh0IC89IGQgLyAyKSA8IDEpIHJldHVybiBjIC8gMiAqIHQgKiB0ICogdCAqIHQgKiB0ICsgYjsKICAgIHJldHVybiBjIC8gMiAqICgodCAtPSAyKSAqIHQgKiB0ICogdCAqIHQgKyAyKSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluU2luZQogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5TaW5lKHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiAtYyAqIE1hdGguY29zKHQgLyBkICogKE1hdGguUEkgLyAyKSkgKyBjICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlT3V0U2luZQogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlT3V0U2luZSh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gYyAqIE1hdGguc2luKHQgLyBkICogKE1hdGguUEkgLyAyKSkgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJbk91dFNpbmUKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwuZWFzZQogICAqLwoKCiAgZnVuY3Rpb24gZWFzZUluT3V0U2luZSh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gLWMgLyAyICogKE1hdGguY29zKE1hdGguUEkgKiB0IC8gZCkgLSAxKSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluRXhwbwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5FeHBvKHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiB0ID09IDAgPyBiIDogYyAqIE1hdGgucG93KDIsIDEwICogKHQgLyBkIC0gMSkpICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlT3V0RXhwbwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlT3V0RXhwbyh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gdCA9PSBkID8gYiArIGMgOiBjICogKC1NYXRoLnBvdygyLCAtMTAgKiB0IC8gZCkgKyAxKSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluT3V0RXhwbwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5PdXRFeHBvKHQsIGIsIGMsIGQpIHsKICAgIGlmICh0ID09IDApIHJldHVybiBiOwogICAgaWYgKHQgPT0gZCkgcmV0dXJuIGIgKyBjOwogICAgaWYgKCh0IC89IGQgLyAyKSA8IDEpIHJldHVybiBjIC8gMiAqIE1hdGgucG93KDIsIDEwICogKHQgLSAxKSkgKyBiOwogICAgcmV0dXJuIGMgLyAyICogKC1NYXRoLnBvdygyLCAtMTAgKiAtLXQpICsgMikgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJbkNpcmMKICAgKiBAbWVtYmVyT2YgZmFicmljLnV0aWwuZWFzZQogICAqLwoKCiAgZnVuY3Rpb24gZWFzZUluQ2lyYyh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gLWMgKiAoTWF0aC5zcXJ0KDEgLSAodCAvPSBkKSAqIHQpIC0gMSkgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VPdXRDaXJjCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VPdXRDaXJjKHQsIGIsIGMsIGQpIHsKICAgIHJldHVybiBjICogTWF0aC5zcXJ0KDEgLSAodCA9IHQgLyBkIC0gMSkgKiB0KSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluT3V0Q2lyYwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5PdXRDaXJjKHQsIGIsIGMsIGQpIHsKICAgIGlmICgodCAvPSBkIC8gMikgPCAxKSByZXR1cm4gLWMgLyAyICogKE1hdGguc3FydCgxIC0gdCAqIHQpIC0gMSkgKyBiOwogICAgcmV0dXJuIGMgLyAyICogKE1hdGguc3FydCgxIC0gKHQgLT0gMikgKiB0KSArIDEpICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlSW5FbGFzdGljCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJbkVsYXN0aWModCwgYiwgYywgZCkgewogICAgdmFyIHMgPSAxLjcwMTU4OwogICAgdmFyIHAgPSAwOwogICAgdmFyIGEgPSBjOwogICAgaWYgKHQgPT0gMCkgcmV0dXJuIGI7CiAgICBpZiAoKHQgLz0gZCkgPT0gMSkgcmV0dXJuIGIgKyBjOwogICAgaWYgKCFwKSBwID0gZCAqIC4zOwoKICAgIGlmIChhIDwgTWF0aC5hYnMoYykpIHsKICAgICAgYSA9IGM7CiAgICAgIHZhciBzID0gcCAvIDQ7CiAgICB9IGVsc2UgdmFyIHMgPSBwIC8gKDIgKiBNYXRoLlBJKSAqIE1hdGguYXNpbihjIC8gYSk7CgogICAgcmV0dXJuIC0oYSAqIE1hdGgucG93KDIsIDEwICogKHQgLT0gMSkpICogTWF0aC5zaW4oKHQgKiBkIC0gcykgKiAoMiAqIE1hdGguUEkpIC8gcCkpICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlT3V0RWxhc3RpYwogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlT3V0RWxhc3RpYyh0LCBiLCBjLCBkKSB7CiAgICB2YXIgcyA9IDEuNzAxNTg7CiAgICB2YXIgcCA9IDA7CiAgICB2YXIgYSA9IGM7CiAgICBpZiAodCA9PSAwKSByZXR1cm4gYjsKICAgIGlmICgodCAvPSBkKSA9PSAxKSByZXR1cm4gYiArIGM7CiAgICBpZiAoIXApIHAgPSBkICogLjM7CgogICAgaWYgKGEgPCBNYXRoLmFicyhjKSkgewogICAgICBhID0gYzsKICAgICAgdmFyIHMgPSBwIC8gNDsKICAgIH0gZWxzZSB2YXIgcyA9IHAgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKGMgLyBhKTsKCiAgICByZXR1cm4gYSAqIE1hdGgucG93KDIsIC0xMCAqIHQpICogTWF0aC5zaW4oKHQgKiBkIC0gcykgKiAoMiAqIE1hdGguUEkpIC8gcCkgKyBjICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlSW5PdXRFbGFzdGljCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJbk91dEVsYXN0aWModCwgYiwgYywgZCkgewogICAgdmFyIHMgPSAxLjcwMTU4OwogICAgdmFyIHAgPSAwOwogICAgdmFyIGEgPSBjOwogICAgaWYgKHQgPT0gMCkgcmV0dXJuIGI7CiAgICBpZiAoKHQgLz0gZCAvIDIpID09IDIpIHJldHVybiBiICsgYzsKICAgIGlmICghcCkgcCA9IGQgKiAoLjMgKiAxLjUpOwoKICAgIGlmIChhIDwgTWF0aC5hYnMoYykpIHsKICAgICAgYSA9IGM7CiAgICAgIHZhciBzID0gcCAvIDQ7CiAgICB9IGVsc2UgdmFyIHMgPSBwIC8gKDIgKiBNYXRoLlBJKSAqIE1hdGguYXNpbihjIC8gYSk7CgogICAgaWYgKHQgPCAxKSByZXR1cm4gLS41ICogKGEgKiBNYXRoLnBvdygyLCAxMCAqICh0IC09IDEpKSAqIE1hdGguc2luKCh0ICogZCAtIHMpICogKDIgKiBNYXRoLlBJKSAvIHApKSArIGI7CiAgICByZXR1cm4gYSAqIE1hdGgucG93KDIsIC0xMCAqICh0IC09IDEpKSAqIE1hdGguc2luKCh0ICogZCAtIHMpICogKDIgKiBNYXRoLlBJKSAvIHApICogLjUgKyBjICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlSW5CYWNrCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJbkJhY2sodCwgYiwgYywgZCwgcykgewogICAgaWYgKHMgPT0gdW5kZWZpbmVkKSBzID0gMS43MDE1ODsKICAgIHJldHVybiBjICogKHQgLz0gZCkgKiB0ICogKChzICsgMSkgKiB0IC0gcykgKyBiOwogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VPdXRCYWNrCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VPdXRCYWNrKHQsIGIsIGMsIGQsIHMpIHsKICAgIGlmIChzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7CiAgICByZXR1cm4gYyAqICgodCA9IHQgLyBkIC0gMSkgKiB0ICogKChzICsgMSkgKiB0ICsgcykgKyAxKSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluT3V0QmFjawogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5PdXRCYWNrKHQsIGIsIGMsIGQsIHMpIHsKICAgIGlmIChzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7CiAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogKHQgKiB0ICogKCgocyAqPSAxLjUyNSkgKyAxKSAqIHQgLSBzKSkgKyBiOwogICAgcmV0dXJuIGMgLyAyICogKCh0IC09IDIpICogdCAqICgoKHMgKj0gMS41MjUpICsgMSkgKiB0ICsgcykgKyAyKSArIGI7CiAgfQogIC8qKgogICAqIEBtZXRob2QgZWFzZUluQm91bmNlCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VJbkJvdW5jZSh0LCBiLCBjLCBkKSB7CiAgICByZXR1cm4gYyAtIGVhc2VPdXRCb3VuY2UoZCAtIHQsIDAsIGMsIGQpICsgYjsKICB9CiAgLyoqCiAgICogQG1ldGhvZCBlYXNlT3V0Qm91bmNlCiAgICogQG1lbWJlck9mIGZhYnJpYy51dGlsLmVhc2UKICAgKi8KCgogIGZ1bmN0aW9uIGVhc2VPdXRCb3VuY2UodCwgYiwgYywgZCkgewogICAgaWYgKCh0IC89IGQpIDwgMSAvIDIuNzUpIHsKICAgICAgcmV0dXJuIGMgKiAoNy41NjI1ICogdCAqIHQpICsgYjsKICAgIH0gZWxzZSBpZiAodCA8IDIgLyAyLjc1KSB7CiAgICAgIHJldHVybiBjICogKDcuNTYyNSAqICh0IC09IDEuNSAvIDIuNzUpICogdCArIC43NSkgKyBiOwogICAgfSBlbHNlIGlmICh0IDwgMi41IC8gMi43NSkgewogICAgICByZXR1cm4gYyAqICg3LjU2MjUgKiAodCAtPSAyLjI1IC8gMi43NSkgKiB0ICsgLjkzNzUpICsgYjsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBjICogKDcuNTYyNSAqICh0IC09IDIuNjI1IC8gMi43NSkgKiB0ICsgLjk4NDM3NSkgKyBiOwogICAgfQogIH0KICAvKioKICAgKiBAbWV0aG9kIGVhc2VJbk91dEJvdW5jZQogICAqIEBtZW1iZXJPZiBmYWJyaWMudXRpbC5lYXNlCiAgICovCgoKICBmdW5jdGlvbiBlYXNlSW5PdXRCb3VuY2UodCwgYiwgYywgZCkgewogICAgaWYgKHQgPCBkIC8gMikgcmV0dXJuIGVhc2VJbkJvdW5jZSh0ICogMiwgMCwgYywgZCkgKiAuNSArIGI7CiAgICByZXR1cm4gZWFzZU91dEJvdW5jZSh0ICogMiAtIGQsIDAsIGMsIGQpICogLjUgKyBjICogLjUgKyBiOwogIH0KICAvKiogQG5hbWVzcGFjZSBmYWJyaWMudXRpbC5lYXNlICovCgoKICBmYWJyaWMudXRpbC5lYXNlID0gewogICAgZWFzZUluUXVhZDogZWFzZUluUXVhZCwKICAgIGVhc2VPdXRRdWFkOiBlYXNlT3V0UXVhZCwKICAgIGVhc2VJbk91dFF1YWQ6IGVhc2VJbk91dFF1YWQsCiAgICBlYXNlSW5DdWJpYzogZWFzZUluQ3ViaWMsCiAgICBlYXNlT3V0Q3ViaWM6IGVhc2VPdXRDdWJpYywKICAgIGVhc2VJbk91dEN1YmljOiBlYXNlSW5PdXRDdWJpYywKICAgIGVhc2VJblF1YXJ0OiBlYXNlSW5RdWFydCwKICAgIGVhc2VPdXRRdWFydDogZWFzZU91dFF1YXJ0LAogICAgZWFzZUluT3V0UXVhcnQ6IGVhc2VJbk91dFF1YXJ0LAogICAgZWFzZUluUXVpbnQ6IGVhc2VJblF1aW50LAogICAgZWFzZU91dFF1aW50OiBlYXNlT3V0UXVpbnQsCiAgICBlYXNlSW5PdXRRdWludDogZWFzZUluT3V0UXVpbnQsCiAgICBlYXNlSW5TaW5lOiBlYXNlSW5TaW5lLAogICAgZWFzZU91dFNpbmU6IGVhc2VPdXRTaW5lLAogICAgZWFzZUluT3V0U2luZTogZWFzZUluT3V0U2luZSwKICAgIGVhc2VJbkV4cG86IGVhc2VJbkV4cG8sCiAgICBlYXNlT3V0RXhwbzogZWFzZU91dEV4cG8sCiAgICBlYXNlSW5PdXRFeHBvOiBlYXNlSW5PdXRFeHBvLAogICAgZWFzZUluQ2lyYzogZWFzZUluQ2lyYywKICAgIGVhc2VPdXRDaXJjOiBlYXNlT3V0Q2lyYywKICAgIGVhc2VJbk91dENpcmM6IGVhc2VJbk91dENpcmMsCiAgICBlYXNlSW5FbGFzdGljOiBlYXNlSW5FbGFzdGljLAogICAgZWFzZU91dEVsYXN0aWM6IGVhc2VPdXRFbGFzdGljLAogICAgZWFzZUluT3V0RWxhc3RpYzogZWFzZUluT3V0RWxhc3RpYywKICAgIGVhc2VJbkJhY2s6IGVhc2VJbkJhY2ssCiAgICBlYXNlT3V0QmFjazogZWFzZU91dEJhY2ssCiAgICBlYXNlSW5PdXRCYWNrOiBlYXNlSW5PdXRCYWNrLAogICAgZWFzZUluQm91bmNlOiBlYXNlSW5Cb3VuY2UsCiAgICBlYXNlT3V0Qm91bmNlOiBlYXNlT3V0Qm91bmNlLAogICAgZWFzZUluT3V0Qm91bmNlOiBlYXNlSW5PdXRCb3VuY2UKICB9Owp9KSgpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CiAgLyoqCiAgICogQG5hbWUgZmFicmljCiAgICogQG5hbWVzcGFjZQogICAqLwoKICB2YXIgZmFicmljID0gZ2xvYmFsLmZhYnJpYyB8fCAoZ2xvYmFsLmZhYnJpYyA9IHt9KSwKICAgICAgZXh0ZW5kID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCwKICAgICAgY2FwaXRhbGl6ZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplLAogICAgICBjbG9uZSA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZTsKICB2YXIgYXR0cmlidXRlc01hcCA9IHsKICAgICdjeCc6ICdsZWZ0JywKICAgICd4JzogJ2xlZnQnLAogICAgJ2N5JzogJ3RvcCcsCiAgICAneSc6ICd0b3AnLAogICAgJ3InOiAncmFkaXVzJywKICAgICdmaWxsLW9wYWNpdHknOiAnb3BhY2l0eScsCiAgICAnZmlsbC1ydWxlJzogJ2ZpbGxSdWxlJywKICAgICdzdHJva2Utd2lkdGgnOiAnc3Ryb2tlV2lkdGgnLAogICAgJ3RyYW5zZm9ybSc6ICd0cmFuc2Zvcm1NYXRyaXgnLAogICAgJ3RleHQtZGVjb3JhdGlvbic6ICd0ZXh0RGVjb3JhdGlvbicsCiAgICAnZm9udC1zaXplJzogJ2ZvbnRTaXplJywKICAgICdmb250LXdlaWdodCc6ICdmb250V2VpZ2h0JywKICAgICdmb250LXN0eWxlJzogJ2ZvbnRTdHlsZScsCiAgICAnZm9udC1mYW1pbHknOiAnZm9udEZhbWlseScKICB9OwoKICBmdW5jdGlvbiBub3JtYWxpemVBdHRyKGF0dHIpIHsKICAgIC8vIHRyYW5zZm9ybSBhdHRyaWJ1dGUgbmFtZXMKICAgIGlmIChhdHRyIGluIGF0dHJpYnV0ZXNNYXApIHsKICAgICAgcmV0dXJuIGF0dHJpYnV0ZXNNYXBbYXR0cl07CiAgICB9CgogICAgcmV0dXJuIGF0dHI7CiAgfQogIC8qKgogICAqIFJldHVybnMgYW4gb2JqZWN0IG9mIGF0dHJpYnV0ZXMnIG5hbWUvdmFsdWUsIGdpdmVuIGVsZW1lbnQgYW5kIGFuIGFycmF5IG9mIGF0dHJpYnV0ZSBuYW1lczsKICAgKiBQYXJzZXMgcGFyZW50ICJnIiBub2RlcyByZWN1cnNpdmVseSB1cHdhcmRzLgogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICogQG1ldGhvZCBwYXJzZUF0dHJpYnV0ZXMKICAgKiBAcGFyYW0ge0RPTUVsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBwYXJzZQogICAqIEBwYXJhbSB7QXJyYXl9IGF0dHJpYnV0ZXMgQXJyYXkgb2YgYXR0cmlidXRlcyB0byBwYXJzZQogICAqIEByZXR1cm4ge09iamVjdH0gb2JqZWN0IGNvbnRhaW5pbmcgcGFyc2VkIGF0dHJpYnV0ZXMnIG5hbWVzL3ZhbHVlcwogICAqLwoKCiAgZnVuY3Rpb24gcGFyc2VBdHRyaWJ1dGVzKGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHsKICAgIGlmICghZWxlbWVudCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHZhbHVlLAogICAgICAgIHBhcnNlZCwKICAgICAgICBwYXJlbnRBdHRyaWJ1dGVzID0ge307IC8vIGlmIHRoZXJlJ3MgYSBwYXJlbnQgY29udGFpbmVyIChgZ2Agbm9kZSksIHBhcnNlIGl0cyBhdHRyaWJ1dGVzIHJlY3Vyc2l2ZWx5IHVwd2FyZHMKCiAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlICYmIC9eZyQvaS50ZXN0KGVsZW1lbnQucGFyZW50Tm9kZS5ub2RlTmFtZSkpIHsKICAgICAgcGFyZW50QXR0cmlidXRlcyA9IGZhYnJpYy5wYXJzZUF0dHJpYnV0ZXMoZWxlbWVudC5wYXJlbnROb2RlLCBhdHRyaWJ1dGVzKTsKICAgIH0KCiAgICB2YXIgb3duQXR0cmlidXRlcyA9IGF0dHJpYnV0ZXMucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBhdHRyKSB7CiAgICAgIHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cik7CiAgICAgIHBhcnNlZCA9IHBhcnNlRmxvYXQodmFsdWUpOwoKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgLy8gIm5vcm1hbGl6ZSIgYXR0cmlidXRlIHZhbHVlcwogICAgICAgIGlmICgoYXR0ciA9PT0gJ2ZpbGwnIHx8IGF0dHIgPT09ICdzdHJva2UnKSAmJiB2YWx1ZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICB2YWx1ZSA9ICcnOwogICAgICAgIH0KCiAgICAgICAgaWYgKGF0dHIgPT09ICdmaWxsLXJ1bGUnKSB7CiAgICAgICAgICB2YWx1ZSA9IHZhbHVlID09PSAnZXZlbm9kZCcgPyAnZGVzdGluYXRpb24tb3ZlcicgOiB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChhdHRyID09PSAndHJhbnNmb3JtJykgewogICAgICAgICAgdmFsdWUgPSBmYWJyaWMucGFyc2VUcmFuc2Zvcm1BdHRyaWJ1dGUodmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgYXR0ciA9IG5vcm1hbGl6ZUF0dHIoYXR0cik7CiAgICAgICAgbWVtb1thdHRyXSA9IGlzTmFOKHBhcnNlZCkgPyB2YWx1ZSA6IHBhcnNlZDsKICAgICAgfQoKICAgICAgcmV0dXJuIG1lbW87CiAgICB9LCB7fSk7IC8vIGFkZCB2YWx1ZXMgcGFyc2VkIGZyb20gc3R5bGUsIHdoaWNoIHRha2UgcHJlY2VkZW5jZSBvdmVyIGF0dHJpYnV0ZXMKICAgIC8vIChzZWU6IGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRy9zdHlsaW5nLmh0bWwjVXNpbmdQcmVzZW50YXRpb25BdHRyaWJ1dGVzKQoKICAgIG93bkF0dHJpYnV0ZXMgPSBleHRlbmQob3duQXR0cmlidXRlcywgZXh0ZW5kKGdldEdsb2JhbFN0eWxlc0ZvckVsZW1lbnQoZWxlbWVudCksIGZhYnJpYy5wYXJzZVN0eWxlQXR0cmlidXRlKGVsZW1lbnQpKSk7CiAgICByZXR1cm4gZXh0ZW5kKHBhcmVudEF0dHJpYnV0ZXMsIG93bkF0dHJpYnV0ZXMpOwogIH0KCiAgOwogIC8qKgogICAqIFBhcnNlcyAidHJhbnNmb3JtIiBhdHRyaWJ1dGUsIHJldHVybmluZyBhbiBhcnJheSBvZiB2YWx1ZXMKICAgKiBAc3RhdGljCiAgICogQGZ1bmN0aW9uCiAgICogQG1lbWJlck9mIGZhYnJpYwogICAqIEBtZXRob2QgcGFyc2VUcmFuc2Zvcm1BdHRyaWJ1dGUKICAgKiBAcGFyYW0gYXR0cmlidXRlVmFsdWUge1N0cmluZ30gc3RyaW5nIGNvbnRhaW5pbmcgYXR0cmlidXRlIHZhbHVlCiAgICogQHJldHVybiB7QXJyYXl9IGFycmF5IG9mIDYgZWxlbWVudHMgcmVwcmVzZW50aW5nIHRyYW5zZm9ybWF0aW9uIG1hdHJpeAogICAqLwoKICBmYWJyaWMucGFyc2VUcmFuc2Zvcm1BdHRyaWJ1dGUgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiByb3RhdGVNYXRyaXgobWF0cml4LCBhcmdzKSB7CiAgICAgIHZhciBhbmdsZSA9IGFyZ3NbMF07CiAgICAgIG1hdHJpeFswXSA9IE1hdGguY29zKGFuZ2xlKTsKICAgICAgbWF0cml4WzFdID0gTWF0aC5zaW4oYW5nbGUpOwogICAgICBtYXRyaXhbMl0gPSAtTWF0aC5zaW4oYW5nbGUpOwogICAgICBtYXRyaXhbM10gPSBNYXRoLmNvcyhhbmdsZSk7CiAgICB9CgogICAgZnVuY3Rpb24gc2NhbGVNYXRyaXgobWF0cml4LCBhcmdzKSB7CiAgICAgIHZhciBtdWx0aXBsaWVyWCA9IGFyZ3NbMF0sCiAgICAgICAgICBtdWx0aXBsaWVyWSA9IGFyZ3MubGVuZ3RoID09PSAyID8gYXJnc1sxXSA6IGFyZ3NbMF07CiAgICAgIG1hdHJpeFswXSA9IG11bHRpcGxpZXJYOwogICAgICBtYXRyaXhbM10gPSBtdWx0aXBsaWVyWTsKICAgIH0KCiAgICBmdW5jdGlvbiBza2V3WE1hdHJpeChtYXRyaXgsIGFyZ3MpIHsKICAgICAgbWF0cml4WzJdID0gYXJnc1swXTsKICAgIH0KCiAgICBmdW5jdGlvbiBza2V3WU1hdHJpeChtYXRyaXgsIGFyZ3MpIHsKICAgICAgbWF0cml4WzFdID0gYXJnc1swXTsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2xhdGVNYXRyaXgobWF0cml4LCBhcmdzKSB7CiAgICAgIG1hdHJpeFs0XSA9IGFyZ3NbMF07CgogICAgICBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgICAgICBtYXRyaXhbNV0gPSBhcmdzWzFdOwogICAgICB9CiAgICB9IC8vIGlkZW50aXR5IG1hdHJpeAoKCiAgICB2YXIgaU1hdHJpeCA9IFsxLCAvLyBhCiAgICAwLCAvLyBiCiAgICAwLCAvLyBjCiAgICAxLCAvLyBkCiAgICAwLCAvLyBlCiAgICAwIC8vIGYKICAgIF0sCiAgICAgICAgLy8gPT0gYmVnaW4gdHJhbnNmb3JtIHJlZ2V4cAogICAgbnVtYmVyID0gJyg/OlstK10/XFxkKyg/OlxcLlxcZCspPyg/OmVbLStdP1xcZCspPyknLAogICAgICAgIGNvbW1hX3dzcCA9ICcoPzpcXHMrLD9cXHMqfCxcXHMqKScsCiAgICAgICAgc2tld1ggPSAnKD86KHNrZXdYKVxccypcXChcXHMqKCcgKyBudW1iZXIgKyAnKVxccypcXCkpJywKICAgICAgICBza2V3WSA9ICcoPzooc2tld1kpXFxzKlxcKFxccyooJyArIG51bWJlciArICcpXFxzKlxcKSknLAogICAgICAgIHJvdGF0ZSA9ICcoPzoocm90YXRlKVxccypcXChcXHMqKCcgKyBudW1iZXIgKyAnKSg/OicgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKScgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKSk/XFxzKlxcKSknLAogICAgICAgIHNjYWxlID0gJyg/OihzY2FsZSlcXHMqXFwoXFxzKignICsgbnVtYmVyICsgJykoPzonICsgY29tbWFfd3NwICsgJygnICsgbnVtYmVyICsgJykpP1xccypcXCkpJywKICAgICAgICB0cmFuc2xhdGUgPSAnKD86KHRyYW5zbGF0ZSlcXHMqXFwoXFxzKignICsgbnVtYmVyICsgJykoPzonICsgY29tbWFfd3NwICsgJygnICsgbnVtYmVyICsgJykpP1xccypcXCkpJywKICAgICAgICBtYXRyaXggPSAnKD86KG1hdHJpeClcXHMqXFwoXFxzKicgKyAnKCcgKyBudW1iZXIgKyAnKScgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKScgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKScgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKScgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKScgKyBjb21tYV93c3AgKyAnKCcgKyBudW1iZXIgKyAnKScgKyAnXFxzKlxcKSknLAogICAgICAgIHRyYW5zZm9ybSA9ICcoPzonICsgbWF0cml4ICsgJ3wnICsgdHJhbnNsYXRlICsgJ3wnICsgc2NhbGUgKyAnfCcgKyByb3RhdGUgKyAnfCcgKyBza2V3WCArICd8JyArIHNrZXdZICsgJyknLAogICAgICAgIHRyYW5zZm9ybXMgPSAnKD86JyArIHRyYW5zZm9ybSArICcoPzonICsgY29tbWFfd3NwICsgdHJhbnNmb3JtICsgJykqJyArICcpJywKICAgICAgICB0cmFuc2Zvcm1fbGlzdCA9ICdeXFxzKig/OicgKyB0cmFuc2Zvcm1zICsgJz8pXFxzKiQnLAogICAgICAgIC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRy9jb29yZHMuaHRtbCNUcmFuc2Zvcm1BdHRyaWJ1dGUKICAgIHJlVHJhbnNmb3JtTGlzdCA9IG5ldyBSZWdFeHAodHJhbnNmb3JtX2xpc3QpLAogICAgICAgIC8vID09IGVuZCB0cmFuc2Zvcm0gcmVnZXhwCiAgICByZVRyYW5zZm9ybSA9IG5ldyBSZWdFeHAodHJhbnNmb3JtKTsKICAgIHJldHVybiBmdW5jdGlvbiAoYXR0cmlidXRlVmFsdWUpIHsKICAgICAgLy8gc3RhcnQgd2l0aCBpZGVudGl0eSBtYXRyaXgKICAgICAgdmFyIG1hdHJpeCA9IGlNYXRyaXguY29uY2F0KCk7IC8vIHJldHVybiBpZiBubyBhcmd1bWVudCB3YXMgZ2l2ZW4gb3IKICAgICAgLy8gYW4gYXJndW1lbnQgZG9lcyBub3QgbWF0Y2ggdHJhbnNmb3JtIGF0dHJpYnV0ZSByZWdleHAKCiAgICAgIGlmICghYXR0cmlidXRlVmFsdWUgfHwgYXR0cmlidXRlVmFsdWUgJiYgIXJlVHJhbnNmb3JtTGlzdC50ZXN0KGF0dHJpYnV0ZVZhbHVlKSkgewogICAgICAgIHJldHVybiBtYXRyaXg7CiAgICAgIH0KCiAgICAgIGF0dHJpYnV0ZVZhbHVlLnJlcGxhY2UocmVUcmFuc2Zvcm0sIGZ1bmN0aW9uIChtYXRjaCkgewogICAgICAgIHZhciBtID0gbmV3IFJlZ0V4cCh0cmFuc2Zvcm0pLmV4ZWMobWF0Y2gpLmZpbHRlcihmdW5jdGlvbiAobWF0Y2gpIHsKICAgICAgICAgIHJldHVybiBtYXRjaCAhPT0gJycgJiYgbWF0Y2ggIT0gbnVsbDsKICAgICAgICB9KSwKICAgICAgICAgICAgb3BlcmF0aW9uID0gbVsxXSwKICAgICAgICAgICAgYXJncyA9IG0uc2xpY2UoMikubWFwKHBhcnNlRmxvYXQpOwoKICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbikgewogICAgICAgICAgY2FzZSAndHJhbnNsYXRlJzoKICAgICAgICAgICAgdHJhbnNsYXRlTWF0cml4KG1hdHJpeCwgYXJncyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3JvdGF0ZSc6CiAgICAgICAgICAgIHJvdGF0ZU1hdHJpeChtYXRyaXgsIGFyZ3MpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdzY2FsZSc6CiAgICAgICAgICAgIHNjYWxlTWF0cml4KG1hdHJpeCwgYXJncyk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3NrZXdYJzoKICAgICAgICAgICAgc2tld1hNYXRyaXgobWF0cml4LCBhcmdzKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnc2tld1knOgogICAgICAgICAgICBza2V3WU1hdHJpeChtYXRyaXgsIGFyZ3MpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdtYXRyaXgnOgogICAgICAgICAgICBtYXRyaXggPSBhcmdzOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gbWF0cml4OwogICAgfTsKICB9KCk7CiAgLyoqCiAgICogUGFyc2VzICJwb2ludHMiIGF0dHJpYnV0ZSwgcmV0dXJuaW5nIGFuIGFycmF5IG9mIHZhbHVlcwogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICogQG1ldGhvZCBwYXJzZVBvaW50c0F0dHJpYnV0ZQogICAqIEBwYXJhbSBwb2ludHMge1N0cmluZ30gcG9pbnRzIGF0dHJpYnV0ZSBzdHJpbmcKICAgKiBAcmV0dXJuIHtBcnJheX0gYXJyYXkgb2YgcG9pbnRzCiAgICovCgoKICBmdW5jdGlvbiBwYXJzZVBvaW50c0F0dHJpYnV0ZShwb2ludHMpIHsKICAgIC8vIHBvaW50cyBhdHRyaWJ1dGUgaXMgcmVxdWlyZWQgYW5kIG11c3Qgbm90IGJlIGVtcHR5CiAgICBpZiAoIXBvaW50cykgcmV0dXJuIG51bGw7CiAgICBwb2ludHMgPSBwb2ludHMudHJpbSgpOwogICAgdmFyIGFzUGFpcnMgPSBwb2ludHMuaW5kZXhPZignLCcpID4gLTE7CiAgICBwb2ludHMgPSBwb2ludHMuc3BsaXQoL1xzKy8pOwogICAgdmFyIHBhcnNlZFBvaW50cyA9IFtdOyAvLyBwb2ludHMgY291bGQgbG9vayBsaWtlICIxMCwyMCAzMCw0MCIgb3IgIjEwIDIwIDMwIDQwIgoKICAgIGlmIChhc1BhaXJzKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICB2YXIgcGFpciA9IHBvaW50c1tpXS5zcGxpdCgnLCcpOwogICAgICAgIHBhcnNlZFBvaW50cy5wdXNoKHsKICAgICAgICAgIHg6IHBhcnNlRmxvYXQocGFpclswXSksCiAgICAgICAgICB5OiBwYXJzZUZsb2F0KHBhaXJbMV0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICBwYXJzZWRQb2ludHMucHVzaCh7CiAgICAgICAgICB4OiBwYXJzZUZsb2F0KHBvaW50c1tpXSksCiAgICAgICAgICB5OiBwYXJzZUZsb2F0KHBvaW50c1tpICsgMV0pCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gLy8gb2RkIG51bWJlciBvZiBwb2ludHMgaXMgYW4gZXJyb3IKCgogICAgaWYgKHBhcnNlZFBvaW50cy5sZW5ndGggJSAyICE9PSAwKSB7Ly8gcmV0dXJuIG51bGw7CiAgICB9CgogICAgcmV0dXJuIHBhcnNlZFBvaW50czsKICB9CgogIDsKICAvKioKICAgKiBQYXJzZXMgInN0eWxlIiBhdHRyaWJ1dGUsIHJldHVuaW5nIGFuIG9iamVjdCB3aXRoIHZhbHVlcwogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICogQG1ldGhvZCBwYXJzZVN0eWxlQXR0cmlidXRlCiAgICogQHBhcmFtIHtTVkdFbGVtZW50fSBlbGVtZW50IEVsZW1lbnQgdG8gcGFyc2UKICAgKiBAcmV0dXJuIHtPYmplY3R9IE9iamVjdHMgd2l0aCB2YWx1ZXMgcGFyc2VkIGZyb20gc3R5bGUgYXR0cmlidXRlIG9mIGFuIGVsZW1lbnQKICAgKi8KCiAgZnVuY3Rpb24gcGFyc2VTdHlsZUF0dHJpYnV0ZShlbGVtZW50KSB7CiAgICB2YXIgb1N0eWxlID0ge30sCiAgICAgICAgc3R5bGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsKCiAgICBpZiAoc3R5bGUpIHsKICAgICAgaWYgKHR5cGVvZiBzdHlsZSA9PSAnc3RyaW5nJykgewogICAgICAgIHN0eWxlID0gc3R5bGUucmVwbGFjZSgvOyQvLCAnJykuc3BsaXQoJzsnKS5mb3JFYWNoKGZ1bmN0aW9uIChjdXJyZW50KSB7CiAgICAgICAgICB2YXIgYXR0ciA9IGN1cnJlbnQuc3BsaXQoJzonKTsKICAgICAgICAgIG9TdHlsZVtub3JtYWxpemVBdHRyKGF0dHJbMF0udHJpbSgpLnRvTG93ZXJDYXNlKCkpXSA9IGF0dHJbMV0udHJpbSgpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodmFyIHByb3AgaW4gc3R5bGUpIHsKICAgICAgICAgIGlmICh0eXBlb2Ygc3R5bGVbcHJvcF0gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIG9TdHlsZVtub3JtYWxpemVBdHRyKHByb3AudG9Mb3dlckNhc2UoKSldID0gc3R5bGVbcHJvcF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG9TdHlsZTsKICB9CgogIDsKCiAgZnVuY3Rpb24gcmVzb2x2ZUdyYWRpZW50cyhpbnN0YW5jZXMpIHsKICAgIGZvciAodmFyIGkgPSBpbnN0YW5jZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgIHZhciBpbnN0YW5jZUZpbGxWYWx1ZSA9IGluc3RhbmNlc1tpXS5nZXQoJ2ZpbGwnKTsKCiAgICAgIGlmICgvXnVybFwoLy50ZXN0KGluc3RhbmNlRmlsbFZhbHVlKSkgewogICAgICAgIHZhciBncmFkaWVudElkID0gaW5zdGFuY2VGaWxsVmFsdWUuc2xpY2UoNSwgaW5zdGFuY2VGaWxsVmFsdWUubGVuZ3RoIC0gMSk7CgogICAgICAgIGlmIChmYWJyaWMuZ3JhZGllbnREZWZzW2dyYWRpZW50SWRdKSB7CiAgICAgICAgICBpbnN0YW5jZXNbaV0uc2V0KCdmaWxsJywgZmFicmljLkdyYWRpZW50LmZyb21FbGVtZW50KGZhYnJpYy5ncmFkaWVudERlZnNbZ3JhZGllbnRJZF0sIGluc3RhbmNlc1tpXSkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICAvKioKICAgKiBUcmFuc2Zvcm1zIGFuIGFycmF5IG9mIHN2ZyBlbGVtZW50cyB0byBjb3JyZXNwb25kaW5nIGZhYnJpYy4qIGluc3RhbmNlcwogICAqIEBzdGF0aWMKICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICogQG1ldGhvZCBwYXJzZUVsZW1lbnRzCiAgICogQHBhcmFtIHtBcnJheX0gZWxlbWVudHMgQXJyYXkgb2YgZWxlbWVudHMgdG8gcGFyc2UKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBCZWluZyBwYXNzZWQgYW4gYXJyYXkgb2YgZmFicmljIGluc3RhbmNlcyAodHJhbnNmb3JtZWQgZnJvbSBTVkcgZWxlbWVudHMpCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgT3B0aW9ucyBvYmplY3QKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcmV2aXZlcl0gTWV0aG9kIGZvciBmdXJ0aGVyIHBhcnNpbmcgb2YgU1ZHIGVsZW1lbnRzLCBjYWxsZWQgYWZ0ZXIgZWFjaCBmYWJyaWMgb2JqZWN0IGNyZWF0ZWQuCiAgICovCgoKICBmdW5jdGlvbiBwYXJzZUVsZW1lbnRzKGVsZW1lbnRzLCBjYWxsYmFjaywgb3B0aW9ucywgcmV2aXZlcikgewogICAgdmFyIGluc3RhbmNlcyA9IEFycmF5KGVsZW1lbnRzLmxlbmd0aCksCiAgICAgICAgaSA9IGVsZW1lbnRzLmxlbmd0aDsKCiAgICBmdW5jdGlvbiBjaGVja0lmRG9uZSgpIHsKICAgICAgaWYgKC0taSA9PT0gMCkgewogICAgICAgIGluc3RhbmNlcyA9IGluc3RhbmNlcy5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICByZXR1cm4gZWwgIT0gbnVsbDsKICAgICAgICB9KTsKICAgICAgICByZXNvbHZlR3JhZGllbnRzKGluc3RhbmNlcyk7CiAgICAgICAgY2FsbGJhY2soaW5zdGFuY2VzKTsKICAgICAgfQogICAgfQoKICAgIGZvciAodmFyIGluZGV4ID0gMCwgZWwsIGxlbiA9IGVsZW1lbnRzLmxlbmd0aDsgaW5kZXggPCBsZW47IGluZGV4KyspIHsKICAgICAgZWwgPSBlbGVtZW50c1tpbmRleF07CiAgICAgIHZhciBrbGFzcyA9IGZhYnJpY1tjYXBpdGFsaXplKGVsLnRhZ05hbWUpXTsKCiAgICAgIGlmIChrbGFzcyAmJiBrbGFzcy5mcm9tRWxlbWVudCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoa2xhc3MuYXN5bmMpIHsKICAgICAgICAgICAga2xhc3MuZnJvbUVsZW1lbnQoZWwsIGZ1bmN0aW9uIChpbmRleCwgZWwpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICAgICAgcmV2aXZlciAmJiByZXZpdmVyKGVsLCBvYmopOwogICAgICAgICAgICAgICAgaW5zdGFuY2VzLnNwbGljZShpbmRleCwgMCwgb2JqKTsKICAgICAgICAgICAgICAgIGNoZWNrSWZEb25lKCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfShpbmRleCksIG9wdGlvbnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG9iaiA9IGtsYXNzLmZyb21FbGVtZW50KGVsLCBvcHRpb25zKTsKICAgICAgICAgICAgcmV2aXZlciAmJiByZXZpdmVyKGVsLCBvYmopOwogICAgICAgICAgICBpbnN0YW5jZXMuc3BsaWNlKGluZGV4LCAwLCBvYmopOwogICAgICAgICAgICBjaGVja0lmRG9uZSgpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGZhYnJpYy5sb2coZS5tZXNzYWdlIHx8IGUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjaGVja0lmRG9uZSgpOwogICAgICB9CiAgICB9CiAgfQoKICA7CiAgLyoqCiAgICogUmV0dXJucyBDU1MgcnVsZXMgZm9yIGEgZ2l2ZW4gU1ZHIGRvY3VtZW50CiAgICogQHN0YXRpYwogICAqIEBmdW5jdGlvbgogICAqIEBtZW1iZXJPZiBmYWJyaWMKICAgKiBAbWV0aG9kIGdldENTU1J1bGVzCiAgICogQHBhcmFtIHtTVkdEb2N1bWVudH0gZG9jIFNWRyBkb2N1bWVudCB0byBwYXJzZQogICAqIEByZXR1cm4ge09iamVjdH0gQ1NTIHJ1bGVzIG9mIHRoaXMgZG9jdW1lbnQKICAgKi8KCiAgZnVuY3Rpb24gZ2V0Q1NTUnVsZXMoZG9jKSB7CiAgICB2YXIgc3R5bGVzID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzdHlsZScpLAogICAgICAgIGFsbFJ1bGVzID0ge30sCiAgICAgICAgcnVsZXM7IC8vIHZlcnkgY3J1ZGUgcGFyc2luZyBvZiBzdHlsZSBjb250ZW50cwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBzdHlsZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgdmFyIHN0eWxlQ29udGVudHMgPSBzdHlsZXNbMF0udGV4dENvbnRlbnQ7IC8vIHJlbW92ZSBjb21tZW50cwoKICAgICAgc3R5bGVDb250ZW50cyA9IHN0eWxlQ29udGVudHMucmVwbGFjZSgvXC9cKltcc1xTXSo/XCpcLy9nLCAnJyk7CiAgICAgIHJ1bGVzID0gc3R5bGVDb250ZW50cy5tYXRjaCgvW157XSpce1tcc1xTXSo/XH0vZyk7CiAgICAgIHJ1bGVzID0gcnVsZXMubWFwKGZ1bmN0aW9uIChydWxlKSB7CiAgICAgICAgcmV0dXJuIHJ1bGUudHJpbSgpOwogICAgICB9KTsKICAgICAgcnVsZXMuZm9yRWFjaChmdW5jdGlvbiAocnVsZSkgewogICAgICAgIHZhciBtYXRjaCA9IHJ1bGUubWF0Y2goLyhbXHNcU10qPylccypceyhbXn1dKilcfS8pLAogICAgICAgICAgICBydWxlID0gbWF0Y2hbMV0sCiAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gbWF0Y2hbMl0udHJpbSgpLAogICAgICAgICAgICBwcm9wZXJ0eVZhbHVlUGFpcnMgPSBkZWNsYXJhdGlvbi5yZXBsYWNlKC87JC8sICcnKS5zcGxpdCgvXHMqO1xzKi8pOwoKICAgICAgICBpZiAoIWFsbFJ1bGVzW3J1bGVdKSB7CiAgICAgICAgICBhbGxSdWxlc1tydWxlXSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHByb3BlcnR5VmFsdWVQYWlycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgdmFyIHBhaXIgPSBwcm9wZXJ0eVZhbHVlUGFpcnNbaV0uc3BsaXQoL1xzKjpccyovKSwKICAgICAgICAgICAgICBwcm9wZXJ0eSA9IHBhaXJbMF0sCiAgICAgICAgICAgICAgdmFsdWUgPSBwYWlyWzFdOwogICAgICAgICAgYWxsUnVsZXNbcnVsZV1bcHJvcGVydHldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gYWxsUnVsZXM7CiAgfQoKICBmdW5jdGlvbiBnZXRHbG9iYWxTdHlsZXNGb3JFbGVtZW50KGVsZW1lbnQpIHsKICAgIHZhciBub2RlTmFtZSA9IGVsZW1lbnQubm9kZU5hbWUsCiAgICAgICAgY2xhc3NOYW1lID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyksCiAgICAgICAgaWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnaWQnKSwKICAgICAgICBzdHlsZXMgPSB7fTsKCiAgICBmb3IgKHZhciBydWxlIGluIGZhYnJpYy5jc3NSdWxlcykgewogICAgICB2YXIgcnVsZU1hdGNoZXNFbGVtZW50ID0gY2xhc3NOYW1lICYmIG5ldyBSZWdFeHAoJ15cXC4nICsgY2xhc3NOYW1lKS50ZXN0KHJ1bGUpIHx8IGlkICYmIG5ldyBSZWdFeHAoJ14jJyArIGlkKS50ZXN0KHJ1bGUpIHx8IG5ldyBSZWdFeHAoJ14nICsgbm9kZU5hbWUpLnRlc3QocnVsZSk7CgogICAgICBpZiAocnVsZU1hdGNoZXNFbGVtZW50KSB7CiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gZmFicmljLmNzc1J1bGVzW3J1bGVdKSB7CiAgICAgICAgICBzdHlsZXNbcHJvcGVydHldID0gZmFicmljLmNzc1J1bGVzW3J1bGVdW3Byb3BlcnR5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gc3R5bGVzOwogIH0KICAvKioKICAgKiBQYXJzZXMgYW4gU1ZHIGRvY3VtZW50LCBjb252ZXJ0cyBpdCB0byBhbiBhcnJheSBvZiBjb3JyZXNwb25kaW5nIGZhYnJpYy4qIGluc3RhbmNlcyBhbmQgcGFzc2VzIHRoZW0gdG8gYSBjYWxsYmFjawogICAqIEBzdGF0aWMKICAgKiBAZnVuY3Rpb24KICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICogQG1ldGhvZCBwYXJzZVNWR0RvY3VtZW50CiAgICogQHBhcmFtIHtTVkdEb2N1bWVudH0gZG9jIFNWRyBkb2N1bWVudCB0byBwYXJzZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGNhbGwgd2hlbiBwYXJzaW5nIGlzIGZpbmlzaGVkOyBJdCdzIGJlaW5nIHBhc3NlZCBhbiBhcnJheSBvZiBlbGVtZW50cyAocGFyc2VkIGZyb20gYSBkb2N1bWVudCkuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jldml2ZXJdIE1ldGhvZCBmb3IgZnVydGhlciBwYXJzaW5nIG9mIFNWRyBlbGVtZW50cywgY2FsbGVkIGFmdGVyIGVhY2ggZmFicmljIG9iamVjdCBjcmVhdGVkLgogICAqLwoKCiAgZmFicmljLnBhcnNlU1ZHRG9jdW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcmVBbGxvd2VkU1ZHVGFnTmFtZXMgPSAvXihwYXRofGNpcmNsZXxwb2x5Z29ufHBvbHlsaW5lfGVsbGlwc2V8cmVjdHxsaW5lfGltYWdlfHRleHQpJC87IC8vIGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRy9jb29yZHMuaHRtbCNWaWV3Qm94QXR0cmlidXRlCiAgICAvLyBcZCBkb2Vzbid0IHF1aXRlIGN1dCBpdCAoYXMgd2UgbmVlZCB0byBtYXRjaCBhbiBhY3R1YWwgZmxvYXQgbnVtYmVyKQogICAgLy8gbWF0Y2hlcywgZS5nLjogKzE0LjU2ZS0xMiwgZXRjLgoKICAgIHZhciByZU51bSA9ICcoPzpbLStdP1xcZCsoPzpcXC5cXGQrKT8oPzplWy0rXT9cXGQrKT8pJzsKICAgIHZhciByZVZpZXdCb3hBdHRyVmFsdWUgPSBuZXcgUmVnRXhwKCdeJyArICdcXHMqKCcgKyByZU51bSArICcrKVxccyosPycgKyAnXFxzKignICsgcmVOdW0gKyAnKylcXHMqLD8nICsgJ1xccyooJyArIHJlTnVtICsgJyspXFxzKiw/JyArICdcXHMqKCcgKyByZU51bSArICcrKVxccyonICsgJyQnKTsKCiAgICBmdW5jdGlvbiBoYXNBbmNlc3RvcldpdGhOb2RlTmFtZShlbGVtZW50LCBub2RlTmFtZSkgewogICAgICB3aGlsZSAoZWxlbWVudCAmJiAoZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSkpIHsKICAgICAgICBpZiAobm9kZU5hbWUudGVzdChlbGVtZW50Lm5vZGVOYW1lKSkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uIChkb2MsIGNhbGxiYWNrLCByZXZpdmVyKSB7CiAgICAgIGlmICghZG9jKSByZXR1cm47CiAgICAgIHZhciBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpLAogICAgICAgICAgZGVzY2VuZGFudHMgPSBmYWJyaWMudXRpbC50b0FycmF5KGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpKTsKCiAgICAgIGlmIChkZXNjZW5kYW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAvLyB3ZSdyZSBsaWtlbHkgaW4gbm9kZSwgd2hlcmUgIm8zLXhtbCIgbGlicmFyeSBmYWlscyB0byBnRUJUTigiKiIpCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FqYXhvcmcvbm9kZS1vMy14bWwvaXNzdWVzLzIxCiAgICAgICAgZGVzY2VuZGFudHMgPSBkb2Muc2VsZWN0Tm9kZXMoIi8vKltuYW1lKC4pIT0nc3ZnJ10iKTsKICAgICAgICB2YXIgYXJyID0gW107CgogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBkZXNjZW5kYW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgYXJyW2ldID0gZGVzY2VuZGFudHNbaV07CiAgICAgICAgfQoKICAgICAgICBkZXNjZW5kYW50cyA9IGFycjsKICAgICAgfQoKICAgICAgdmFyIGVsZW1lbnRzID0gZGVzY2VuZGFudHMuZmlsdGVyKGZ1bmN0aW9uIChlbCkgewogICAgICAgIHJldHVybiByZUFsbG93ZWRTVkdUYWdOYW1lcy50ZXN0KGVsLnRhZ05hbWUpICYmICFoYXNBbmNlc3RvcldpdGhOb2RlTmFtZShlbCwgL14oPzpwYXR0ZXJufGRlZnMpJC8pOyAvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcvc3RydWN0Lmh0bWwjRGVmc0VsZW1lbnQKICAgICAgfSk7CiAgICAgIGlmICghZWxlbWVudHMgfHwgZWxlbWVudHMgJiYgIWVsZW1lbnRzLmxlbmd0aCkgcmV0dXJuOwogICAgICB2YXIgdmlld0JveEF0dHIgPSBkb2MuZ2V0QXR0cmlidXRlKCd2aWV3Qm94JyksCiAgICAgICAgICB3aWR0aEF0dHIgPSBkb2MuZ2V0QXR0cmlidXRlKCd3aWR0aCcpLAogICAgICAgICAgaGVpZ2h0QXR0ciA9IGRvYy5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpLAogICAgICAgICAgd2lkdGggPSBudWxsLAogICAgICAgICAgaGVpZ2h0ID0gbnVsbCwKICAgICAgICAgIG1pblgsCiAgICAgICAgICBtaW5ZOwoKICAgICAgaWYgKHZpZXdCb3hBdHRyICYmICh2aWV3Qm94QXR0ciA9IHZpZXdCb3hBdHRyLm1hdGNoKHJlVmlld0JveEF0dHJWYWx1ZSkpKSB7CiAgICAgICAgbWluWCA9IHBhcnNlSW50KHZpZXdCb3hBdHRyWzFdLCAxMCk7CiAgICAgICAgbWluWSA9IHBhcnNlSW50KHZpZXdCb3hBdHRyWzJdLCAxMCk7CiAgICAgICAgd2lkdGggPSBwYXJzZUludCh2aWV3Qm94QXR0clszXSwgMTApOwogICAgICAgIGhlaWdodCA9IHBhcnNlSW50KHZpZXdCb3hBdHRyWzRdLCAxMCk7CiAgICAgIH0gLy8gdmFsdWVzIG9mIHdpZHRoL2hlaWdodCBhdHRyaWJ1dGVzIG92ZXJ3cml0ZSB0aG9zZSBleHRyYWN0ZWQgZnJvbSB2aWV3Ym94IGF0dHJpYnV0ZQoKCiAgICAgIHdpZHRoID0gd2lkdGhBdHRyID8gcGFyc2VGbG9hdCh3aWR0aEF0dHIpIDogd2lkdGg7CiAgICAgIGhlaWdodCA9IGhlaWdodEF0dHIgPyBwYXJzZUZsb2F0KGhlaWdodEF0dHIpIDogaGVpZ2h0OwogICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgaGVpZ2h0OiBoZWlnaHQKICAgICAgfTsKICAgICAgZmFicmljLmdyYWRpZW50RGVmcyA9IGZhYnJpYy5nZXRHcmFkaWVudERlZnMoZG9jKTsKICAgICAgZmFicmljLmNzc1J1bGVzID0gZ2V0Q1NTUnVsZXMoZG9jKTsgLy8gUHJlY2VkZW5jZSBvZiBydWxlczogICBzdHlsZSA+IGNsYXNzID4gYXR0cmlidXRlCgogICAgICBmYWJyaWMucGFyc2VFbGVtZW50cyhlbGVtZW50cywgZnVuY3Rpb24gKGluc3RhbmNlcykgewogICAgICAgIGZhYnJpYy5kb2N1bWVudFBhcnNpbmdUaW1lID0gbmV3IERhdGUoKSAtIHN0YXJ0VGltZTsKCiAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICBjYWxsYmFjayhpbnN0YW5jZXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfSwgY2xvbmUob3B0aW9ucyksIHJldml2ZXIpOwogICAgfTsKICB9KCk7CiAgLyoqCiAgICAqIFVzZWQgZm9yIGNhY2hpbmcgU1ZHIGRvY3VtZW50cyAobG9hZGVkIHZpYSBgZmFicmljLkNhbnZhcyNsb2FkU1ZHRnJvbVVSTGApCiAgICAqIEBwcm9wZXJ0eQogICAgKiBAbmFtZXNwYWNlCiAgICAqLwoKCiAgdmFyIHN2Z0NhY2hlID0gewogICAgLyoqCiAgICAgKiBAbWV0aG9kIGhhcwogICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICAgKi8KICAgIGhhczogZnVuY3Rpb24gaGFzKG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGNhbGxiYWNrKGZhbHNlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIGdldAogICAgICogQHBhcmFtIHtTdHJpbmd9IHVybAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqLwogICAgZ2V0OiBmdW5jdGlvbiBnZXQodXJsLCBjYWxsYmFjaykgewogICAgICAvKiBOT09QICovCiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBzZXQKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QKICAgICAqLwogICAgc2V0OiBmdW5jdGlvbiBzZXQodXJsLCBvYmplY3QpIHsKICAgICAgLyogTk9PUCAqLwogICAgfQogIH07CiAgLyoqCiAgICogVGFrZXMgdXJsIGNvcnJlc3BvbmRpbmcgdG8gYW4gU1ZHIGRvY3VtZW50LCBhbmQgcGFyc2VzIGl0IGludG8gYSBzZXQgb2YgZmFicmljIG9iamVjdHMKICAgKiBAbWV0aG9kIGxvYWRTVkdGcm9tVVJMCiAgICogQHBhcmFtIHtTdHJpbmd9IHVybAogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jldml2ZXJdIE1ldGhvZCBmb3IgZnVydGhlciBwYXJzaW5nIG9mIFNWRyBlbGVtZW50cywgY2FsbGVkIGFmdGVyIGVhY2ggZmFicmljIG9iamVjdCBjcmVhdGVkLgogICAqLwoKICBmdW5jdGlvbiBsb2FkU1ZHRnJvbVVSTCh1cmwsIGNhbGxiYWNrLCByZXZpdmVyKSB7CiAgICB1cmwgPSB1cmwucmVwbGFjZSgvXlxuXHMqLywgJycpLnRyaW0oKTsKICAgIHN2Z0NhY2hlLmhhcyh1cmwsIGZ1bmN0aW9uIChoYXNVcmwpIHsKICAgICAgaWYgKGhhc1VybCkgewogICAgICAgIHN2Z0NhY2hlLmdldCh1cmwsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgdmFyIGVubGl2ZWRSZWNvcmQgPSBfZW5saXZlbkNhY2hlZE9iamVjdCh2YWx1ZSk7CgogICAgICAgICAgY2FsbGJhY2soZW5saXZlZFJlY29yZC5vYmplY3RzLCBlbmxpdmVkUmVjb3JkLm9wdGlvbnMpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG5ldyBmYWJyaWMudXRpbC5yZXF1ZXN0KHVybCwgewogICAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICAgIG9uQ29tcGxldGU6IG9uQ29tcGxldGUKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgZnVuY3Rpb24gb25Db21wbGV0ZShyKSB7CiAgICAgIHZhciB4bWwgPSByLnJlc3BvbnNlWE1MOwoKICAgICAgaWYgKCF4bWwuZG9jdW1lbnRFbGVtZW50ICYmIGZhYnJpYy53aW5kb3cuQWN0aXZlWE9iamVjdCAmJiByLnJlc3BvbnNlVGV4dCkgewogICAgICAgIHhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MRE9NJyk7CiAgICAgICAgeG1sLmFzeW5jID0gJ2ZhbHNlJzsgLy9JRSBjaG9rZXMgb24gRE9DVFlQRQoKICAgICAgICB4bWwubG9hZFhNTChyLnJlc3BvbnNlVGV4dC5yZXBsYWNlKC88IURPQ1RZUEVbXHNcU10qPyhcW1tcc1xTXSpcXSkqPz4vaSwgJycpKTsKICAgICAgfQoKICAgICAgaWYgKCF4bWwuZG9jdW1lbnRFbGVtZW50KSByZXR1cm47CiAgICAgIGZhYnJpYy5wYXJzZVNWR0RvY3VtZW50KHhtbC5kb2N1bWVudEVsZW1lbnQsIGZ1bmN0aW9uIChyZXN1bHRzLCBvcHRpb25zKSB7CiAgICAgICAgc3ZnQ2FjaGUuc2V0KHVybCwgewogICAgICAgICAgb2JqZWN0czogZmFicmljLnV0aWwuYXJyYXkuaW52b2tlKHJlc3VsdHMsICd0b09iamVjdCcpLAogICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgIH0pOwogICAgICAgIGNhbGxiYWNrKHJlc3VsdHMsIG9wdGlvbnMpOwogICAgICB9LCByZXZpdmVyKTsKICAgIH0KICB9CiAgLyoqCiAgKiBAbWV0aG9kIF9lbmxpdmVuQ2FjaGVkT2JqZWN0CiAgKi8KCgogIGZ1bmN0aW9uIF9lbmxpdmVuQ2FjaGVkT2JqZWN0KGNhY2hlZE9iamVjdCkgewogICAgdmFyIG9iamVjdHMgPSBjYWNoZWRPYmplY3Qub2JqZWN0cywKICAgICAgICBvcHRpb25zID0gY2FjaGVkT2JqZWN0Lm9wdGlvbnM7CiAgICBvYmplY3RzID0gb2JqZWN0cy5tYXAoZnVuY3Rpb24gKG8pIHsKICAgICAgcmV0dXJuIGZhYnJpY1tjYXBpdGFsaXplKG8udHlwZSldLmZyb21PYmplY3Qobyk7CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIG9iamVjdHM6IG9iamVjdHMsCiAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgIH07CiAgfQogIC8qKgogICAgKiBUYWtlcyBzdHJpbmcgY29ycmVzcG9uZGluZyB0byBhbiBTVkcgZG9jdW1lbnQsIGFuZCBwYXJzZXMgaXQgaW50byBhIHNldCBvZiBmYWJyaWMgb2JqZWN0cwogICAgKiBAbWV0aG9kIGxvYWRTVkdGcm9tU3RyaW5nCiAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcKICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jldml2ZXJdIE1ldGhvZCBmb3IgZnVydGhlciBwYXJzaW5nIG9mIFNWRyBlbGVtZW50cywgY2FsbGVkIGFmdGVyIGVhY2ggZmFicmljIG9iamVjdCBjcmVhdGVkLgogICAgKi8KCgogIGZ1bmN0aW9uIGxvYWRTVkdGcm9tU3RyaW5nKHN0cmluZywgY2FsbGJhY2ssIHJldml2ZXIpIHsKICAgIHN0cmluZyA9IHN0cmluZy50cmltKCk7CiAgICB2YXIgZG9jOwoKICAgIGlmICh0eXBlb2YgRE9NUGFyc2VyICE9PSAndW5kZWZpbmVkJykgewogICAgICB2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwoKICAgICAgaWYgKHBhcnNlciAmJiBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKSB7CiAgICAgICAgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhzdHJpbmcsICd0ZXh0L3htbCcpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGZhYnJpYy53aW5kb3cuQWN0aXZlWE9iamVjdCkgewogICAgICB2YXIgZG9jID0gbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxET00nKTsKICAgICAgZG9jLmFzeW5jID0gJ2ZhbHNlJzsgLy9JRSBjaG9rZXMgb24gRE9DVFlQRQoKICAgICAgZG9jLmxvYWRYTUwoc3RyaW5nLnJlcGxhY2UoLzwhRE9DVFlQRVtcc1xTXSo/KFxbW1xzXFNdKlxdKSo/Pi9pLCAnJykpOwogICAgfQoKICAgIGZhYnJpYy5wYXJzZVNWR0RvY3VtZW50KGRvYy5kb2N1bWVudEVsZW1lbnQsIGZ1bmN0aW9uIChyZXN1bHRzLCBvcHRpb25zKSB7CiAgICAgIGNhbGxiYWNrKHJlc3VsdHMsIG9wdGlvbnMpOwogICAgfSwgcmV2aXZlcik7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVTVkdGb250RmFjZXNNYXJrdXAob2JqZWN0cykgewogICAgdmFyIG1hcmt1cCA9ICcnOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBvYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGlmIChvYmplY3RzW2ldLnR5cGUgIT09ICd0ZXh0JyB8fCAhb2JqZWN0c1tpXS5wYXRoKSBjb250aW51ZTsKICAgICAgbWFya3VwICs9IFsnQGZvbnQtZmFjZSB7JywgJ2ZvbnQtZmFtaWx5OiAnLCBvYmplY3RzW2ldLmZvbnRGYW1pbHksICc7ICcsICdzcmM6IHVybChcJycsIG9iamVjdHNbaV0ucGF0aCwgJ1wnKScsICd9J10uam9pbignJyk7CiAgICB9CgogICAgaWYgKG1hcmt1cCkgewogICAgICBtYXJrdXAgPSBbJzxkZWZzPicsICc8c3R5bGUgdHlwZT0idGV4dC9jc3MiPicsICc8IVtDREFUQVsnLCBtYXJrdXAsICddXT4nLCAnPC9zdHlsZT4nLCAnPC9kZWZzPiddLmpvaW4oJycpOwogICAgfQoKICAgIHJldHVybiBtYXJrdXA7CiAgfQoKICBleHRlbmQoZmFicmljLCB7CiAgICBwYXJzZUF0dHJpYnV0ZXM6IHBhcnNlQXR0cmlidXRlcywKICAgIHBhcnNlRWxlbWVudHM6IHBhcnNlRWxlbWVudHMsCiAgICBwYXJzZVN0eWxlQXR0cmlidXRlOiBwYXJzZVN0eWxlQXR0cmlidXRlLAogICAgcGFyc2VQb2ludHNBdHRyaWJ1dGU6IHBhcnNlUG9pbnRzQXR0cmlidXRlLAogICAgZ2V0Q1NTUnVsZXM6IGdldENTU1J1bGVzLAogICAgbG9hZFNWR0Zyb21VUkw6IGxvYWRTVkdGcm9tVVJMLAogICAgbG9hZFNWR0Zyb21TdHJpbmc6IGxvYWRTVkdGcm9tU3RyaW5nLAogICAgY3JlYXRlU1ZHRm9udEZhY2VzTWFya3VwOiBjcmVhdGVTVkdGb250RmFjZXNNYXJrdXAKICB9KTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIGdldENvbG9yU3RvcEZyb21TdHlsZShlbCkgewogICAgdmFyIHN0eWxlID0gZWwuZ2V0QXR0cmlidXRlKCdzdHlsZScpOwoKICAgIGlmIChzdHlsZSkgewogICAgICB2YXIga2V5VmFsdWVQYWlycyA9IHN0eWxlLnNwbGl0KC9ccyo7XHMqLyk7CgogICAgICBpZiAoa2V5VmFsdWVQYWlyc1trZXlWYWx1ZVBhaXJzLmxlbmd0aCAtIDFdID09PSAnJykgewogICAgICAgIGtleVZhbHVlUGFpcnMucG9wKCk7CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSBrZXlWYWx1ZVBhaXJzLmxlbmd0aDsgaS0tOykgewogICAgICAgIHZhciBzcGxpdCA9IGtleVZhbHVlUGFpcnNbaV0uc3BsaXQoL1xzKjpccyovKSwKICAgICAgICAgICAga2V5ID0gc3BsaXRbMF0udHJpbSgpLAogICAgICAgICAgICB2YWx1ZSA9IHNwbGl0WzFdLnRyaW0oKTsKCiAgICAgICAgaWYgKGtleSA9PT0gJ3N0b3AtY29sb3InKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIEBjbGFzcyBPYmplY3QKICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICovCgoKICBmYWJyaWMuR3JhZGllbnQgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcygKICAvKiogQHNjb3BlIGZhYnJpYy5HcmFkaWVudC5wcm90b3R5cGUgKi8KICB7CiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdGhpcy54MSA9IG9wdGlvbnMueDEgfHwgMDsKICAgICAgdGhpcy55MSA9IG9wdGlvbnMueTEgfHwgMDsKICAgICAgdGhpcy54MiA9IG9wdGlvbnMueDIgfHwgMDsKICAgICAgdGhpcy55MiA9IG9wdGlvbnMueTIgfHwgMDsKICAgICAgdGhpcy5jb2xvclN0b3BzID0gb3B0aW9ucy5jb2xvclN0b3BzOwogICAgfSwKICAgIHRvT2JqZWN0OiBmdW5jdGlvbiB0b09iamVjdCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB4MTogdGhpcy54MSwKICAgICAgICB4MjogdGhpcy54MiwKICAgICAgICB5MTogdGhpcy55MSwKICAgICAgICB5MjogdGhpcy55MiwKICAgICAgICBjb2xvclN0b3BzOiB0aGlzLmNvbG9yU3RvcHMKICAgICAgfTsKICAgIH0sCiAgICB0b0xpdmVHcmFkaWVudDogZnVuY3Rpb24gdG9MaXZlR3JhZGllbnQoY3R4KSB7CiAgICAgIHZhciBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCh0aGlzLngxLCB0aGlzLnkxLCB0aGlzLngyIHx8IGN0eC5jYW52YXMud2lkdGgsIHRoaXMueTIpOwoKICAgICAgZm9yICh2YXIgcG9zaXRpb24gaW4gdGhpcy5jb2xvclN0b3BzKSB7CiAgICAgICAgdmFyIGNvbG9yVmFsdWUgPSB0aGlzLmNvbG9yU3RvcHNbcG9zaXRpb25dOwogICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcChwYXJzZUZsb2F0KHBvc2l0aW9uKSwgY29sb3JWYWx1ZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBncmFkaWVudDsKICAgIH0KICB9KTsKICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5HcmFkaWVudCwgewogICAgLyoqCiAgICAgKiBAbWV0aG9kIGZyb21FbGVtZW50CiAgICAgKiBAc3RhdGljCiAgICAgKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRy9wc2VydmVycy5odG1sI0xpbmVhckdyYWRpZW50RWxlbWVudAogICAgICovCiAgICBmcm9tRWxlbWVudDogZnVuY3Rpb24gZnJvbUVsZW1lbnQoZWwsIGluc3RhbmNlKSB7CiAgICAgIC8qKgogICAgICAgKiAgQGV4YW1wbGU6CiAgICAgICAqCiAgICAgICAqICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIj4KICAgICAgICogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0id2hpdGUiLz4KICAgICAgICogICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSJibGFjayIvPgogICAgICAgKiAgPC9saW5lYXJHcmFkaWVudD4KICAgICAgICoKICAgICAgICogIE9SCiAgICAgICAqCiAgICAgICAqICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQxIj4KICAgICAgICogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6cmdiKDI1NSwyNTUsMjU1KSIvPgogICAgICAgKiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOnJnYigwLDAsMCkiLz4KICAgICAgICogIDwvbGluZWFyR3JhZGllbnQ+CiAgICAgICAqCiAgICAgICAqLwogICAgICB2YXIgY29sb3JTdG9wRWxzID0gZWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N0b3AnKSwKICAgICAgICAgIGVsLAogICAgICAgICAgb2Zmc2V0LAogICAgICAgICAgY29sb3JTdG9wcyA9IHt9LAogICAgICAgICAgY29sb3JTdG9wRnJvbVN0eWxlLAogICAgICAgICAgY29vcmRzID0gewogICAgICAgIHgxOiBlbC5nZXRBdHRyaWJ1dGUoJ3gxJykgfHwgMCwKICAgICAgICB5MTogZWwuZ2V0QXR0cmlidXRlKCd5MScpIHx8IDAsCiAgICAgICAgeDI6IGVsLmdldEF0dHJpYnV0ZSgneDInKSB8fCAnMTAwJScsCiAgICAgICAgeTI6IGVsLmdldEF0dHJpYnV0ZSgneTInKSB8fCAwCiAgICAgIH07CgogICAgICBmb3IgKHZhciBpID0gY29sb3JTdG9wRWxzLmxlbmd0aDsgaS0tOykgewogICAgICAgIGVsID0gY29sb3JTdG9wRWxzW2ldOwogICAgICAgIG9mZnNldCA9IGVsLmdldEF0dHJpYnV0ZSgnb2Zmc2V0Jyk7IC8vIGNvbnZlcnQgcGVyY2VudHMgdG8gYWJzb2x1dGUgdmFsdWVzCgogICAgICAgIG9mZnNldCA9IHBhcnNlRmxvYXQob2Zmc2V0KSAvICgvJSQvLnRlc3Qob2Zmc2V0KSA/IDEwMCA6IDEpOwogICAgICAgIGNvbG9yU3RvcHNbb2Zmc2V0XSA9IGdldENvbG9yU3RvcEZyb21TdHlsZShlbCkgfHwgZWwuZ2V0QXR0cmlidXRlKCdzdG9wLWNvbG9yJyk7CiAgICAgIH0KCiAgICAgIF9jb252ZXJ0UGVyY2VudFVuaXRzVG9WYWx1ZXMoaW5zdGFuY2UsIGNvb3Jkcyk7CgogICAgICByZXR1cm4gbmV3IGZhYnJpYy5HcmFkaWVudCh7CiAgICAgICAgeDE6IGNvb3Jkcy54MSwKICAgICAgICB5MTogY29vcmRzLnkxLAogICAgICAgIHgyOiBjb29yZHMueDIsCiAgICAgICAgeTI6IGNvb3Jkcy55MiwKICAgICAgICBjb2xvclN0b3BzOiBjb2xvclN0b3BzCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2QgZm9yT2JqZWN0CiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIGZvck9iamVjdDogZnVuY3Rpb24gZm9yT2JqZWN0KG9iaiwgb3B0aW9ucykgewogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgICAgX2NvbnZlcnRQZXJjZW50VW5pdHNUb1ZhbHVlcyhvYmosIG9wdGlvbnMpOwoKICAgICAgcmV0dXJuIG5ldyBmYWJyaWMuR3JhZGllbnQob3B0aW9ucyk7CiAgICB9CiAgfSk7CgogIGZ1bmN0aW9uIF9jb252ZXJ0UGVyY2VudFVuaXRzVG9WYWx1ZXMob2JqZWN0LCBvcHRpb25zKSB7CiAgICBmb3IgKHZhciBwcm9wIGluIG9wdGlvbnMpIHsKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zW3Byb3BdID09PSAnc3RyaW5nJyAmJiAvXlxkKyUkLy50ZXN0KG9wdGlvbnNbcHJvcF0pKSB7CiAgICAgICAgdmFyIHBlcmNlbnRzID0gcGFyc2VGbG9hdChvcHRpb25zW3Byb3BdLCAxMCk7CgogICAgICAgIGlmIChwcm9wID09PSAneDEnIHx8IHByb3AgPT09ICd4MicpIHsKICAgICAgICAgIG9wdGlvbnNbcHJvcF0gPSBvYmplY3Qud2lkdGggKiBwZXJjZW50cyAvIDEwMDsKICAgICAgICB9IGVsc2UgaWYgKHByb3AgPT09ICd5MScgfHwgcHJvcCA9PT0gJ3kyJykgewogICAgICAgICAgb3B0aW9uc1twcm9wXSA9IG9iamVjdC5oZWlnaHQgKiBwZXJjZW50cyAvIDEwMDsKICAgICAgICB9CiAgICAgIH0gLy8gbm9ybWFsaXplIHJlbmRlcmluZyBwb2ludCAoc2hvdWxkIGJlIGZyb20gdG9wL2xlZnQgY29ybmVyIHJhdGhlciB0aGFuIGNlbnRlciBvZiB0aGUgc2hhcGUpCgoKICAgICAgaWYgKHByb3AgPT09ICd4MScgfHwgcHJvcCA9PT0gJ3gyJykgewogICAgICAgIG9wdGlvbnNbcHJvcF0gLT0gb2JqZWN0LndpZHRoIC8gMjsKICAgICAgfSBlbHNlIGlmIChwcm9wID09PSAneTEnIHx8IHByb3AgPT09ICd5MicpIHsKICAgICAgICBvcHRpb25zW3Byb3BdIC09IG9iamVjdC5oZWlnaHQgLyAyOwogICAgICB9CiAgICB9CiAgfQogIC8qKgogICAqIFBhcnNlcyBhbiBTVkcgZG9jdW1lbnQsIHJldHVybmluZyBhbGwgb2YgdGhlIGdyYWRpZW50IGRlY2xhcmF0aW9ucyBmb3VuZCBpbiBpdAogICAqIEBzdGF0aWMKICAgKiBAZnVuY3Rpb24KICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICogQG1ldGhvZCBnZXRHcmFkaWVudERlZnMKICAgKiBAcGFyYW0ge1NWR0RvY3VtZW50fSBkb2MgU1ZHIGRvY3VtZW50IHRvIHBhcnNlCiAgICogQHJldHVybiB7T2JqZWN0fSBHcmFkaWVudCBkZWZpbml0aW9uczsga2V5IGNvcnJlc3BvbmRzIHRvIGVsZW1lbnQgaWQsIHZhbHVlIC0tIHRvIGdyYWRpZW50IGRlZmluaXRpb24gZWxlbWVudAogICAqLwoKCiAgZnVuY3Rpb24gZ2V0R3JhZGllbnREZWZzKGRvYykgewogICAgdmFyIGxpbmVhckdyYWRpZW50RWxzID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdsaW5lYXJHcmFkaWVudCcpLAogICAgICAgIHJhZGlhbEdyYWRpZW50RWxzID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdyYWRpYWxHcmFkaWVudCcpLAogICAgICAgIGVsLAogICAgICAgIGdyYWRpZW50RGVmcyA9IHt9OwoKICAgIGZvciAodmFyIGkgPSBsaW5lYXJHcmFkaWVudEVscy5sZW5ndGg7IGktLTspIHsKICAgICAgZWwgPSBsaW5lYXJHcmFkaWVudEVsc1tpXTsKICAgICAgZ3JhZGllbnREZWZzW2VsLmdldEF0dHJpYnV0ZSgnaWQnKV0gPSBlbDsKICAgIH0KCiAgICBmb3IgKHZhciBpID0gcmFkaWFsR3JhZGllbnRFbHMubGVuZ3RoOyBpLS07KSB7CiAgICAgIGVsID0gcmFkaWFsR3JhZGllbnRFbHNbaV07CiAgICAgIGdyYWRpZW50RGVmc1tlbC5nZXRBdHRyaWJ1dGUoJ2lkJyldID0gZWw7CiAgICB9CgogICAgcmV0dXJuIGdyYWRpZW50RGVmczsKICB9CgogIGZhYnJpYy5nZXRHcmFkaWVudERlZnMgPSBnZXRHcmFkaWVudERlZnM7Cn0pKCk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKICAvKiBBZGFwdGF0aW9uIG9mIHdvcmsgb2YgS2V2aW4gTGluZHNleSAoa2V2aW5Aa2V2bGluZGV2LmNvbSkgKi8KCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSk7CgogIGlmIChmYWJyaWMuUG9pbnQpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuUG9pbnQgaXMgYWxyZWFkeSBkZWZpbmVkJyk7CiAgICByZXR1cm47CiAgfQoKICBmYWJyaWMuUG9pbnQgPSBQb2ludDsKICAvKioKICAgKiBAbmFtZSBQb2ludAogICAqIEBtZW1iZXJPZiBmYWJyaWMKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge051bWJlcn0geAogICAqIEBwYXJhbSB7TnVtYmVyfSB5CiAgICogQHJldHVybiB7ZmFicmljLlBvaW50fSB0aGlzQXJnCiAgICovCgogIGZ1bmN0aW9uIFBvaW50KHgsIHkpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewogICAgICB0aGlzLmluaXQoeCwgeSk7CiAgICB9CiAgfQoKICBQb2ludC5wcm90b3R5cGUgPQogIC8qKiBAc2NvcGUgZmFicmljLlBvaW50LnByb3RvdHlwZSAqLwogIHsKICAgIGNvbnN0cnVjdG9yOiBQb2ludCwKCiAgICAvKioKICAgICAqIEBtZXRob2QgaW5pdAogICAgICogQHBhcmFtIHtOdW1iZXJ9IHgKICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5CiAgICAgKi8KICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoeCwgeSkgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2QgYWRkCiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5Qb2ludH0gdGhhdAogICAgICogQHJldHVybiB7ZmFicmljLlBvaW50fSBuZXcgUG9pbnQgaW5zdGFuY2Ugd2l0aCBhZGRlZCB2YWx1ZXMKICAgICAqLwogICAgYWRkOiBmdW5jdGlvbiBhZGQodGhhdCkgewogICAgICByZXR1cm4gbmV3IFBvaW50KHRoaXMueCArIHRoYXQueCwgdGhpcy55ICsgdGhhdC55KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIGFkZEVxdWFscwogICAgICogQHBhcmFtIHtmYWJyaWMuUG9pbnR9IHRoYXQKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5Qb2ludH0gdGhpc0FyZwogICAgICovCiAgICBhZGRFcXVhbHM6IGZ1bmN0aW9uIGFkZEVxdWFscyh0aGF0KSB7CiAgICAgIHRoaXMueCArPSB0aGF0Lng7CiAgICAgIHRoaXMueSArPSB0aGF0Lnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2Qgc2NhbGFyQWRkCiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2NhbGFyCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuUG9pbnR9IG5ldyBQb2ludCB3aXRoIGFkZGVkIHZhbHVlCiAgICAgKi8KICAgIHNjYWxhckFkZDogZnVuY3Rpb24gc2NhbGFyQWRkKHNjYWxhcikgewogICAgICByZXR1cm4gbmV3IFBvaW50KHRoaXMueCArIHNjYWxhciwgdGhpcy55ICsgc2NhbGFyKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIHNjYWxhckFkZEVxdWFscwogICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjYWxhcgogICAgICogQHBhcmFtIHtmYWJyaWMuUG9pbnR9IHRoaXNBcmcKICAgICAqLwogICAgc2NhbGFyQWRkRXF1YWxzOiBmdW5jdGlvbiBzY2FsYXJBZGRFcXVhbHMoc2NhbGFyKSB7CiAgICAgIHRoaXMueCArPSBzY2FsYXI7CiAgICAgIHRoaXMueSArPSBzY2FsYXI7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2Qgc3VidHJhY3QKICAgICAqIEBwYXJhbSB7ZmFicmljLlBvaW50fSB0aGF0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuUG9pbnR9IG5ldyBQb2ludCBvYmplY3Qgd2l0aCBzdWJ0cmFjdGVkIHZhbHVlcwogICAgICovCiAgICBzdWJ0cmFjdDogZnVuY3Rpb24gc3VidHJhY3QodGhhdCkgewogICAgICByZXR1cm4gbmV3IFBvaW50KHRoaXMueCAtIHRoYXQueCwgdGhpcy55IC0gdGhhdC55KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIHN1YnRyYWN0RXF1YWxzCiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5Qb2ludH0gdGhhdAogICAgICogQHJldHVybiB7ZmFicmljLlBvaW50fSB0aGlzQXJnCiAgICAgKi8KICAgIHN1YnRyYWN0RXF1YWxzOiBmdW5jdGlvbiBzdWJ0cmFjdEVxdWFscyh0aGF0KSB7CiAgICAgIHRoaXMueCAtPSB0aGF0Lng7CiAgICAgIHRoaXMueSAtPSB0aGF0Lnk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIHNjYWxhclN1YnRyYWN0OiBmdW5jdGlvbiBzY2FsYXJTdWJ0cmFjdChzY2FsYXIpIHsKICAgICAgcmV0dXJuIG5ldyBQb2ludCh0aGlzLnggLSBzY2FsYXIsIHRoaXMueSAtIHNjYWxhcik7CiAgICB9LAogICAgc2NhbGFyU3VidHJhY3RFcXVhbHM6IGZ1bmN0aW9uIHNjYWxhclN1YnRyYWN0RXF1YWxzKHNjYWxhcikgewogICAgICB0aGlzLnggLT0gc2NhbGFyOwogICAgICB0aGlzLnkgLT0gc2NhbGFyOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBtdWx0aXBseTogZnVuY3Rpb24gbXVsdGlwbHkoc2NhbGFyKSB7CiAgICAgIHJldHVybiBuZXcgUG9pbnQodGhpcy54ICogc2NhbGFyLCB0aGlzLnkgKiBzY2FsYXIpOwogICAgfSwKICAgIG11bHRpcGx5RXF1YWxzOiBmdW5jdGlvbiBtdWx0aXBseUVxdWFscyhzY2FsYXIpIHsKICAgICAgdGhpcy54ICo9IHNjYWxhcjsKICAgICAgdGhpcy55ICo9IHNjYWxhcjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgZGl2aWRlOiBmdW5jdGlvbiBkaXZpZGUoc2NhbGFyKSB7CiAgICAgIHJldHVybiBuZXcgUG9pbnQodGhpcy54IC8gc2NhbGFyLCB0aGlzLnkgLyBzY2FsYXIpOwogICAgfSwKICAgIGRpdmlkZUVxdWFsczogZnVuY3Rpb24gZGl2aWRlRXF1YWxzKHNjYWxhcikgewogICAgICB0aGlzLnggLz0gc2NhbGFyOwogICAgICB0aGlzLnkgLz0gc2NhbGFyOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBlcTogZnVuY3Rpb24gZXEodGhhdCkgewogICAgICByZXR1cm4gdGhpcy54ID09IHRoYXQueCAmJiB0aGlzLnkgPT0gdGhhdC55OwogICAgfSwKICAgIGx0OiBmdW5jdGlvbiBsdCh0aGF0KSB7CiAgICAgIHJldHVybiB0aGlzLnggPCB0aGF0LnggJiYgdGhpcy55IDwgdGhhdC55OwogICAgfSwKICAgIGx0ZTogZnVuY3Rpb24gbHRlKHRoYXQpIHsKICAgICAgcmV0dXJuIHRoaXMueCA8PSB0aGF0LnggJiYgdGhpcy55IDw9IHRoYXQueTsKICAgIH0sCiAgICBndDogZnVuY3Rpb24gZ3QodGhhdCkgewogICAgICByZXR1cm4gdGhpcy54ID4gdGhhdC54ICYmIHRoaXMueSA+IHRoYXQueTsKICAgIH0sCiAgICBndGU6IGZ1bmN0aW9uIGd0ZSh0aGF0KSB7CiAgICAgIHJldHVybiB0aGlzLnggPj0gdGhhdC54ICYmIHRoaXMueSA+PSB0aGF0Lnk7CiAgICB9LAogICAgbGVycDogZnVuY3Rpb24gbGVycCh0aGF0LCB0KSB7CiAgICAgIHJldHVybiBuZXcgUG9pbnQodGhpcy54ICsgKHRoYXQueCAtIHRoaXMueCkgKiB0LCB0aGlzLnkgKyAodGhhdC55IC0gdGhpcy55KSAqIHQpOwogICAgfSwKICAgIGRpc3RhbmNlRnJvbTogZnVuY3Rpb24gZGlzdGFuY2VGcm9tKHRoYXQpIHsKICAgICAgdmFyIGR4ID0gdGhpcy54IC0gdGhhdC54LAogICAgICAgICAgZHkgPSB0aGlzLnkgLSB0aGF0Lnk7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgfSwKICAgIG1pbjogZnVuY3Rpb24gbWluKHRoYXQpIHsKICAgICAgcmV0dXJuIG5ldyBQb2ludChNYXRoLm1pbih0aGlzLngsIHRoYXQueCksIE1hdGgubWluKHRoaXMueSwgdGhhdC55KSk7CiAgICB9LAogICAgbWF4OiBmdW5jdGlvbiBtYXgodGhhdCkgewogICAgICByZXR1cm4gbmV3IFBvaW50KE1hdGgubWF4KHRoaXMueCwgdGhhdC54KSwgTWF0aC5tYXgodGhpcy55LCB0aGF0LnkpKTsKICAgIH0sCiAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLnggKyAiLCIgKyB0aGlzLnk7CiAgICB9LAogICAgc2V0WFk6IGZ1bmN0aW9uIHNldFhZKHgsIHkpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgIH0sCiAgICBzZXRGcm9tUG9pbnQ6IGZ1bmN0aW9uIHNldEZyb21Qb2ludCh0aGF0KSB7CiAgICAgIHRoaXMueCA9IHRoYXQueDsKICAgICAgdGhpcy55ID0gdGhhdC55OwogICAgfSwKICAgIHN3YXA6IGZ1bmN0aW9uIHN3YXAodGhhdCkgewogICAgICB2YXIgeCA9IHRoaXMueCwKICAgICAgICAgIHkgPSB0aGlzLnk7CiAgICAgIHRoaXMueCA9IHRoYXQueDsKICAgICAgdGhpcy55ID0gdGhhdC55OwogICAgICB0aGF0LnggPSB4OwogICAgICB0aGF0LnkgPSB5OwogICAgfQogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CiAgLyogQWRhcHRhdGlvbiBvZiB3b3JrIG9mIEtldmluIExpbmRzZXkgKGtldmluQGtldmxpbmRldi5jb20pICovCgogIHZhciBmYWJyaWMgPSBnbG9iYWwuZmFicmljIHx8IChnbG9iYWwuZmFicmljID0ge30pOwoKICBpZiAoZmFicmljLkludGVyc2VjdGlvbikgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5JbnRlcnNlY3Rpb24gaXMgYWxyZWFkeSBkZWZpbmVkJyk7CiAgICByZXR1cm47CiAgfQogIC8qKgogICAqIEBjbGFzcyBJbnRlcnNlY3Rpb24KICAgKiBAbWVtYmVyT2YgZmFicmljCiAgICovCgoKICBmdW5jdGlvbiBJbnRlcnNlY3Rpb24oc3RhdHVzKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5pbml0KHN0YXR1cyk7CiAgICB9CiAgfQoKICBmYWJyaWMuSW50ZXJzZWN0aW9uID0gSW50ZXJzZWN0aW9uOwogIGZhYnJpYy5JbnRlcnNlY3Rpb24ucHJvdG90eXBlID0KICAvKiogQHNjb3BlIGZhYnJpYy5JbnRlcnNlY3Rpb24ucHJvdG90eXBlICovCiAgewogICAgLyoqCiAgICAgKiBAbWV0aG9kIGluaXQKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdGF0dXMKICAgICAqLwogICAgaW5pdDogZnVuY3Rpb24gaW5pdChzdGF0dXMpIHsKICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICAgIHRoaXMucG9pbnRzID0gW107CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBhcHBlbmRQb2ludAogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0YXR1cwogICAgICovCiAgICBhcHBlbmRQb2ludDogZnVuY3Rpb24gYXBwZW5kUG9pbnQocG9pbnQpIHsKICAgICAgdGhpcy5wb2ludHMucHVzaChwb2ludCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBhcHBlbmRQb2ludHMKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdGF0dXMKICAgICAqLwogICAgYXBwZW5kUG9pbnRzOiBmdW5jdGlvbiBhcHBlbmRQb2ludHMocG9pbnRzKSB7CiAgICAgIHRoaXMucG9pbnRzID0gdGhpcy5wb2ludHMuY29uY2F0KHBvaW50cyk7CiAgICB9CiAgfTsKICAvKioKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBpbnRlcnNlY3RMaW5lTGluZQogICAqLwoKICBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVMaW5lID0gZnVuY3Rpb24gKGExLCBhMiwgYjEsIGIyKSB7CiAgICB2YXIgcmVzdWx0LAogICAgICAgIHVhX3QgPSAoYjIueCAtIGIxLngpICogKGExLnkgLSBiMS55KSAtIChiMi55IC0gYjEueSkgKiAoYTEueCAtIGIxLngpLAogICAgICAgIHViX3QgPSAoYTIueCAtIGExLngpICogKGExLnkgLSBiMS55KSAtIChhMi55IC0gYTEueSkgKiAoYTEueCAtIGIxLngpLAogICAgICAgIHVfYiA9IChiMi55IC0gYjEueSkgKiAoYTIueCAtIGExLngpIC0gKGIyLnggLSBiMS54KSAqIChhMi55IC0gYTEueSk7CgogICAgaWYgKHVfYiAhPSAwKSB7CiAgICAgIHZhciB1YSA9IHVhX3QgLyB1X2IsCiAgICAgICAgICB1YiA9IHViX3QgLyB1X2I7CgogICAgICBpZiAoMCA8PSB1YSAmJiB1YSA8PSAxICYmIDAgPD0gdWIgJiYgdWIgPD0gMSkgewogICAgICAgIHJlc3VsdCA9IG5ldyBJbnRlcnNlY3Rpb24oIkludGVyc2VjdGlvbiIpOwogICAgICAgIHJlc3VsdC5wb2ludHMucHVzaChuZXcgZmFicmljLlBvaW50KGExLnggKyB1YSAqIChhMi54IC0gYTEueCksIGExLnkgKyB1YSAqIChhMi55IC0gYTEueSkpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSBuZXcgSW50ZXJzZWN0aW9uKCJObyBJbnRlcnNlY3Rpb24iKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKHVhX3QgPT0gMCB8fCB1Yl90ID09IDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgSW50ZXJzZWN0aW9uKCJDb2luY2lkZW50Iik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IEludGVyc2VjdGlvbigiUGFyYWxsZWwiKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKICAvKioKICAgKiBAbWV0aG9kIGludGVyc2VjdExpbmVQb2x5Z29uCiAgICovCgoKICBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVQb2x5Z29uID0gZnVuY3Rpb24gKGExLCBhMiwgcG9pbnRzKSB7CiAgICB2YXIgcmVzdWx0ID0gbmV3IEludGVyc2VjdGlvbigiTm8gSW50ZXJzZWN0aW9uIiksCiAgICAgICAgbGVuZ3RoID0gcG9pbnRzLmxlbmd0aDsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBiMSA9IHBvaW50c1tpXSwKICAgICAgICAgIGIyID0gcG9pbnRzWyhpICsgMSkgJSBsZW5ndGhdLAogICAgICAgICAgaW50ZXIgPSBJbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZUxpbmUoYTEsIGEyLCBiMSwgYjIpOwogICAgICByZXN1bHQuYXBwZW5kUG9pbnRzKGludGVyLnBvaW50cyk7CiAgICB9CgogICAgaWYgKHJlc3VsdC5wb2ludHMubGVuZ3RoID4gMCkgewogICAgICByZXN1bHQuc3RhdHVzID0gIkludGVyc2VjdGlvbiI7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9OwogIC8qKgogICAqIEBtZXRob2QgaW50ZXJzZWN0UG9seWdvblBvbHlnb24KICAgKi8KCgogIGZhYnJpYy5JbnRlcnNlY3Rpb24uaW50ZXJzZWN0UG9seWdvblBvbHlnb24gPSBmdW5jdGlvbiAocG9pbnRzMSwgcG9pbnRzMikgewogICAgdmFyIHJlc3VsdCA9IG5ldyBJbnRlcnNlY3Rpb24oIk5vIEludGVyc2VjdGlvbiIpLAogICAgICAgIGxlbmd0aCA9IHBvaW50czEubGVuZ3RoOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGExID0gcG9pbnRzMVtpXSwKICAgICAgICAgIGEyID0gcG9pbnRzMVsoaSArIDEpICUgbGVuZ3RoXSwKICAgICAgICAgIGludGVyID0gSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVQb2x5Z29uKGExLCBhMiwgcG9pbnRzMik7CiAgICAgIHJlc3VsdC5hcHBlbmRQb2ludHMoaW50ZXIucG9pbnRzKTsKICAgIH0KCiAgICBpZiAocmVzdWx0LnBvaW50cy5sZW5ndGggPiAwKSB7CiAgICAgIHJlc3VsdC5zdGF0dXMgPSAiSW50ZXJzZWN0aW9uIjsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0OwogIH07CiAgLyoqCiAgICogQG1ldGhvZCBpbnRlcnNlY3RQb2x5Z29uUmVjdGFuZ2xlCiAgICovCgoKICBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdFBvbHlnb25SZWN0YW5nbGUgPSBmdW5jdGlvbiAocG9pbnRzLCByMSwgcjIpIHsKICAgIHZhciBtaW4gPSByMS5taW4ocjIpLAogICAgICAgIG1heCA9IHIxLm1heChyMiksCiAgICAgICAgdG9wUmlnaHQgPSBuZXcgZmFicmljLlBvaW50KG1heC54LCBtaW4ueSksCiAgICAgICAgYm90dG9tTGVmdCA9IG5ldyBmYWJyaWMuUG9pbnQobWluLngsIG1heC55KSwKICAgICAgICBpbnRlcjEgPSBJbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZVBvbHlnb24obWluLCB0b3BSaWdodCwgcG9pbnRzKSwKICAgICAgICBpbnRlcjIgPSBJbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZVBvbHlnb24odG9wUmlnaHQsIG1heCwgcG9pbnRzKSwKICAgICAgICBpbnRlcjMgPSBJbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZVBvbHlnb24obWF4LCBib3R0b21MZWZ0LCBwb2ludHMpLAogICAgICAgIGludGVyNCA9IEludGVyc2VjdGlvbi5pbnRlcnNlY3RMaW5lUG9seWdvbihib3R0b21MZWZ0LCBtaW4sIHBvaW50cyksCiAgICAgICAgcmVzdWx0ID0gbmV3IEludGVyc2VjdGlvbigiTm8gSW50ZXJzZWN0aW9uIik7CiAgICByZXN1bHQuYXBwZW5kUG9pbnRzKGludGVyMS5wb2ludHMpOwogICAgcmVzdWx0LmFwcGVuZFBvaW50cyhpbnRlcjIucG9pbnRzKTsKICAgIHJlc3VsdC5hcHBlbmRQb2ludHMoaW50ZXIzLnBvaW50cyk7CiAgICByZXN1bHQuYXBwZW5kUG9pbnRzKGludGVyNC5wb2ludHMpOwoKICAgIGlmIChyZXN1bHQucG9pbnRzLmxlbmd0aCA+IDApIHsKICAgICAgcmVzdWx0LnN0YXR1cyA9ICJJbnRlcnNlY3Rpb24iOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSk7CgogIGlmIChmYWJyaWMuQ29sb3IpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuQ29sb3IgaXMgYWxyZWFkeSBkZWZpbmVkLicpOwogICAgcmV0dXJuOwogIH0KICAvKioKICAgKiBUaGUgcHVycG9zZSBvZiB7QGxpbmsgZmFicmljLkNvbG9yfSBpcyB0byBhYnN0cmFjdCBhbmQgZW5jYXBzdWxhdGUgY29tbW9uIGNvbG9yIG9wZXJhdGlvbnM7CiAgICoge0BsaW5rIGZhYnJpYy5Db2xvcn0gaXMgYSBjb25zdHJ1Y3RvciBhbmQgY3JlYXRlcyBpbnN0YW5jZXMgb2Yge0BsaW5rIGZhYnJpYy5Db2xvcn0gb2JqZWN0cy4KICAgKgogICAqIEBjbGFzcyBDb2xvcgogICAqIEBtZW1iZXJPZiBmYWJyaWMKICAgKiBAcGFyYW0ge1N0cmluZ30gY29sb3IgKG9wdGlvbmFsKSBpbiBoZXggb3IgcmdiKGEpIGZvcm1hdAogICAqLwoKCiAgZnVuY3Rpb24gQ29sb3IoY29sb3IpIHsKICAgIGlmICghY29sb3IpIHsKICAgICAgdGhpcy5zZXRTb3VyY2UoWzAsIDAsIDAsIDFdKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX3RyeVBhcnNpbmdDb2xvcihjb2xvcik7CiAgICB9CiAgfQoKICBmYWJyaWMuQ29sb3IgPSBDb2xvcjsKICBmYWJyaWMuQ29sb3IucHJvdG90eXBlID0KICAvKiogQHNjb3BlIGZhYnJpYy5Db2xvci5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF90cnlQYXJzaW5nQ29sb3IKICAgICAqLwogICAgX3RyeVBhcnNpbmdDb2xvcjogZnVuY3Rpb24gX3RyeVBhcnNpbmdDb2xvcihjb2xvcikgewogICAgICB2YXIgc291cmNlID0gQ29sb3Iuc291cmNlRnJvbUhleChjb2xvcik7CgogICAgICBpZiAoIXNvdXJjZSkgewogICAgICAgIHNvdXJjZSA9IENvbG9yLnNvdXJjZUZyb21SZ2IoY29sb3IpOwogICAgICB9CgogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgdGhpcy5zZXRTb3VyY2Uoc291cmNlKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc291cmNlIG9mIHRoaXMgY29sb3IgKHdoZXJlIHNvdXJjZSBpcyBhbiBhcnJheSByZXByZXNlbnRhdGlvbjsgZXg6IFsyMDAsIDIwMCwgMTAwLCAxXSkKICAgICAqIEBtZXRob2QgZ2V0U291cmNlCiAgICAgKiBAcmV0dXJuIHtBcnJheX0KICAgICAqLwogICAgZ2V0U291cmNlOiBmdW5jdGlvbiBnZXRTb3VyY2UoKSB7CiAgICAgIHJldHVybiB0aGlzLl9zb3VyY2U7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyBzb3VyY2Ugb2YgdGhpcyBjb2xvciAod2hlcmUgc291cmNlIGlzIGFuIGFycmF5IHJlcHJlc2VudGF0aW9uOyBleDogWzIwMCwgMjAwLCAxMDAsIDFdKQogICAgICogQG1ldGhvZCBzZXRTb3VyY2UKICAgICAqIEBwYXJhbSB7QXJyYXl9IHNvdXJjZQogICAgICovCiAgICBzZXRTb3VyY2U6IGZ1bmN0aW9uIHNldFNvdXJjZShzb3VyY2UpIHsKICAgICAgdGhpcy5fc291cmNlID0gc291cmNlOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgY29sb3IgcmVwcmVzZW5hdGlvbiBpbiBSR0IgZm9ybWF0CiAgICAgKiBAbWV0aG9kIHRvUmdiCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGV4OiByZ2IoMC0yNTUsMC0yNTUsMC0yNTUpCiAgICAgKi8KICAgIHRvUmdiOiBmdW5jdGlvbiB0b1JnYigpIHsKICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuZ2V0U291cmNlKCk7CiAgICAgIHJldHVybiAncmdiKCcgKyBzb3VyY2VbMF0gKyAnLCcgKyBzb3VyY2VbMV0gKyAnLCcgKyBzb3VyY2VbMl0gKyAnKSc7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjb2xvciByZXByZXNlbmF0aW9uIGluIFJHQkEgZm9ybWF0CiAgICAgKiBAbWV0aG9kIHRvUmdiYQogICAgICogQHJldHVybiB7U3RyaW5nfSBleDogcmdiYSgwLTI1NSwwLTI1NSwwLTI1NSwwLTEpCiAgICAgKi8KICAgIHRvUmdiYTogZnVuY3Rpb24gdG9SZ2JhKCkgewogICAgICB2YXIgc291cmNlID0gdGhpcy5nZXRTb3VyY2UoKTsKICAgICAgcmV0dXJuICdyZ2JhKCcgKyBzb3VyY2VbMF0gKyAnLCcgKyBzb3VyY2VbMV0gKyAnLCcgKyBzb3VyY2VbMl0gKyAnLCcgKyBzb3VyY2VbM10gKyAnKSc7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjb2xvciByZXByZXNlbmF0aW9uIGluIEhFWCBmb3JtYXQKICAgICAqIEBtZXRob2QgdG9IZXgKICAgICAqIEByZXR1cm4ge1N0cmluZ30gZXg6IEZGNTU1NQogICAgICovCiAgICB0b0hleDogZnVuY3Rpb24gdG9IZXgoKSB7CiAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldFNvdXJjZSgpOwogICAgICB2YXIgciA9IHNvdXJjZVswXS50b1N0cmluZygxNik7CiAgICAgIHIgPSByLmxlbmd0aCA9PSAxID8gJzAnICsgciA6IHI7CiAgICAgIHZhciBnID0gc291cmNlWzFdLnRvU3RyaW5nKDE2KTsKICAgICAgZyA9IGcubGVuZ3RoID09IDEgPyAnMCcgKyBnIDogZzsKICAgICAgdmFyIGIgPSBzb3VyY2VbMl0udG9TdHJpbmcoMTYpOwogICAgICBiID0gYi5sZW5ndGggPT0gMSA/ICcwJyArIGIgOiBiOwogICAgICByZXR1cm4gci50b1VwcGVyQ2FzZSgpICsgZy50b1VwcGVyQ2FzZSgpICsgYi50b1VwcGVyQ2FzZSgpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldHMgdmFsdWUgb2YgYWxwaGEgY2hhbm5lbCBmb3IgdGhpcyBjb2xvciAKICAgICAqIEBtZXRob2QgZ2V0QWxwaGEKICAgICAqIEByZXR1cm4ge051bWJlcn0gMC0xCiAgICAgKi8KICAgIGdldEFscGhhOiBmdW5jdGlvbiBnZXRBbHBoYSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0U291cmNlKClbM107CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyB2YWx1ZSBvZiBhbHBoYSBjaGFubmVsIGZvciB0aGlzIGNvbG9yCiAgICAgKiBAbWV0aG9kIHNldEFscGhhCiAgICAgKiBAcGFyYW0ge051bWJlcn0gMC0xCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ29sb3J9IHRoaXNBcmcKICAgICAqLwogICAgc2V0QWxwaGE6IGZ1bmN0aW9uIHNldEFscGhhKGFscGhhKSB7CiAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldFNvdXJjZSgpOwogICAgICBzb3VyY2VbM10gPSBhbHBoYTsKICAgICAgdGhpcy5zZXRTb3VyY2Uoc291cmNlKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogVHJhbnNmb3JtcyBjb2xvciB0byBpdHMgZ3JheXNjYWxlIHJlcHJlc2VudGF0aW9uCiAgICAgKiBAbWV0aG9kIHRvR3JheXNjYWxlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ29sb3J9IHRoaXNBcmcKICAgICAqLwogICAgdG9HcmF5c2NhbGU6IGZ1bmN0aW9uIHRvR3JheXNjYWxlKCkgewogICAgICB2YXIgc291cmNlID0gdGhpcy5nZXRTb3VyY2UoKSwKICAgICAgICAgIGF2ZXJhZ2UgPSBwYXJzZUludCgoc291cmNlWzBdICogMC4zICsgc291cmNlWzFdICogMC41OSArIHNvdXJjZVsyXSAqIDAuMTEpLnRvRml4ZWQoMCksIDEwKSwKICAgICAgICAgIGN1cnJlbnRBbHBoYSA9IHNvdXJjZVszXTsKICAgICAgdGhpcy5zZXRTb3VyY2UoW2F2ZXJhZ2UsIGF2ZXJhZ2UsIGF2ZXJhZ2UsIGN1cnJlbnRBbHBoYV0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBUcmFuc2Zvcm1zIGNvbG9yIHRvIGl0cyBibGFjayBhbmQgd2hpdGUgcmVwcmVzZW50YXRpb24KICAgICAqIEBtZXRob2QgdG9HcmF5c2NhbGUKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5Db2xvcn0gdGhpc0FyZwogICAgICovCiAgICB0b0JsYWNrV2hpdGU6IGZ1bmN0aW9uIHRvQmxhY2tXaGl0ZSh0aHJlc2hvbGQpIHsKICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuZ2V0U291cmNlKCksCiAgICAgICAgICBhdmVyYWdlID0gKHNvdXJjZVswXSAqIDAuMyArIHNvdXJjZVsxXSAqIDAuNTkgKyBzb3VyY2VbMl0gKiAwLjExKS50b0ZpeGVkKDApLAogICAgICAgICAgY3VycmVudEFscGhhID0gc291cmNlWzNdLAogICAgICAgICAgdGhyZXNob2xkID0gdGhyZXNob2xkIHx8IDEyNzsKICAgICAgYXZlcmFnZSA9IE51bWJlcihhdmVyYWdlKSA8IE51bWJlcih0aHJlc2hvbGQpID8gMCA6IDI1NTsKICAgICAgdGhpcy5zZXRTb3VyY2UoW2F2ZXJhZ2UsIGF2ZXJhZ2UsIGF2ZXJhZ2UsIGN1cnJlbnRBbHBoYV0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBPdmVybGF5cyBjb2xvciB3aXRoIGFub3RoZXIgY29sb3IKICAgICAqIEBtZXRob2Qgb3ZlcmxheVdpdGgKICAgICAqIEBwYXJhbSB7U3RyaW5nfGZhYnJpYy5Db2xvcn0gb3RoZXJDb2xvcgogICAgICogQHJldHVybiB7ZmFicmljLkNvbG9yfSB0aGlzQXJnCiAgICAgKi8KICAgIG92ZXJsYXlXaXRoOiBmdW5jdGlvbiBvdmVybGF5V2l0aChvdGhlckNvbG9yKSB7CiAgICAgIGlmICghKG90aGVyQ29sb3IgaW5zdGFuY2VvZiBDb2xvcikpIHsKICAgICAgICBvdGhlckNvbG9yID0gbmV3IENvbG9yKG90aGVyQ29sb3IpOwogICAgICB9CgogICAgICB2YXIgcmVzdWx0ID0gW10sCiAgICAgICAgICBhbHBoYSA9IHRoaXMuZ2V0QWxwaGEoKSwKICAgICAgICAgIG90aGVyQWxwaGEgPSAwLjUsCiAgICAgICAgICBzb3VyY2UgPSB0aGlzLmdldFNvdXJjZSgpLAogICAgICAgICAgb3RoZXJTb3VyY2UgPSBvdGhlckNvbG9yLmdldFNvdXJjZSgpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICByZXN1bHQucHVzaChNYXRoLnJvdW5kKHNvdXJjZVtpXSAqICgxIC0gb3RoZXJBbHBoYSkgKyBvdGhlclNvdXJjZVtpXSAqIG90aGVyQWxwaGEpKTsKICAgICAgfQoKICAgICAgcmVzdWx0WzNdID0gYWxwaGE7CiAgICAgIHRoaXMuc2V0U291cmNlKHJlc3VsdCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH07CiAgLyoqCiAgICogUmVnZXggbWF0Y2hpbmcgY29sb3IgaW4gUkdCIG9yIFJHQkEgZm9ybWF0cyAoZXg6IHJnYigwLCAwLCAwKSwgcmdiKDI1NSwgMTAwLCAxMCwgMC41KSwgcmdiKDEsMSwxKSkKICAgKiBAc3RhdGljCiAgICogQGZpZWxkCiAgICovCgogIGZhYnJpYy5Db2xvci5yZVJHQmEgPSAvXnJnYmE/XCgoXGR7MSwzfSlccyosXHMqKFxkezEsM30pXHMqLFxzKihcZHsxLDN9KSg/OlxzKixccyooXGQrKD86XC5cZCspPykpP1wpJC87CiAgLyoqCiAgICogUmVnZXggbWF0Y2hpbmcgY29sb3IgaW4gSEVYIGZvcm1hdCAoZXg6ICNGRjU1NTUsIDAxMDE1NSwgYWZmKQogICAqIEBzdGF0aWMKICAgKiBAZmllbGQKICAgKi8KCiAgZmFicmljLkNvbG9yLnJlSGV4ID0gL14jPyhbMC05YS1mXXs2fXxbMC05YS1mXXszfSkkL2k7CiAgLyoqCiAgICogUmV0dXJucyBuZXcgY29sb3Igb2JqZWN0LCB3aGVuIGdpdmVuIGEgY29sb3IgaW4gUkdCIGZvcm1hdAogICAqIEBtZXRob2QgZnJvbVJnYgogICAqIEBwYXJhbSB7U3RyaW5nfSBjb2xvciBleDogcmdiKDAtMjU1LDAtMjU1LDAtMjU1KQogICAqIEByZXR1cm4ge2ZhYnJpYy5Db2xvcn0KICAgKi8KCiAgZmFicmljLkNvbG9yLmZyb21SZ2IgPSBmdW5jdGlvbiAoY29sb3IpIHsKICAgIHJldHVybiBDb2xvci5mcm9tU291cmNlKENvbG9yLnNvdXJjZUZyb21SZ2IoY29sb3IpKTsKICB9OwogIC8qKgogICAqIFJldHVybnMgYXJyYXkgcmVwcmVzZW5hdGF0aW9uIChleDogWzEwMCwgMTAwLCAyMDAsIDFdKSBvZiBhIGNvbG9yIHRoYXQncyBpbiBSR0Igb3IgUkdCQSBmb3JtYXQKICAgKiBAbWV0aG9kIHNvdXJjZUZyb21SZ2IKICAgKiBAcGFyYW0ge1N0cmluZ30gY29sb3IgZXg6IHJnYigwLTI1NSwwLTI1NSwwLTI1NSkKICAgKiBAcmV0dXJuIHtBcnJheX0gc291cmNlCiAgICovCgoKICBmYWJyaWMuQ29sb3Iuc291cmNlRnJvbVJnYiA9IGZ1bmN0aW9uIChjb2xvcikgewogICAgdmFyIG1hdGNoID0gY29sb3IubWF0Y2goQ29sb3IucmVSR0JhKTsKCiAgICBpZiAobWF0Y2gpIHsKICAgICAgcmV0dXJuIFtwYXJzZUludChtYXRjaFsxXSwgMTApLCBwYXJzZUludChtYXRjaFsyXSwgMTApLCBwYXJzZUludChtYXRjaFszXSwgMTApLCBtYXRjaFs0XSA/IHBhcnNlRmxvYXQobWF0Y2hbNF0pIDogMV07CiAgICB9CiAgfTsKICAvKioKICAgKiBSZXR1cm5zIG5ldyBjb2xvciBvYmplY3QsIHdoZW4gZ2l2ZW4gYSBjb2xvciBpbiBSR0JBIGZvcm1hdAogICAqIEBzdGF0aWMKICAgKiBAZnVuY3Rpb24KICAgKiBAbWV0aG9kIGZyb21SZ2JhCiAgICogQHBhcmFtIHtTdHJpbmd9IGNvbG9yCiAgICogQHJldHVybiB7ZmFicmljLkNvbG9yfQogICAqLwoKCiAgZmFicmljLkNvbG9yLmZyb21SZ2JhID0gQ29sb3IuZnJvbVJnYjsKICAvKioKICAgKiBSZXR1cm5zIG5ldyBjb2xvciBvYmplY3QsIHdoZW4gZ2l2ZW4gYSBjb2xvciBpbiBIRVggZm9ybWF0CiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgZnJvbUhleAogICAqIEByZXR1cm4ge2ZhYnJpYy5Db2xvcn0KICAgKi8KCiAgZmFicmljLkNvbG9yLmZyb21IZXggPSBmdW5jdGlvbiAoY29sb3IpIHsKICAgIHJldHVybiBDb2xvci5mcm9tU291cmNlKENvbG9yLnNvdXJjZUZyb21IZXgoY29sb3IpKTsKICB9OwogIC8qKgogICAqIFJldHVybnMgYXJyYXkgcmVwcmVzZW5hdGF0aW9uIChleDogWzEwMCwgMTAwLCAyMDAsIDFdKSBvZiBhIGNvbG9yIHRoYXQncyBpbiBIRVggZm9ybWF0CiAgICogQHN0YXRpYwogICAqIEBtZXRob2Qgc291cmNlRnJvbUhleAogICAqIEBwYXJhbSB7U3RyaW5nfSBjb2xvciBleDogRkY1NTU1CiAgICogQHJldHVybiB7QXJyYXl9IHNvdXJjZQogICAqLwoKCiAgZmFicmljLkNvbG9yLnNvdXJjZUZyb21IZXggPSBmdW5jdGlvbiAoY29sb3IpIHsKICAgIGlmIChjb2xvci5tYXRjaChDb2xvci5yZUhleCkpIHsKICAgICAgdmFyIHZhbHVlID0gY29sb3Iuc2xpY2UoY29sb3IuaW5kZXhPZignIycpICsgMSksCiAgICAgICAgICBpc1Nob3J0Tm90YXRpb24gPSB2YWx1ZS5sZW5ndGggPT09IDMsCiAgICAgICAgICByID0gaXNTaG9ydE5vdGF0aW9uID8gdmFsdWUuY2hhckF0KDApICsgdmFsdWUuY2hhckF0KDApIDogdmFsdWUuc3Vic3RyaW5nKDAsIDIpLAogICAgICAgICAgZyA9IGlzU2hvcnROb3RhdGlvbiA/IHZhbHVlLmNoYXJBdCgxKSArIHZhbHVlLmNoYXJBdCgxKSA6IHZhbHVlLnN1YnN0cmluZygyLCA0KSwKICAgICAgICAgIGIgPSBpc1Nob3J0Tm90YXRpb24gPyB2YWx1ZS5jaGFyQXQoMikgKyB2YWx1ZS5jaGFyQXQoMikgOiB2YWx1ZS5zdWJzdHJpbmcoNCwgNik7CiAgICAgIHJldHVybiBbcGFyc2VJbnQociwgMTYpLCBwYXJzZUludChnLCAxNiksIHBhcnNlSW50KGIsIDE2KSwgMV07CiAgICB9CiAgfTsKICAvKioKICAgKiBSZXR1cm5zIG5ldyBjb2xvciBvYmplY3QsIHdoZW4gZ2l2ZW4gY29sb3IgaW4gYXJyYXkgcmVwcmVzZW50YXRpb24gKGV4OiBbMjAwLCAxMDAsIDEwMCwgMC41XSkKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmcm9tU291cmNlCiAgICogQHJldHVybiB7ZmFicmljLkNvbG9yfQogICAqLwoKCiAgZmFicmljLkNvbG9yLmZyb21Tb3VyY2UgPSBmdW5jdGlvbiAoc291cmNlKSB7CiAgICB2YXIgb0NvbG9yID0gbmV3IENvbG9yKCk7CiAgICBvQ29sb3Iuc2V0U291cmNlKHNvdXJjZSk7CiAgICByZXR1cm4gb0NvbG9yOwogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIGlmIChmYWJyaWMuU3RhdGljQ2FudmFzKSB7CiAgICBmYWJyaWMud2FybignZmFicmljLlN0YXRpY0NhbnZhcyBpcyBhbHJlYWR5IGRlZmluZWQuJyk7CiAgICByZXR1cm47CiAgfSAvLyBhbGlhc2VzIGZvciBmYXN0ZXIgcmVzb2x1dGlvbgoKCiAgdmFyIGV4dGVuZCA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQsCiAgICAgIGdldEVsZW1lbnRPZmZzZXQgPSBmYWJyaWMudXRpbC5nZXRFbGVtZW50T2Zmc2V0LAogICAgICByZW1vdmVGcm9tQXJyYXkgPSBmYWJyaWMudXRpbC5yZW1vdmVGcm9tQXJyYXksCiAgICAgIHJlbW92ZUxpc3RlbmVyID0gZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIsCiAgICAgIENBTlZBU19JTklUX0VSUk9SID0gbmV3IEVycm9yKCdDb3VsZCBub3QgaW5pdGlhbGl6ZSBgY2FudmFzYCBlbGVtZW50Jyk7CiAgLyoqCiAgICogQGNsYXNzIGZhYnJpYy5TdGF0aWNDYW52YXMKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgU3RyaW5nfSBlbCAmbHQ7Y2FudmFzPiBlbGVtZW50IHRvIGluaXRpYWxpemUgaW5zdGFuY2Ugb24KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0CiAgICovCgogIGZhYnJpYy5TdGF0aWNDYW52YXMgPSBmdW5jdGlvbiAoZWwsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CgogICAgdGhpcy5faW5pdFN0YXRpYyhlbCwgb3B0aW9ucyk7CgogICAgZmFicmljLlN0YXRpY0NhbnZhcy5hY3RpdmVJbnN0YW5jZSA9IHRoaXM7CiAgfTsKCiAgZXh0ZW5kKGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLCBmYWJyaWMuT2JzZXJ2YWJsZSk7CiAgZXh0ZW5kKGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLAogIC8qKiBAc2NvcGUgZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEJhY2tncm91bmQgY29sb3Igb2YgY2FudmFzIGluc3RhbmNlCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDAsIDAsIDAsIDApJywKCiAgICAvKioKICAgICAqIEJhY2tncm91bmQgaW1hZ2Ugb2YgY2FudmFzIGluc3RhbmNlCiAgICAgKiBTaG91bGQgYmUgc2V0IHZpYSBgc2V0QmFja2dyb3VuZEltYWdlYAogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgYmFja2dyb3VuZEltYWdlOiAnJywKCiAgICAvKioKICAgICAqIE9wYWNpdHkgb2YgdGhlIGJhY2tncm91bmQgaW1hZ2Ugb2YgdGhlIGNhbnZhcyBpbnN0YW5jZQogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBGbG9hdAogICAgICovCiAgICBiYWNrZ3JvdW5kSW1hZ2VPcGFjaXR5OiAxLjAsCgogICAgLyoqCiAgICAgKiBJbmRpY2F0dXMgd2hldGhlciB0aGUgYmFja2dyb3VuZCBpbWFnZSBzaG91bGQgYmUgc3RyZXRjaGVkIHRvIGZpdCB0aGUKICAgICAqIGRpbWVuc2lvbnMgb2YgdGhlIGNhbnZhcyBpbnN0YW5jZS4KICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBiYWNrZ3JvdW5kSW1hZ2VTdHJldGNoOiB0cnVlLAoKICAgIC8qKgogICAgICogSW5kaWNhdGVzIHdoZXRoZXIgdG9PYmplY3QvdG9EYXRhbGVzc09iamVjdCBzaG91bGQgaW5jbHVkZSBkZWZhdWx0IHZhbHVlcwogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIGluY2x1ZGVEZWZhdWx0VmFsdWVzOiB0cnVlLAoKICAgIC8qKgogICAgICogSW5kaWNhdGVzIHdoZXRoZXIgb2JqZWN0cycgc3RhdGUgc2hvdWxkIGJlIHNhdmVkCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgc3RhdGVmdWw6IHRydWUsCgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciBmYWJyaWMuQ2FudmFzI2FkZCBzaG91bGQgYWxzbyByZS1yZW5kZXIgY2FudmFzLgogICAgICogRGlzYWJsaW5nIHRoaXMgb3B0aW9uIGNvdWxkIGdpdmUgYSBncmVhdCBwZXJmb3JtYW5jZSBib29zdCB3aGVuIGFkZGluZyBhIGxvdCBvZiBvYmplY3RzIHRvIGNhbnZhcyBhdCBvbmNlCiAgICAgKiAoZm9sbG93ZWQgYnkgYSBtYW51YWwgcmVuZGVyaW5nIGFmdGVyIGFkZGl0aW9uKQogICAgICovCiAgICByZW5kZXJPbkFkZGl0aW9uOiB0cnVlLAoKICAgIC8qKgogICAgICogRnVuY3Rpb24gdGhhdCBkZXRlcm1pbmVzIGNsaXBwaW5nIG9mIGVudGlyZSBjYW52YXMgYXJlYQogICAgICogQmVpbmcgcGFzc2VkIGNvbnRleHQgYXMgZmlyc3QgYXJndW1lbnQuIFNlZSBjbGlwcGluZyBjYW52YXMgYXJlYSBpbiBodHRwczovL2dpdGh1Yi5jb20va2FuZ2F4L2ZhYnJpYy5qcy93aWtpL0ZBUQogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBGdW5jdGlvbgogICAgICovCiAgICBjbGlwVG86IG51bGwsCgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciBvYmplY3QgY29udHJvbHMgKGJvcmRlcnMvY29ybmVycykgYXJlIHJlbmRlcmVkIGFib3ZlIG92ZXJsYXkgaW1hZ2UKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBjb250cm9sc0Fib3ZlT3ZlcmxheTogZmFsc2UsCgogICAgLyoqCiAgICAgKiBDYWxsYmFjazsgaW52b2tlZCByaWdodCBiZWZvcmUgb2JqZWN0IGlzIGFib3V0IHRvIGJlIHNjYWxlZC9yb3RhdGVkCiAgICAgKiBAbWV0aG9kIG9uQmVmb3JlU2NhbGVSb3RhdGUKICAgICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gdGFyZ2V0IE9iamVjdCB0aGF0J3MgYWJvdXQgdG8gYmUgc2NhbGVkL3JvdGF0ZWQKICAgICAqLwogICAgb25CZWZvcmVTY2FsZVJvdGF0ZTogZnVuY3Rpb24gb25CZWZvcmVTY2FsZVJvdGF0ZSh0YXJnZXQpIHsKICAgICAgLyogTk9PUCAqLwogICAgfSwKCiAgICAvKioKICAgICAqIENhbGxiYWNrOyBpbnZva2VkIG9uIGV2ZXJ5IHJlZHJhdyBvZiBjYW52YXMgYW5kIGlzIGJlaW5nIHBhc3NlZCBhIG51bWJlciBpbmRpY2F0aW5nIGN1cnJlbnQgZnBzCiAgICAgKiBAbWV0aG9kIG9uRnBzVXBkYXRlCiAgICAgKiBAcGFyYW0ge051bWJlcn0gZnBzCiAgICAgKi8KICAgIG9uRnBzVXBkYXRlOiBudWxsLAogICAgX2luaXRTdGF0aWM6IGZ1bmN0aW9uIF9pbml0U3RhdGljKGVsLCBvcHRpb25zKSB7CiAgICAgIHRoaXMuX29iamVjdHMgPSBbXTsKCiAgICAgIHRoaXMuX2NyZWF0ZUxvd2VyQ2FudmFzKGVsKTsKCiAgICAgIHRoaXMuX2luaXRPcHRpb25zKG9wdGlvbnMpOwoKICAgICAgaWYgKG9wdGlvbnMub3ZlcmxheUltYWdlKSB7CiAgICAgICAgdGhpcy5zZXRPdmVybGF5SW1hZ2Uob3B0aW9ucy5vdmVybGF5SW1hZ2UsIHRoaXMucmVuZGVyQWxsLmJpbmQodGhpcykpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2UpIHsKICAgICAgICB0aGlzLnNldEJhY2tncm91bmRJbWFnZShvcHRpb25zLmJhY2tncm91bmRJbWFnZSwgdGhpcy5yZW5kZXJBbGwuYmluZCh0aGlzKSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsY09mZnNldCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgY2FudmFzIGVsZW1lbnQgb2Zmc2V0IHJlbGF0aXZlIHRvIHRoZSBkb2N1bWVudAogICAgICogVGhpcyBtZXRob2QgaXMgYWxzbyBhdHRhY2hlZCBhcyAicmVzaXplIiBldmVudCBoYW5kbGVyIG9mIHdpbmRvdwogICAgICogQG1ldGhvZCBjYWxjT2Zmc2V0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSBpbnN0YW5jZQogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBjYWxjT2Zmc2V0OiBmdW5jdGlvbiBjYWxjT2Zmc2V0KCkgewogICAgICB0aGlzLl9vZmZzZXQgPSBnZXRFbGVtZW50T2Zmc2V0KHRoaXMubG93ZXJDYW52YXNFbCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgb3ZlcmxheSBpbWFnZSBmb3IgdGhpcyBjYW52YXMKICAgICAqIEBtZXRob2Qgc2V0T3ZlcmxheUltYWdlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIHVybCBvZiBhbiBpbWFnZSB0byBzZXQgb3ZlcmxheSB0bwogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgY2FsbGJhY2sgdG8gaW52b2tlIHdoZW4gaW1hZ2UgaXMgbG9hZGVkIGFuZCBzZXQgYXMgYW4gb3ZlcmxheQogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZXRPdmVybGF5SW1hZ2U6IGZ1bmN0aW9uIHNldE92ZXJsYXlJbWFnZSh1cmwsIGNhbGxiYWNrKSB7CiAgICAgIC8vIFRPRE8gKGthbmdheCk6IHRlc3QgY2FsbGJhY2sKICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHVybCwgZnVuY3Rpb24gKGltZykgewogICAgICAgIHRoaXMub3ZlcmxheUltYWdlID0gaW1nOwogICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICAgIH0sIHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIGJhY2tncm91bmQgaW1hZ2UgZm9yIHRoaXMgY2FudmFzCiAgICAgKiBAbWV0aG9kIHNldEJhY2tncm91bmRJbWFnZQogICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCB1cmwgb2YgYW4gaW1hZ2UgdG8gc2V0IGJhY2tncm91bmQgdG8KICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIGNhbGxiYWNrIHRvIGludm9rZSB3aGVuIGltYWdlIGlzIGxvYWRlZCBhbmQgc2V0IGFzIGJhY2tncm91bmQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIG9wdGlvbmFsIG9wdGlvbnMgdG8gc2V0IGZvciB0aGUgYmFja2dyb3VuZCBpbWFnZQogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIHNldEJhY2tncm91bmRJbWFnZSh1cmwsIGNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiBmYWJyaWMudXRpbC5sb2FkSW1hZ2UodXJsLCBmdW5jdGlvbiAoaW1nKSB7CiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBpbWc7CgogICAgICAgIGlmIChvcHRpb25zICYmICdiYWNrZ3JvdW5kSW1hZ2VPcGFjaXR5JyBpbiBvcHRpb25zKSB7CiAgICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZU9wYWNpdHkgPSBvcHRpb25zLmJhY2tncm91bmRJbWFnZU9wYWNpdHk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucyAmJiAnYmFja2dyb3VuZEltYWdlU3RyZXRjaCcgaW4gb3B0aW9ucykgewogICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2VTdHJldGNoID0gb3B0aW9ucy5iYWNrZ3JvdW5kSW1hZ2VTdHJldGNoOwogICAgICAgIH0KCiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsKICAgICAgfSwgdGhpcyk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2NyZWF0ZUNhbnZhc0VsZW1lbnQKICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudAogICAgICovCiAgICBfY3JlYXRlQ2FudmFzRWxlbWVudDogZnVuY3Rpb24gX2NyZWF0ZUNhbnZhc0VsZW1lbnQoKSB7CiAgICAgIHZhciBlbGVtZW50ID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwoKICAgICAgaWYgKCFlbGVtZW50LnN0eWxlKSB7CiAgICAgICAgZWxlbWVudC5zdHlsZSA9IHt9OwogICAgICB9CgogICAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgICB0aHJvdyBDQU5WQVNfSU5JVF9FUlJPUjsKICAgICAgfQoKICAgICAgdGhpcy5faW5pdENhbnZhc0VsZW1lbnQoZWxlbWVudCk7CgogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0sCiAgICBfaW5pdENhbnZhc0VsZW1lbnQ6IGZ1bmN0aW9uIF9pbml0Q2FudmFzRWxlbWVudChlbGVtZW50KSB7CiAgICAgIGlmICh0eXBlb2YgZWxlbWVudC5nZXRDb250ZXh0ID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgR192bWxDYW52YXNNYW5hZ2VyICE9PSAndW5kZWZpbmVkJyAmJiBHX3ZtbENhbnZhc01hbmFnZXIuaW5pdEVsZW1lbnQpIHsKICAgICAgICBHX3ZtbENhbnZhc01hbmFnZXIuaW5pdEVsZW1lbnQoZWxlbWVudCk7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgZWxlbWVudC5nZXRDb250ZXh0ID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHRocm93IENBTlZBU19JTklUX0VSUk9SOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBfaW5pdE9wdGlvbnMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICAgKi8KICAgIF9pbml0T3B0aW9uczogZnVuY3Rpb24gX2luaXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgZm9yICh2YXIgcHJvcCBpbiBvcHRpb25zKSB7CiAgICAgICAgdGhpc1twcm9wXSA9IG9wdGlvbnNbcHJvcF07CiAgICAgIH0KCiAgICAgIHRoaXMud2lkdGggPSBwYXJzZUludCh0aGlzLmxvd2VyQ2FudmFzRWwud2lkdGgsIDEwKSB8fCAwOwogICAgICB0aGlzLmhlaWdodCA9IHBhcnNlSW50KHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQsIDEwKSB8fCAwOwogICAgICBpZiAoIXRoaXMubG93ZXJDYW52YXNFbC5zdHlsZSkgcmV0dXJuOwogICAgICB0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGUud2lkdGggPSB0aGlzLndpZHRoICsgJ3B4JzsKICAgICAgdGhpcy5sb3dlckNhbnZhc0VsLnN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4JzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgc2Vjb25kYXJ5IGNhbnZhcwogICAgICogQG1ldGhvZCBfY3JlYXRlTG93ZXJDYW52YXMKICAgICAqLwogICAgX2NyZWF0ZUxvd2VyQ2FudmFzOiBmdW5jdGlvbiBfY3JlYXRlTG93ZXJDYW52YXMoY2FudmFzRWwpIHsKICAgICAgdGhpcy5sb3dlckNhbnZhc0VsID0gZmFicmljLnV0aWwuZ2V0QnlJZChjYW52YXNFbCkgfHwgdGhpcy5fY3JlYXRlQ2FudmFzRWxlbWVudCgpOwoKICAgICAgdGhpcy5faW5pdENhbnZhc0VsZW1lbnQodGhpcy5sb3dlckNhbnZhc0VsKTsKCiAgICAgIGZhYnJpYy51dGlsLmFkZENsYXNzKHRoaXMubG93ZXJDYW52YXNFbCwgJ2xvd2VyLWNhbnZhcycpOwoKICAgICAgaWYgKHRoaXMuaW50ZXJhY3RpdmUpIHsKICAgICAgICB0aGlzLl9hcHBseUNhbnZhc1N0eWxlKHRoaXMubG93ZXJDYW52YXNFbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY29udGV4dENvbnRhaW5lciA9IHRoaXMubG93ZXJDYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgY2FudmFzIHdpZHRoCiAgICAgKiBAbWV0aG9kIGdldFdpZHRoCiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9CiAgICAgKi8KICAgIGdldFdpZHRoOiBmdW5jdGlvbiBnZXRXaWR0aCgpIHsKICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjYW52YXMgaGVpZ2h0CiAgICAgKiBAbWV0aG9kIGdldEhlaWdodAogICAgICogQHJldHVybiB7TnVtYmVyfQogICAgICovCiAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uIGdldEhlaWdodCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0OwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgd2lkdGggb2YgdGhpcyBjYW52YXMgaW5zdGFuY2UKICAgICAqIEBtZXRob2Qgc2V0V2lkdGgKICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCB2YWx1ZSB0byBzZXQgd2lkdGggdG8KICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IGluc3RhbmNlCiAgICAgKiBAY2hhaW5hYmxlIHRydWUKICAgICAqLwogICAgc2V0V2lkdGg6IGZ1bmN0aW9uIHNldFdpZHRoKHZhbHVlKSB7CiAgICAgIHJldHVybiB0aGlzLl9zZXREaW1lbnNpb24oJ3dpZHRoJywgdmFsdWUpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgaGVpZ2h0IG9mIHRoaXMgY2FudmFzIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHNldEhlaWdodAogICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCB2YWx1ZSB0byBzZXQgaGVpZ2h0IHRvCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSBpbnN0YW5jZQogICAgICogQGNoYWluYWJsZSB0cnVlCiAgICAgKi8KICAgIHNldEhlaWdodDogZnVuY3Rpb24gc2V0SGVpZ2h0KHZhbHVlKSB7CiAgICAgIHJldHVybiB0aGlzLl9zZXREaW1lbnNpb24oJ2hlaWdodCcsIHZhbHVlKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIGRpbWVuc2lvbnMgKHdpZHRoLCBoZWlnaHQpIG9mIHRoaXMgY2FudmFzIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHNldERpbWVuc2lvbnMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkaW1lbnNpb25zCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNldERpbWVuc2lvbnM6IGZ1bmN0aW9uIHNldERpbWVuc2lvbnMoZGltZW5zaW9ucykgewogICAgICBmb3IgKHZhciBwcm9wIGluIGRpbWVuc2lvbnMpIHsKICAgICAgICB0aGlzLl9zZXREaW1lbnNpb24ocHJvcCwgZGltZW5zaW9uc1twcm9wXSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIEhlbHBlciBmb3Igc2V0dGluZyB3aWR0aC9oZWlnaHQKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9zZXREaW1lbnNpb25zCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBwcm9wZXJ0eSAod2lkdGh8aGVpZ2h0KQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIHZhbHVlIHRvIHNldCBwcm9wZXJ0eSB0bwogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gaW5zdGFuY2UKICAgICAqIEBjaGFpbmFibGUgdHJ1ZQogICAgICovCiAgICBfc2V0RGltZW5zaW9uOiBmdW5jdGlvbiBfc2V0RGltZW5zaW9uKHByb3AsIHZhbHVlKSB7CiAgICAgIHRoaXMubG93ZXJDYW52YXNFbFtwcm9wXSA9IHZhbHVlOwogICAgICB0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGVbcHJvcF0gPSB2YWx1ZSArICdweCc7CgogICAgICBpZiAodGhpcy51cHBlckNhbnZhc0VsKSB7CiAgICAgICAgdGhpcy51cHBlckNhbnZhc0VsW3Byb3BdID0gdmFsdWU7CiAgICAgICAgdGhpcy51cHBlckNhbnZhc0VsLnN0eWxlW3Byb3BdID0gdmFsdWUgKyAncHgnOwogICAgICB9CgogICAgICBpZiAodGhpcy53cmFwcGVyRWwpIHsKICAgICAgICB0aGlzLndyYXBwZXJFbC5zdHlsZVtwcm9wXSA9IHZhbHVlICsgJ3B4JzsKICAgICAgfQoKICAgICAgdGhpc1twcm9wXSA9IHZhbHVlOwogICAgICB0aGlzLmNhbGNPZmZzZXQoKTsKICAgICAgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyAmbHQ7Y2FudmFzPiBlbGVtZW50IGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBpbnN0YW5jZQogICAgICogQG1ldGhvZCBnZXRFbGVtZW50CiAgICAgKiBAcmV0dXJuIHtIVE1MQ2FudmFzRWxlbWVudH0KICAgICAqLwogICAgZ2V0RWxlbWVudDogZnVuY3Rpb24gZ2V0RWxlbWVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMubG93ZXJDYW52YXNFbDsKICAgIH0sCiAgICAvLyBwbGFjZWhvbGRlcgogICAgZ2V0QWN0aXZlT2JqZWN0OiBmdW5jdGlvbiBnZXRBY3RpdmVPYmplY3QoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKICAgIC8vIHBsYWNlaG9sZGVyCiAgICBnZXRBY3RpdmVHcm91cDogZnVuY3Rpb24gZ2V0QWN0aXZlR3JvdXAoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioKICAgICAqIEdpdmVuIGEgY29udGV4dCwgcmVuZGVycyBhbiBvYmplY3Qgb24gdGhhdCBjb250ZXh0CiAgICAgKiBAcGFyYW0gY3R4IHtPYmplY3R9IGNvbnRleHQgdG8gcmVuZGVyIG9iamVjdCBvbgogICAgICogQHBhcmFtIG9iamVjdCB7T2JqZWN0fSBvYmplY3QgdG8gcmVuZGVyCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBfZHJhdzogZnVuY3Rpb24gX2RyYXcoY3R4LCBvYmplY3QpIHsKICAgICAgaWYgKCFvYmplY3QpIHJldHVybjsKCiAgICAgIGlmICh0aGlzLmNvbnRyb2xzQWJvdmVPdmVybGF5KSB7CiAgICAgICAgdmFyIGhhc0JvcmRlcnMgPSBvYmplY3QuaGFzQm9yZGVycywKICAgICAgICAgICAgaGFzQ29ybmVycyA9IG9iamVjdC5oYXNDb3JuZXJzOwogICAgICAgIG9iamVjdC5oYXNCb3JkZXJzID0gb2JqZWN0Lmhhc0Nvcm5lcnMgPSBmYWxzZTsKICAgICAgICBvYmplY3QucmVuZGVyKGN0eCk7CiAgICAgICAgb2JqZWN0Lmhhc0JvcmRlcnMgPSBoYXNCb3JkZXJzOwogICAgICAgIG9iamVjdC5oYXNDb3JuZXJzID0gaGFzQ29ybmVyczsKICAgICAgfSBlbHNlIHsKICAgICAgICBvYmplY3QucmVuZGVyKGN0eCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBBZGRzIG9iamVjdHMgdG8gY2FudmFzLCB0aGVuIHJlbmRlcnMgY2FudmFzOwogICAgICogT2JqZWN0cyBzaG91bGQgYmUgaW5zdGFuY2VzIG9mIChvciBpbmhlcml0IGZyb20pIGZhYnJpYy5PYmplY3QKICAgICAqIEBtZXRob2QgYWRkCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGFkZDogZnVuY3Rpb24gYWRkKCkgewogICAgICB0aGlzLl9vYmplY3RzLnB1c2guYXBwbHkodGhpcy5fb2JqZWN0cywgYXJndW1lbnRzKTsKCiAgICAgIGZvciAodmFyIGkgPSBhcmd1bWVudHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgdGhpcy5faW5pdE9iamVjdChhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICB0aGlzLnJlbmRlck9uQWRkaXRpb24gJiYgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2luaXRPYmplY3QKICAgICAqLwogICAgX2luaXRPYmplY3Q6IGZ1bmN0aW9uIF9pbml0T2JqZWN0KG9iaikgewogICAgICB0aGlzLnN0YXRlZnVsICYmIG9iai5zZXR1cFN0YXRlKCk7CiAgICAgIG9iai5zZXRDb29yZHMoKTsKICAgICAgb2JqLmNhbnZhcyA9IHRoaXM7CiAgICAgIHRoaXMuZmlyZSgnb2JqZWN0OmFkZGVkJywgewogICAgICAgIHRhcmdldDogb2JqCiAgICAgIH0pOwogICAgICBvYmouZmlyZSgnYWRkZWQnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnRzIGFuIG9iamVjdCB0byBjYW52YXMgYXQgc3BlY2lmaWVkIGluZGV4IGFuZCByZW5kZXJzIGNhbnZhcy4KICAgICAqIEFuIG9iamVjdCBzaG91bGQgYmUgYW4gaW5zdGFuY2Ugb2YgKG9yIGluaGVyaXQgZnJvbSkgZmFicmljLk9iamVjdAogICAgICogQG1ldGhvZCBpbnNlcnRBdAogICAgICogQHBhcmFtIG9iamVjdCB7T2JqZWN0fSBPYmplY3QgdG8gaW5zZXJ0CiAgICAgKiBAcGFyYW0gaW5kZXgge051bWJlcn0gaW5kZXggdG8gaW5zZXJ0IG9iamVjdCBhdAogICAgICogQHBhcmFtIG5vblNwbGljaW5nIHtCb29sZWFufSB3aGVuIGB0cnVlYCwgbm8gc3BsaWNpbmcgKHNoaWZ0aW5nKSBvZiBvYmplY3RzIG9jY3VycwogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gaW5zdGFuY2UKICAgICAqLwogICAgaW5zZXJ0QXQ6IGZ1bmN0aW9uIGluc2VydEF0KG9iamVjdCwgaW5kZXgsIG5vblNwbGljaW5nKSB7CiAgICAgIGlmIChub25TcGxpY2luZykgewogICAgICAgIHRoaXMuX29iamVjdHNbaW5kZXhdID0gb2JqZWN0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX29iamVjdHMuc3BsaWNlKGluZGV4LCAwLCBvYmplY3QpOwogICAgICB9CgogICAgICB0aGlzLl9pbml0T2JqZWN0KG9iamVjdCk7CgogICAgICB0aGlzLnJlbmRlck9uQWRkaXRpb24gJiYgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBvYmplY3RzIHRoaXMgaW5zdGFuY2UgaGFzCiAgICAgKiBAbWV0aG9kIGdldE9iamVjdHMKICAgICAqIEByZXR1cm4ge0FycmF5fQogICAgICovCiAgICBnZXRPYmplY3RzOiBmdW5jdGlvbiBnZXRPYmplY3RzKCkgewogICAgICByZXR1cm4gdGhpcy5fb2JqZWN0czsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDbGVhcnMgc3BlY2lmaWVkIGNvbnRleHQgb2YgY2FudmFzIGVsZW1lbnQKICAgICAqIEBtZXRob2QgY2xlYXJDb250ZXh0CiAgICAgKiBAcGFyYW0gY29udGV4dCB7T2JqZWN0fSBjdHggY29udGV4dCB0byBjbGVhcgogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBjbGVhckNvbnRleHQ6IGZ1bmN0aW9uIGNsZWFyQ29udGV4dChjdHgpIHsKICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgY29udGV4dCBvZiBjYW52YXMgd2hlcmUgb2JqZWN0cyBhcmUgZHJhd24KICAgICAqIEBtZXRob2QgZ2V0Q29udGV4dAogICAgICogQHJldHVybiB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfQogICAgICovCiAgICBnZXRDb250ZXh0OiBmdW5jdGlvbiBnZXRDb250ZXh0KCkgewogICAgICByZXR1cm4gdGhpcy5jb250ZXh0Q29udGFpbmVyOwogICAgfSwKCiAgICAvKioKICAgICAqIENsZWFycyBhbGwgY29udGV4dHMgKGJhY2tncm91bmQsIG1haW4sIHRvcCkgb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgY2xlYXIKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICB0aGlzLl9vYmplY3RzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuY2xlYXJDb250ZXh0KHRoaXMuY29udGV4dENvbnRhaW5lcik7CgogICAgICBpZiAodGhpcy5jb250ZXh0VG9wKSB7CiAgICAgICAgdGhpcy5jbGVhckNvbnRleHQodGhpcy5jb250ZXh0VG9wKTsKICAgICAgfQoKICAgICAgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVuZGVycyBib3RoIHRoZSB0b3AgY2FudmFzIGFuZCB0aGUgc2Vjb25kYXJ5IGNvbnRhaW5lciBjYW52YXMuCiAgICAgKiBAbWV0aG9kIHJlbmRlckFsbAogICAgICogQHBhcmFtIGFsbE9uVG9wIHtCb29sZWFufSBvcHRpb25hbCBXaGV0aGVyIHdlIHdhbnQgdG8gZm9yY2UgYWxsIGltYWdlcyB0byBiZSByZW5kZXJlZCBvbiB0aGUgdG9wIGNhbnZhcwogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gaW5zdGFuY2UKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgcmVuZGVyQWxsOiBmdW5jdGlvbiByZW5kZXJBbGwoYWxsT25Ub3ApIHsKICAgICAgdmFyIGNhbnZhc1RvRHJhd09uID0gdGhpc1thbGxPblRvcCA9PT0gdHJ1ZSAmJiB0aGlzLmludGVyYWN0aXZlID8gJ2NvbnRleHRUb3AnIDogJ2NvbnRleHRDb250YWluZXInXTsKCiAgICAgIGlmICh0aGlzLmNvbnRleHRUb3ApIHsKICAgICAgICB0aGlzLmNsZWFyQ29udGV4dCh0aGlzLmNvbnRleHRUb3ApOwogICAgICB9CgogICAgICBpZiAoYWxsT25Ub3AgPT09IGZhbHNlIHx8IHR5cGVvZiBhbGxPblRvcCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICB0aGlzLmNsZWFyQ29udGV4dChjYW52YXNUb0RyYXdPbik7CiAgICAgIH0KCiAgICAgIHZhciBsZW5ndGggPSB0aGlzLl9vYmplY3RzLmxlbmd0aCwKICAgICAgICAgIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLAogICAgICAgICAgc3RhcnRUaW1lID0gbmV3IERhdGUoKTsKCiAgICAgIGlmICh0aGlzLmNsaXBUbykgewogICAgICAgIGNhbnZhc1RvRHJhd09uLnNhdmUoKTsKICAgICAgICBjYW52YXNUb0RyYXdPbi5iZWdpblBhdGgoKTsKICAgICAgICB0aGlzLmNsaXBUbyhjYW52YXNUb0RyYXdPbik7CiAgICAgICAgY2FudmFzVG9EcmF3T24uY2xpcCgpOwogICAgICB9CgogICAgICBjYW52YXNUb0RyYXdPbi5maWxsU3R5bGUgPSB0aGlzLmJhY2tncm91bmRDb2xvcjsKICAgICAgY2FudmFzVG9EcmF3T24uZmlsbFJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOwoKICAgICAgaWYgKF90eXBlb2YodGhpcy5iYWNrZ3JvdW5kSW1hZ2UpID09ICdvYmplY3QnKSB7CiAgICAgICAgY2FudmFzVG9EcmF3T24uc2F2ZSgpOwogICAgICAgIGNhbnZhc1RvRHJhd09uLmdsb2JhbEFscGhhID0gdGhpcy5iYWNrZ3JvdW5kSW1hZ2VPcGFjaXR5OwoKICAgICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kSW1hZ2VTdHJldGNoKSB7CiAgICAgICAgICBjYW52YXNUb0RyYXdPbi5kcmF3SW1hZ2UodGhpcy5iYWNrZ3JvdW5kSW1hZ2UsIDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FudmFzVG9EcmF3T24uZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIGNhbnZhc1RvRHJhd09uLnJlc3RvcmUoKTsKICAgICAgfQoKICAgICAgaWYgKGxlbmd0aCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmICghYWN0aXZlR3JvdXAgfHwgYWN0aXZlR3JvdXAgJiYgdGhpcy5fb2JqZWN0c1tpXSAmJiAhYWN0aXZlR3JvdXAuY29udGFpbnModGhpcy5fb2JqZWN0c1tpXSkpIHsKICAgICAgICAgICAgdGhpcy5fZHJhdyhjYW52YXNUb0RyYXdPbiwgdGhpcy5fb2JqZWN0c1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5jbGlwVG8pIHsKICAgICAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7CiAgICAgIH0gLy8gZGVsZWdhdGUgcmVuZGVyaW5nIHRvIGdyb3VwIHNlbGVjdGlvbiAoaWYgb25lIGV4aXN0cykKCgogICAgICBpZiAoYWN0aXZlR3JvdXApIHsKICAgICAgICB0aGlzLl9kcmF3KHRoaXMuY29udGV4dFRvcCwgYWN0aXZlR3JvdXApOwogICAgICB9CgogICAgICBpZiAodGhpcy5vdmVybGF5SW1hZ2UpIHsKICAgICAgICB0aGlzLmNvbnRleHRDb250YWluZXIuZHJhd0ltYWdlKHRoaXMub3ZlcmxheUltYWdlLCAwLCAwKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuY29udHJvbHNBYm92ZU92ZXJsYXkpIHsKICAgICAgICB0aGlzLmRyYXdDb250cm9scyh0aGlzLmNvbnRleHRDb250YWluZXIpOwogICAgICB9CgogICAgICBpZiAodGhpcy5vbkZwc1VwZGF0ZSkgewogICAgICAgIHZhciBlbGFwc2VkVGltZSA9IG5ldyBEYXRlKCkgLSBzdGFydFRpbWU7CiAgICAgICAgdGhpcy5vbkZwc1VwZGF0ZSh+figxMDAwIC8gZWxhcHNlZFRpbWUpKTsKICAgICAgfQoKICAgICAgdGhpcy5maXJlKCdhZnRlcjpyZW5kZXInKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogTWV0aG9kIHRvIHJlbmRlciBvbmx5IHRoZSB0b3AgY2FudmFzLgogICAgICogQWxzbyB1c2VkIHRvIHJlbmRlciB0aGUgZ3JvdXAgc2VsZWN0aW9uIGJveC4KICAgICAqIEBtZXRob2QgcmVuZGVyVG9wCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHJlbmRlclRvcDogZnVuY3Rpb24gcmVuZGVyVG9wKCkgewogICAgICB0aGlzLmNsZWFyQ29udGV4dCh0aGlzLmNvbnRleHRUb3AgfHwgdGhpcy5jb250ZXh0Q29udGFpbmVyKTsKCiAgICAgIGlmICh0aGlzLm92ZXJsYXlJbWFnZSkgewogICAgICAgIHRoaXMuY29udGV4dENvbnRhaW5lci5kcmF3SW1hZ2UodGhpcy5vdmVybGF5SW1hZ2UsIDAsIDApOwogICAgICB9IC8vIHdlIHJlbmRlciB0aGUgdG9wIGNvbnRleHQgLSBsYXN0IG9iamVjdAoKCiAgICAgIGlmICh0aGlzLnNlbGVjdGlvbiAmJiB0aGlzLl9ncm91cFNlbGVjdG9yKSB7CiAgICAgICAgdGhpcy5fZHJhd1NlbGVjdGlvbigpOwogICAgICB9IC8vIGRlbGVnYXRlIHJlbmRlcmluZyB0byBncm91cCBzZWxlY3Rpb24gaWYgb25lIGV4aXN0cwogICAgICAvLyB1c2VkIGZvciBkcmF3aW5nIHNlbGVjdGlvbiBib3JkZXJzL2Nvcm5lcnMKCgogICAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCk7CgogICAgICBpZiAoYWN0aXZlR3JvdXApIHsKICAgICAgICBhY3RpdmVHcm91cC5yZW5kZXIodGhpcy5jb250ZXh0VG9wKTsKICAgICAgfQoKICAgICAgdGhpcy5maXJlKCdhZnRlcjpyZW5kZXInKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogRHJhd3Mgb2JqZWN0cycgY29udHJvbHMgKGJvcmRlcnMvY29ybmVycykKICAgICAqIEBtZXRob2QgZHJhd0NvbnRyb2xzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY3R4IGNvbnRleHQgdG8gcmVuZGVyIGNvbnRyb2xzIG9uCiAgICAgKi8KICAgIGRyYXdDb250cm9sczogZnVuY3Rpb24gZHJhd0NvbnRyb2xzKGN0eCkgewogICAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCk7CgogICAgICBpZiAoYWN0aXZlR3JvdXApIHsKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGZhYnJpYy5Hcm91cC5wcm90b3R5cGUudHJhbnNmb3JtLmNhbGwoYWN0aXZlR3JvdXAsIGN0eCk7CiAgICAgICAgYWN0aXZlR3JvdXAuZHJhd0JvcmRlcnMoY3R4KS5kcmF3Q29ybmVycyhjdHgpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgIGlmICghdGhpcy5fb2JqZWN0c1tpXS5hY3RpdmUpIGNvbnRpbnVlOwogICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgIGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRyYW5zZm9ybS5jYWxsKHRoaXMuX29iamVjdHNbaV0sIGN0eCk7CgogICAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS5kcmF3Qm9yZGVycyhjdHgpLmRyYXdDb3JuZXJzKGN0eCk7CgogICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBFeHBvcnRzIGNhbnZhcyBlbGVtZW50IHRvIGEgZGF0YXVybCBpbWFnZS4KICAgICAqIEBtZXRob2QgdG9EYXRhVVJMCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IHRoZSBmb3JtYXQgb2YgdGhlIG91dHB1dCBpbWFnZS4gRWl0aGVyICJqcGVnIiBvciAicG5nIi4KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBxdWFsaXR5IHF1YWxpdHkgbGV2ZWwgKDAuLjEpCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICAgKi8KICAgIHRvRGF0YVVSTDogZnVuY3Rpb24gdG9EYXRhVVJMKGZvcm1hdCwgcXVhbGl0eSkgewogICAgICB2YXIgY2FudmFzRWwgPSB0aGlzLnVwcGVyQ2FudmFzRWwgfHwgdGhpcy5sb3dlckNhbnZhc0VsOwogICAgICB0aGlzLnJlbmRlckFsbCh0cnVlKTsKICAgICAgdmFyIGRhdGEgPSBmYWJyaWMuU3RhdGljQ2FudmFzLnN1cHBvcnRzKCd0b0RhdGFVUkxXaXRoUXVhbGl0eScpID8gY2FudmFzRWwudG9EYXRhVVJMKCdpbWFnZS8nICsgZm9ybWF0LCBxdWFsaXR5KSA6IGNhbnZhc0VsLnRvRGF0YVVSTCgnaW1hZ2UvJyArIGZvcm1hdCk7CiAgICAgIHRoaXMucmVuZGVyQWxsKCk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfSwKCiAgICAvKioKICAgICAqIEV4cG9ydHMgY2FudmFzIGVsZW1lbnQgdG8gYSBkYXRhdXJsIGltYWdlIChhbGxvd2luZyB0byBjaGFuZ2UgaW1hZ2Ugc2l6ZSB2aWEgbXVsdGlwbGllcikuCiAgICAgKiBAbWV0aG9kIHRvRGF0YVVSTFdpdGhNdWx0aXBsaWVyCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9ybWF0IChwbmd8anBlZykKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBtdWx0aXBsaWVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0gcXVhbGl0eSAoMC4uMSkKICAgICAqIEByZXR1cm4ge1N0cmluZ30KICAgICAqLwogICAgdG9EYXRhVVJMV2l0aE11bHRpcGxpZXI6IGZ1bmN0aW9uIHRvRGF0YVVSTFdpdGhNdWx0aXBsaWVyKGZvcm1hdCwgbXVsdGlwbGllciwgcXVhbGl0eSkgewogICAgICB2YXIgb3JpZ1dpZHRoID0gdGhpcy5nZXRXaWR0aCgpLAogICAgICAgICAgb3JpZ0hlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KCksCiAgICAgICAgICBzY2FsZWRXaWR0aCA9IG9yaWdXaWR0aCAqIG11bHRpcGxpZXIsCiAgICAgICAgICBzY2FsZWRIZWlnaHQgPSBvcmlnSGVpZ2h0ICogbXVsdGlwbGllciwKICAgICAgICAgIGFjdGl2ZU9iamVjdCA9IHRoaXMuZ2V0QWN0aXZlT2JqZWN0KCksCiAgICAgICAgICBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKTsKICAgICAgdGhpcy5zZXRXaWR0aChzY2FsZWRXaWR0aCkuc2V0SGVpZ2h0KHNjYWxlZEhlaWdodCk7CiAgICAgIHRoaXMuY29udGV4dFRvcC5zY2FsZShtdWx0aXBsaWVyLCBtdWx0aXBsaWVyKTsKCiAgICAgIGlmIChhY3RpdmVHcm91cCkgewogICAgICAgIC8vIG5vdCByZW1vdmluZyBncm91cCBkdWUgdG8gY29tcGxpY2F0aW9ucyB3aXRoIHJlc3RvcmluZyBpdCB3aXRoIGNvcnJlY3Qgc3RhdGUgYWZ0ZXJ3b3JkcwogICAgICAgIHRoaXMuX3RlbXBSZW1vdmVCb3JkZXJzQ29ybmVyc0Zyb21Hcm91cChhY3RpdmVHcm91cCk7CiAgICAgIH0gZWxzZSBpZiAoYWN0aXZlT2JqZWN0KSB7CiAgICAgICAgdGhpcy5kZWFjdGl2YXRlQWxsKCk7CiAgICAgIH0gLy8gcmVzdG9yaW5nIHdpZHRoLCBoZWlnaHQgZm9yIGByZW5kZXJBbGxgIHRvIGRyYXcKICAgICAgLy8gYmFja2dyb3VuZCBwcm9wZXJseSAod2hpbGUgY29udGV4dCBpcyBzY2FsZWQpCgoKICAgICAgdGhpcy53aWR0aCA9IG9yaWdXaWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSBvcmlnSGVpZ2h0OwogICAgICB0aGlzLnJlbmRlckFsbCh0cnVlKTsKICAgICAgdmFyIGRhdGFVUkwgPSB0aGlzLnRvRGF0YVVSTChmb3JtYXQsIHF1YWxpdHkpOwogICAgICB0aGlzLmNvbnRleHRUb3Auc2NhbGUoMSAvIG11bHRpcGxpZXIsIDEgLyBtdWx0aXBsaWVyKTsKICAgICAgdGhpcy5zZXRXaWR0aChvcmlnV2lkdGgpLnNldEhlaWdodChvcmlnSGVpZ2h0KTsKCiAgICAgIGlmIChhY3RpdmVHcm91cCkgewogICAgICAgIHRoaXMuX3Jlc3RvcmVCb3JkZXJzQ29ybmVyc09uR3JvdXAoYWN0aXZlR3JvdXApOwogICAgICB9IGVsc2UgaWYgKGFjdGl2ZU9iamVjdCkgewogICAgICAgIHRoaXMuc2V0QWN0aXZlT2JqZWN0KGFjdGl2ZU9iamVjdCk7CiAgICAgIH0KCiAgICAgIHRoaXMucmVuZGVyQWxsKCk7CiAgICAgIHJldHVybiBkYXRhVVJMOwogICAgfSwKICAgIF90ZW1wUmVtb3ZlQm9yZGVyc0Nvcm5lcnNGcm9tR3JvdXA6IGZ1bmN0aW9uIF90ZW1wUmVtb3ZlQm9yZGVyc0Nvcm5lcnNGcm9tR3JvdXAoZ3JvdXApIHsKICAgICAgZ3JvdXAub3JpZ0hpZGVDb3JuZXJzID0gZ3JvdXAuaGlkZUNvcm5lcnM7CiAgICAgIGdyb3VwLm9yaWdCb3JkZXJDb2xvciA9IGdyb3VwLmJvcmRlckNvbG9yOwogICAgICBncm91cC5oaWRlQ29ybmVycyA9IHRydWU7CiAgICAgIGdyb3VwLmJvcmRlckNvbG9yID0gJ3JnYmEoMCwwLDAsMCknOwogICAgICBncm91cC5mb3JFYWNoT2JqZWN0KGZ1bmN0aW9uIChvKSB7CiAgICAgICAgby5vcmlnQm9yZGVyQ29sb3IgPSBvLmJvcmRlckNvbG9yOwogICAgICAgIG8uYm9yZGVyQ29sb3IgPSAncmdiYSgwLDAsMCwwKSc7CiAgICAgIH0pOwogICAgfSwKICAgIF9yZXN0b3JlQm9yZGVyc0Nvcm5lcnNPbkdyb3VwOiBmdW5jdGlvbiBfcmVzdG9yZUJvcmRlcnNDb3JuZXJzT25Hcm91cChncm91cCkgewogICAgICBncm91cC5oaWRlQ29ybmVycyA9IGdyb3VwLm9yaWdIaWRlQ29ybmVyczsKICAgICAgZ3JvdXAuYm9yZGVyQ29sb3IgPSBncm91cC5vcmlnQm9yZGVyQ29sb3I7CiAgICAgIGdyb3VwLmZvckVhY2hPYmplY3QoZnVuY3Rpb24gKG8pIHsKICAgICAgICBvLmJvcmRlckNvbG9yID0gby5vcmlnQm9yZGVyQ29sb3I7CiAgICAgICAgZGVsZXRlIG8ub3JpZ0JvcmRlckNvbG9yOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGNvb3JkaW5hdGVzIG9mIGEgY2VudGVyIG9mIGNhbnZhcy4KICAgICAqIFJldHVybmVkIHZhbHVlIGlzIGFuIG9iamVjdCB3aXRoIHRvcCBhbmQgbGVmdCBwcm9wZXJ0aWVzCiAgICAgKiBAbWV0aG9kIGdldENlbnRlcgogICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3Qgd2l0aCAidG9wIiBhbmQgImxlZnQiIG51bWJlciB2YWx1ZXMKICAgICAqLwogICAgZ2V0Q2VudGVyOiBmdW5jdGlvbiBnZXRDZW50ZXIoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdG9wOiB0aGlzLmdldEhlaWdodCgpIC8gMiwKICAgICAgICBsZWZ0OiB0aGlzLmdldFdpZHRoKCkgLyAyCiAgICAgIH07CiAgICB9LAoKICAgIC8qKgogICAgICogQ2VudGVycyBvYmplY3QgaG9yaXpvbnRhbGx5LgogICAgICogQG1ldGhvZCBjZW50ZXJPYmplY3RICiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5PYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY2VudGVyCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKi8KICAgIGNlbnRlck9iamVjdEg6IGZ1bmN0aW9uIGNlbnRlck9iamVjdEgob2JqZWN0KSB7CiAgICAgIG9iamVjdC5zZXQoJ2xlZnQnLCB0aGlzLmdldENlbnRlcigpLmxlZnQpOwogICAgICB0aGlzLnJlbmRlckFsbCgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDZW50ZXJzIG9iamVjdCB2ZXJ0aWNhbGx5LgogICAgICogQG1ldGhvZCBjZW50ZXJPYmplY3RICiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5PYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY2VudGVyCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGNlbnRlck9iamVjdFY6IGZ1bmN0aW9uIGNlbnRlck9iamVjdFYob2JqZWN0KSB7CiAgICAgIG9iamVjdC5zZXQoJ3RvcCcsIHRoaXMuZ2V0Q2VudGVyKCkudG9wKTsKICAgICAgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2VudGVycyBvYmplY3QgdmVydGljYWxseSBhbmQgaG9yaXpvbnRhbGx5LgogICAgICogQG1ldGhvZCBjZW50ZXJPYmplY3QKICAgICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjZW50ZXIKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgY2VudGVyT2JqZWN0OiBmdW5jdGlvbiBjZW50ZXJPYmplY3Qob2JqZWN0KSB7CiAgICAgIHJldHVybiB0aGlzLmNlbnRlck9iamVjdEgob2JqZWN0KS5jZW50ZXJPYmplY3RWKG9iamVjdCk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJzIGRhdGFsZXNzIEpTT04gcmVwcmVzZW50YXRpb24gb2YgY2FudmFzCiAgICAgKiBAbWV0aG9kIHRvRGF0YWxlc3NKU09OCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGpzb24gc3RyaW5nCiAgICAgKi8KICAgIHRvRGF0YWxlc3NKU09OOiBmdW5jdGlvbiB0b0RhdGFsZXNzSlNPTigpIHsKICAgICAgcmV0dXJuIHRoaXMudG9EYXRhbGVzc09iamVjdCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGNhbnZhcwogICAgICogQG1ldGhvZCB0b09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCiAgICB0b09iamVjdDogZnVuY3Rpb24gdG9PYmplY3QoKSB7CiAgICAgIHJldHVybiB0aGlzLl90b09iamVjdE1ldGhvZCgndG9PYmplY3QnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGRhdGFsZXNzIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBjYW52YXMKICAgICAqIEBtZXRob2QgdG9EYXRhbGVzc09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCiAgICB0b0RhdGFsZXNzT2JqZWN0OiBmdW5jdGlvbiB0b0RhdGFsZXNzT2JqZWN0KCkgewogICAgICByZXR1cm4gdGhpcy5fdG9PYmplY3RNZXRob2QoJ3RvRGF0YWxlc3NPYmplY3QnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfdG9PYmplY3RNZXRob2QKICAgICAqLwogICAgX3RvT2JqZWN0TWV0aG9kOiBmdW5jdGlvbiBfdG9PYmplY3RNZXRob2QobWV0aG9kTmFtZSkgewogICAgICB2YXIgZGF0YSA9IHsKICAgICAgICBvYmplY3RzOiB0aGlzLl9vYmplY3RzLm1hcChmdW5jdGlvbiAoaW5zdGFuY2UpIHsKICAgICAgICAgIC8vIFRPRE8gKGthbmdheCk6IGZpZ3VyZSBvdXQgaG93IHRvIGNsZWFuIHRoaXMgdXAKICAgICAgICAgIGlmICghdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcykgewogICAgICAgICAgICB2YXIgb3JpZ2luYWxWYWx1ZSA9IGluc3RhbmNlLmluY2x1ZGVEZWZhdWx0VmFsdWVzOwogICAgICAgICAgICBpbnN0YW5jZS5pbmNsdWRlRGVmYXVsdFZhbHVlcyA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvYmplY3QgPSBpbnN0YW5jZVttZXRob2ROYW1lXSgpOwoKICAgICAgICAgIGlmICghdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcykgewogICAgICAgICAgICBpbnN0YW5jZS5pbmNsdWRlRGVmYXVsdFZhbHVlcyA9IG9yaWdpbmFsVmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICB9LCB0aGlzKSwKICAgICAgICBiYWNrZ3JvdW5kOiB0aGlzLmJhY2tncm91bmRDb2xvcgogICAgICB9OwoKICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZEltYWdlKSB7CiAgICAgICAgZGF0YS5iYWNrZ3JvdW5kSW1hZ2UgPSB0aGlzLmJhY2tncm91bmRJbWFnZS5zcmM7CiAgICAgICAgZGF0YS5iYWNrZ3JvdW5kSW1hZ2VPcGFjaXR5ID0gdGhpcy5iYWNrZ3JvdW5kSW1hZ2VPcGFjaXR5OwogICAgICAgIGRhdGEuYmFja2dyb3VuZEltYWdlU3RyZXRjaCA9IHRoaXMuYmFja2dyb3VuZEltYWdlU3RyZXRjaDsKICAgICAgfQoKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBTVkcgcmVwcmVzZW50YXRpb24gb2YgY2FudmFzCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBtZXRob2QgdG9TVkcKICAgICAqIEByZXR1cm4ge1N0cmluZ30KICAgICAqLwogICAgdG9TVkc6IGZ1bmN0aW9uIHRvU1ZHKCkgewogICAgICB2YXIgbWFya3VwID0gWyc8P3htbCB2ZXJzaW9uPSIxLjAiIHN0YW5kYWxvbmU9Im5vIiA/PicsICc8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIgJywgJyJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+JywgJzxzdmcgJywgJ3htbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgJywgJ3htbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiAnLCAndmVyc2lvbj0iMS4xIiAnLCAnd2lkdGg9IicsIHRoaXMud2lkdGgsICciICcsICdoZWlnaHQ9IicsIHRoaXMuaGVpZ2h0LCAnIiAnLCAneG1sOnNwYWNlPSJwcmVzZXJ2ZSI+JywgJzxkZXNjPkNyZWF0ZWQgd2l0aCBGYWJyaWMuanMgJywgZmFicmljLnZlcnNpb24sICc8L2Rlc2M+JywgZmFicmljLmNyZWF0ZVNWR0ZvbnRGYWNlc01hcmt1cCh0aGlzLmdldE9iamVjdHMoKSldOwoKICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZEltYWdlKSB7CiAgICAgICAgbWFya3VwLnB1c2goJzxpbWFnZSB4PSIwIiB5PSIwIiAnLCAnd2lkdGg9IicsIHRoaXMud2lkdGgsICciIGhlaWdodD0iJywgdGhpcy5oZWlnaHQsICciIHByZXNlcnZlQXNwZWN0UmF0aW89IicsIHRoaXMuYmFja2dyb3VuZEltYWdlU3RyZXRjaCA/ICdub25lJyA6ICdkZWZlcicsICciIHhsaW5rOmhyZWY9IicsIHRoaXMuYmFja2dyb3VuZEltYWdlLnNyYywgJyIgc3R5bGU9Im9wYWNpdHk6JywgdGhpcy5iYWNrZ3JvdW5kSW1hZ2VPcGFjaXR5LCAnIj48L2ltYWdlPicpOwogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwgb2JqZWN0cyA9IHRoaXMuZ2V0T2JqZWN0cygpLCBsZW4gPSBvYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgbWFya3VwLnB1c2gob2JqZWN0c1tpXS50b1NWRygpKTsKICAgICAgfQoKICAgICAgbWFya3VwLnB1c2goJzwvc3ZnPicpOwogICAgICByZXR1cm4gbWFya3VwLmpvaW4oJycpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBjYW52YXMgY29udGFpbnMgbm8gb2JqZWN0cwogICAgICogQG1ldGhvZCBpc0VtcHR5CiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIGNhbnZhcyBpcyBlbXB0eQogICAgICovCiAgICBpc0VtcHR5OiBmdW5jdGlvbiBpc0VtcHR5KCkgewogICAgICByZXR1cm4gdGhpcy5fb2JqZWN0cy5sZW5ndGggPT09IDA7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVtb3ZlcyBhbiBvYmplY3QgZnJvbSBjYW52YXMgYW5kIHJldHVybnMgaXQKICAgICAqIEBtZXRob2QgcmVtb3ZlCiAgICAgKiBAcGFyYW0gb2JqZWN0IHtPYmplY3R9IE9iamVjdCB0byByZW1vdmUKICAgICAqIEByZXR1cm4ge09iamVjdH0gcmVtb3ZlZCBvYmplY3QKICAgICAqLwogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUob2JqZWN0KSB7CiAgICAgIHJlbW92ZUZyb21BcnJheSh0aGlzLl9vYmplY3RzLCBvYmplY3QpOwoKICAgICAgaWYgKHRoaXMuZ2V0QWN0aXZlT2JqZWN0KCkgPT09IG9iamVjdCkgewogICAgICAgIC8vIHJlbW92aW5nIGFjdGl2ZSBvYmplY3Qgc2hvdWxkIGZpcmUgInNlbGVjdGlvbjpjbGVhcmVkIiBldmVudHMKICAgICAgICB0aGlzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsKICAgICAgICAgIHRhcmdldDogb2JqZWN0CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7CiAgICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2xlYXJlZCcpOwogICAgICB9CgogICAgICB0aGlzLnJlbmRlckFsbCgpOwogICAgICByZXR1cm4gb2JqZWN0OwogICAgfSwKCiAgICAvKioKICAgICAqIE1vdmVzIGFuIG9iamVjdCB0byB0aGUgYm90dG9tIG9mIHRoZSBzdGFjayBvZiBkcmF3biBvYmplY3RzCiAgICAgKiBAbWV0aG9kIHNlbmRUb0JhY2sKICAgICAqIEBwYXJhbSBvYmplY3Qge2ZhYnJpYy5PYmplY3R9IE9iamVjdCB0byBzZW5kIHRvIGJhY2sKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2VuZFRvQmFjazogZnVuY3Rpb24gc2VuZFRvQmFjayhvYmplY3QpIHsKICAgICAgcmVtb3ZlRnJvbUFycmF5KHRoaXMuX29iamVjdHMsIG9iamVjdCk7CgogICAgICB0aGlzLl9vYmplY3RzLnVuc2hpZnQob2JqZWN0KTsKCiAgICAgIHJldHVybiB0aGlzLnJlbmRlckFsbCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIE1vdmVzIGFuIG9iamVjdCB0byB0aGUgdG9wIG9mIHRoZSBzdGFjayBvZiBkcmF3biBvYmplY3RzCiAgICAgKiBAbWV0aG9kIGJyaW5nVG9Gcm9udAogICAgICogQHBhcmFtIG9iamVjdCB7ZmFicmljLk9iamVjdH0gT2JqZWN0IHRvIHNlbmQKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgYnJpbmdUb0Zyb250OiBmdW5jdGlvbiBicmluZ1RvRnJvbnQob2JqZWN0KSB7CiAgICAgIHJlbW92ZUZyb21BcnJheSh0aGlzLl9vYmplY3RzLCBvYmplY3QpOwoKICAgICAgdGhpcy5fb2JqZWN0cy5wdXNoKG9iamVjdCk7CgogICAgICByZXR1cm4gdGhpcy5yZW5kZXJBbGwoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBNb3ZlcyBhbiBvYmplY3Qgb25lIGxldmVsIGRvd24gaW4gc3RhY2sgb2YgZHJhd24gb2JqZWN0cwogICAgICogQG1ldGhvZCBzZW5kQmFja3dhcmRzCiAgICAgKiBAcGFyYW0gb2JqZWN0IHtmYWJyaWMuT2JqZWN0fSBPYmplY3QgdG8gc2VuZAogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZW5kQmFja3dhcmRzOiBmdW5jdGlvbiBzZW5kQmFja3dhcmRzKG9iamVjdCkgewogICAgICB2YXIgaWR4ID0gdGhpcy5fb2JqZWN0cy5pbmRleE9mKG9iamVjdCksCiAgICAgICAgICBuZXh0SW50ZXJzZWN0aW5nSWR4ID0gaWR4OyAvLyBpZiBvYmplY3QgaXMgbm90IG9uIHRoZSBib3R0b20gb2Ygc3RhY2sKCgogICAgICBpZiAoaWR4ICE9PSAwKSB7CiAgICAgICAgLy8gdHJhdmVyc2UgZG93biB0aGUgc3RhY2sgbG9va2luZyBmb3IgdGhlIG5lYXJlc3QgaW50ZXJzZWN0aW5nIG9iamVjdAogICAgICAgIGZvciAodmFyIGkgPSBpZHggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgaWYgKG9iamVjdC5pbnRlcnNlY3RzV2l0aE9iamVjdCh0aGlzLl9vYmplY3RzW2ldKSB8fCBvYmplY3QuaXNDb250YWluZWRXaXRoaW5PYmplY3QodGhpcy5fb2JqZWN0c1tpXSkpIHsKICAgICAgICAgICAgbmV4dEludGVyc2VjdGluZ0lkeCA9IGk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmVtb3ZlRnJvbUFycmF5KHRoaXMuX29iamVjdHMsIG9iamVjdCk7CgogICAgICAgIHRoaXMuX29iamVjdHMuc3BsaWNlKG5leHRJbnRlcnNlY3RpbmdJZHgsIDAsIG9iamVjdCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLnJlbmRlckFsbCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIE1vdmVzIGFuIG9iamVjdCBvbmUgbGV2ZWwgdXAgaW4gc3RhY2sgb2YgZHJhd24gb2JqZWN0cwogICAgICogQG1ldGhvZCBicmluZ0ZvcndhcmQKICAgICAqIEBwYXJhbSBvYmplY3Qge2ZhYnJpYy5PYmplY3R9IE9iamVjdCB0byBzZW5kCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGJyaW5nRm9yd2FyZDogZnVuY3Rpb24gYnJpbmdGb3J3YXJkKG9iamVjdCkgewogICAgICB2YXIgb2JqZWN0cyA9IHRoaXMuZ2V0T2JqZWN0cygpLAogICAgICAgICAgaWR4ID0gb2JqZWN0cy5pbmRleE9mKG9iamVjdCksCiAgICAgICAgICBuZXh0SW50ZXJzZWN0aW5nSWR4ID0gaWR4OyAvLyBpZiBvYmplY3QgaXMgbm90IG9uIHRvcCBvZiBzdGFjayAobGFzdCBpdGVtIGluIGFuIGFycmF5KQoKICAgICAgaWYgKGlkeCAhPT0gb2JqZWN0cy5sZW5ndGggLSAxKSB7CiAgICAgICAgLy8gdHJhdmVyc2UgdXAgdGhlIHN0YWNrIGxvb2tpbmcgZm9yIHRoZSBuZWFyZXN0IGludGVyc2VjdGluZyBvYmplY3QKICAgICAgICBmb3IgKHZhciBpID0gaWR4ICsgMSwgbCA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgICAgICBpZiAob2JqZWN0LmludGVyc2VjdHNXaXRoT2JqZWN0KG9iamVjdHNbaV0pIHx8IG9iamVjdC5pc0NvbnRhaW5lZFdpdGhpbk9iamVjdCh0aGlzLl9vYmplY3RzW2ldKSkgewogICAgICAgICAgICBuZXh0SW50ZXJzZWN0aW5nSWR4ID0gaTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZW1vdmVGcm9tQXJyYXkob2JqZWN0cywgb2JqZWN0KTsKICAgICAgICBvYmplY3RzLnNwbGljZShuZXh0SW50ZXJzZWN0aW5nSWR4LCAwLCBvYmplY3QpOwogICAgICB9CgogICAgICB0aGlzLnJlbmRlckFsbCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IGF0IHNwZWNpZmllZCBpbmRleAogICAgICogQG1ldGhvZCBpdGVtCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXgKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9CiAgICAgKi8KICAgIGl0ZW06IGZ1bmN0aW9uIGl0ZW0oaW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0cygpW2luZGV4XTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG51bWJlciByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZSBjb21wbGV4aXR5CiAgICAgKiBAbWV0aG9kIGNvbXBsZXhpdHkKICAgICAqIEByZXR1cm4ge051bWJlcn0gY29tcGxleGl0eQogICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gdGhpcy5nZXRPYmplY3RzKCkucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBjdXJyZW50KSB7CiAgICAgICAgbWVtbyArPSBjdXJyZW50LmNvbXBsZXhpdHkgPyBjdXJyZW50LmNvbXBsZXhpdHkoKSA6IDA7CiAgICAgICAgcmV0dXJuIG1lbW87CiAgICAgIH0sIDApOwogICAgfSwKCiAgICAvKioKICAgICAqIEl0ZXJhdGVzIG92ZXIgYWxsIG9iamVjdHMsIGludm9raW5nIGNhbGxiYWNrIGZvciBlYWNoIG9uZSBvZiB0aGVtCiAgICAgKiBAbWV0aG9kIGZvckVhY2hPYmplY3QKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgICAqLwogICAgZm9yRWFjaE9iamVjdDogZnVuY3Rpb24gZm9yRWFjaE9iamVjdChjYWxsYmFjaywgY29udGV4dCkgewogICAgICB2YXIgb2JqZWN0cyA9IHRoaXMuZ2V0T2JqZWN0cygpLAogICAgICAgICAgaSA9IG9iamVjdHMubGVuZ3RoOwoKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgb2JqZWN0c1tpXSwgaSwgb2JqZWN0cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIENsZWFycyBhIGNhbnZhcyBlbGVtZW50IGFuZCByZW1vdmVzIGFsbCBldmVudCBoYW5kbGVycy4KICAgICAqIEBtZXRob2QgZGlzcG9zZQogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICB0aGlzLmNsZWFyKCk7CgogICAgICBpZiAodGhpcy5pbnRlcmFjdGl2ZSkgewogICAgICAgIHJlbW92ZUxpc3RlbmVyKHRoaXMudXBwZXJDYW52YXNFbCwgJ21vdXNlZG93bicsIHRoaXMuX29uTW91c2VEb3duKTsKICAgICAgICByZW1vdmVMaXN0ZW5lcih0aGlzLnVwcGVyQ2FudmFzRWwsICdtb3VzZW1vdmUnLCB0aGlzLl9vbk1vdXNlTW92ZSk7CiAgICAgICAgcmVtb3ZlTGlzdGVuZXIoZmFicmljLndpbmRvdywgJ3Jlc2l6ZScsIHRoaXMuX29uUmVzaXplKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX3Jlc2l6ZUltYWdlVG9GaXQKICAgICAqIEBwYXJhbSB7SFRNTEltYWdlRWxlbWVudH0gaW1nRWwKICAgICAqLwogICAgX3Jlc2l6ZUltYWdlVG9GaXQ6IGZ1bmN0aW9uIF9yZXNpemVJbWFnZVRvRml0KGltZ0VsKSB7CiAgICAgIHZhciBpbWFnZVdpZHRoID0gaW1nRWwud2lkdGggfHwgaW1nRWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICB3aWR0aFNjYWxlRmFjdG9yID0gdGhpcy5nZXRXaWR0aCgpIC8gaW1hZ2VXaWR0aDsgLy8gc2NhbGUgaW1hZ2UgZG93biBzbyB0aGF0IGl0IGhhcyBvcmlnaW5hbCBkaW1lbnNpb25zIHdoZW4gcHJpbnRlZCBpbiBsYXJnZSByZXNvbHV0aW9uCgogICAgICBpZiAoaW1hZ2VXaWR0aCkgewogICAgICAgIGltZ0VsLndpZHRoID0gaW1hZ2VXaWR0aCAqIHdpZHRoU2NhbGVGYWN0b3I7CiAgICAgIH0KICAgIH0KICB9KTsKICAvKioKICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICogQG1ldGhvZCB0b1N0cmluZwogICAqIEByZXR1cm4ge1N0cmluZ30gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICovCgogIGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewogICAgLy8gQXNzaWduIGV4cGxpY2l0bHkgc2luY2UgYGV4dGVuZGAgZG9lc24ndCB0YWtlIGNhcmUgb2YgRG9udEVudW0gYnVnIHlldAogICAgcmV0dXJuICcjPGZhYnJpYy5DYW52YXMgKCcgKyB0aGlzLmNvbXBsZXhpdHkoKSArICcpOiAnICsgJ3sgb2JqZWN0czogJyArIHRoaXMuZ2V0T2JqZWN0cygpLmxlbmd0aCArICcgfT4nOwogIH07CgogIGV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLAogIC8qKiBAc2NvcGUgZmFicmljLlN0YXRpY0NhbnZhcyAqLwogIHsKICAgIC8qKgogICAgICogQHN0YXRpYwogICAgICogQHByb3BlcnR5IEVNUFRZX0pTT04KICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBFTVBUWV9KU09OOiAneyJvYmplY3RzIjogW10sICJiYWNrZ3JvdW5kIjogIndoaXRlIn0nLAoKICAgIC8qKgogICAgICogVGFrZXMgPGNhbnZhcz4gZWxlbWVudCBhbmQgdHJhbnNmb3JtcyBpdHMgZGF0YSBpbiBzdWNoIHdheSB0aGF0IGl0IGJlY29tZXMgZ3JheXNjYWxlCiAgICAgKiBAc3RhdGljCiAgICAgKiBAbWV0aG9kIHRvR3JheXNjYWxlCiAgICAgKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50fSBjYW52YXNFbAogICAgICovCiAgICB0b0dyYXlzY2FsZTogZnVuY3Rpb24gdG9HcmF5c2NhbGUoY2FudmFzRWwpIHsKICAgICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgICAgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzRWwud2lkdGgsIGNhbnZhc0VsLmhlaWdodCksCiAgICAgICAgICBkYXRhID0gaW1hZ2VEYXRhLmRhdGEsCiAgICAgICAgICBpTGVuID0gaW1hZ2VEYXRhLndpZHRoLAogICAgICAgICAgakxlbiA9IGltYWdlRGF0YS5oZWlnaHQsCiAgICAgICAgICBpbmRleCwKICAgICAgICAgIGF2ZXJhZ2UsCiAgICAgICAgICBpLAogICAgICAgICAgajsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBpTGVuOyBpKyspIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgakxlbjsgaisrKSB7CiAgICAgICAgICBpbmRleCA9IGkgKiA0ICogakxlbiArIGogKiA0OwogICAgICAgICAgYXZlcmFnZSA9IChkYXRhW2luZGV4XSArIGRhdGFbaW5kZXggKyAxXSArIGRhdGFbaW5kZXggKyAyXSkgLyAzOwogICAgICAgICAgZGF0YVtpbmRleF0gPSBhdmVyYWdlOwogICAgICAgICAgZGF0YVtpbmRleCArIDFdID0gYXZlcmFnZTsKICAgICAgICAgIGRhdGFbaW5kZXggKyAyXSA9IGF2ZXJhZ2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogICAgfSwKCiAgICAvKioKICAgICAqIFByb3ZpZGVzIGEgd2F5IHRvIGNoZWNrIHN1cHBvcnQgb2Ygc29tZSBvZiB0aGUgY2FudmFzIG1ldGhvZHMKICAgICAqIChlaXRoZXIgdGhvc2Ugb2YgSFRNTENhbnZhc0VsZW1lbnQgaXRzZWxmLCBvciByZW5kZXJpbmcgY29udGV4dCkKICAgICAqCiAgICAgKiBAbWV0aG9kIHN1cHBvcnRzCiAgICAgKiBAcGFyYW0gbWV0aG9kTmFtZSB7U3RyaW5nfSBNZXRob2QgdG8gY2hlY2sgc3VwcG9ydCBmb3I7CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3VsZCBiZSBvbmUgb2YgImdldEltYWdlRGF0YSIsICJ0b0RhdGFVUkwiIG9yICJ0b0RhdGFVUkxXaXRoUXVhbGl0eSIKICAgICAqIEByZXR1cm4ge0Jvb2xlYW4gfCBudWxsfSBgdHJ1ZWAgaWYgbWV0aG9kIGlzIHN1cHBvcnRlZCAob3IgYXQgbGVhc3QgZXhpc3RzKSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBgbnVsbGAgaWYgY2FudmFzIGVsZW1lbnQgb3IgY29udGV4dCBjYW4gbm90IGJlIGluaXRpYWxpemVkCiAgICAgKi8KICAgIHN1cHBvcnRzOiBmdW5jdGlvbiBzdXBwb3J0cyhtZXRob2ROYW1lKSB7CiAgICAgIHZhciBlbCA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKCiAgICAgIGlmICh0eXBlb2YgR192bWxDYW52YXNNYW5hZ2VyICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIEdfdm1sQ2FudmFzTWFuYWdlci5pbml0RWxlbWVudChlbCk7CiAgICAgIH0KCiAgICAgIGlmICghZWwgfHwgIWVsLmdldENvbnRleHQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGN0eCA9IGVsLmdldENvbnRleHQoJzJkJyk7CgogICAgICBpZiAoIWN0eCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBzd2l0Y2ggKG1ldGhvZE5hbWUpIHsKICAgICAgICBjYXNlICdnZXRJbWFnZURhdGEnOgogICAgICAgICAgcmV0dXJuIHR5cGVvZiBjdHguZ2V0SW1hZ2VEYXRhICE9PSAndW5kZWZpbmVkJzsKCiAgICAgICAgY2FzZSAndG9EYXRhVVJMJzoKICAgICAgICAgIHJldHVybiB0eXBlb2YgZWwudG9EYXRhVVJMICE9PSAndW5kZWZpbmVkJzsKCiAgICAgICAgY2FzZSAndG9EYXRhVVJMV2l0aFF1YWxpdHknOgogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZWwudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogIH0pOwogIC8qKgogICAqIFJldHVycyBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGNhbnZhcwogICAqIEBmdW5jdGlvbgogICAqIEBtZXRob2QgdG9KU09OCiAgICogQHJldHVybiB7U3RyaW5nfSBqc29uIHN0cmluZwogICAqLwoKICBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS50b0pTT04gPSBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS50b09iamVjdDsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKCkgewogIHZhciBleHRlbmQgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kLAogICAgICBfZ2V0UG9pbnRlciA9IGZhYnJpYy51dGlsLmdldFBvaW50ZXIsCiAgICAgIGFkZExpc3RlbmVyID0gZmFicmljLnV0aWwuYWRkTGlzdGVuZXIsCiAgICAgIHJlbW92ZUxpc3RlbmVyID0gZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIsCiAgICAgIGN1cnNvck1hcCA9IHsKICAgICd0cic6ICduZS1yZXNpemUnLAogICAgJ2JyJzogJ3NlLXJlc2l6ZScsCiAgICAnYmwnOiAnc3ctcmVzaXplJywKICAgICd0bCc6ICdudy1yZXNpemUnLAogICAgJ21sJzogJ3ctcmVzaXplJywKICAgICdtdCc6ICduLXJlc2l6ZScsCiAgICAnbXInOiAnZS1yZXNpemUnLAogICAgJ21iJzogJ3MtcmVzaXplJwogIH0sCiAgICAgIHV0aWxNaW4gPSBmYWJyaWMudXRpbC5hcnJheS5taW4sCiAgICAgIHV0aWxNYXggPSBmYWJyaWMudXRpbC5hcnJheS5tYXgsCiAgICAgIHNxcnQgPSBNYXRoLnNxcnQsCiAgICAgIHBvdyA9IE1hdGgucG93LAogICAgICBhdGFuMiA9IE1hdGguYXRhbjIsCiAgICAgIGFicyA9IE1hdGguYWJzLAogICAgICBtaW4gPSBNYXRoLm1pbiwKICAgICAgbWF4ID0gTWF0aC5tYXgsCiAgICAgIFNUUk9LRV9PRkZTRVQgPSAwLjU7CiAgLyoqCiAgICogQGNsYXNzIGZhYnJpYy5DYW52YXMKICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBmYWJyaWMuU3RhdGljQ2FudmFzCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudCB8IFN0cmluZ30gZWwgJmx0O2NhbnZhcz4gZWxlbWVudCB0byBpbml0aWFsaXplIGluc3RhbmNlIG9uCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqLwoKICBmYWJyaWMuQ2FudmFzID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgIHRoaXMuX2luaXRTdGF0aWMoZWwsIG9wdGlvbnMpOwoKICAgIHRoaXMuX2luaXRJbnRlcmFjdGl2ZSgpOwoKICAgIHRoaXMuX2NyZWF0ZUNhY2hlQ2FudmFzKCk7CgogICAgZmFicmljLkNhbnZhcy5hY3RpdmVJbnN0YW5jZSA9IHRoaXM7CiAgfTsKCiAgZnVuY3Rpb24gUHJvdG9Qcm94eSgpIHt9CgogIFByb3RvUHJveHkucHJvdG90eXBlID0gZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGU7CiAgZmFicmljLkNhbnZhcy5wcm90b3R5cGUgPSBuZXcgUHJvdG9Qcm94eSgpOwogIHZhciBJbnRlcmFjdGl2ZU1ldGhvZHMgPQogIC8qKiBAc2NvcGUgZmFicmljLkNhbnZhcy5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEluZGljYXRlcyB0aGF0IGNhbnZhcyBpcyBpbnRlcmFjdGl2ZS4gVGhpcyBwcm9wZXJ0eSBzaG91bGQgbm90IGJlIGNoYW5nZWQuCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgaW50ZXJhY3RpdmU6IHRydWUsCgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciBncm91cCBzZWxlY3Rpb24gc2hvdWxkIGJlIGVuYWJsZWQKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBzZWxlY3Rpb246IHRydWUsCgogICAgLyoqCiAgICAgKiBDb2xvciBvZiBzZWxlY3Rpb24KICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIHNlbGVjdGlvbkNvbG9yOiAncmdiYSgxMDAsIDEwMCwgMjU1LCAwLjMpJywKICAgIC8vIGJsdWUKCiAgICAvKioKICAgICAqIENvbG9yIG9mIHRoZSBib3JkZXIgb2Ygc2VsZWN0aW9uICh1c3VhbGx5IHNsaWdodGx5IGRhcmtlciB0aGFuIGNvbG9yIG9mIHNlbGVjdGlvbiBpdHNlbGYpCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBzZWxlY3Rpb25Cb3JkZXJDb2xvcjogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKScsCgogICAgLyoqCiAgICAgKiBXaWR0aCBvZiBhIGxpbmUgdXNlZCBpbiBvYmplY3QvZ3JvdXAgc2VsZWN0aW9uCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIE51bWJlcgogICAgICovCiAgICBzZWxlY3Rpb25MaW5lV2lkdGg6IDEsCgogICAgLyoqCiAgICAgKiBDb2xvciBvZiB0aGUgbGluZSB1c2VkIGluIGZyZWUgZHJhd2luZyBtb2RlCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBmcmVlRHJhd2luZ0NvbG9yOiAncmdiKDAsIDAsIDApJywKCiAgICAvKioKICAgICAqIFdpZHRoIG9mIGEgbGluZSB1c2VkIGluIGZyZWUgZHJhd2luZyBtb2RlCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIE51bWJlcgogICAgICovCiAgICBmcmVlRHJhd2luZ0xpbmVXaWR0aDogMSwKCiAgICAvKioKICAgICAqIERlZmF1bHQgY3Vyc29yIHZhbHVlIHVzZWQgd2hlbiBob3ZlcmluZyBvdmVyIGFuIG9iamVjdCBvbiBjYW52YXMKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIGhvdmVyQ3Vyc29yOiAnbW92ZScsCgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGN1cnNvciB2YWx1ZSB1c2VkIHdoZW4gbW92aW5nIGFuIG9iamVjdCBvbiBjYW52YXMKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIG1vdmVDdXJzb3I6ICdtb3ZlJywKCiAgICAvKioKICAgICAqIERlZmF1bHQgY3Vyc29yIHZhbHVlIHVzZWQgZm9yIHRoZSBlbnRpcmUgY2FudmFzCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBkZWZhdWx0Q3Vyc29yOiAnZGVmYXVsdCcsCgogICAgLyoqCiAgICAgKiBDdXJzb3IgdmFsdWUgdXNlZCBmb3Igcm90YXRpb24gcG9pbnQKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIHJvdGF0aW9uQ3Vyc29yOiAnY3Jvc3NoYWlyJywKCiAgICAvKioKICAgICAqIERlZmF1bHQgZWxlbWVudCBjbGFzcyB0aGF0J3MgZ2l2ZW4gdG8gd3JhcHBlciAoZGl2KSBlbGVtZW50IG9mIGNhbnZhcwogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgY29udGFpbmVyQ2xhc3M6ICdjYW52YXMtY29udGFpbmVyJywKICAgIHBlclBpeGVsVGFyZ2V0RmluZDogZmFsc2UsCiAgICB0YXJnZXRGaW5kVG9sZXJhbmNlOiAwLAogICAgX2luaXRJbnRlcmFjdGl2ZTogZnVuY3Rpb24gX2luaXRJbnRlcmFjdGl2ZSgpIHsKICAgICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybSA9IG51bGw7CiAgICAgIHRoaXMuX2dyb3VwU2VsZWN0b3IgPSBudWxsOwogICAgICB0aGlzLl9mcmVlRHJhd2luZ1hQb2ludHMgPSBbXTsKICAgICAgdGhpcy5fZnJlZURyYXdpbmdZUG9pbnRzID0gW107CgogICAgICB0aGlzLl9pbml0V3JhcHBlckVsZW1lbnQoKTsKCiAgICAgIHRoaXMuX2NyZWF0ZVVwcGVyQ2FudmFzKCk7CgogICAgICB0aGlzLl9pbml0RXZlbnRzKCk7CgogICAgICB0aGlzLmNhbGNPZmZzZXQoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBBZGRzIG1vdXNlIGxpc3RlbmVycyB0byAgY2FudmFzCiAgICAgKiBAbWV0aG9kIF9pbml0RXZlbnRzCiAgICAgKiBAcHJpdmF0ZQogICAgICogU2VlIGNvbmZpZ3VyYXRpb24gZG9jdW1lbnRhdGlvbiBmb3IgbW9yZSBkZXRhaWxzLgogICAgICovCiAgICBfaW5pdEV2ZW50czogZnVuY3Rpb24gX2luaXRFdmVudHMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB0aGlzLl9vbk1vdXNlRG93biA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgX3RoaXMuX19vbk1vdXNlRG93bihlKTsKCiAgICAgICAgYWRkTGlzdGVuZXIoZmFicmljLmRvY3VtZW50LCAnbW91c2V1cCcsIF90aGlzLl9vbk1vdXNlVXApOwogICAgICAgIGZhYnJpYy5pc1RvdWNoU3VwcG9ydGVkICYmIGFkZExpc3RlbmVyKGZhYnJpYy5kb2N1bWVudCwgJ3RvdWNoZW5kJywgX3RoaXMuX29uTW91c2VVcCk7CiAgICAgICAgYWRkTGlzdGVuZXIoZmFicmljLmRvY3VtZW50LCAnbW91c2Vtb3ZlJywgX3RoaXMuX29uTW91c2VNb3ZlKTsKICAgICAgICBmYWJyaWMuaXNUb3VjaFN1cHBvcnRlZCAmJiBhZGRMaXN0ZW5lcihmYWJyaWMuZG9jdW1lbnQsICd0b3VjaG1vdmUnLCBfdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICAgIHJlbW92ZUxpc3RlbmVyKF90aGlzLnVwcGVyQ2FudmFzRWwsICdtb3VzZW1vdmUnLCBfdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICAgIGZhYnJpYy5pc1RvdWNoU3VwcG9ydGVkICYmIHJlbW92ZUxpc3RlbmVyKF90aGlzLnVwcGVyQ2FudmFzRWwsICd0b3VjaG1vdmUnLCBfdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICB9OwoKICAgICAgdGhpcy5fb25Nb3VzZVVwID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpcy5fX29uTW91c2VVcChlKTsKCiAgICAgICAgcmVtb3ZlTGlzdGVuZXIoZmFicmljLmRvY3VtZW50LCAnbW91c2V1cCcsIF90aGlzLl9vbk1vdXNlVXApOwogICAgICAgIGZhYnJpYy5pc1RvdWNoU3VwcG9ydGVkICYmIHJlbW92ZUxpc3RlbmVyKGZhYnJpYy5kb2N1bWVudCwgJ3RvdWNoZW5kJywgX3RoaXMuX29uTW91c2VVcCk7CiAgICAgICAgcmVtb3ZlTGlzdGVuZXIoZmFicmljLmRvY3VtZW50LCAnbW91c2Vtb3ZlJywgX3RoaXMuX29uTW91c2VNb3ZlKTsKICAgICAgICBmYWJyaWMuaXNUb3VjaFN1cHBvcnRlZCAmJiByZW1vdmVMaXN0ZW5lcihmYWJyaWMuZG9jdW1lbnQsICd0b3VjaG1vdmUnLCBfdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICAgIGFkZExpc3RlbmVyKF90aGlzLnVwcGVyQ2FudmFzRWwsICdtb3VzZW1vdmUnLCBfdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICAgIGZhYnJpYy5pc1RvdWNoU3VwcG9ydGVkICYmIGFkZExpc3RlbmVyKF90aGlzLnVwcGVyQ2FudmFzRWwsICd0b3VjaG1vdmUnLCBfdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICB9OwoKICAgICAgdGhpcy5fb25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQgJiYgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICBfdGhpcy5fX29uTW91c2VNb3ZlKGUpOwogICAgICB9OwoKICAgICAgdGhpcy5fb25SZXNpemUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzLmNhbGNPZmZzZXQoKTsKICAgICAgfTsKCiAgICAgIGFkZExpc3RlbmVyKGZhYnJpYy53aW5kb3csICdyZXNpemUnLCB0aGlzLl9vblJlc2l6ZSk7CgogICAgICBpZiAoZmFicmljLmlzVG91Y2hTdXBwb3J0ZWQpIHsKICAgICAgICBhZGRMaXN0ZW5lcih0aGlzLnVwcGVyQ2FudmFzRWwsICd0b3VjaHN0YXJ0JywgdGhpcy5fb25Nb3VzZURvd24pOwogICAgICAgIGFkZExpc3RlbmVyKHRoaXMudXBwZXJDYW52YXNFbCwgJ3RvdWNobW92ZScsIHRoaXMuX29uTW91c2VNb3ZlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhZGRMaXN0ZW5lcih0aGlzLnVwcGVyQ2FudmFzRWwsICdtb3VzZWRvd24nLCB0aGlzLl9vbk1vdXNlRG93bik7CiAgICAgICAgYWRkTGlzdGVuZXIodGhpcy51cHBlckNhbnZhc0VsLCAnbW91c2Vtb3ZlJywgdGhpcy5fb25Nb3VzZU1vdmUpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgZGVmaW5lcyB0aGUgYWN0aW9ucyB3aGVuIG1vdXNlIGlzIHJlbGVhc2VkIG9uIGNhbnZhcy4KICAgICAqIFRoZSBtZXRob2QgcmVzZXRzIHRoZSBjdXJyZW50VHJhbnNmb3JtIHBhcmFtZXRlcnMsIHN0b3JlIHRoZSBpbWFnZSBjb3JuZXIKICAgICAqIHBvc2l0aW9uIGluIHRoZSBpbWFnZSBvYmplY3QgYW5kIHJlbmRlciB0aGUgY2FudmFzIG9uIHRvcC4KICAgICAqIEBtZXRob2QgX19vbk1vdXNlVXAKICAgICAqIEBwYXJhbSB7RXZlbnR9IGUgRXZlbnQgb2JqZWN0IGZpcmVkIG9uIG1vdXNldXAKICAgICAqCiAgICAgKi8KICAgIF9fb25Nb3VzZVVwOiBmdW5jdGlvbiBfX29uTW91c2VVcChlKSB7CiAgICAgIGlmICh0aGlzLmlzRHJhd2luZ01vZGUgJiYgdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nKSB7CiAgICAgICAgdGhpcy5fZmluYWxpemVEcmF3aW5nUGF0aCgpOwoKICAgICAgICB0aGlzLmZpcmUoJ21vdXNlOnVwJywgewogICAgICAgICAgZTogZQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0pIHsKICAgICAgICB2YXIgdHJhbnNmb3JtID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSwKICAgICAgICAgICAgdGFyZ2V0ID0gdHJhbnNmb3JtLnRhcmdldDsKCiAgICAgICAgaWYgKHRhcmdldC5fc2NhbGluZykgewogICAgICAgICAgdGFyZ2V0Ll9zY2FsaW5nID0gZmFsc2U7CiAgICAgICAgfSAvLyBkZXRlcm1pbmUgdGhlIG5ldyBjb29yZHMgZXZlcnl0aW1lIHRoZSBpbWFnZSBjaGFuZ2VzIGl0cyBwb3NpdGlvbgoKCiAgICAgICAgdmFyIGkgPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsKCiAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTsKICAgICAgICB9IC8vIG9ubHkgZmlyZSA6bW9kaWZpZWQgZXZlbnQgaWYgdGFyZ2V0IGNvb3JkaW5hdGVzIHdlcmUgY2hhbmdlZCBkdXJpbmcgbW91c2Vkb3duLW1vdXNldXAKCgogICAgICAgIGlmICh0aGlzLnN0YXRlZnVsICYmIHRhcmdldC5oYXNTdGF0ZUNoYW5nZWQoKSkgewogICAgICAgICAgdGFyZ2V0LmlzTW92aW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsKICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQKICAgICAgICAgIH0pOwogICAgICAgICAgdGFyZ2V0LmZpcmUoJ21vZGlmaWVkJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtID0gbnVsbDsKCiAgICAgIGlmICh0aGlzLl9ncm91cFNlbGVjdG9yKSB7CiAgICAgICAgLy8gZ3JvdXAgc2VsZWN0aW9uIHdhcyBjb21wbGV0ZWQsIGRldGVybWluZSBpdHMgYm91bmRzCiAgICAgICAgdGhpcy5fZmluZFNlbGVjdGVkT2JqZWN0cyhlKTsKICAgICAgfQoKICAgICAgdmFyIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpOwoKICAgICAgaWYgKGFjdGl2ZUdyb3VwKSB7CiAgICAgICAgYWN0aXZlR3JvdXAuc2V0T2JqZWN0c0Nvb3JkcygpOwogICAgICAgIGFjdGl2ZUdyb3VwLnNldCgnaXNNb3ZpbmcnLCBmYWxzZSk7CgogICAgICAgIHRoaXMuX3NldEN1cnNvcih0aGlzLmRlZmF1bHRDdXJzb3IpOwogICAgICB9IC8vIGNsZWFyIHNlbGVjdGlvbgoKCiAgICAgIHRoaXMuX2dyb3VwU2VsZWN0b3IgPSBudWxsOwogICAgICB0aGlzLnJlbmRlckFsbCgpOwoKICAgICAgdGhpcy5fc2V0Q3Vyc29yRnJvbUV2ZW50KGUsIHRhcmdldCk7IC8vIGZpeCBmb3IgRkYKCgogICAgICB0aGlzLl9zZXRDdXJzb3IoJycpOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLl9zZXRDdXJzb3JGcm9tRXZlbnQoZSwgdGFyZ2V0KTsKICAgICAgfSwgNTApOwogICAgICB0aGlzLmZpcmUoJ21vdXNlOnVwJywgewogICAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICAgIGU6IGUKICAgICAgfSk7CiAgICAgIHRhcmdldCAmJiB0YXJnZXQuZmlyZSgnbW91c2V1cCcsIHsKICAgICAgICBlOiBlCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGRlZmluZXMgdGhlIGFjdGlvbnMgd2hlbiBtb3VzZSBpcyBjbGljIGtlZCBvbiBjYW52YXMuCiAgICAgKiBUaGUgbWV0aG9kIGluaXRzIHRoZSBjdXJyZW50VHJhbnNmb3JtIHBhcmFtZXRlcnMgYW5kIHJlbmRlcnMgYWxsIHRoZQogICAgICogY2FudmFzIHNvIHRoZSBjdXJyZW50IGltYWdlIGNhbiBiZSBwbGFjZWQgb24gdGhlIHRvcCBjYW52YXMgYW5kIHRoZSByZXN0CiAgICAgKiBpbiBvbiB0aGUgY29udGFpbmVyIG9uZS4KICAgICAqIEBtZXRob2QgX19vbk1vdXNlRG93bgogICAgICogQHBhcmFtIGUge0V2ZW50fSBFdmVudCBvYmplY3QgZmlyZWQgb24gbW91c2Vkb3duCiAgICAgKgogICAgICovCiAgICBfX29uTW91c2VEb3duOiBmdW5jdGlvbiBfX29uTW91c2VEb3duKGUpIHsKICAgICAgLy8gYWNjZXB0IG9ubHkgbGVmdCBjbGlja3MKICAgICAgdmFyIGlzTGVmdENsaWNrID0gJ3doaWNoJyBpbiBlID8gZS53aGljaCA9PSAxIDogZS5idXR0b24gPT0gMTsKICAgICAgaWYgKCFpc0xlZnRDbGljayAmJiAhZmFicmljLmlzVG91Y2hTdXBwb3J0ZWQpIHJldHVybjsKCiAgICAgIGlmICh0aGlzLmlzRHJhd2luZ01vZGUpIHsKICAgICAgICB0aGlzLl9wcmVwYXJlRm9yRHJhd2luZyhlKTsgLy8gY2FwdHVyZSBjb29yZGluYXRlcyBpbW1lZGlhdGVseTsgdGhpcyBhbGxvd3MgdG8gZHJhdyBkb3RzICh3aGVuIG1vdmVtZW50IG5ldmVyIG9jY3VycykKCgogICAgICAgIHRoaXMuX2NhcHR1cmVEcmF3aW5nUGF0aChlKTsKCiAgICAgICAgdGhpcy5maXJlKCdtb3VzZTpkb3duJywgewogICAgICAgICAgZTogZQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBpZ25vcmUgaWYgc29tZSBvYmplY3QgaXMgYmVpbmcgdHJhbnNmb3JtZWQgYXQgdGhpcyBtb21lbnQKCgogICAgICBpZiAodGhpcy5fY3VycmVudFRyYW5zZm9ybSkgcmV0dXJuOwogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpLAogICAgICAgICAgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlKSwKICAgICAgICAgIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLAogICAgICAgICAgY29ybmVyOwoKICAgICAgaWYgKHRoaXMuX3Nob3VsZENsZWFyU2VsZWN0aW9uKGUpKSB7CiAgICAgICAgdGhpcy5fZ3JvdXBTZWxlY3RvciA9IHsKICAgICAgICAgIGV4OiBwb2ludGVyLngsCiAgICAgICAgICBleTogcG9pbnRlci55LAogICAgICAgICAgdG9wOiAwLAogICAgICAgICAgbGVmdDogMAogICAgICAgIH07CiAgICAgICAgdGhpcy5kZWFjdGl2YXRlQWxsV2l0aERpc3BhdGNoKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZGV0ZXJtaW5lIGlmIGl0J3MgYSBkcmFnIG9yIHJvdGF0ZSBjYXNlCiAgICAgICAgLy8gcm90YXRlIGFuZCBzY2FsZSB3aWxsIGhhcHBlbiBhdCB0aGUgc2FtZSB0aW1lCiAgICAgICAgdGhpcy5zdGF0ZWZ1bCAmJiB0YXJnZXQuc2F2ZVN0YXRlKCk7CgogICAgICAgIGlmIChjb3JuZXIgPSB0YXJnZXQuX2ZpbmRUYXJnZXRDb3JuZXIoZSwgdGhpcy5fb2Zmc2V0KSkgewogICAgICAgICAgdGhpcy5vbkJlZm9yZVNjYWxlUm90YXRlKHRhcmdldCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9zZXR1cEN1cnJlbnRUcmFuc2Zvcm0oZSwgdGFyZ2V0KTsKCiAgICAgICAgdmFyIHNob3VsZEhhbmRsZUdyb3VwTG9naWMgPSBlLnNoaWZ0S2V5ICYmIChhY3RpdmVHcm91cCB8fCB0aGlzLmdldEFjdGl2ZU9iamVjdCgpKSAmJiB0aGlzLnNlbGVjdGlvbjsKCiAgICAgICAgaWYgKHNob3VsZEhhbmRsZUdyb3VwTG9naWMpIHsKICAgICAgICAgIHRoaXMuX2hhbmRsZUdyb3VwTG9naWMoZSwgdGFyZ2V0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRhcmdldCAhPT0gdGhpcy5nZXRBY3RpdmVHcm91cCgpKSB7CiAgICAgICAgICAgIHRoaXMuZGVhY3RpdmF0ZUFsbCgpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc2V0QWN0aXZlT2JqZWN0KHRhcmdldCwgZSk7CiAgICAgICAgfQogICAgICB9IC8vIHdlIG11c3QgcmVuZGVyQWxsIHNvIHRoYXQgYWN0aXZlIGltYWdlIGlzIHBsYWNlZCBvbiB0aGUgdG9wIGNhbnZhcwoKCiAgICAgIHRoaXMucmVuZGVyQWxsKCk7CiAgICAgIHRoaXMuZmlyZSgnbW91c2U6ZG93bicsIHsKICAgICAgICB0YXJnZXQ6IHRhcmdldCwKICAgICAgICBlOiBlCiAgICAgIH0pOwogICAgICB0YXJnZXQgJiYgdGFyZ2V0LmZpcmUoJ21vdXNlZG93bicsIHsKICAgICAgICBlOiBlCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAgKiBNZXRob2QgdGhhdCBkZWZpbmVzIHRoZSBhY3Rpb25zIHdoZW4gbW91c2UgaXMgaG92ZXJpbmcgdGhlIGNhbnZhcy4KICAgICAgKiBUaGUgY3VycmVudFRyYW5zZm9ybSBwYXJhbWV0ZXIgd2lsbCBkZWZpbmRlIHdoZXRoZXIgdGhlIHVzZXIgaXMgcm90YXRpbmcvc2NhbGluZy90cmFuc2xhdGluZwogICAgICAqIGFuIGltYWdlIG9yIG5laXRoZXIgb2YgdGhlbSAob25seSBob3ZlcmluZykuIEEgZ3JvdXAgc2VsZWN0aW9uIGlzIGFsc28gcG9zc2libGUgYW5kIHdvdWxkIGNhbmNlbAogICAgICAqIGFsbCBhbnkgb3RoZXIgdHlwZSBvZiBhY3Rpb24uCiAgICAgICogSW4gY2FzZSBvZiBhbiBpbWFnZSB0cmFuc2Zvcm1hdGlvbiBvbmx5IHRoZSB0b3AgY2FudmFzIHdpbGwgYmUgcmVuZGVyZWQuCiAgICAgICogQG1ldGhvZCBfX29uTW91c2VNb3ZlCiAgICAgICogQHBhcmFtIGUge0V2ZW50fSBFdmVudCBvYmplY3QgZmlyZWQgb24gbW91c2Vtb3ZlCiAgICAgICoKICAgICAgKi8KICAgIF9fb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIF9fb25Nb3VzZU1vdmUoZSkgewogICAgICBpZiAodGhpcy5pc0RyYXdpbmdNb2RlKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzQ3VycmVudGx5RHJhd2luZykgewogICAgICAgICAgdGhpcy5fY2FwdHVyZURyYXdpbmdQYXRoKGUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5maXJlKCdtb3VzZTptb3ZlJywgewogICAgICAgICAgZTogZQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGdyb3VwU2VsZWN0b3IgPSB0aGlzLl9ncm91cFNlbGVjdG9yOyAvLyBXZSBpbml0aWFsbHkgY2xpY2tlZCBpbiBhbiBlbXB0eSBhcmVhLCBzbyB3ZSBkcmF3IGEgYm94IGZvciBtdWx0aXBsZSBzZWxlY3Rpb24uCgogICAgICBpZiAoZ3JvdXBTZWxlY3RvciAhPT0gbnVsbCkgewogICAgICAgIHZhciBwb2ludGVyID0gX2dldFBvaW50ZXIoZSk7CgogICAgICAgIGdyb3VwU2VsZWN0b3IubGVmdCA9IHBvaW50ZXIueCAtIHRoaXMuX29mZnNldC5sZWZ0IC0gZ3JvdXBTZWxlY3Rvci5leDsKICAgICAgICBncm91cFNlbGVjdG9yLnRvcCA9IHBvaW50ZXIueSAtIHRoaXMuX29mZnNldC50b3AgLSBncm91cFNlbGVjdG9yLmV5OwogICAgICAgIHRoaXMucmVuZGVyVG9wKCk7CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0pIHsKICAgICAgICAvLyBhbGlhcyBzdHlsZSB0byBlbGltaW50YXRlIHVubmVjZXNzYXJ5IGxvb2t1cAogICAgICAgIHZhciBzdHlsZSA9IHRoaXMudXBwZXJDYW52YXNFbC5zdHlsZTsgLy8gSGVyZSB3ZSBhcmUgaG92ZXJpbmcgdGhlIGNhbnZhcyB0aGVuIHdlIHdpbGwgZGV0ZXJtaW5lCiAgICAgICAgLy8gd2hhdCBwYXJ0IG9mIHRoZSBwaWN0dXJlcyB3ZSBhcmUgaG92ZXJpbmcgdG8gY2hhbmdlIHRoZSBjYXJldCBzeW1ib2wuCiAgICAgICAgLy8gV2Ugd29uJ3QgZG8gdGhhdCB3aGlsZSBkcmFnZ2luZyBvciByb3RhdGluZyBpbiBvcmRlciB0byBpbXByb3ZlIHRoZQogICAgICAgIC8vIHBlcmZvcm1hbmNlLgoKICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpOwoKICAgICAgICBpZiAoIXRhcmdldCkgewogICAgICAgICAgLy8gaW1hZ2UvdGV4dCB3YXMgaG92ZXJlZC1vdXQgZnJvbSwgd2UgcmVtb3ZlIGl0cyBib3JkZXJzCiAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fb2JqZWN0cy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgaWYgKHRoaXMuX29iamVjdHNbaV0gJiYgIXRoaXMuX29iamVjdHNbaV0uYWN0aXZlKSB7CiAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRBY3RpdmUoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgc3R5bGUuY3Vyc29yID0gdGhpcy5kZWZhdWx0Q3Vyc29yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBzZXQgcHJvcGVyIGN1cnNvcgogICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yRnJvbUV2ZW50KGUsIHRhcmdldCk7CgogICAgICAgICAgaWYgKHRhcmdldC5pc0FjdGl2ZSgpKSB7CiAgICAgICAgICAgIC8vIGRpc3BsYXkgY29ybmVycyB3aGVuIGhvdmVyaW5nIG92ZXIgYW4gaW1hZ2UKICAgICAgICAgICAgdGFyZ2V0LnNldENvcm5lcnNWaXNpYmlsaXR5ICYmIHRhcmdldC5zZXRDb3JuZXJzVmlzaWJpbGl0eSh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gb2JqZWN0IGlzIGJlaW5nIHRyYW5zZm9ybWVkIChzY2FsZWQvcm90YXRlZC9tb3ZlZC9ldGMuKQogICAgICAgIHZhciBwb2ludGVyID0gX2dldFBvaW50ZXIoZSksCiAgICAgICAgICAgIHggPSBwb2ludGVyLngsCiAgICAgICAgICAgIHkgPSBwb2ludGVyLnk7CgogICAgICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0LmlzTW92aW5nID0gdHJ1ZTsKCiAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uYWN0aW9uID09PSAncm90YXRlJykgewogICAgICAgICAgLy8gcm90YXRlIG9iamVjdCBvbmx5IGlmIHNoaWZ0IGtleSBpcyBub3QgcHJlc3NlZAogICAgICAgICAgLy8gYW5kIGlmIGl0IGlzIG5vdCBhIGdyb3VwIHdlIGFyZSB0cmFuc2Zvcm1pbmcKICAgICAgICAgIGlmICghZS5zaGlmdEtleSkgewogICAgICAgICAgICB0aGlzLl9yb3RhdGVPYmplY3QoeCwgeSk7CgogICAgICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDpyb3RhdGluZycsIHsKICAgICAgICAgICAgICB0YXJnZXQ6IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQuZmlyZSgncm90YXRpbmcnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0Lmhhc1JvdGF0aW5nUG9pbnQpIHsKICAgICAgICAgICAgdGhpcy5fc2NhbGVPYmplY3QoeCwgeSk7CgogICAgICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDpzY2FsaW5nJywgewogICAgICAgICAgICAgIHRhcmdldDogdGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnRhcmdldC5maXJlKCdzY2FsaW5nJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jdXJyZW50VHJhbnNmb3JtLmFjdGlvbiA9PT0gJ3NjYWxlJykgewogICAgICAgICAgdGhpcy5fc2NhbGVPYmplY3QoeCwgeSk7CgogICAgICAgICAgdGhpcy5maXJlKCdvYmplY3Q6c2NhbGluZycsIHsKICAgICAgICAgICAgdGFyZ2V0OiB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnRhcmdldAogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQuZmlyZSgnc2NhbGluZycpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5fY3VycmVudFRyYW5zZm9ybS5hY3Rpb24gPT09ICdzY2FsZVgnKSB7CiAgICAgICAgICB0aGlzLl9zY2FsZU9iamVjdCh4LCB5LCAneCcpOwoKICAgICAgICAgIHRoaXMuZmlyZSgnb2JqZWN0OnNjYWxpbmcnLCB7CiAgICAgICAgICAgIHRhcmdldDogdGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0LmZpcmUoJ3NjYWxpbmcnKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uYWN0aW9uID09PSAnc2NhbGVZJykgewogICAgICAgICAgdGhpcy5fc2NhbGVPYmplY3QoeCwgeSwgJ3knKTsKCiAgICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDpzY2FsaW5nJywgewogICAgICAgICAgICB0YXJnZXQ6IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnRhcmdldC5maXJlKCdzY2FsaW5nJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX3RyYW5zbGF0ZU9iamVjdCh4LCB5KTsKCiAgICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDptb3ZpbmcnLCB7CiAgICAgICAgICAgIHRhcmdldDogdGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMuX3NldEN1cnNvcih0aGlzLm1vdmVDdXJzb3IpOwoKICAgICAgICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0LmZpcmUoJ21vdmluZycpOwogICAgICAgIH0gLy8gb25seSBjb21taXQgaGVyZS4gd2hlbiB3ZSBhcmUgYWN0dWFsbHkgbW92aW5nIHRoZSBwaWN0dXJlcwoKCiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgfQoKICAgICAgdGhpcy5maXJlKCdtb3VzZTptb3ZlJywgewogICAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICAgIGU6IGUKICAgICAgfSk7CiAgICAgIHRhcmdldCAmJiB0YXJnZXQuZmlyZSgnbW91c2Vtb3ZlJywgewogICAgICAgIGU6IGUKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQXBwbGllcyBvbmUgaW1wbGVtZW50YXRpb24gb2YgJ3BvaW50IGluc2lkZSBwb2x5Z29uJyBhbGdvcml0aG0KICAgICAqIEBtZXRob2QgY29udGFpbnNQb2ludAogICAgICogQHBhcmFtIGUgeyBFdmVudCB9IGV2ZW50IG9iamVjdAogICAgICogQHBhcmFtIHRhcmdldCB7IGZhYnJpYy5PYmplY3QgfSBvYmplY3QgdG8gdGVzdCBhZ2FpbnN0CiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIHBvaW50IGNvbnRhaW5zIHdpdGhpbiBhcmVhIG9mIGdpdmVuIG9iamVjdAogICAgICovCiAgICBjb250YWluc1BvaW50OiBmdW5jdGlvbiBjb250YWluc1BvaW50KGUsIHRhcmdldCkgewogICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlKSwKICAgICAgICAgIHh5ID0gdGhpcy5fbm9ybWFsaXplUG9pbnRlcih0YXJnZXQsIHBvaW50ZXIpLAogICAgICAgICAgeCA9IHh5LngsCiAgICAgICAgICB5ID0geHkueTsgLy8gaHR0cDovL3d3dy5nZW9nLnViYy5jYS9jb3Vyc2VzL2tsaW5rL2dpcy5ub3Rlcy9uY2dpYS91MzIuaHRtbAogICAgICAvLyBodHRwOi8vaWRhdi51Y2RhdmlzLmVkdS9+b2tyZXlsb3MvVEFzaGlwL1NwcmluZzIwMDAvUG9pbnRJblBvbHlnb24uaHRtbAogICAgICAvLyB3ZSBpdGVyYXRlIHRocm91Z2ggZWFjaCBvYmplY3QuIElmIHRhcmdldCBmb3VuZCwgcmV0dXJuIGl0LgoKCiAgICAgIHZhciBpTGluZXMgPSB0YXJnZXQuX2dldEltYWdlTGluZXModGFyZ2V0Lm9Db29yZHMpLAogICAgICAgICAgeHBvaW50cyA9IHRhcmdldC5fZmluZENyb3NzUG9pbnRzKHgsIHksIGlMaW5lcyk7IC8vIGlmIHhjb3VudCBpcyBvZGQgdGhlbiB3ZSBjbGlja2VkIGluc2lkZSB0aGUgb2JqZWN0CiAgICAgIC8vIEZvciB0aGUgc3BlY2lmaWMgY2FzZSBvZiBzcXVhcmUgaW1hZ2VzIHhjb3VudCA9PT0gMSBpbiBhbGwgdHJ1ZSBjYXNlcwoKCiAgICAgIGlmICh4cG9pbnRzICYmIHhwb2ludHMgJSAyID09PSAxIHx8IHRhcmdldC5fZmluZFRhcmdldENvcm5lcihlLCB0aGlzLl9vZmZzZXQpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfbm9ybWFsaXplUG9pbnRlcgogICAgICovCiAgICBfbm9ybWFsaXplUG9pbnRlcjogZnVuY3Rpb24gX25vcm1hbGl6ZVBvaW50ZXIob2JqZWN0LCBwb2ludGVyKSB7CiAgICAgIHZhciBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKSwKICAgICAgICAgIHggPSBwb2ludGVyLngsCiAgICAgICAgICB5ID0gcG9pbnRlci55OwogICAgICB2YXIgaXNPYmplY3RJbkdyb3VwID0gYWN0aXZlR3JvdXAgJiYgb2JqZWN0LnR5cGUgIT09ICdncm91cCcgJiYgYWN0aXZlR3JvdXAuY29udGFpbnMob2JqZWN0KTsKCiAgICAgIGlmIChpc09iamVjdEluR3JvdXApIHsKICAgICAgICB4IC09IGFjdGl2ZUdyb3VwLmxlZnQ7CiAgICAgICAgeSAtPSBhY3RpdmVHcm91cC50b3A7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgeDogeCwKICAgICAgICB5OiB5CiAgICAgIH07CiAgICB9LAogICAgX2lzVGFyZ2V0VHJhbnNwYXJlbnQ6IGZ1bmN0aW9uIF9pc1RhcmdldFRyYW5zcGFyZW50KHRhcmdldCwgeCwgeSkgewogICAgICB2YXIgY2FjaGVDb250ZXh0ID0gdGhpcy5jb250ZXh0Q2FjaGU7CiAgICAgIHZhciBoYXNCb3JkZXJzID0gdGFyZ2V0Lmhhc0JvcmRlcnMsCiAgICAgICAgICB0cmFuc3BhcmVudENvcm5lcnMgPSB0YXJnZXQudHJhbnNwYXJlbnRDb3JuZXJzOwogICAgICB0YXJnZXQuaGFzQm9yZGVycyA9IHRhcmdldC50cmFuc3BhcmVudENvcm5lcnMgPSBmYWxzZTsKCiAgICAgIHRoaXMuX2RyYXcoY2FjaGVDb250ZXh0LCB0YXJnZXQpOwoKICAgICAgdGFyZ2V0Lmhhc0JvcmRlcnMgPSBoYXNCb3JkZXJzOwogICAgICB0YXJnZXQudHJhbnNwYXJlbnRDb3JuZXJzID0gdHJhbnNwYXJlbnRDb3JuZXJzOyAvLyBJZiB0b2xlcmFuY2UgaXMgPiAwIGFkanVzdCBzdGFydCBjb29yZHMgdG8gdGFrZSBpbnRvIGFjY291bnQuIElmIG1vdmVzIG9mZiBDYW52YXMgZml4IHRvIDAKCiAgICAgIGlmICh0aGlzLnRhcmdldEZpbmRUb2xlcmFuY2UgPiAwKSB7CiAgICAgICAgaWYgKHggPiB0aGlzLnRhcmdldEZpbmRUb2xlcmFuY2UpIHsKICAgICAgICAgIHggLT0gdGhpcy50YXJnZXRGaW5kVG9sZXJhbmNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB4ID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gdGhpcy50YXJnZXRGaW5kVG9sZXJhbmNlKSB7CiAgICAgICAgICB5IC09IHRoaXMudGFyZ2V0RmluZFRvbGVyYW5jZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgeSA9IDA7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgaXNUcmFuc3BhcmVudCA9IHRydWU7CiAgICAgIHZhciBpbWFnZURhdGEgPSBjYWNoZUNvbnRleHQuZ2V0SW1hZ2VEYXRhKHgsIHksIHRoaXMudGFyZ2V0RmluZFRvbGVyYW5jZSAqIDIgfHwgMSwgdGhpcy50YXJnZXRGaW5kVG9sZXJhbmNlICogMiB8fCAxKTsgLy8gU3BsaXQgaW1hZ2UgZGF0YSAtIGZvciB0b2xlcmFuY2UgPiAxLCBwaXhlbERhdGFTaXplID0gNDsKCiAgICAgIGZvciAodmFyIGkgPSAzOyBpIDwgaW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICB2YXIgdGVtcCA9IGltYWdlRGF0YS5kYXRhW2ldOwogICAgICAgIGlzVHJhbnNwYXJlbnQgPSB0ZW1wIDw9IDA7CiAgICAgICAgaWYgKGlzVHJhbnNwYXJlbnQgPT09IGZhbHNlKSBicmVhazsgLy9TdG9wIGlmIGNvbG91ciBmb3VuZAogICAgICB9CgogICAgICBpbWFnZURhdGEgPSBudWxsOwogICAgICB0aGlzLmNsZWFyQ29udGV4dChjYWNoZUNvbnRleHQpOwogICAgICByZXR1cm4gaXNUcmFuc3BhcmVudDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfc2hvdWxkQ2xlYXJTZWxlY3Rpb24KICAgICAqLwogICAgX3Nob3VsZENsZWFyU2VsZWN0aW9uOiBmdW5jdGlvbiBfc2hvdWxkQ2xlYXJTZWxlY3Rpb24oZSkgewogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpLAogICAgICAgICAgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCk7CiAgICAgIHJldHVybiAhdGFyZ2V0IHx8IHRhcmdldCAmJiBhY3RpdmVHcm91cCAmJiAhYWN0aXZlR3JvdXAuY29udGFpbnModGFyZ2V0KSAmJiBhY3RpdmVHcm91cCAhPT0gdGFyZ2V0ICYmICFlLnNoaWZ0S2V5OwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9zZXR1cEN1cnJlbnRUcmFuc2Zvcm0KICAgICAqLwogICAgX3NldHVwQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gX3NldHVwQ3VycmVudFRyYW5zZm9ybShlLCB0YXJnZXQpIHsKICAgICAgdmFyIGFjdGlvbiA9ICdkcmFnJywKICAgICAgICAgIGNvcm5lciwKICAgICAgICAgIHBvaW50ZXIgPSBfZ2V0UG9pbnRlcihlKTsKCiAgICAgIGlmIChjb3JuZXIgPSB0YXJnZXQuX2ZpbmRUYXJnZXRDb3JuZXIoZSwgdGhpcy5fb2Zmc2V0KSkgewogICAgICAgIGFjdGlvbiA9IGNvcm5lciA9PT0gJ21sJyB8fCBjb3JuZXIgPT09ICdtcicgPyAnc2NhbGVYJyA6IGNvcm5lciA9PT0gJ210JyB8fCBjb3JuZXIgPT09ICdtYicgPyAnc2NhbGVZJyA6IGNvcm5lciA9PT0gJ210cicgPyAncm90YXRlJyA6IHRhcmdldC5oYXNSb3RhdGluZ1BvaW50ID8gJ3NjYWxlJyA6ICdyb3RhdGUnOwogICAgICB9CgogICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtID0gewogICAgICAgIHRhcmdldDogdGFyZ2V0LAogICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgIHNjYWxlWDogdGFyZ2V0LnNjYWxlWCwKICAgICAgICBzY2FsZVk6IHRhcmdldC5zY2FsZVksCiAgICAgICAgb2Zmc2V0WDogcG9pbnRlci54IC0gdGFyZ2V0LmxlZnQsCiAgICAgICAgb2Zmc2V0WTogcG9pbnRlci55IC0gdGFyZ2V0LnRvcCwKICAgICAgICBleDogcG9pbnRlci54LAogICAgICAgIGV5OiBwb2ludGVyLnksCiAgICAgICAgbGVmdDogdGFyZ2V0LmxlZnQsCiAgICAgICAgdG9wOiB0YXJnZXQudG9wLAogICAgICAgIHRoZXRhOiB0YXJnZXQuX3RoZXRhLAogICAgICAgIHdpZHRoOiB0YXJnZXQud2lkdGggKiB0YXJnZXQuc2NhbGVYCiAgICAgIH07CiAgICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwgPSB7CiAgICAgICAgbGVmdDogdGFyZ2V0LmxlZnQsCiAgICAgICAgdG9wOiB0YXJnZXQudG9wCiAgICAgIH07CiAgICB9LAogICAgX2hhbmRsZUdyb3VwTG9naWM6IGZ1bmN0aW9uIF9oYW5kbGVHcm91cExvZ2ljKGUsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB0aGlzLmdldEFjdGl2ZUdyb3VwKCkpIHsKICAgICAgICAvLyBpZiBpdCdzIGEgZ3JvdXAsIGZpbmQgdGFyZ2V0IGFnYWluLCB0aGlzIHRpbWUgc2tpcHBpbmcgZ3JvdXAKICAgICAgICB0YXJnZXQgPSB0aGlzLmZpbmRUYXJnZXQoZSwgdHJ1ZSk7IC8vIGlmIGV2ZW4gb2JqZWN0IGlzIG5vdCBmb3VuZCwgYmFpbCBvdXQKCiAgICAgICAgaWYgKCF0YXJnZXQgfHwgdGFyZ2V0LmlzVHlwZSgnZ3JvdXAnKSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpOwoKICAgICAgaWYgKGFjdGl2ZUdyb3VwKSB7CiAgICAgICAgaWYgKGFjdGl2ZUdyb3VwLmNvbnRhaW5zKHRhcmdldCkpIHsKICAgICAgICAgIGFjdGl2ZUdyb3VwLnJlbW92ZVdpdGhVcGRhdGUodGFyZ2V0KTsKICAgICAgICAgIHRhcmdldC5zZXRBY3RpdmUoZmFsc2UpOwoKICAgICAgICAgIGlmIChhY3RpdmVHcm91cC5zaXplKCkgPT09IDEpIHsKICAgICAgICAgICAgLy8gcmVtb3ZlIGdyb3VwIGFsbHRvZ2V0aGVyIGlmIGFmdGVyIHJlbW92YWwgaXQgb25seSBjb250YWlucyAxIG9iamVjdAogICAgICAgICAgICB0aGlzLmRpc2NhcmRBY3RpdmVHcm91cCgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhY3RpdmVHcm91cC5hZGRXaXRoVXBkYXRlKHRhcmdldCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjcmVhdGVkJywgewogICAgICAgICAgdGFyZ2V0OiBhY3RpdmVHcm91cCwKICAgICAgICAgIGU6IGUKICAgICAgICB9KTsKICAgICAgICBhY3RpdmVHcm91cC5zZXRBY3RpdmUodHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZ3JvdXAgZG9lcyBub3QgZXhpc3QKICAgICAgICBpZiAodGhpcy5fYWN0aXZlT2JqZWN0KSB7CiAgICAgICAgICAvLyBvbmx5IGlmIHRoZXJlJ3MgYW4gYWN0aXZlIG9iamVjdAogICAgICAgICAgaWYgKHRhcmdldCAhPT0gdGhpcy5fYWN0aXZlT2JqZWN0KSB7CiAgICAgICAgICAgIC8vIGFuZCB0aGF0IG9iamVjdCBpcyBub3QgdGhlIGFjdHVhbCB0YXJnZXQKICAgICAgICAgICAgdmFyIGdyb3VwID0gbmV3IGZhYnJpYy5Hcm91cChbdGhpcy5fYWN0aXZlT2JqZWN0LCB0YXJnZXRdKTsKICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVHcm91cChncm91cCk7CiAgICAgICAgICAgIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpOwogICAgICAgICAgfQogICAgICAgIH0gLy8gYWN0aXZhdGUgdGFyZ2V0IG9iamVjdCBpbiBhbnkgY2FzZQoKCiAgICAgICAgdGFyZ2V0LnNldEFjdGl2ZSh0cnVlKTsKICAgICAgfQoKICAgICAgaWYgKGFjdGl2ZUdyb3VwKSB7CiAgICAgICAgYWN0aXZlR3JvdXAuc2F2ZUNvb3JkcygpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX3ByZXBhcmVGb3JEcmF3aW5nCiAgICAgKi8KICAgIF9wcmVwYXJlRm9yRHJhd2luZzogZnVuY3Rpb24gX3ByZXBhcmVGb3JEcmF3aW5nKGUpIHsKICAgICAgdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nID0gdHJ1ZTsKICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCkucmVuZGVyQWxsKCk7CiAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpOwogICAgICB0aGlzLl9mcmVlRHJhd2luZ1hQb2ludHMubGVuZ3RoID0gdGhpcy5fZnJlZURyYXdpbmdZUG9pbnRzLmxlbmd0aCA9IDA7CgogICAgICB0aGlzLl9mcmVlRHJhd2luZ1hQb2ludHMucHVzaChwb2ludGVyLngpOwoKICAgICAgdGhpcy5fZnJlZURyYXdpbmdZUG9pbnRzLnB1c2gocG9pbnRlci55KTsKCiAgICAgIHRoaXMuY29udGV4dFRvcC5iZWdpblBhdGgoKTsKICAgICAgdGhpcy5jb250ZXh0VG9wLm1vdmVUbyhwb2ludGVyLngsIHBvaW50ZXIueSk7CiAgICAgIHRoaXMuY29udGV4dFRvcC5zdHJva2VTdHlsZSA9IHRoaXMuZnJlZURyYXdpbmdDb2xvcjsKICAgICAgdGhpcy5jb250ZXh0VG9wLmxpbmVXaWR0aCA9IHRoaXMuZnJlZURyYXdpbmdMaW5lV2lkdGg7CiAgICAgIHRoaXMuY29udGV4dFRvcC5saW5lQ2FwID0gdGhpcy5jb250ZXh0VG9wLmxpbmVKb2luID0gJ3JvdW5kJzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfY2FwdHVyZURyYXdpbmdQYXRoCiAgICAgKi8KICAgIF9jYXB0dXJlRHJhd2luZ1BhdGg6IGZ1bmN0aW9uIF9jYXB0dXJlRHJhd2luZ1BhdGgoZSkgewogICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlKTsKCiAgICAgIHRoaXMuX2ZyZWVEcmF3aW5nWFBvaW50cy5wdXNoKHBvaW50ZXIueCk7CgogICAgICB0aGlzLl9mcmVlRHJhd2luZ1lQb2ludHMucHVzaChwb2ludGVyLnkpOwoKICAgICAgdGhpcy5jb250ZXh0VG9wLmxpbmVUbyhwb2ludGVyLngsIHBvaW50ZXIueSk7CiAgICAgIHRoaXMuY29udGV4dFRvcC5zdHJva2UoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfZmluYWxpemVEcmF3aW5nUGF0aAogICAgICovCiAgICBfZmluYWxpemVEcmF3aW5nUGF0aDogZnVuY3Rpb24gX2ZpbmFsaXplRHJhd2luZ1BhdGgoKSB7CiAgICAgIHRoaXMuY29udGV4dFRvcC5jbG9zZVBhdGgoKTsKICAgICAgdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nID0gZmFsc2U7CiAgICAgIHZhciBtaW5YID0gdXRpbE1pbih0aGlzLl9mcmVlRHJhd2luZ1hQb2ludHMpLAogICAgICAgICAgbWluWSA9IHV0aWxNaW4odGhpcy5fZnJlZURyYXdpbmdZUG9pbnRzKSwKICAgICAgICAgIG1heFggPSB1dGlsTWF4KHRoaXMuX2ZyZWVEcmF3aW5nWFBvaW50cyksCiAgICAgICAgICBtYXhZID0gdXRpbE1heCh0aGlzLl9mcmVlRHJhd2luZ1lQb2ludHMpLAogICAgICAgICAgY3R4ID0gdGhpcy5jb250ZXh0VG9wLAogICAgICAgICAgcGF0aCA9IFtdLAogICAgICAgICAgeFBvaW50LAogICAgICAgICAgeVBvaW50LAogICAgICAgICAgeFBvaW50cyA9IHRoaXMuX2ZyZWVEcmF3aW5nWFBvaW50cywKICAgICAgICAgIHlQb2ludHMgPSB0aGlzLl9mcmVlRHJhd2luZ1lQb2ludHM7CiAgICAgIHBhdGgucHVzaCgnTSAnLCB4UG9pbnRzWzBdIC0gbWluWCwgJyAnLCB5UG9pbnRzWzBdIC0gbWluWSwgJyAnKTsKCiAgICAgIGZvciAodmFyIGkgPSAxOyB4UG9pbnQgPSB4UG9pbnRzW2ldLCB5UG9pbnQgPSB5UG9pbnRzW2ldOyBpKyspIHsKICAgICAgICBwYXRoLnB1c2goJ0wgJywgeFBvaW50IC0gbWluWCwgJyAnLCB5UG9pbnQgLSBtaW5ZLCAnICcpOwogICAgICB9IC8vIFRPRE8gKGthbmdheCk6IG1heWJlIHJlbW92ZSBQYXRoIGNyZWF0aW9uIGZyb20gaGVyZSwgdG8gZGVjb3VwbGUgZmFicmljLkNhbnZhcyBmcm9tIGZhYnJpYy5QYXRoLAogICAgICAvLyBhbmQgaW5zdGVhZCBmaXJlIHNvbWV0aGluZyBsaWtlICJkcmF3aW5nOmNvbXBsZXRlZCIgZXZlbnQgd2l0aCBwYXRoIHN0cmluZwoKCiAgICAgIHBhdGggPSBwYXRoLmpvaW4oJycpOwoKICAgICAgaWYgKHBhdGggPT09ICJNIDAgMCBMIDAgMCAiKSB7CiAgICAgICAgLy8gZG8gbm90IGNyZWF0ZSAwIHdpZHRoL2hlaWdodCBwYXRocywgYXMgdGhleSBhcmUgcmVuZGVyZWQgaW5jb25zaXN0ZW50bHkgYWNyb3NzIGJyb3dzZXJzCiAgICAgICAgLy8gRmlyZWZveCA0LCBmb3IgZXhhbXBsZSwgcmVuZGVycyBhIGRvdCwgd2hlcmVhcyBDaHJvbWUgMTAgcmVuZGVycyBub3RoaW5nCiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBwID0gbmV3IGZhYnJpYy5QYXRoKHBhdGgpOwogICAgICBwLmZpbGwgPSBudWxsOwogICAgICBwLnN0cm9rZSA9IHRoaXMuZnJlZURyYXdpbmdDb2xvcjsKICAgICAgcC5zdHJva2VXaWR0aCA9IHRoaXMuZnJlZURyYXdpbmdMaW5lV2lkdGg7CiAgICAgIHRoaXMuYWRkKHApOwogICAgICBwLnNldCgibGVmdCIsIG1pblggKyAobWF4WCAtIG1pblgpIC8gMikuc2V0KCJ0b3AiLCBtaW5ZICsgKG1heFkgLSBtaW5ZKSAvIDIpLnNldENvb3JkcygpOwogICAgICB0aGlzLnJlbmRlckFsbCgpOwogICAgICB0aGlzLmZpcmUoJ3BhdGg6Y3JlYXRlZCcsIHsKICAgICAgICBwYXRoOiBwCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFRyYW5zbGF0ZXMgb2JqZWN0IGJ5ICJzZXR0aW5nIiBpdHMgbGVmdC90b3AKICAgICAqIEBtZXRob2QgX3RyYW5zbGF0ZU9iamVjdAogICAgICogQHBhcmFtIHgge051bWJlcn0gcG9pbnRlcidzIHggY29vcmRpbmF0ZQogICAgICogQHBhcmFtIHkge051bWJlcn0gcG9pbnRlcidzIHkgY29vcmRpbmF0ZQogICAgICovCiAgICBfdHJhbnNsYXRlT2JqZWN0OiBmdW5jdGlvbiBfdHJhbnNsYXRlT2JqZWN0KHgsIHkpIHsKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0OwogICAgICB0YXJnZXQubG9ja01vdmVtZW50WCB8fCB0YXJnZXQuc2V0KCdsZWZ0JywgeCAtIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub2Zmc2V0WCk7CiAgICAgIHRhcmdldC5sb2NrTW92ZW1lbnRZIHx8IHRhcmdldC5zZXQoJ3RvcCcsIHkgLSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9mZnNldFkpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNjYWxlcyBvYmplY3QgYnkgaW52b2tpbmcgaXRzIHNjYWxlWC9zY2FsZVkgbWV0aG9kcwogICAgICogQG1ldGhvZCBfc2NhbGVPYmplY3QKICAgICAqIEBwYXJhbSB4IHtOdW1iZXJ9IHBvaW50ZXIncyB4IGNvb3JkaW5hdGUKICAgICAqIEBwYXJhbSB5IHtOdW1iZXJ9IHBvaW50ZXIncyB5IGNvb3JkaW5hdGUKICAgICAqIEBwYXJhbSBieSB7U3RyaW5nfSBFaXRoZXIgJ3gnIG9yICd5JyAtIHNwZWNpZmllcyBkaW1lbnNpb24gY29uc3RyYWludCBieSB3aGljaCB0byBzY2FsZSBhbiBvYmplY3QuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgV2hlbiBub3QgcHJvdmlkZWQsIGFuIG9iamVjdCBpcyBzY2FsZWQgYnkgYm90aCBkaW1lbnNpb25zIGVxdWFsbHkKICAgICAqLwogICAgX3NjYWxlT2JqZWN0OiBmdW5jdGlvbiBfc2NhbGVPYmplY3QoeCwgeSwgYnkpIHsKICAgICAgdmFyIHQgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLAogICAgICAgICAgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LAogICAgICAgICAgdGFyZ2V0ID0gdC50YXJnZXQ7CiAgICAgIGlmICh0YXJnZXQubG9ja1NjYWxpbmdYICYmIHRhcmdldC5sb2NrU2NhbGluZ1kpIHJldHVybjsKICAgICAgdmFyIGxhc3RMZW4gPSBzcXJ0KHBvdyh0LmV5IC0gdC50b3AgLSBvZmZzZXQudG9wLCAyKSArIHBvdyh0LmV4IC0gdC5sZWZ0IC0gb2Zmc2V0LmxlZnQsIDIpKSwKICAgICAgICAgIGN1ckxlbiA9IHNxcnQocG93KHkgLSB0LnRvcCAtIG9mZnNldC50b3AsIDIpICsgcG93KHggLSB0LmxlZnQgLSBvZmZzZXQubGVmdCwgMikpOwogICAgICB0YXJnZXQuX3NjYWxpbmcgPSB0cnVlOwoKICAgICAgaWYgKCFieSkgewogICAgICAgIHRhcmdldC5sb2NrU2NhbGluZ1ggfHwgdGFyZ2V0LnNldCgnc2NhbGVYJywgdC5zY2FsZVggKiBjdXJMZW4gLyBsYXN0TGVuKTsKICAgICAgICB0YXJnZXQubG9ja1NjYWxpbmdZIHx8IHRhcmdldC5zZXQoJ3NjYWxlWScsIHQuc2NhbGVZICogY3VyTGVuIC8gbGFzdExlbik7CiAgICAgIH0gZWxzZSBpZiAoYnkgPT09ICd4JyAmJiAhdGFyZ2V0LmxvY2tVbmlTY2FsaW5nKSB7CiAgICAgICAgdGFyZ2V0LmxvY2tTY2FsaW5nWCB8fCB0YXJnZXQuc2V0KCdzY2FsZVgnLCB0LnNjYWxlWCAqIGN1ckxlbiAvIGxhc3RMZW4pOwogICAgICB9IGVsc2UgaWYgKGJ5ID09PSAneScgJiYgIXRhcmdldC5sb2NrVW5pU2NhbGluZykgewogICAgICAgIHRhcmdldC5sb2NrU2NhbGluZ1kgfHwgdGFyZ2V0LnNldCgnc2NhbGVZJywgdC5zY2FsZVkgKiBjdXJMZW4gLyBsYXN0TGVuKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJvdGF0ZXMgb2JqZWN0IGJ5IGludm9raW5nIGl0cyByb3RhdGUgbWV0aG9kCiAgICAgKiBAbWV0aG9kIF9yb3RhdGVPYmplY3QKICAgICAqIEBwYXJhbSB4IHtOdW1iZXJ9IHBvaW50ZXIncyB4IGNvb3JkaW5hdGUKICAgICAqIEBwYXJhbSB5IHtOdW1iZXJ9IHBvaW50ZXIncyB5IGNvb3JkaW5hdGUKICAgICAqLwogICAgX3JvdGF0ZU9iamVjdDogZnVuY3Rpb24gX3JvdGF0ZU9iamVjdCh4LCB5KSB7CiAgICAgIHZhciB0ID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSwKICAgICAgICAgIG8gPSB0aGlzLl9vZmZzZXQ7CiAgICAgIGlmICh0LnRhcmdldC5sb2NrUm90YXRpb24pIHJldHVybjsKICAgICAgdmFyIGxhc3RBbmdsZSA9IGF0YW4yKHQuZXkgLSB0LnRvcCAtIG8udG9wLCB0LmV4IC0gdC5sZWZ0IC0gby5sZWZ0KSwKICAgICAgICAgIGN1ckFuZ2xlID0gYXRhbjIoeSAtIHQudG9wIC0gby50b3AsIHggLSB0LmxlZnQgLSBvLmxlZnQpOwogICAgICB0LnRhcmdldC5fdGhldGEgPSBjdXJBbmdsZSAtIGxhc3RBbmdsZSArIHQudGhldGE7CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBfc2V0Q3Vyc29yCiAgICAgKi8KICAgIF9zZXRDdXJzb3I6IGZ1bmN0aW9uIF9zZXRDdXJzb3IodmFsdWUpIHsKICAgICAgdGhpcy51cHBlckNhbnZhc0VsLnN0eWxlLmN1cnNvciA9IHZhbHVlOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgdGhlIGN1cnNvciBkZXBlbmRpbmcgb24gd2hlcmUgdGhlIGNhbnZhcyBpcyBiZWluZyBob3ZlcmVkLgogICAgICogTm90ZTogdmVyeSBidWdneSBpbiBPcGVyYQogICAgICogQG1ldGhvZCBfc2V0Q3Vyc29yRnJvbUV2ZW50CiAgICAgKiBAcGFyYW0gZSB7RXZlbnR9IEV2ZW50IG9iamVjdAogICAgICogQHBhcmFtIHRhcmdldCB7T2JqZWN0fSBPYmplY3QgdGhhdCB0aGUgbW91c2UgaXMgaG92ZXJpbmcsIGlmIHNvLgogICAgICovCiAgICBfc2V0Q3Vyc29yRnJvbUV2ZW50OiBmdW5jdGlvbiBfc2V0Q3Vyc29yRnJvbUV2ZW50KGUsIHRhcmdldCkgewogICAgICB2YXIgcyA9IHRoaXMudXBwZXJDYW52YXNFbC5zdHlsZTsKCiAgICAgIGlmICghdGFyZ2V0KSB7CiAgICAgICAgcy5jdXJzb3IgPSB0aGlzLmRlZmF1bHRDdXJzb3I7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKTsgLy8gb25seSBzaG93IHByb3BlciBjb3JuZXIgd2hlbiBncm91cCBzZWxlY3Rpb24gaXMgbm90IGFjdGl2ZQoKICAgICAgICB2YXIgY29ybmVyID0gISF0YXJnZXQuX2ZpbmRUYXJnZXRDb3JuZXIgJiYgKCFhY3RpdmVHcm91cCB8fCAhYWN0aXZlR3JvdXAuY29udGFpbnModGFyZ2V0KSkgJiYgdGFyZ2V0Ll9maW5kVGFyZ2V0Q29ybmVyKGUsIHRoaXMuX29mZnNldCk7CgogICAgICAgIGlmICghY29ybmVyKSB7CiAgICAgICAgICBzLmN1cnNvciA9IHRoaXMuaG92ZXJDdXJzb3I7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChjb3JuZXIgaW4gY3Vyc29yTWFwKSB7CiAgICAgICAgICAgIHMuY3Vyc29yID0gY3Vyc29yTWFwW2Nvcm5lcl07CiAgICAgICAgICB9IGVsc2UgaWYgKGNvcm5lciA9PT0gJ210cicgJiYgdGFyZ2V0Lmhhc1JvdGF0aW5nUG9pbnQpIHsKICAgICAgICAgICAgcy5jdXJzb3IgPSB0aGlzLnJvdGF0aW9uQ3Vyc29yOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcy5jdXJzb3IgPSB0aGlzLmRlZmF1bHRDdXJzb3I7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2QgX2RyYXdTZWxlY3Rpb24KICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIF9kcmF3U2VsZWN0aW9uOiBmdW5jdGlvbiBfZHJhd1NlbGVjdGlvbigpIHsKICAgICAgdmFyIGdyb3VwU2VsZWN0b3IgPSB0aGlzLl9ncm91cFNlbGVjdG9yLAogICAgICAgICAgbGVmdCA9IGdyb3VwU2VsZWN0b3IubGVmdCwKICAgICAgICAgIHRvcCA9IGdyb3VwU2VsZWN0b3IudG9wLAogICAgICAgICAgYWxlZnQgPSBhYnMobGVmdCksCiAgICAgICAgICBhdG9wID0gYWJzKHRvcCk7CiAgICAgIHRoaXMuY29udGV4dFRvcC5maWxsU3R5bGUgPSB0aGlzLnNlbGVjdGlvbkNvbG9yOwogICAgICB0aGlzLmNvbnRleHRUb3AuZmlsbFJlY3QoZ3JvdXBTZWxlY3Rvci5leCAtIChsZWZ0ID4gMCA/IDAgOiAtbGVmdCksIGdyb3VwU2VsZWN0b3IuZXkgLSAodG9wID4gMCA/IDAgOiAtdG9wKSwgYWxlZnQsIGF0b3ApOwogICAgICB0aGlzLmNvbnRleHRUb3AubGluZVdpZHRoID0gdGhpcy5zZWxlY3Rpb25MaW5lV2lkdGg7CiAgICAgIHRoaXMuY29udGV4dFRvcC5zdHJva2VTdHlsZSA9IHRoaXMuc2VsZWN0aW9uQm9yZGVyQ29sb3I7CiAgICAgIHRoaXMuY29udGV4dFRvcC5zdHJva2VSZWN0KGdyb3VwU2VsZWN0b3IuZXggKyBTVFJPS0VfT0ZGU0VUIC0gKGxlZnQgPiAwID8gMCA6IGFsZWZ0KSwgZ3JvdXBTZWxlY3Rvci5leSArIFNUUk9LRV9PRkZTRVQgLSAodG9wID4gMCA/IDAgOiBhdG9wKSwgYWxlZnQsIGF0b3ApOwogICAgfSwKICAgIF9maW5kU2VsZWN0ZWRPYmplY3RzOiBmdW5jdGlvbiBfZmluZFNlbGVjdGVkT2JqZWN0cyhlKSB7CiAgICAgIHZhciB0YXJnZXQsCiAgICAgICAgICB0YXJnZXRSZWdpb24sCiAgICAgICAgICBncm91cCA9IFtdLAogICAgICAgICAgeDEgPSB0aGlzLl9ncm91cFNlbGVjdG9yLmV4LAogICAgICAgICAgeTEgPSB0aGlzLl9ncm91cFNlbGVjdG9yLmV5LAogICAgICAgICAgeDIgPSB4MSArIHRoaXMuX2dyb3VwU2VsZWN0b3IubGVmdCwKICAgICAgICAgIHkyID0geTEgKyB0aGlzLl9ncm91cFNlbGVjdG9yLnRvcCwKICAgICAgICAgIGN1cnJlbnRPYmplY3QsCiAgICAgICAgICBzZWxlY3Rpb25YMVkxID0gbmV3IGZhYnJpYy5Qb2ludChtaW4oeDEsIHgyKSwgbWluKHkxLCB5MikpLAogICAgICAgICAgc2VsZWN0aW9uWDJZMiA9IG5ldyBmYWJyaWMuUG9pbnQobWF4KHgxLCB4MiksIG1heCh5MSwgeTIpKTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgY3VycmVudE9iamVjdCA9IHRoaXMuX29iamVjdHNbaV07CiAgICAgICAgaWYgKCFjdXJyZW50T2JqZWN0KSBjb250aW51ZTsKCiAgICAgICAgaWYgKGN1cnJlbnRPYmplY3QuaW50ZXJzZWN0c1dpdGhSZWN0KHNlbGVjdGlvblgxWTEsIHNlbGVjdGlvblgyWTIpIHx8IGN1cnJlbnRPYmplY3QuaXNDb250YWluZWRXaXRoaW5SZWN0KHNlbGVjdGlvblgxWTEsIHNlbGVjdGlvblgyWTIpKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb24gJiYgY3VycmVudE9iamVjdC5zZWxlY3RhYmxlKSB7CiAgICAgICAgICAgIGN1cnJlbnRPYmplY3Quc2V0QWN0aXZlKHRydWUpOwogICAgICAgICAgICBncm91cC5wdXNoKGN1cnJlbnRPYmplY3QpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBkbyBub3QgY3JlYXRlIGdyb3VwIGZvciAxIGVsZW1lbnQgb25seQoKCiAgICAgIGlmIChncm91cC5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLnNldEFjdGl2ZU9iamVjdChncm91cFswXSwgZSk7CiAgICAgIH0gZWxzZSBpZiAoZ3JvdXAubGVuZ3RoID4gMSkgewogICAgICAgIHZhciBncm91cCA9IG5ldyBmYWJyaWMuR3JvdXAoZ3JvdXApOwogICAgICAgIHRoaXMuc2V0QWN0aXZlR3JvdXAoZ3JvdXApOwogICAgICAgIGdyb3VwLnNhdmVDb29yZHMoKTsKICAgICAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjcmVhdGVkJywgewogICAgICAgICAgdGFyZ2V0OiBncm91cAogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLnJlbmRlckFsbCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIE1ldGhvZCB0aGF0IGRldGVybWluZXMgd2hhdCBvYmplY3Qgd2UgYXJlIGNsaWNraW5nIG9uCiAgICAgKiBAbWV0aG9kIGZpbmRUYXJnZXQKICAgICAqIEBwYXJhbSB7RXZlbnR9IGUgbW91c2UgZXZlbnQKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gc2tpcEdyb3VwIHdoZW4gdHJ1ZSwgZ3JvdXAgaXMgc2tpcHBlZCBhbmQgb25seSBvYmplY3RzIGFyZSB0cmF2ZXJzZWQgdGhyb3VnaAogICAgICovCiAgICBmaW5kVGFyZ2V0OiBmdW5jdGlvbiBmaW5kVGFyZ2V0KGUsIHNraXBHcm91cCkgewogICAgICB2YXIgdGFyZ2V0LAogICAgICAgICAgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlKTsgLy8gZmlyc3QgY2hlY2sgY3VycmVudCBncm91cCAoaWYgb25lIGV4aXN0cykKCiAgICAgIHZhciBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKTsKCiAgICAgIGlmIChhY3RpdmVHcm91cCAmJiAhc2tpcEdyb3VwICYmIHRoaXMuY29udGFpbnNQb2ludChlLCBhY3RpdmVHcm91cCkpIHsKICAgICAgICB0YXJnZXQgPSBhY3RpdmVHcm91cDsKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9IC8vIHRoZW4gY2hlY2sgYWxsIG9mIHRoZSBvYmplY3RzIG9uIGNhbnZhcwogICAgICAvLyBDYWNoZSBhbGwgdGFyZ2V0cyB3aGVyZSB0aGVpciBib3VuZGluZyBib3ggY29udGFpbnMgcG9pbnQuCgoKICAgICAgdmFyIHBvc3NpYmxlVGFyZ2V0cyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgaWYgKHRoaXMuX29iamVjdHNbaV0gJiYgdGhpcy5jb250YWluc1BvaW50KGUsIHRoaXMuX29iamVjdHNbaV0pKSB7CiAgICAgICAgICBpZiAodGhpcy5wZXJQaXhlbFRhcmdldEZpbmQgfHwgdGhpcy5fb2JqZWN0c1tpXS5wZXJQaXhlbFRhcmdldEZpbmQpIHsKICAgICAgICAgICAgcG9zc2libGVUYXJnZXRzW3Bvc3NpYmxlVGFyZ2V0cy5sZW5ndGhdID0gdGhpcy5fb2JqZWN0c1tpXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhcmdldCA9IHRoaXMuX29iamVjdHNbaV07CiAgICAgICAgICAgIHRoaXMucmVsYXRlZFRhcmdldCA9IHRhcmdldDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcG9zc2libGVUYXJnZXRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSk7CgogICAgICAgIHZhciBpc1RyYW5zcGFyZW50ID0gdGhpcy5faXNUYXJnZXRUcmFuc3BhcmVudChwb3NzaWJsZVRhcmdldHNbaV0sIHBvaW50ZXIueCwgcG9pbnRlci55KTsKCiAgICAgICAgaWYgKCFpc1RyYW5zcGFyZW50KSB7CiAgICAgICAgICB0YXJnZXQgPSBwb3NzaWJsZVRhcmdldHNbaV07CiAgICAgICAgICB0aGlzLnJlbGF0ZWRUYXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0YXJnZXQgJiYgdGFyZ2V0LnNlbGVjdGFibGUpIHsKICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBwb2ludGVyIGNvb3JkaW5hdGVzIHJlbGF0aXZlIHRvIGNhbnZhcy4KICAgICAqIEBtZXRob2QgZ2V0UG9pbnRlcgogICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3Qgd2l0aCAieCIgYW5kICJ5IiBudW1iZXIgdmFsdWVzCiAgICAgKi8KICAgIGdldFBvaW50ZXI6IGZ1bmN0aW9uIGdldFBvaW50ZXIoZSkgewogICAgICB2YXIgcG9pbnRlciA9IF9nZXRQb2ludGVyKGUpOwoKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBwb2ludGVyLnggLSB0aGlzLl9vZmZzZXQubGVmdCwKICAgICAgICB5OiBwb2ludGVyLnkgLSB0aGlzLl9vZmZzZXQudG9wCiAgICAgIH07CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBfY3JlYXRlVXBwZXJDYW52YXMKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8U3RyaW5nfSBjYW52YXNFbCBDYW52YXMgZWxlbWVudAogICAgICogQHRocm93cyB7Q0FOVkFTX0lOSVRfRVJST1J9IElmIGNhbnZhcyBjYW4gbm90IGJlIGluaXRpYWxpemVkCiAgICAgKi8KICAgIF9jcmVhdGVVcHBlckNhbnZhczogZnVuY3Rpb24gX2NyZWF0ZVVwcGVyQ2FudmFzKCkgewogICAgICB0aGlzLnVwcGVyQ2FudmFzRWwgPSB0aGlzLl9jcmVhdGVDYW52YXNFbGVtZW50KCk7CiAgICAgIHRoaXMudXBwZXJDYW52YXNFbC5jbGFzc05hbWUgPSAndXBwZXItY2FudmFzJzsKICAgICAgdGhpcy53cmFwcGVyRWwuYXBwZW5kQ2hpbGQodGhpcy51cHBlckNhbnZhc0VsKTsKCiAgICAgIHRoaXMuX2FwcGx5Q2FudmFzU3R5bGUodGhpcy51cHBlckNhbnZhc0VsKTsKCiAgICAgIHRoaXMuY29udGV4dFRvcCA9IHRoaXMudXBwZXJDYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpOwogICAgfSwKICAgIF9jcmVhdGVDYWNoZUNhbnZhczogZnVuY3Rpb24gX2NyZWF0ZUNhY2hlQ2FudmFzKCkgewogICAgICB0aGlzLmNhY2hlQ2FudmFzRWwgPSB0aGlzLl9jcmVhdGVDYW52YXNFbGVtZW50KCk7CiAgICAgIHRoaXMuY2FjaGVDYW52YXNFbC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgdGhpcy53aWR0aCk7CiAgICAgIHRoaXMuY2FjaGVDYW52YXNFbC5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIHRoaXMuaGVpZ2h0KTsKICAgICAgdGhpcy5jb250ZXh0Q2FjaGUgPSB0aGlzLmNhY2hlQ2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfaW5pdFdyYXBwZXJFbGVtZW50CiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGgKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQKICAgICAqLwogICAgX2luaXRXcmFwcGVyRWxlbWVudDogZnVuY3Rpb24gX2luaXRXcmFwcGVyRWxlbWVudCgpIHsKICAgICAgdGhpcy53cmFwcGVyRWwgPSBmYWJyaWMudXRpbC53cmFwRWxlbWVudCh0aGlzLmxvd2VyQ2FudmFzRWwsICdkaXYnLCB7CiAgICAgICAgJ2NsYXNzJzogdGhpcy5jb250YWluZXJDbGFzcwogICAgICB9KTsKICAgICAgZmFicmljLnV0aWwuc2V0U3R5bGUodGhpcy53cmFwcGVyRWwsIHsKICAgICAgICB3aWR0aDogdGhpcy5nZXRXaWR0aCgpICsgJ3B4JywKICAgICAgICBoZWlnaHQ6IHRoaXMuZ2V0SGVpZ2h0KCkgKyAncHgnLAogICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnCiAgICAgIH0pOwogICAgICBmYWJyaWMudXRpbC5tYWtlRWxlbWVudFVuc2VsZWN0YWJsZSh0aGlzLndyYXBwZXJFbCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2FwcGx5Q2FudmFzU3R5bGUKICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudAogICAgICovCiAgICBfYXBwbHlDYW52YXNTdHlsZTogZnVuY3Rpb24gX2FwcGx5Q2FudmFzU3R5bGUoZWxlbWVudCkgewogICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCkgfHwgZWxlbWVudC53aWR0aCwKICAgICAgICAgIGhlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KCkgfHwgZWxlbWVudC5oZWlnaHQ7CiAgICAgIGZhYnJpYy51dGlsLnNldFN0eWxlKGVsZW1lbnQsIHsKICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICB3aWR0aDogd2lkdGggKyAncHgnLAogICAgICAgIGhlaWdodDogaGVpZ2h0ICsgJ3B4JywKICAgICAgICBsZWZ0OiAwLAogICAgICAgIHRvcDogMAogICAgICB9KTsKICAgICAgZWxlbWVudC53aWR0aCA9IHdpZHRoOwogICAgICBlbGVtZW50LmhlaWdodCA9IGhlaWdodDsKICAgICAgZmFicmljLnV0aWwubWFrZUVsZW1lbnRVbnNlbGVjdGFibGUoZWxlbWVudCk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjb250ZXh0IG9mIGNhbnZhcyB3aGVyZSBvYmplY3Qgc2VsZWN0aW9uIGlzIGRyYXduCiAgICAgKiBAbWV0aG9kIGdldFNlbGVjdGlvbkNvbnRleHQKICAgICAqIEByZXR1cm4ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0KICAgICAqLwogICAgZ2V0U2VsZWN0aW9uQ29udGV4dDogZnVuY3Rpb24gZ2V0U2VsZWN0aW9uQ29udGV4dCgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udGV4dFRvcDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zICZsdDtjYW52YXM+IGVsZW1lbnQgb24gd2hpY2ggb2JqZWN0IHNlbGVjdGlvbiBpcyBkcmF3bgogICAgICogQG1ldGhvZCBnZXRTZWxlY3Rpb25FbGVtZW50CiAgICAgKiBAcmV0dXJuIHtIVE1MQ2FudmFzRWxlbWVudH0KICAgICAqLwogICAgZ2V0U2VsZWN0aW9uRWxlbWVudDogZnVuY3Rpb24gZ2V0U2VsZWN0aW9uRWxlbWVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMudXBwZXJDYW52YXNFbDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIGdpdmVuIG9iamVjdCBhcyBhY3RpdmUKICAgICAqIEBtZXRob2Qgc2V0QWN0aXZlT2JqZWN0CiAgICAgKiBAcGFyYW0gb2JqZWN0IHtmYWJyaWMuT2JqZWN0fSBPYmplY3QgdG8gc2V0IGFzIGFuIGFjdGl2ZSBvbmUKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2V0QWN0aXZlT2JqZWN0OiBmdW5jdGlvbiBzZXRBY3RpdmVPYmplY3Qob2JqZWN0LCBlKSB7CiAgICAgIGlmICh0aGlzLl9hY3RpdmVPYmplY3QpIHsKICAgICAgICB0aGlzLl9hY3RpdmVPYmplY3Quc2V0QWN0aXZlKGZhbHNlKTsKICAgICAgfQoKICAgICAgdGhpcy5fYWN0aXZlT2JqZWN0ID0gb2JqZWN0OwogICAgICBvYmplY3Quc2V0QWN0aXZlKHRydWUpOwogICAgICB0aGlzLnJlbmRlckFsbCgpOwogICAgICB0aGlzLmZpcmUoJ29iamVjdDpzZWxlY3RlZCcsIHsKICAgICAgICB0YXJnZXQ6IG9iamVjdCwKICAgICAgICBlOiBlCiAgICAgIH0pOwogICAgICBvYmplY3QuZmlyZSgnc2VsZWN0ZWQnLCB7CiAgICAgICAgZTogZQogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjdXJyZW50bHkgYWN0aXZlIG9iamVjdAogICAgICogQG1ldGhvZCBnZXRBY3RpdmVPYmplY3QKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IGFjdGl2ZSBvYmplY3QKICAgICAqLwogICAgZ2V0QWN0aXZlT2JqZWN0OiBmdW5jdGlvbiBnZXRBY3RpdmVPYmplY3QoKSB7CiAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVPYmplY3Q7CiAgICB9LAoKICAgIC8qKgogICAgICogRGlzY2FyZHMgY3VycmVudGx5IGFjdGl2ZSBvYmplY3QKICAgICAqIEBtZXRob2QgZGlzY2FyZEFjdGl2ZU9iamVjdAogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBkaXNjYXJkQWN0aXZlT2JqZWN0OiBmdW5jdGlvbiBkaXNjYXJkQWN0aXZlT2JqZWN0KCkgewogICAgICBpZiAodGhpcy5fYWN0aXZlT2JqZWN0KSB7CiAgICAgICAgdGhpcy5fYWN0aXZlT2JqZWN0LnNldEFjdGl2ZShmYWxzZSk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2FjdGl2ZU9iamVjdCA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgYWN0aXZlIGdyb3VwIHRvIGEgc3BlaWNpZmllZCBvbmUKICAgICAqIEBtZXRob2Qgc2V0QWN0aXZlR3JvdXAKICAgICAqIEBwYXJhbSB7ZmFicmljLkdyb3VwfSBncm91cCBHcm91cCB0byBzZXQgYXMgYSBjdXJyZW50IG9uZQogICAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZXRBY3RpdmVHcm91cDogZnVuY3Rpb24gc2V0QWN0aXZlR3JvdXAoZ3JvdXApIHsKICAgICAgdGhpcy5fYWN0aXZlR3JvdXAgPSBncm91cDsKICAgICAgZ3JvdXAgJiYgZ3JvdXAuc2V0QWN0aXZlKHRydWUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGN1cnJlbnRseSBhY3RpdmUgZ3JvdXAKICAgICAqIEBtZXRob2QgZ2V0QWN0aXZlR3JvdXAKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5Hcm91cH0gQ3VycmVudCBncm91cAogICAgICovCiAgICBnZXRBY3RpdmVHcm91cDogZnVuY3Rpb24gZ2V0QWN0aXZlR3JvdXAoKSB7CiAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVHcm91cDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGN1cnJlbnRseSBhY3RpdmUgZ3JvdXAKICAgICAqIEBtZXRob2QgZGlzY2FyZEFjdGl2ZUdyb3VwCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKi8KICAgIGRpc2NhcmRBY3RpdmVHcm91cDogZnVuY3Rpb24gZGlzY2FyZEFjdGl2ZUdyb3VwKCkgewogICAgICB2YXIgZyA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKTsKCiAgICAgIGlmIChnKSB7CiAgICAgICAgZy5kZXN0cm95KCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLnNldEFjdGl2ZUdyb3VwKG51bGwpOwogICAgfSwKCiAgICAvKioKICAgICAqIERlYWN0aXZhdGVzIGFsbCBvYmplY3RzIGJ5IGNhbGxpbmcgdGhlaXIgc2V0QWN0aXZlKGZhbHNlKQogICAgICogQG1ldGhvZCBkZWFjdGl2YXRlQWxsCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKi8KICAgIGRlYWN0aXZhdGVBbGw6IGZ1bmN0aW9uIGRlYWN0aXZhdGVBbGwoKSB7CiAgICAgIHZhciBhbGxPYmplY3RzID0gdGhpcy5nZXRPYmplY3RzKCksCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGxlbiA9IGFsbE9iamVjdHMubGVuZ3RoOwoKICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGFsbE9iamVjdHNbaV0uc2V0QWN0aXZlKGZhbHNlKTsKICAgICAgfQoKICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTsKICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIERlYWN0aXZhdGVzIGFsbCBvYmplY3RzIGFuZCBkaXNwYXRjaGVzIGFwcHJvcHJpYXRlIGV2ZW50cwogICAgICogQG1ldGhvZCBkZWFjdGl2YXRlQWxsV2l0aERpc3BhdGNoCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICAgKi8KICAgIGRlYWN0aXZhdGVBbGxXaXRoRGlzcGF0Y2g6IGZ1bmN0aW9uIGRlYWN0aXZhdGVBbGxXaXRoRGlzcGF0Y2goKSB7CiAgICAgIHZhciBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCkgfHwgdGhpcy5nZXRBY3RpdmVPYmplY3QoKTsKCiAgICAgIGlmIChhY3RpdmVPYmplY3QpIHsKICAgICAgICB0aGlzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsKICAgICAgICAgIHRhcmdldDogYWN0aXZlT2JqZWN0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZGVhY3RpdmF0ZUFsbCgpOwoKICAgICAgaWYgKGFjdGl2ZU9iamVjdCkgewogICAgICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNsZWFyZWQnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS50b1N0cmluZyA9IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnRvU3RyaW5nOwogIGV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwgSW50ZXJhY3RpdmVNZXRob2RzKTsgLy8gaXRlcmF0aW5nIG1hbnVhbGx5IHRvIHdvcmthcm91bmQgT3BlcmEncyBidWcKICAvLyB3aGVyZSAicHJvdG90eXBlIiBwcm9wZXJ0eSBpcyBlbnVtZXJhYmxlIGFuZCBvdmVycmlkZXMgZXhpc3RpbmcgcHJvdG90eXBlCgogIGZvciAodmFyIHByb3AgaW4gZmFicmljLlN0YXRpY0NhbnZhcykgewogICAgaWYgKHByb3AgIT09ICdwcm90b3R5cGUnKSB7CiAgICAgIGZhYnJpYy5DYW52YXNbcHJvcF0gPSBmYWJyaWMuU3RhdGljQ2FudmFzW3Byb3BdOwogICAgfQogIH0KCiAgaWYgKGZhYnJpYy5pc1RvdWNoU3VwcG9ydGVkKSB7CiAgICBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2V0Q3Vyc29yRnJvbUV2ZW50ID0gZnVuY3Rpb24gKCkge307CiAgfQogIC8qKgogICAqIEBjbGFzcyBmYWJyaWMuRWxlbWVudAogICAqIEBhbGlhcyBmYWJyaWMuQ2FudmFzCiAgICogQGRlcHJlY2F0ZWQKICAgKiBAY29uc3RydWN0b3IKICAgKi8KCgogIGZhYnJpYy5FbGVtZW50ID0gZmFicmljLkNhbnZhczsKfSkoKTsKCmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHsKICBGWF9EVVJBVElPTjogNTAwLAoKICAvKioKICAgKiBDZW50ZXJzIG9iamVjdCBob3Jpem9udGFsbHkgd2l0aCBhbmltYXRpb24uCiAgICogQG1ldGhvZCBmeENlbnRlck9iamVjdEgKICAgKiBAcGFyYW0ge2ZhYnJpYy5PYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY2VudGVyCiAgICogQHBhcmFtIHtPYmplY3R9IFtjYWxsYmFja3NdIENhbGxiYWNrcyBvYmplY3Qgd2l0aCBvcHRpb25hbCAib25Db21wbGV0ZSIgYW5kL29yICJvbkNoYW5nZSIgcHJvcGVydGllcwogICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmcKICAgKiBAY2hhaW5hYmxlCiAgICovCiAgZnhDZW50ZXJPYmplY3RIOiBmdW5jdGlvbiBmeENlbnRlck9iamVjdEgob2JqZWN0LCBjYWxsYmFja3MpIHsKICAgIGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTsKCiAgICB2YXIgZW1wdHkgPSBmdW5jdGlvbiBlbXB0eSgpIHt9LAogICAgICAgIF9vbkNvbXBsZXRlID0gY2FsbGJhY2tzLm9uQ29tcGxldGUgfHwgZW1wdHksCiAgICAgICAgX29uQ2hhbmdlID0gY2FsbGJhY2tzLm9uQ2hhbmdlIHx8IGVtcHR5LAogICAgICAgIF90aGlzID0gdGhpczsKCiAgICBmYWJyaWMudXRpbC5hbmltYXRlKHsKICAgICAgc3RhcnRWYWx1ZTogb2JqZWN0LmdldCgnbGVmdCcpLAogICAgICBlbmRWYWx1ZTogdGhpcy5nZXRDZW50ZXIoKS5sZWZ0LAogICAgICBkdXJhdGlvbjogdGhpcy5GWF9EVVJBVElPTiwKICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHZhbHVlKSB7CiAgICAgICAgb2JqZWN0LnNldCgnbGVmdCcsIHZhbHVlKTsKCiAgICAgICAgX3RoaXMucmVuZGVyQWxsKCk7CgogICAgICAgIF9vbkNoYW5nZSgpOwogICAgICB9LAogICAgICBvbkNvbXBsZXRlOiBmdW5jdGlvbiBvbkNvbXBsZXRlKCkgewogICAgICAgIG9iamVjdC5zZXRDb29yZHMoKTsKCiAgICAgICAgX29uQ29tcGxldGUoKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdGhpczsKICB9LAoKICAvKioKICAgKiBDZW50ZXJzIG9iamVjdCB2ZXJ0aWNhbGx5IHdpdGggYW5pbWF0aW9uLgogICAqIEBtZXRob2QgZnhDZW50ZXJPYmplY3RWCiAgICogQHBhcmFtIHtmYWJyaWMuT2JqZWN0fSBvYmplY3QgT2JqZWN0IHRvIGNlbnRlcgogICAqIEBwYXJhbSB7T2JqZWN0fSBbY2FsbGJhY2tzXSBDYWxsYmFja3Mgb2JqZWN0IHdpdGggb3B0aW9uYWwgIm9uQ29tcGxldGUiIGFuZC9vciAib25DaGFuZ2UiIHByb3BlcnRpZXMKICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICogQGNoYWluYWJsZQogICAqLwogIGZ4Q2VudGVyT2JqZWN0VjogZnVuY3Rpb24gZnhDZW50ZXJPYmplY3RWKG9iamVjdCwgY2FsbGJhY2tzKSB7CiAgICBjYWxsYmFja3MgPSBjYWxsYmFja3MgfHwge307CgogICAgdmFyIGVtcHR5ID0gZnVuY3Rpb24gZW1wdHkoKSB7fSwKICAgICAgICBfb25Db21wbGV0ZTIgPSBjYWxsYmFja3Mub25Db21wbGV0ZSB8fCBlbXB0eSwKICAgICAgICBfb25DaGFuZ2UyID0gY2FsbGJhY2tzLm9uQ2hhbmdlIHx8IGVtcHR5LAogICAgICAgIF90aGlzID0gdGhpczsKCiAgICBmYWJyaWMudXRpbC5hbmltYXRlKHsKICAgICAgc3RhcnRWYWx1ZTogb2JqZWN0LmdldCgndG9wJyksCiAgICAgIGVuZFZhbHVlOiB0aGlzLmdldENlbnRlcigpLnRvcCwKICAgICAgZHVyYXRpb246IHRoaXMuRlhfRFVSQVRJT04sCiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh2YWx1ZSkgewogICAgICAgIG9iamVjdC5zZXQoJ3RvcCcsIHZhbHVlKTsKCiAgICAgICAgX3RoaXMucmVuZGVyQWxsKCk7CgogICAgICAgIF9vbkNoYW5nZTIoKTsKICAgICAgfSwKICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24gb25Db21wbGV0ZSgpIHsKICAgICAgICBvYmplY3Quc2V0Q29vcmRzKCk7CgogICAgICAgIF9vbkNvbXBsZXRlMigpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAqIFNhbWUgYXMgYGZhYnJpYy5DYW52YXMjcmVtb3ZlYCBidXQgYW5pbWF0ZWQKICAgKiBAbWV0aG9kIGZ4UmVtb3ZlCiAgICogQHBhcmFtIHtmYWJyaWMuT2JqZWN0fSBvYmplY3QgT2JqZWN0IHRvIHJlbW92ZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrLCBpbnZva2VkIG9uIGVmZmVjdCBjb21wbGV0aW9uCiAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZwogICAqIEBjaGFpbmFibGUKICAgKi8KICBmeFJlbW92ZTogZnVuY3Rpb24gZnhSZW1vdmUob2JqZWN0LCBjYWxsYmFja3MpIHsKICAgIGNhbGxiYWNrcyA9IGNhbGxiYWNrcyB8fCB7fTsKCiAgICB2YXIgZW1wdHkgPSBmdW5jdGlvbiBlbXB0eSgpIHt9LAogICAgICAgIF9vbkNvbXBsZXRlMyA9IGNhbGxiYWNrcy5vbkNvbXBsZXRlIHx8IGVtcHR5LAogICAgICAgIF9vbkNoYW5nZTMgPSBjYWxsYmFja3Mub25DaGFuZ2UgfHwgZW1wdHksCiAgICAgICAgX3RoaXMgPSB0aGlzOwoKICAgIGZhYnJpYy51dGlsLmFuaW1hdGUoewogICAgICBzdGFydFZhbHVlOiBvYmplY3QuZ2V0KCdvcGFjaXR5JyksCiAgICAgIGVuZFZhbHVlOiAwLAogICAgICBkdXJhdGlvbjogdGhpcy5GWF9EVVJBVElPTiwKICAgICAgb25TdGFydDogZnVuY3Rpb24gb25TdGFydCgpIHsKICAgICAgICBvYmplY3Quc2V0QWN0aXZlKGZhbHNlKTsKICAgICAgfSwKICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHZhbHVlKSB7CiAgICAgICAgb2JqZWN0LnNldCgnb3BhY2l0eScsIHZhbHVlKTsKCiAgICAgICAgX3RoaXMucmVuZGVyQWxsKCk7CgogICAgICAgIF9vbkNoYW5nZTMoKTsKICAgICAgfSwKICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24gb25Db21wbGV0ZSgpIHsKICAgICAgICBfdGhpcy5yZW1vdmUob2JqZWN0KTsKCiAgICAgICAgX29uQ29tcGxldGUzKCk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHRoaXM7CiAgfQp9KTsKZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwgewogIC8qKgogICAqIFBvcHVsYXRlcyBjYW52YXMgd2l0aCBkYXRhIGZyb20gdGhlIHNwZWNpZmllZCBkYXRhbGVzcyBKU09OCiAgICogSlNPTiBmb3JtYXQgbXVzdCBjb25mb3JtIHRvIHRoZSBvbmUgb2YgYGZhYnJpYy5DYW52YXMjdG9EYXRhbGVzc0pTT05gCiAgICogQG1ldGhvZCBsb2FkRnJvbURhdGFsZXNzSlNPTgogICAqIEBwYXJhbSB7U3RyaW5nfSBqc29uIEpTT04gc3RyaW5nCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2ssIGludm9rZWQgd2hlbiBqc29uIGlzIHBhcnNlZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBjb3JyZXNwb25kaW5nIG9iamVjdHMgKGUuZzogZmFicmljLkltYWdlKQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZSBpbml0aWFsaXplZAogICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IGluc3RhbmNlCiAgICogQGNoYWluYWJsZQogICAqLwogIGxvYWRGcm9tRGF0YWxlc3NKU09OOiBmdW5jdGlvbiBsb2FkRnJvbURhdGFsZXNzSlNPTihqc29uLCBjYWxsYmFjaykgewogICAgaWYgKCFqc29uKSB7CiAgICAgIHJldHVybjsKICAgIH0gLy8gc2VyaWFsaXplIGlmIGl0IHdhc24ndCBhbHJlYWR5CgoKICAgIHZhciBzZXJpYWxpemVkID0gdHlwZW9mIGpzb24gPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShqc29uKSA6IGpzb247CiAgICBpZiAoIXNlcmlhbGl6ZWQgfHwgc2VyaWFsaXplZCAmJiAhc2VyaWFsaXplZC5vYmplY3RzKSByZXR1cm47CiAgICB0aGlzLmNsZWFyKCk7IC8vIFRPRE86IHRlc3QgdGhpcwoKICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gc2VyaWFsaXplZC5iYWNrZ3JvdW5kOwoKICAgIHRoaXMuX2VubGl2ZW5EYXRhbGVzc09iamVjdHMoc2VyaWFsaXplZC5vYmplY3RzLCBjYWxsYmFjayk7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCBfZW5saXZlbkRhdGFsZXNzT2JqZWN0cwogICAqIEBwYXJhbSB7QXJyYXl9IG9iamVjdHMKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAqLwogIF9lbmxpdmVuRGF0YWxlc3NPYmplY3RzOiBmdW5jdGlvbiBfZW5saXZlbkRhdGFsZXNzT2JqZWN0cyhvYmplY3RzLCBjYWxsYmFjaykgewogICAgLyoqIEBpZ25vcmUgKi8KICAgIGZ1bmN0aW9uIG9uT2JqZWN0TG9hZGVkKG9iamVjdCwgaW5kZXgpIHsKICAgICAgX3RoaXMuaW5zZXJ0QXQob2JqZWN0LCBpbmRleCwgdHJ1ZSk7CgogICAgICBvYmplY3Quc2V0Q29vcmRzKCk7CgogICAgICBpZiAoKytudW1Mb2FkZWRPYmplY3RzID09PSBudW1Ub3RhbE9iamVjdHMpIHsKICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpOwogICAgICB9CiAgICB9CgogICAgdmFyIF90aGlzID0gdGhpcywKICAgICAgICBudW1Mb2FkZWRPYmplY3RzID0gMCwKICAgICAgICBudW1Ub3RhbE9iamVjdHMgPSBvYmplY3RzLmxlbmd0aDsKCiAgICBpZiAobnVtVG90YWxPYmplY3RzID09PSAwICYmIGNhbGxiYWNrKSB7CiAgICAgIGNhbGxiYWNrKCk7CiAgICB9CgogICAgdHJ5IHsKICAgICAgb2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uIChvYmosIGluZGV4KSB7CiAgICAgICAgdmFyIHBhdGhQcm9wID0gb2JqLnBhdGhzID8gJ3BhdGhzJyA6ICdwYXRoJzsKICAgICAgICB2YXIgcGF0aCA9IG9ialtwYXRoUHJvcF07CiAgICAgICAgZGVsZXRlIG9ialtwYXRoUHJvcF07CgogICAgICAgIGlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgIHN3aXRjaCAob2JqLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnaW1hZ2UnOgogICAgICAgICAgICAgIGZhYnJpY1tmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShvYmoudHlwZSldLmZyb21PYmplY3Qob2JqLCBmdW5jdGlvbiAobykgewogICAgICAgICAgICAgICAgb25PYmplY3RMb2FkZWQobywgaW5kZXgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB2YXIga2xhc3MgPSBmYWJyaWNbZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKG9iai50eXBlKSldOwoKICAgICAgICAgICAgICBpZiAoa2xhc3MgJiYga2xhc3MuZnJvbU9iamVjdCkgewogICAgICAgICAgICAgICAgLy8gcmVzdG9yZSBwYXRoCiAgICAgICAgICAgICAgICBpZiAocGF0aCkgewogICAgICAgICAgICAgICAgICBvYmpbcGF0aFByb3BdID0gcGF0aDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvbk9iamVjdExvYWRlZChrbGFzcy5mcm9tT2JqZWN0KG9iaiksIGluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAob2JqLnR5cGUgPT09ICdpbWFnZScpIHsKICAgICAgICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHBhdGgsIGZ1bmN0aW9uIChpbWFnZSkgewogICAgICAgICAgICAgIHZhciBvSW1nID0gbmV3IGZhYnJpYy5JbWFnZShpbWFnZSk7CiAgICAgICAgICAgICAgb0ltZy5zZXRTb3VyY2VQYXRoKHBhdGgpOwogICAgICAgICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob0ltZywgb2JqKTsKICAgICAgICAgICAgICBvSW1nLnNldEFuZ2xlKG9iai5hbmdsZSk7CiAgICAgICAgICAgICAgb25PYmplY3RMb2FkZWQob0ltZywgaW5kZXgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAob2JqLnR5cGUgPT09ICd0ZXh0JykgewogICAgICAgICAgICBpZiAob2JqLnVzZU5hdGl2ZSkgewogICAgICAgICAgICAgIG9uT2JqZWN0TG9hZGVkKGZhYnJpYy5UZXh0LmZyb21PYmplY3Qob2JqKSwgaW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG9iai5wYXRoID0gcGF0aDsKICAgICAgICAgICAgICB2YXIgb2JqZWN0ID0gZmFicmljLlRleHQuZnJvbU9iamVjdChvYmopOwoKICAgICAgICAgICAgICB2YXIgb25zY3JpcHRsb2FkID0gZnVuY3Rpb24gb25zY3JpcHRsb2FkKCkgewogICAgICAgICAgICAgICAgLy8gVE9ETyAoa2FuZ2F4KTogZmluZCBvdXQgd2h5IE9wZXJhIHJlZnVzZXMgdG8gd29yayB3aXRob3V0IHRoaXMgdGltZW91dAogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChmYWJyaWMud2luZG93Lm9wZXJhKSA9PT0gJ1tvYmplY3QgT3BlcmFdJykgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBvbk9iamVjdExvYWRlZChvYmplY3QsIGluZGV4KTsKICAgICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG9uT2JqZWN0TG9hZGVkKG9iamVjdCwgaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGZhYnJpYy51dGlsLmdldFNjcmlwdChwYXRoLCBvbnNjcmlwdGxvYWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmYWJyaWMubG9hZFNWR0Zyb21VUkwocGF0aCwgZnVuY3Rpb24gKGVsZW1lbnRzLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IGZhYnJpYy51dGlsLmdyb3VwU1ZHRWxlbWVudHMoZWxlbWVudHMsIG9iaiwgcGF0aCk7IC8vIGNvcHkgcGFyYW1ldGVycyBmcm9tIHNlcmlhbGllZCBqc29uIHRvIG9iamVjdCAobGVmdCwgdG9wLCBzY2FsZVgsIHNjYWxlWSwgZXRjLikKICAgICAgICAgICAgICAvLyBza2lwIHRoaXMgc3RlcCBpZiBhbiBvYmplY3QgaXMgYSBQYXRoR3JvdXAsIHNpbmNlIHdlIGFscmVhZHkgcGFzc2VkIGl0IG9wdGlvbnMgb2JqZWN0IGJlZm9yZQoKICAgICAgICAgICAgICBpZiAoIShvYmplY3QgaW5zdGFuY2VvZiBmYWJyaWMuUGF0aEdyb3VwKSkgewogICAgICAgICAgICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvYmplY3QsIG9iaik7CgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmouYW5nbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgIG9iamVjdC5zZXRBbmdsZShvYmouYW5nbGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgb25PYmplY3RMb2FkZWQob2JqZWN0LCBpbmRleCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgdGhpcyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGZhYnJpYy5sb2coZS5tZXNzYWdlKTsKICAgIH0KICB9LAoKICAvKioKICAgKiBQb3B1bGF0ZXMgY2FudmFzIHdpdGggZGF0YSBmcm9tIHRoZSBzcGVjaWZpZWQgSlNPTgogICAqIEpTT04gZm9ybWF0IG11c3QgY29uZm9ybSB0byB0aGUgb25lIG9mIGBmYWJyaWMuQ2FudmFzI3RvSlNPTmAKICAgKiBAbWV0aG9kIGxvYWRGcm9tSlNPTgogICAqIEBwYXJhbSB7U3RyaW5nfSBqc29uIEpTT04gc3RyaW5nCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2ssIGludm9rZWQgd2hlbiBqc29uIGlzIHBhcnNlZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBjb3JyZXNwb25kaW5nIG9iamVjdHMgKGUuZzogZmFicmljLkltYWdlKQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZSBpbml0aWFsaXplZAogICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IGluc3RhbmNlCiAgICogQGNoYWluYWJsZQogICAqLwogIGxvYWRGcm9tSlNPTjogZnVuY3Rpb24gbG9hZEZyb21KU09OKGpzb24sIGNhbGxiYWNrKSB7CiAgICBpZiAoIWpzb24pIHJldHVybjsKICAgIHZhciBzZXJpYWxpemVkID0gSlNPTi5wYXJzZShqc29uKTsKICAgIGlmICghc2VyaWFsaXplZCB8fCBzZXJpYWxpemVkICYmICFzZXJpYWxpemVkLm9iamVjdHMpIHJldHVybjsKICAgIHRoaXMuY2xlYXIoKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHRoaXMuX2VubGl2ZW5PYmplY3RzKHNlcmlhbGl6ZWQub2JqZWN0cywgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBzZXJpYWxpemVkLmJhY2tncm91bmQ7CgogICAgICBpZiAoc2VyaWFsaXplZC5iYWNrZ3JvdW5kSW1hZ2UpIHsKICAgICAgICBfdGhpcy5zZXRCYWNrZ3JvdW5kSW1hZ2Uoc2VyaWFsaXplZC5iYWNrZ3JvdW5kSW1hZ2UsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLmJhY2tncm91bmRJbWFnZU9wYWNpdHkgPSBzZXJpYWxpemVkLmJhY2tncm91bmRJbWFnZU9wYWNpdHk7CiAgICAgICAgICBfdGhpcy5iYWNrZ3JvdW5kSW1hZ2VTdHJldGNoID0gc2VyaWFsaXplZC5iYWNrZ3JvdW5kSW1hZ2VTdHJldGNoOwoKICAgICAgICAgIF90aGlzLnJlbmRlckFsbCgpOwoKICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsKICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIHRoaXM7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCBfZW5saXZlbk9iamVjdHMKICAgKiBAcGFyYW0ge0FycmF5fSBvYmplY3RzCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgKi8KICBfZW5saXZlbk9iamVjdHM6IGZ1bmN0aW9uIF9lbmxpdmVuT2JqZWN0cyhvYmplY3RzLCBjYWxsYmFjaykgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBmYWJyaWMudXRpbC5lbmxpdmVuT2JqZWN0cyhvYmplY3RzLCBmdW5jdGlvbiAoZW5saXZlbmVkT2JqZWN0cykgewogICAgICBlbmxpdmVuZWRPYmplY3RzLmZvckVhY2goZnVuY3Rpb24gKG9iaiwgaW5kZXgpIHsKICAgICAgICBfdGhpcy5pbnNlcnRBdChvYmosIGluZGV4LCB0cnVlKTsKICAgICAgfSk7CiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICB9KTsKICB9LAoKICAvKioKICAgKiBAcHJpdmF0ZQogICAqIEBtZXRob2QgX3RvRGF0YVVSTAogICAqIEBwYXJhbSB7U3RyaW5nfSBmb3JtYXQKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawogICAqLwogIF90b0RhdGFVUkw6IGZ1bmN0aW9uIF90b0RhdGFVUkwoZm9ybWF0LCBjYWxsYmFjaykgewogICAgdGhpcy5jbG9uZShmdW5jdGlvbiAoY2xvbmUpIHsKICAgICAgY2FsbGJhY2soY2xvbmUudG9EYXRhVVJMKGZvcm1hdCkpOwogICAgfSk7CiAgfSwKCiAgLyoqCiAgICogQHByaXZhdGUKICAgKiBAbWV0aG9kIF90b0RhdGFVUkxXaXRoTXVsdGlwbGllcgogICAqIEBwYXJhbSB7U3RyaW5nfSBmb3JtYXQKICAgKiBAcGFyYW0ge051bWJlcn0gbXVsdGlwbGllcgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICovCiAgX3RvRGF0YVVSTFdpdGhNdWx0aXBsaWVyOiBmdW5jdGlvbiBfdG9EYXRhVVJMV2l0aE11bHRpcGxpZXIoZm9ybWF0LCBtdWx0aXBsaWVyLCBjYWxsYmFjaykgewogICAgdGhpcy5jbG9uZShmdW5jdGlvbiAoY2xvbmUpIHsKICAgICAgY2FsbGJhY2soY2xvbmUudG9EYXRhVVJMV2l0aE11bHRpcGxpZXIoZm9ybWF0LCBtdWx0aXBsaWVyKSk7CiAgICB9KTsKICB9LAoKICAvKioKICAgKiBDbG9uZXMgY2FudmFzIGluc3RhbmNlCiAgICogQG1ldGhvZCBjbG9uZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbY2FsbGJhY2tdIFJlY2VpdmVzIGNsb25lZCBpbnN0YW5jZSBhcyBhIGZpcnN0IGFyZ3VtZW50CiAgICovCiAgY2xvbmU6IGZ1bmN0aW9uIGNsb25lKGNhbGxiYWNrKSB7CiAgICB2YXIgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMpOwogICAgdGhpcy5jbG9uZVdpdGhvdXREYXRhKGZ1bmN0aW9uIChjbG9uZSkgewogICAgICBjbG9uZS5sb2FkRnJvbUpTT04oZGF0YSwgZnVuY3Rpb24gKCkgewogICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGNsb25lKTsKICAgICAgfSk7CiAgICB9KTsKICB9LAoKICAvKioKICAgKiBDbG9uZXMgY2FudmFzIGluc3RhbmNlIHdpdGhvdXQgY2xvbmluZyBleGlzdGluZyBkYXRhLgogICAqIFRoaXMgZXNzZW50aWFsbHkgY29waWVzIGNhbnZhcyBkaW1lbnNpb25zLCBjbGlwcGluZyBwcm9wZXJ0aWVzLCBldGMuCiAgICogYnV0IGxlYXZlcyBkYXRhIGVtcHR5IChzbyB0aGF0IHlvdSBjYW4gcG9wdWxhdGUgaXQgd2l0aCB5b3VyIG93bikKICAgKiBAbWV0aG9kIGNsb25lV2l0aG91dERhdGEKICAgKiBAcGFyYW0ge09iamVjdH0gW2NhbGxiYWNrXSBSZWNlaXZlcyBjbG9uZWQgaW5zdGFuY2UgYXMgYSBmaXJzdCBhcmd1bWVudAogICAqLwogIGNsb25lV2l0aG91dERhdGE6IGZ1bmN0aW9uIGNsb25lV2l0aG91dERhdGEoY2FsbGJhY2spIHsKICAgIHZhciBlbCA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIGVsLndpZHRoID0gdGhpcy5nZXRXaWR0aCgpOwogICAgZWwuaGVpZ2h0ID0gdGhpcy5nZXRIZWlnaHQoKTsKICAgIHZhciBjbG9uZSA9IG5ldyBmYWJyaWMuQ2FudmFzKGVsKTsKICAgIGNsb25lLmNsaXBUbyA9IHRoaXMuY2xpcFRvOwoKICAgIGlmICh0aGlzLmJhY2tncm91bmRJbWFnZSkgewogICAgICBjbG9uZS5zZXRCYWNrZ3JvdW5kSW1hZ2UodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc3JjLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgY2xvbmUucmVuZGVyQWxsKCk7CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soY2xvbmUpOwogICAgICB9KTsKICAgICAgY2xvbmUuYmFja2dyb3VuZEltYWdlT3BhY2l0eSA9IHRoaXMuYmFja2dyb3VuZEltYWdlT3BhY2l0eTsKICAgICAgY2xvbmUuYmFja2dyb3VuZEltYWdlU3RyZXRjaCA9IHRoaXMuYmFja2dyb3VuZEltYWdlU3RyZXRjaDsKICAgIH0gZWxzZSB7CiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGNsb25lKTsKICAgIH0KICB9Cn0pOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBmYWJyaWMgPSBnbG9iYWwuZmFicmljIHx8IChnbG9iYWwuZmFicmljID0ge30pLAogICAgICBleHRlbmQgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kLAogICAgICBjbG9uZSA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZSwKICAgICAgdG9GaXhlZCA9IGZhYnJpYy51dGlsLnRvRml4ZWQsCiAgICAgIGNhcGl0YWxpemUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSwKICAgICAgZ2V0UG9pbnRlciA9IGZhYnJpYy51dGlsLmdldFBvaW50ZXIsCiAgICAgIGRlZ3JlZXNUb1JhZGlhbnMgPSBmYWJyaWMudXRpbC5kZWdyZWVzVG9SYWRpYW5zLAogICAgICBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCiAgaWYgKGZhYnJpYy5PYmplY3QpIHsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIE9iamVjdAogICAqIEBtZW1iZXJPZiBmYWJyaWMKICAgKi8KCgogIGZhYnJpYy5PYmplY3QgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcygKICAvKiogQHNjb3BlIGZhYnJpYy5PYmplY3QucHJvdG90eXBlICovCiAgewogICAgLyoqCiAgICAgKiBUeXBlIG9mIGFuIG9iamVjdCAocmVjdCwgY2lyY2xlLCBwYXRoLCBldGMpCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICB0eXBlOiAnb2JqZWN0JywKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIHRvcDogMCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIGxlZnQ6IDAsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIE51bWJlcgogICAgICovCiAgICB3aWR0aDogMCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIGhlaWdodDogMCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIHNjYWxlWDogMSwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIHNjYWxlWTogMSwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBmbGlwWDogZmFsc2UsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgZmxpcFk6IGZhbHNlLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgb3BhY2l0eTogMSwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIGFuZ2xlOiAwLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgY29ybmVyc2l6ZTogMTIsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgdHJhbnNwYXJlbnRDb3JuZXJzOiB0cnVlLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgcGFkZGluZzogMCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIGJvcmRlckNvbG9yOiAncmdiYSgxMDIsMTUzLDI1NSwwLjc1KScsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBjb3JuZXJDb2xvcjogJ3JnYmEoMTAyLDE1MywyNTUsMC41KScsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBmaWxsOiAncmdiKDAsMCwwKScsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBmaWxsUnVsZTogJ3NvdXJjZS1vdmVyJywKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIG92ZXJsYXlGaWxsOiBudWxsLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgc3Ryb2tlOiBudWxsLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgc3Ryb2tlV2lkdGg6IDEsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIEFycmF5CiAgICAgKi8KICAgIHN0cm9rZURhc2hBcnJheTogbnVsbCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIGJvcmRlck9wYWNpdHlXaGVuTW92aW5nOiAwLjQsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIE51bWJlcgogICAgICovCiAgICBib3JkZXJTY2FsZUZhY3RvcjogMSwKCiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBtYXRyaXgKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQXJyYXkKICAgICAqLwogICAgdHJhbnNmb3JtTWF0cml4OiBudWxsLAoKICAgIC8qKgogICAgICogV2hlbiBzZXQgdG8gYGZhbHNlYCwgYW4gb2JqZWN0IGNhbiBub3QgYmUgc2VsZWN0ZWQgZm9yIG1vZGlmaWNhdGlvbiAodXNpbmcgZWl0aGVyIHBvaW50LWNsaWNrLWJhc2VkIG9yIGdyb3VwLWJhc2VkIHNlbGVjdGlvbikKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBzZWxlY3RhYmxlOiB0cnVlLAoKICAgIC8qKgogICAgICogV2hlbiBzZXQgdG8gYGZhbHNlYCwgb2JqZWN0J3MgY29udHJvbHMgYXJlIG5vdCBkaXNwbGF5ZWQgYW5kIGNhbiBub3QgYmUgdXNlZCB0byBtYW5pcHVsYXRlIG9iamVjdAogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIGhhc0NvbnRyb2xzOiB0cnVlLAoKICAgIC8qKgogICAgICogV2hlbiBzZXQgdG8gYGZhbHNlYCwgb2JqZWN0J3MgYm9yZGVycyBhcmUgbm90IHJlbmRlcmVkCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIEJvb2xlYW4KICAgICAqLwogICAgaGFzQm9yZGVyczogdHJ1ZSwKCiAgICAvKioKICAgICAqIFdoZW4gc2V0IHRvIGBmYWxzZWAsIG9iamVjdCdzIHJvdGF0aW5nIHBvaW50IHdpbGwgbm90IGJlIHZpc2libGUgb3Igc2VsZWN0YWJsZQogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIGhhc1JvdGF0aW5nUG9pbnQ6IGZhbHNlLAoKICAgIC8qKgogICAgICogT2Zmc2V0IGZvciBvYmplY3QncyByb3RhdGluZyBwb2ludCAod2hlbiBlbmFibGVkKQogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgcm90YXRpbmdQb2ludE9mZnNldDogNDAsCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgX3RoZXRhOiAwLAogICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiBmYWxzZSwKICAgIGluY2x1ZGVEZWZhdWx0VmFsdWVzOiB0cnVlLAoKICAgIC8qKgogICAgICogTGlzdCBvZiBwcm9wZXJ0aWVzIHRvIGNvbnNpZGVyIHdoZW4gY2hlY2tpbmcgaWYgc3RhdGUgb2YgYW4gb2JqZWN0IGlzIGNoYW5nZWQgKGZhYnJpYy5PYmplY3QjaGFzU3RhdGVDaGFuZ2VkKTsKICAgICAqIGFzIHdlbGwgYXMgZm9yIGhpc3RvcnkgKHVuZG8vcmVkbykgcHVycG9zZXMKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQXJyYXkKICAgICAqLwogICAgc3RhdGVQcm9wZXJ0aWVzOiAoJ3RvcCBsZWZ0IHdpZHRoIGhlaWdodCBzY2FsZVggc2NhbGVZIGZsaXBYIGZsaXBZICcgKyAndGhldGEgYW5nbGUgb3BhY2l0eSBjb3JuZXJzaXplIGZpbGwgb3ZlcmxheUZpbGwgJyArICdzdHJva2Ugc3Ryb2tlV2lkdGggc3Ryb2tlRGFzaEFycmF5IGZpbGxSdWxlICcgKyAnYm9yZGVyU2NhbGVGYWN0b3IgdHJhbnNmb3JtTWF0cml4IHNlbGVjdGFibGUnKS5zcGxpdCgnICcpLAoKICAgIC8qKgogICAgICogQG1ldGhvZCBjYWxsU3VwZXIKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2ROYW1lCiAgICAgKi8KICAgIGNhbGxTdXBlcjogZnVuY3Rpb24gY2FsbFN1cGVyKG1ldGhvZE5hbWUpIHsKICAgICAgdmFyIGZuID0gdGhpcy5jb25zdHJ1Y3Rvci5zdXBlcmNsYXNzLnByb3RvdHlwZVttZXRob2ROYW1lXTsKICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gZm4uYXBwbHkodGhpcywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSA6IGZuLmNhbGwodGhpcyk7CiAgICB9LAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IKICAgICAqIEBtZXRob2QgaW5pdGlhbGl6ZQogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAgICovCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CgogICAgICAgIHRoaXMuX2luaXRHcmFkaWVudChvcHRpb25zKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2QgaW5pdEdyYWRpZW50CiAgICAgKi8KICAgIF9pbml0R3JhZGllbnQ6IGZ1bmN0aW9uIF9pbml0R3JhZGllbnQob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucy5maWxsICYmIF90eXBlb2Yob3B0aW9ucy5maWxsKSA9PSAnb2JqZWN0JyAmJiAhKG9wdGlvbnMuZmlsbCBpbnN0YW5jZW9mIGZhYnJpYy5HcmFkaWVudCkpIHsKICAgICAgICB0aGlzLnNldCgnZmlsbCcsIG5ldyBmYWJyaWMuR3JhZGllbnQob3B0aW9ucy5maWxsKSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIHNldE9wdGlvbnMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgICAqLwogICAgc2V0T3B0aW9uczogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgIHZhciBpID0gdGhpcy5zdGF0ZVByb3BlcnRpZXMubGVuZ3RoLAogICAgICAgICAgcHJvcDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBwcm9wID0gdGhpcy5zdGF0ZVByb3BlcnRpZXNbaV07CgogICAgICAgIGlmIChwcm9wIGluIG9wdGlvbnMpIHsKICAgICAgICAgIHRoaXMuc2V0KHByb3AsIG9wdGlvbnNbcHJvcF0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2QgdHJhbnNmb3JtCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQKICAgICAqLwogICAgdHJhbnNmb3JtOiBmdW5jdGlvbiB0cmFuc2Zvcm0oY3R4KSB7CiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMub3BhY2l0eTsKICAgICAgY3R4LnRyYW5zbGF0ZSh0aGlzLmxlZnQsIHRoaXMudG9wKTsKICAgICAgY3R4LnJvdGF0ZSh0aGlzLl90aGV0YSk7CiAgICAgIGN0eC5zY2FsZSh0aGlzLnNjYWxlWCAqICh0aGlzLmZsaXBYID8gLTEgOiAxKSwgdGhpcy5zY2FsZVkgKiAodGhpcy5mbGlwWSA/IC0xIDogMSkpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvT2JqZWN0CiAgICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICAgKi8KICAgIHRvT2JqZWN0OiBmdW5jdGlvbiB0b09iamVjdCgpIHsKICAgICAgdmFyIE5VTV9GUkFDVElPTl9ESUdJVFMgPSBmYWJyaWMuT2JqZWN0Lk5VTV9GUkFDVElPTl9ESUdJVFM7CiAgICAgIHZhciBvYmplY3QgPSB7CiAgICAgICAgdHlwZTogdGhpcy50eXBlLAogICAgICAgIGxlZnQ6IHRvRml4ZWQodGhpcy5sZWZ0LCBOVU1fRlJBQ1RJT05fRElHSVRTKSwKICAgICAgICB0b3A6IHRvRml4ZWQodGhpcy50b3AsIE5VTV9GUkFDVElPTl9ESUdJVFMpLAogICAgICAgIHdpZHRoOiB0b0ZpeGVkKHRoaXMud2lkdGgsIE5VTV9GUkFDVElPTl9ESUdJVFMpLAogICAgICAgIGhlaWdodDogdG9GaXhlZCh0aGlzLmhlaWdodCwgTlVNX0ZSQUNUSU9OX0RJR0lUUyksCiAgICAgICAgZmlsbDogdGhpcy5maWxsICYmIHRoaXMuZmlsbC50b09iamVjdCA/IHRoaXMuZmlsbC50b09iamVjdCgpIDogdGhpcy5maWxsLAogICAgICAgIG92ZXJsYXlGaWxsOiB0aGlzLm92ZXJsYXlGaWxsLAogICAgICAgIHN0cm9rZTogdGhpcy5zdHJva2UsCiAgICAgICAgc3Ryb2tlV2lkdGg6IHRoaXMuc3Ryb2tlV2lkdGgsCiAgICAgICAgc3Ryb2tlRGFzaEFycmF5OiB0aGlzLnN0cm9rZURhc2hBcnJheSwKICAgICAgICBzY2FsZVg6IHRvRml4ZWQodGhpcy5zY2FsZVgsIE5VTV9GUkFDVElPTl9ESUdJVFMpLAogICAgICAgIHNjYWxlWTogdG9GaXhlZCh0aGlzLnNjYWxlWSwgTlVNX0ZSQUNUSU9OX0RJR0lUUyksCiAgICAgICAgYW5nbGU6IHRvRml4ZWQodGhpcy5nZXRBbmdsZSgpLCBOVU1fRlJBQ1RJT05fRElHSVRTKSwKICAgICAgICBmbGlwWDogdGhpcy5mbGlwWCwKICAgICAgICBmbGlwWTogdGhpcy5mbGlwWSwKICAgICAgICBvcGFjaXR5OiB0b0ZpeGVkKHRoaXMub3BhY2l0eSwgTlVNX0ZSQUNUSU9OX0RJR0lUUyksCiAgICAgICAgc2VsZWN0YWJsZTogdGhpcy5zZWxlY3RhYmxlLAogICAgICAgIGhhc0NvbnRyb2xzOiB0aGlzLmhhc0NvbnRyb2xzLAogICAgICAgIGhhc0JvcmRlcnM6IHRoaXMuaGFzQm9yZGVycywKICAgICAgICBoYXNSb3RhdGluZ1BvaW50OiB0aGlzLmhhc1JvdGF0aW5nUG9pbnQsCiAgICAgICAgdHJhbnNwYXJlbnRDb3JuZXJzOiB0aGlzLnRyYW5zcGFyZW50Q29ybmVycywKICAgICAgICBwZXJQaXhlbFRhcmdldEZpbmQ6IHRoaXMucGVyUGl4ZWxUYXJnZXRGaW5kCiAgICAgIH07CgogICAgICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHsKICAgICAgICBvYmplY3QgPSB0aGlzLl9yZW1vdmVEZWZhdWx0VmFsdWVzKG9iamVjdCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyAoZGF0YWxlc3MpIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b0RhdGFsZXNzT2JqZWN0CiAgICAgKi8KICAgIHRvRGF0YWxlc3NPYmplY3Q6IGZ1bmN0aW9uIHRvRGF0YWxlc3NPYmplY3QoKSB7CiAgICAgIC8vIHdpbGwgYmUgb3ZlcndyaXR0ZW4gYnkgc3ViY2xhc3NlcwogICAgICByZXR1cm4gdGhpcy50b09iamVjdCgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3R5bGVzLXN0cmluZyBmb3Igc3ZnLWV4cG9ydAogICAgICogQG1ldGhvZCBnZXRTdmdTdHlsZXMKICAgICAqIEByZXR1cm4ge3N0cmluZ30KICAgICAqLwogICAgZ2V0U3ZnU3R5bGVzOiBmdW5jdGlvbiBnZXRTdmdTdHlsZXMoKSB7CiAgICAgIHJldHVybiBbInN0cm9rZTogIiwgdGhpcy5zdHJva2UgPyB0aGlzLnN0cm9rZSA6ICdub25lJywgIjsgIiwgInN0cm9rZS13aWR0aDogIiwgdGhpcy5zdHJva2VXaWR0aCA/IHRoaXMuc3Ryb2tlV2lkdGggOiAnMCcsICI7ICIsICJzdHJva2UtZGFzaGFycmF5OiAiLCB0aGlzLnN0cm9rZURhc2hBcnJheSA/IHRoaXMuc3Ryb2tlRGFzaEFycmF5LmpvaW4oJyAnKSA6ICI7ICIsICJmaWxsOiAiLCB0aGlzLmZpbGwgPyB0aGlzLmZpbGwgOiAnbm9uZScsICI7ICIsICJvcGFjaXR5OiAiLCB0aGlzLm9wYWNpdHkgPyB0aGlzLm9wYWNpdHkgOiAnMScsICI7Il0uam9pbigiIik7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyB0cmFuc2Zvcm0tc3RyaW5nIGZvciBzdmctZXhwb3J0CiAgICAgKiBAbWV0aG9kIGdldFN2Z1RyYW5zZm9ybQogICAgICogQHJldHVybiB7c3RyaW5nfQogICAgICovCiAgICBnZXRTdmdUcmFuc2Zvcm06IGZ1bmN0aW9uIGdldFN2Z1RyYW5zZm9ybSgpIHsKICAgICAgdmFyIGFuZ2xlID0gdGhpcy5nZXRBbmdsZSgpOwogICAgICByZXR1cm4gWyJ0cmFuc2xhdGUoIiwgdG9GaXhlZCh0aGlzLmxlZnQsIDIpLCAiICIsIHRvRml4ZWQodGhpcy50b3AsIDIpLCAiKSIsIGFuZ2xlICE9PSAwID8gIiByb3RhdGUoIiArIHRvRml4ZWQoYW5nbGUsIDIpICsgIikiIDogJycsIHRoaXMuc2NhbGVYID09PSAxICYmIHRoaXMuc2NhbGVZID09PSAxID8gJycgOiAiIHNjYWxlKCIgKyB0b0ZpeGVkKHRoaXMuc2NhbGVYLCAyKSArICIgIiArIHRvRml4ZWQodGhpcy5zY2FsZVksIDIpICsgIikiXS5qb2luKCcnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfcmVtb3ZlRGVmYXVsdFZhbHVlcwogICAgICovCiAgICBfcmVtb3ZlRGVmYXVsdFZhbHVlczogZnVuY3Rpb24gX3JlbW92ZURlZmF1bHRWYWx1ZXMob2JqZWN0KSB7CiAgICAgIHZhciBkZWZhdWx0T3B0aW9ucyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLm9wdGlvbnM7CgogICAgICBpZiAoZGVmYXVsdE9wdGlvbnMpIHsKICAgICAgICB0aGlzLnN0YXRlUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgICAgICBpZiAob2JqZWN0W3Byb3BdID09PSBkZWZhdWx0T3B0aW9uc1twcm9wXSkgewogICAgICAgICAgICBkZWxldGUgb2JqZWN0W3Byb3BdOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gb2JqZWN0OwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBhbiBvYmplY3QgaXMgaW4gaXRzIGFjdGl2ZSBzdGF0ZQogICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBhbiBvYmplY3QgaXMgaW4gaXRzIGFjdGl2ZSBzdGF0ZQogICAgICovCiAgICBpc0FjdGl2ZTogZnVuY3Rpb24gaXNBY3RpdmUoKSB7CiAgICAgIHJldHVybiAhIXRoaXMuYWN0aXZlOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgc3RhdGUgb2YgYW4gb2JqZWN0IC0gYHRydWVgIG1ha2VzIGl0IGFjdGl2ZSwgYGZhbHNlYCAtIGluYWN0aXZlCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGFjdGl2ZQogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZXRBY3RpdmU6IGZ1bmN0aW9uIHNldEFjdGl2ZShhY3RpdmUpIHsKICAgICAgdGhpcy5hY3RpdmUgPSAhIWFjdGl2ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQHJldHVybiB7U3RyaW5nfQogICAgICovCiAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiAiIzxmYWJyaWMuIiArIGNhcGl0YWxpemUodGhpcy50eXBlKSArICI+IjsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIHByb3BlcnR5IHRvIGEgZ2l2ZW4gdmFsdWUKICAgICAqIEBtZXRob2Qgc2V0CiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZQogICAgICogQHBhcmFtIHtPYmplY3R8RnVuY3Rpb259IHZhbHVlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewogICAgICBpZiAoX3R5cGVvZihrZXkpID09PSAnb2JqZWN0JykgewogICAgICAgIGZvciAodmFyIHByb3AgaW4ga2V5KSB7CiAgICAgICAgICB0aGlzLl9zZXQocHJvcCwga2V5W3Byb3BdKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUodGhpcy5nZXQoa2V5KSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBfc2V0OiBmdW5jdGlvbiBfc2V0KGtleSwgdmFsdWUpIHsKICAgICAgdmFyIHNob3VsZENvbnN0cmFpblZhbHVlID0gKGtleSA9PT0gJ3NjYWxlWCcgfHwga2V5ID09PSAnc2NhbGVZJykgJiYgdmFsdWUgPCBmYWJyaWMuT2JqZWN0Lk1JTl9TQ0FMRV9MSU1JVDsKCiAgICAgIGlmIChzaG91bGRDb25zdHJhaW5WYWx1ZSkgewogICAgICAgIHZhbHVlID0gZmFicmljLk9iamVjdC5NSU5fU0NBTEVfTElNSVQ7CiAgICAgIH0KCiAgICAgIGlmIChrZXkgPT09ICdhbmdsZScpIHsKICAgICAgICB0aGlzLnNldEFuZ2xlKHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFRvZ2dsZXMgc3BlY2lmaWVkIHByb3BlcnR5IGZyb20gYHRydWVgIHRvIGBmYWxzZWAgb3IgZnJvbSBgZmFsc2VgIHRvIGB0cnVlYAogICAgICogQG1ldGhvZCB0b2dnbGUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eSBwcm9wZXJ0eSB0byB0b2dnbGUKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgdG9nZ2xlOiBmdW5jdGlvbiB0b2dnbGUocHJvcGVydHkpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXQocHJvcGVydHkpOwoKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgdGhpcy5zZXQocHJvcGVydHksICF2YWx1ZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2Qgc2V0U291cmNlUGF0aAogICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNldFNvdXJjZVBhdGg6IGZ1bmN0aW9uIHNldFNvdXJjZVBhdGgodmFsdWUpIHsKICAgICAgdGhpcy5zb3VyY2VQYXRoID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIEJhc2ljIGdldHRlcgogICAgICogQG1ldGhvZCBnZXQKICAgICAqIEBwYXJhbSB7QW55fSBwcm9wZXJ0eQogICAgICogQHJldHVybiB7QW55fSB2YWx1ZSBvZiBhIHByb3BlcnR5CiAgICAgKi8KICAgIGdldDogZnVuY3Rpb24gZ2V0KHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBwcm9wZXJ0eSA9PT0gJ2FuZ2xlJyA/IHRoaXMuZ2V0QW5nbGUoKSA6IHRoaXNbcHJvcGVydHldOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2QgcmVuZGVyCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IGNvbnRleHQgdG8gcmVuZGVyIG9uCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IG5vVHJhbnNmb3JtCiAgICAgKi8KICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGN0eCwgbm9UcmFuc2Zvcm0pIHsKICAgICAgLy8gZG8gbm90IHJlbmRlciBpZiB3aWR0aCBvciBoZWlnaHQgYXJlIHplcm9zCiAgICAgIGlmICh0aGlzLndpZHRoID09PSAwIHx8IHRoaXMuaGVpZ2h0ID09PSAwKSByZXR1cm47CiAgICAgIGN0eC5zYXZlKCk7CiAgICAgIHZhciBtID0gdGhpcy50cmFuc2Zvcm1NYXRyaXg7CgogICAgICBpZiAobSAmJiAhdGhpcy5ncm91cCkgewogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0obVswXSwgbVsxXSwgbVsyXSwgbVszXSwgbVs0XSwgbVs1XSk7CiAgICAgIH0KCiAgICAgIGlmICghbm9UcmFuc2Zvcm0pIHsKICAgICAgICB0aGlzLnRyYW5zZm9ybShjdHgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdHJva2UgfHwgdGhpcy5zdHJva2VEYXNoQXJyYXkpIHsKICAgICAgICBjdHgubGluZVdpZHRoID0gdGhpcy5zdHJva2VXaWR0aDsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLnN0cm9rZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3ZlcmxheUZpbGwpIHsKICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5vdmVybGF5RmlsbDsKICAgICAgfSBlbHNlIGlmICh0aGlzLmZpbGwpIHsKICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5maWxsLnRvTGl2ZUdyYWRpZW50ID8gdGhpcy5maWxsLnRvTGl2ZUdyYWRpZW50KGN0eCkgOiB0aGlzLmZpbGw7CiAgICAgIH0KCiAgICAgIGlmIChtICYmIHRoaXMuZ3JvdXApIHsKICAgICAgICBjdHgudHJhbnNsYXRlKC10aGlzLmdyb3VwLndpZHRoIC8gMiwgLXRoaXMuZ3JvdXAuaGVpZ2h0IC8gMik7CiAgICAgICAgY3R4LnRyYW5zZm9ybShtWzBdLCBtWzFdLCBtWzJdLCBtWzNdLCBtWzRdLCBtWzVdKTsKICAgICAgfQoKICAgICAgdGhpcy5fcmVuZGVyKGN0eCwgbm9UcmFuc2Zvcm0pOwoKICAgICAgaWYgKHRoaXMuYWN0aXZlICYmICFub1RyYW5zZm9ybSkgewogICAgICAgIHRoaXMuZHJhd0JvcmRlcnMoY3R4KTsKICAgICAgICB0aGlzLmRyYXdDb3JuZXJzKGN0eCk7CiAgICAgIH0KCiAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyB3aWR0aCBvZiBhbiBvYmplY3QKICAgICAqIEBtZXRob2QgZ2V0V2lkdGgKICAgICAqIEByZXR1cm4ge051bWJlcn0gd2lkdGggdmFsdWUKICAgICAqLwogICAgZ2V0V2lkdGg6IGZ1bmN0aW9uIGdldFdpZHRoKCkgewogICAgICByZXR1cm4gdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgaGVpZ2h0IG9mIGFuIG9iamVjdAogICAgICogQG1ldGhvZCBnZXRIZWlnaHQKICAgICAqIEByZXR1cm4ge051bWJlcn0gaGVpZ2h0IHZhbHVlCiAgICAgKi8KICAgIGdldEhlaWdodDogZnVuY3Rpb24gZ2V0SGVpZ2h0KCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTY2FsZXMgYW4gb2JqZWN0IChlcXVhbGx5IGJ5IHggYW5kIHkpCiAgICAgKiBAbWV0aG9kIHNjYWxlCiAgICAgKiBAcGFyYW0gdmFsdWUge051bWJlcn0gc2NhbGUgZmFjdG9yCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNjYWxlOiBmdW5jdGlvbiBzY2FsZSh2YWx1ZSkgewogICAgICB0aGlzLnNjYWxlWCA9IHZhbHVlOwogICAgICB0aGlzLnNjYWxlWSA9IHZhbHVlOwogICAgICB0aGlzLnNldENvb3JkcygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTY2FsZXMgYW4gb2JqZWN0IHRvIGEgZ2l2ZW4gd2lkdGgsIHdpdGggcmVzcGVjdCB0byBib3VuZGluZyBib3ggKHNjYWxpbmcgYnkgeC95IGVxdWFsbHkpCiAgICAgKiBAbWV0aG9kIHNjYWxlVG9XaWR0aAogICAgICogQHBhcmFtIHZhbHVlIHtOdW1iZXJ9IG5ldyB3aWR0aCB2YWx1ZQogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzY2FsZVRvV2lkdGg6IGZ1bmN0aW9uIHNjYWxlVG9XaWR0aCh2YWx1ZSkgewogICAgICAvLyBhZGp1c3QgdG8gYm91bmRpbmcgcmVjdCBmYWN0b3Igc28gdGhhdCByb3RhdGVkIHNoYXBlcyB3b3VsZCBmaXQgYXMgd2VsbAogICAgICB2YXIgYm91bmRpbmdSZWN0RmFjdG9yID0gdGhpcy5nZXRCb3VuZGluZ1JlY3RXaWR0aCgpIC8gdGhpcy5nZXRXaWR0aCgpOwogICAgICByZXR1cm4gdGhpcy5zY2FsZSh2YWx1ZSAvIHRoaXMud2lkdGggLyBib3VuZGluZ1JlY3RGYWN0b3IpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNjYWxlcyBhbiBvYmplY3QgdG8gYSBnaXZlbiBoZWlnaHQsIHdpdGggcmVzcGVjdCB0byBib3VuZGluZyBib3ggKHNjYWxpbmcgYnkgeC95IGVxdWFsbHkpCiAgICAgKiBAbWV0aG9kIHNjYWxlVG9IZWlnaHQKICAgICAqIEBwYXJhbSB2YWx1ZSB7TnVtYmVyfSBuZXcgaGVpZ2h0IHZhbHVlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNjYWxlVG9IZWlnaHQ6IGZ1bmN0aW9uIHNjYWxlVG9IZWlnaHQodmFsdWUpIHsKICAgICAgLy8gYWRqdXN0IHRvIGJvdW5kaW5nIHJlY3QgZmFjdG9yIHNvIHRoYXQgcm90YXRlZCBzaGFwZXMgd291bGQgZml0IGFzIHdlbGwKICAgICAgdmFyIGJvdW5kaW5nUmVjdEZhY3RvciA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0SGVpZ2h0KCkgLyB0aGlzLmdldEhlaWdodCgpOwogICAgICByZXR1cm4gdGhpcy5zY2FsZSh2YWx1ZSAvIHRoaXMuaGVpZ2h0IC8gYm91bmRpbmdSZWN0RmFjdG9yKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIG9iamVjdCBvcGFjaXR5CiAgICAgKiBAbWV0aG9kIHNldE9wYWNpdHkKICAgICAqIEBwYXJhbSB2YWx1ZSB7TnVtYmVyfSB2YWx1ZSAwLTEKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2V0T3BhY2l0eTogZnVuY3Rpb24gc2V0T3BhY2l0eSh2YWx1ZSkgewogICAgICB0aGlzLnNldCgnb3BhY2l0eScsIHZhbHVlKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBvYmplY3QncyBhbmdsZSB2YWx1ZQogICAgICogQG1ldGhvZCBnZXRBbmdsZQogICAgICogQHJldHVybiB7TnVtYmVyfSBhbmdsZSB2YWx1ZQogICAgICovCiAgICBnZXRBbmdsZTogZnVuY3Rpb24gZ2V0QW5nbGUoKSB7CiAgICAgIHJldHVybiB0aGlzLl90aGV0YSAqIDE4MCAvIE1hdGguUEk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyBvYmplY3QncyBhbmdsZQogICAgICogQG1ldGhvZCBzZXRBbmdsZQogICAgICogQHBhcmFtIHZhbHVlIHtOdW1iZXJ9IGFuZ2xlIHZhbHVlCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoaXNBcmcKICAgICAqLwogICAgc2V0QW5nbGU6IGZ1bmN0aW9uIHNldEFuZ2xlKHZhbHVlKSB7CiAgICAgIHRoaXMuX3RoZXRhID0gdmFsdWUgLyAxODAgKiBNYXRoLlBJOwogICAgICB0aGlzLmFuZ2xlID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgY29ybmVyIHBvc2l0aW9uIGNvb3JkaW5hdGVzIGJhc2VkIG9uIGN1cnJlbnQgYW5nbGUsIHdpZHRoIGFuZCBoZWlnaHQuCiAgICAgKiBAbWV0aG9kIHNldENvb3JkcwogICAgICogcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNldENvb3JkczogZnVuY3Rpb24gc2V0Q29vcmRzKCkgewogICAgICB2YXIgc3Ryb2tlV2lkdGggPSB0aGlzLnN0cm9rZVdpZHRoID4gMSA/IHRoaXMuc3Ryb2tlV2lkdGggOiAwLAogICAgICAgICAgcGFkZGluZyA9IHRoaXMucGFkZGluZzsKICAgICAgdGhpcy5jdXJyZW50V2lkdGggPSAodGhpcy53aWR0aCArIHN0cm9rZVdpZHRoKSAqIHRoaXMuc2NhbGVYICsgcGFkZGluZyAqIDI7CiAgICAgIHRoaXMuY3VycmVudEhlaWdodCA9ICh0aGlzLmhlaWdodCArIHN0cm9rZVdpZHRoKSAqIHRoaXMuc2NhbGVZICsgcGFkZGluZyAqIDI7CiAgICAgIHRoaXMuX2h5cG90ZW51c2UgPSBNYXRoLnNxcnQoTWF0aC5wb3codGhpcy5jdXJyZW50V2lkdGggLyAyLCAyKSArIE1hdGgucG93KHRoaXMuY3VycmVudEhlaWdodCAvIDIsIDIpKTsKICAgICAgdGhpcy5fYW5nbGUgPSBNYXRoLmF0YW4odGhpcy5jdXJyZW50SGVpZ2h0IC8gdGhpcy5jdXJyZW50V2lkdGgpOyAvLyBvZmZzZXQgYWRkZWQgZm9yIHJvdGF0ZSBhbmQgc2NhbGUgYWN0aW9ucwoKICAgICAgdmFyIG9mZnNldFggPSBNYXRoLmNvcyh0aGlzLl9hbmdsZSArIHRoaXMuX3RoZXRhKSAqIHRoaXMuX2h5cG90ZW51c2UsCiAgICAgICAgICBvZmZzZXRZID0gTWF0aC5zaW4odGhpcy5fYW5nbGUgKyB0aGlzLl90aGV0YSkgKiB0aGlzLl9oeXBvdGVudXNlLAogICAgICAgICAgdGhldGEgPSB0aGlzLl90aGV0YSwKICAgICAgICAgIHNpblRoID0gTWF0aC5zaW4odGhldGEpLAogICAgICAgICAgY29zVGggPSBNYXRoLmNvcyh0aGV0YSk7CgogICAgICB2YXIgdGwgPSB7CiAgICAgICAgeDogdGhpcy5sZWZ0IC0gb2Zmc2V0WCwKICAgICAgICB5OiB0aGlzLnRvcCAtIG9mZnNldFkKICAgICAgfTsKICAgICAgdmFyIHRyID0gewogICAgICAgIHg6IHRsLnggKyB0aGlzLmN1cnJlbnRXaWR0aCAqIGNvc1RoLAogICAgICAgIHk6IHRsLnkgKyB0aGlzLmN1cnJlbnRXaWR0aCAqIHNpblRoCiAgICAgIH07CiAgICAgIHZhciBiciA9IHsKICAgICAgICB4OiB0ci54IC0gdGhpcy5jdXJyZW50SGVpZ2h0ICogc2luVGgsCiAgICAgICAgeTogdHIueSArIHRoaXMuY3VycmVudEhlaWdodCAqIGNvc1RoCiAgICAgIH07CiAgICAgIHZhciBibCA9IHsKICAgICAgICB4OiB0bC54IC0gdGhpcy5jdXJyZW50SGVpZ2h0ICogc2luVGgsCiAgICAgICAgeTogdGwueSArIHRoaXMuY3VycmVudEhlaWdodCAqIGNvc1RoCiAgICAgIH07CiAgICAgIHZhciBtbCA9IHsKICAgICAgICB4OiB0bC54IC0gdGhpcy5jdXJyZW50SGVpZ2h0IC8gMiAqIHNpblRoLAogICAgICAgIHk6IHRsLnkgKyB0aGlzLmN1cnJlbnRIZWlnaHQgLyAyICogY29zVGgKICAgICAgfTsKICAgICAgdmFyIG10ID0gewogICAgICAgIHg6IHRsLnggKyB0aGlzLmN1cnJlbnRXaWR0aCAvIDIgKiBjb3NUaCwKICAgICAgICB5OiB0bC55ICsgdGhpcy5jdXJyZW50V2lkdGggLyAyICogc2luVGgKICAgICAgfTsKICAgICAgdmFyIG1yID0gewogICAgICAgIHg6IHRyLnggLSB0aGlzLmN1cnJlbnRIZWlnaHQgLyAyICogc2luVGgsCiAgICAgICAgeTogdHIueSArIHRoaXMuY3VycmVudEhlaWdodCAvIDIgKiBjb3NUaAogICAgICB9OwogICAgICB2YXIgbWIgPSB7CiAgICAgICAgeDogYmwueCArIHRoaXMuY3VycmVudFdpZHRoIC8gMiAqIGNvc1RoLAogICAgICAgIHk6IGJsLnkgKyB0aGlzLmN1cnJlbnRXaWR0aCAvIDIgKiBzaW5UaAogICAgICB9OwogICAgICB2YXIgbXRyID0gewogICAgICAgIHg6IHRsLnggKyB0aGlzLmN1cnJlbnRXaWR0aCAvIDIgKiBjb3NUaCwKICAgICAgICB5OiB0bC55ICsgdGhpcy5jdXJyZW50V2lkdGggLyAyICogc2luVGgKICAgICAgfTsgLy8gZGVidWdnaW5nCiAgICAgIC8vIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgIC8vICAgICAgICAgY2FudmFzLmNvbnRleHRUb3AuZmlsbFN0eWxlID0gJ2dyZWVuJzsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChtYi54LCBtYi55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChibC54LCBibC55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChici54LCBici55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdCh0bC54LCB0bC55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdCh0ci54LCB0ci55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChtbC54LCBtbC55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChtci54LCBtci55LCAzLCAzKTsKICAgICAgLy8gICAgICAgICBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChtdC54LCBtdC55LCAzLCAzKTsKICAgICAgLy8gICAgICAgfSwgNTApOwogICAgICAvLyBjbG9ja3dpc2UKCiAgICAgIHRoaXMub0Nvb3JkcyA9IHsKICAgICAgICB0bDogdGwsCiAgICAgICAgdHI6IHRyLAogICAgICAgIGJyOiBiciwKICAgICAgICBibDogYmwsCiAgICAgICAgbWw6IG1sLAogICAgICAgIG10OiBtdCwKICAgICAgICBtcjogbXIsCiAgICAgICAgbWI6IG1iLAogICAgICAgIG10cjogbXRyCiAgICAgIH07IC8vIHNldCBjb29yZGluYXRlcyBvZiB0aGUgZHJhZ2dhYmxlIGJveGVzIGluIHRoZSBjb3JuZXJzIHVzZWQgdG8gc2NhbGUvcm90YXRlIHRoZSBpbWFnZQoKICAgICAgdGhpcy5fc2V0Q29ybmVyQ29vcmRzKCk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAqIFJldHVybnMgd2lkdGggb2YgYW4gb2JqZWN0J3MgYm91bmRpbmcgcmVjdGFuZ2xlCiAgICAqIEBtZXRob2QgZ2V0Qm91bmRpbmdSZWN0V2lkdGgKICAgICogQHJldHVybiB7TnVtYmVyfSB3aWR0aCB2YWx1ZQogICAgKi8KICAgIGdldEJvdW5kaW5nUmVjdFdpZHRoOiBmdW5jdGlvbiBnZXRCb3VuZGluZ1JlY3RXaWR0aCgpIHsKICAgICAgdGhpcy5vQ29vcmRzIHx8IHRoaXMuc2V0Q29vcmRzKCk7CiAgICAgIHZhciB4Q29vcmRzID0gW3RoaXMub0Nvb3Jkcy50bC54LCB0aGlzLm9Db29yZHMudHIueCwgdGhpcy5vQ29vcmRzLmJyLngsIHRoaXMub0Nvb3Jkcy5ibC54XTsKICAgICAgdmFyIG1pblggPSBmYWJyaWMudXRpbC5hcnJheS5taW4oeENvb3Jkcyk7CiAgICAgIHZhciBtYXhYID0gZmFicmljLnV0aWwuYXJyYXkubWF4KHhDb29yZHMpOwogICAgICByZXR1cm4gTWF0aC5hYnMobWluWCAtIG1heFgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgaGVpZ2h0IG9mIGFuIG9iamVjdCdzIGJvdW5kaW5nIHJlY3RhbmdsZQogICAgICogQG1ldGhvZCBnZXRCb3VuZGluZ1JlY3RIZWlnaHQKICAgICAqIEByZXR1cm4ge051bWJlcn0gaGVpZ2h0IHZhbHVlCiAgICAgKi8KICAgIGdldEJvdW5kaW5nUmVjdEhlaWdodDogZnVuY3Rpb24gZ2V0Qm91bmRpbmdSZWN0SGVpZ2h0KCkgewogICAgICB0aGlzLm9Db29yZHMgfHwgdGhpcy5zZXRDb29yZHMoKTsKICAgICAgdmFyIHlDb29yZHMgPSBbdGhpcy5vQ29vcmRzLnRsLnksIHRoaXMub0Nvb3Jkcy50ci55LCB0aGlzLm9Db29yZHMuYnIueSwgdGhpcy5vQ29vcmRzLmJsLnldOwogICAgICB2YXIgbWluWSA9IGZhYnJpYy51dGlsLmFycmF5Lm1pbih5Q29vcmRzKTsKICAgICAgdmFyIG1heFkgPSBmYWJyaWMudXRpbC5hcnJheS5tYXgoeUNvb3Jkcyk7CiAgICAgIHJldHVybiBNYXRoLmFicyhtaW5ZIC0gbWF4WSk7CiAgICB9LAoKICAgIC8qKgogICAgICogRHJhd3MgYm9yZGVycyBvZiBhbiBvYmplY3QncyBib3VuZGluZyBib3guCiAgICAgKiBSZXF1aXJlcyBwdWJsaWMgcHJvcGVydGllczogd2lkdGgsIGhlaWdodAogICAgICogUmVxdWlyZXMgcHVibGljIG9wdGlvbnM6IHBhZGRpbmcsIGJvcmRlckNvbG9yCiAgICAgKiBAbWV0aG9kIGRyYXdCb3JkZXJzCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gZHJhdyBvbgogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBkcmF3Qm9yZGVyczogZnVuY3Rpb24gZHJhd0JvcmRlcnMoY3R4KSB7CiAgICAgIGlmICghdGhpcy5oYXNCb3JkZXJzKSByZXR1cm47CiAgICAgIHZhciBNSU5fU0NBTEVfTElNSVQgPSBmYWJyaWMuT2JqZWN0Lk1JTl9TQ0FMRV9MSU1JVCwKICAgICAgICAgIHBhZGRpbmcgPSB0aGlzLnBhZGRpbmcsCiAgICAgICAgICBwYWRkaW5nMiA9IHBhZGRpbmcgKiAyLAogICAgICAgICAgc3Ryb2tlV2lkdGggPSB0aGlzLnN0cm9rZVdpZHRoID4gMSA/IHRoaXMuc3Ryb2tlV2lkdGggOiAwOwogICAgICBjdHguc2F2ZSgpOwogICAgICBjdHguZ2xvYmFsQWxwaGEgPSB0aGlzLmlzTW92aW5nID8gdGhpcy5ib3JkZXJPcGFjaXR5V2hlbk1vdmluZyA6IDE7CiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuYm9yZGVyQ29sb3I7CiAgICAgIHZhciBzY2FsZVggPSAxIC8gKHRoaXMuc2NhbGVYIDwgTUlOX1NDQUxFX0xJTUlUID8gTUlOX1NDQUxFX0xJTUlUIDogdGhpcy5zY2FsZVgpLAogICAgICAgICAgc2NhbGVZID0gMSAvICh0aGlzLnNjYWxlWSA8IE1JTl9TQ0FMRV9MSU1JVCA/IE1JTl9TQ0FMRV9MSU1JVCA6IHRoaXMuc2NhbGVZKTsKICAgICAgY3R4LmxpbmVXaWR0aCA9IDEgLyB0aGlzLmJvcmRlclNjYWxlRmFjdG9yOwogICAgICBjdHguc2NhbGUoc2NhbGVYLCBzY2FsZVkpOwogICAgICB2YXIgdyA9IHRoaXMuZ2V0V2lkdGgoKSwKICAgICAgICAgIGggPSB0aGlzLmdldEhlaWdodCgpOwogICAgICBjdHguc3Ryb2tlUmVjdCh+figtKHcgLyAyKSAtIHBhZGRpbmcgLSBzdHJva2VXaWR0aCAvIDIgKiB0aGlzLnNjYWxlWCkgKyAwLjUsIC8vIG9mZnNldCBuZWVkZWQgdG8gbWFrZSBsaW5lcyBsb29rIHNoYXJwZXIKICAgICAgfn4oLShoIC8gMikgLSBwYWRkaW5nIC0gc3Ryb2tlV2lkdGggLyAyICogdGhpcy5zY2FsZVkpICsgMC41LCB+fih3ICsgcGFkZGluZzIgKyBzdHJva2VXaWR0aCAqIHRoaXMuc2NhbGVYKSwgfn4oaCArIHBhZGRpbmcyICsgc3Ryb2tlV2lkdGggKiB0aGlzLnNjYWxlWSkpOwoKICAgICAgaWYgKHRoaXMuaGFzUm90YXRpbmdQb2ludCAmJiAhdGhpcy5sb2NrUm90YXRpb24gJiYgdGhpcy5oYXNDb250cm9scykgewogICAgICAgIHZhciByb3RhdGVIZWlnaHQgPSAodGhpcy5mbGlwWSA/IGggKyBzdHJva2VXaWR0aCAqIHRoaXMuc2NhbGVZICsgcGFkZGluZyAqIDIgOiAtaCAtIHN0cm9rZVdpZHRoICogdGhpcy5zY2FsZVkgLSBwYWRkaW5nICogMikgLyAyOwogICAgICAgIHZhciByb3RhdGVXaWR0aCA9IC13IC8gMjsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbygwLCByb3RhdGVIZWlnaHQpOwogICAgICAgIGN0eC5saW5lVG8oMCwgcm90YXRlSGVpZ2h0ICsgKHRoaXMuZmxpcFkgPyB0aGlzLnJvdGF0aW5nUG9pbnRPZmZzZXQgOiAtdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0KSk7CiAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQoKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgX3JlbmRlckRhc2hlZFN0cm9rZTogZnVuY3Rpb24gX3JlbmRlckRhc2hlZFN0cm9rZShjdHgpIHsKICAgICAgaWYgKDEgJiB0aGlzLnN0cm9rZURhc2hBcnJheS5sZW5ndGgKICAgICAgLyogaWYgb2RkIG51bWJlciBvZiBpdGVtcyAqLwogICAgICApIHsKICAgICAgICAgIC8qIGR1cGxpY2F0ZSBpdGVtcyAqLwogICAgICAgICAgdGhpcy5zdHJva2VEYXNoQXJyYXkucHVzaC5hcHBseSh0aGlzLnN0cm9rZURhc2hBcnJheSwgdGhpcy5zdHJva2VEYXNoQXJyYXkpOwogICAgICAgIH0KCiAgICAgIHZhciBpID0gMCwKICAgICAgICAgIHggPSAtdGhpcy53aWR0aCAvIDIsCiAgICAgICAgICB5ID0gLXRoaXMuaGVpZ2h0IC8gMiwKICAgICAgICAgIF90aGlzID0gdGhpcywKICAgICAgICAgIHBhZGRpbmcgPSB0aGlzLnBhZGRpbmcsCiAgICAgICAgICB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKSwKICAgICAgICAgIGhlaWdodCA9IHRoaXMuZ2V0SGVpZ2h0KCksCiAgICAgICAgICBkYXNoZWRBcnJheUxlbmd0aCA9IHRoaXMuc3Ryb2tlRGFzaEFycmF5Lmxlbmd0aDsKCiAgICAgIGN0eC5zYXZlKCk7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsKCiAgICAgIGZ1bmN0aW9uIHJlbmRlclNpZGUoeE11bHRpcGxpZXIsIHlNdWx0aXBsaWVyKSB7CiAgICAgICAgdmFyIGxpbmVMZW5ndGggPSAwLAogICAgICAgICAgICBzaWRlTGVuZ3RoID0gKHlNdWx0aXBsaWVyID8gX3RoaXMuaGVpZ2h0IDogX3RoaXMud2lkdGgpICsgcGFkZGluZyAqIDI7CgogICAgICAgIHdoaWxlIChsaW5lTGVuZ3RoIDwgc2lkZUxlbmd0aCkgewogICAgICAgICAgdmFyIGxlbmd0aE9mU3ViUGF0aCA9IF90aGlzLnN0cm9rZURhc2hBcnJheVtpKytdOwogICAgICAgICAgbGluZUxlbmd0aCArPSBsZW5ndGhPZlN1YlBhdGg7CgogICAgICAgICAgaWYgKGxpbmVMZW5ndGggPiBzaWRlTGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGluZUxlbmd0aCAtIHNpZGVMZW5ndGg7CiAgICAgICAgICB9IC8vIHRyYWNrIGNvb3JkcwoKCiAgICAgICAgICBpZiAoeE11bHRpcGxpZXIpIHsKICAgICAgICAgICAgeCArPSBsZW5ndGhPZlN1YlBhdGggKiB4TXVsdGlwbGllciAtIChsZW5ndGhEaWZmICogeE11bHRpcGxpZXIgfHwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB5ICs9IGxlbmd0aE9mU3ViUGF0aCAqIHlNdWx0aXBsaWVyIC0gKGxlbmd0aERpZmYgKiB5TXVsdGlwbGllciB8fCAwKTsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHhbMSAmIGkKICAgICAgICAgIC8qIG9kZCAqLwogICAgICAgICAgPyAnbW92ZVRvJyA6ICdsaW5lVG8nXSh4LCB5KTsKCiAgICAgICAgICBpZiAoaSA+PSBkYXNoZWRBcnJheUxlbmd0aCkgewogICAgICAgICAgICBpID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlbmRlclNpZGUoMSwgMCk7CiAgICAgIHJlbmRlclNpZGUoMCwgMSk7CiAgICAgIHJlbmRlclNpZGUoLTEsIDApOwogICAgICByZW5kZXJTaWRlKDAsIC0xKTsKICAgICAgY3R4LnN0cm9rZSgpOwogICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogRHJhd3MgY29ybmVycyBvZiBhbiBvYmplY3QncyBib3VuZGluZyBib3guCiAgICAgKiBSZXF1aXJlcyBwdWJsaWMgcHJvcGVydGllczogd2lkdGgsIGhlaWdodCwgc2NhbGVYLCBzY2FsZVkKICAgICAqIFJlcXVpcmVzIHB1YmxpYyBvcHRpb25zOiBjb3JuZXJzaXplLCBwYWRkaW5nCiAgICAgKiBAbWV0aG9kIGRyYXdDb3JuZXJzCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gZHJhdyBvbgogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBkcmF3Q29ybmVyczogZnVuY3Rpb24gZHJhd0Nvcm5lcnMoY3R4KSB7CiAgICAgIGlmICghdGhpcy5oYXNDb250cm9scykgcmV0dXJuOwoKICAgICAgdmFyIHNpemUgPSB0aGlzLmNvcm5lcnNpemUsCiAgICAgICAgICBzaXplMiA9IHNpemUgLyAyLAogICAgICAgICAgc3Ryb2tlV2lkdGgyID0gdGhpcy5zdHJva2VXaWR0aCAvIDIsCiAgICAgICAgICBsZWZ0ID0gLSh0aGlzLndpZHRoIC8gMiksCiAgICAgICAgICB0b3AgPSAtKHRoaXMuaGVpZ2h0IC8gMiksCiAgICAgICAgICBfbGVmdCwKICAgICAgICAgIF90b3AsCiAgICAgICAgICBzaXplWCA9IHNpemUgLyB0aGlzLnNjYWxlWCwKICAgICAgICAgIHNpemVZID0gc2l6ZSAvIHRoaXMuc2NhbGVZLAogICAgICAgICAgcGFkZGluZ1ggPSB0aGlzLnBhZGRpbmcgLyB0aGlzLnNjYWxlWCwKICAgICAgICAgIHBhZGRpbmdZID0gdGhpcy5wYWRkaW5nIC8gdGhpcy5zY2FsZVksCiAgICAgICAgICBzY2FsZU9mZnNldFkgPSBzaXplMiAvIHRoaXMuc2NhbGVZLAogICAgICAgICAgc2NhbGVPZmZzZXRYID0gc2l6ZTIgLyB0aGlzLnNjYWxlWCwKICAgICAgICAgIHNjYWxlT2Zmc2V0U2l6ZVggPSAoc2l6ZTIgLSBzaXplKSAvIHRoaXMuc2NhbGVYLAogICAgICAgICAgc2NhbGVPZmZzZXRTaXplWSA9IChzaXplMiAtIHNpemUpIC8gdGhpcy5zY2FsZVksCiAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodCwKICAgICAgICAgIHdpZHRoID0gdGhpcy53aWR0aCwKICAgICAgICAgIG1ldGhvZE5hbWUgPSB0aGlzLnRyYW5zcGFyZW50Q29ybmVycyA/ICdzdHJva2VSZWN0JyA6ICdmaWxsUmVjdCc7CgogICAgICBjdHguc2F2ZSgpOwogICAgICBjdHgubGluZVdpZHRoID0gMSAvIE1hdGgubWF4KHRoaXMuc2NhbGVYLCB0aGlzLnNjYWxlWSk7CiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMuaXNNb3ZpbmcgPyB0aGlzLmJvcmRlck9wYWNpdHlXaGVuTW92aW5nIDogMTsKICAgICAgY3R4LnN0cm9rZVN0eWxlID0gY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29ybmVyQ29sb3I7IC8vIHRvcC1sZWZ0CgogICAgICBfbGVmdCA9IGxlZnQgLSBzY2FsZU9mZnNldFggLSBzdHJva2VXaWR0aDIgLSBwYWRkaW5nWDsKICAgICAgX3RvcCA9IHRvcCAtIHNjYWxlT2Zmc2V0WSAtIHN0cm9rZVdpZHRoMiAtIHBhZGRpbmdZOwogICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICBjdHhbbWV0aG9kTmFtZV0oX2xlZnQsIF90b3AsIHNpemVYLCBzaXplWSk7IC8vIHRvcC1yaWdodAoKICAgICAgX2xlZnQgPSBsZWZ0ICsgd2lkdGggLSBzY2FsZU9mZnNldFggKyBzdHJva2VXaWR0aDIgKyBwYWRkaW5nWDsKICAgICAgX3RvcCA9IHRvcCAtIHNjYWxlT2Zmc2V0WSAtIHN0cm9rZVdpZHRoMiAtIHBhZGRpbmdZOwogICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICBjdHhbbWV0aG9kTmFtZV0oX2xlZnQsIF90b3AsIHNpemVYLCBzaXplWSk7IC8vIGJvdHRvbS1sZWZ0CgogICAgICBfbGVmdCA9IGxlZnQgLSBzY2FsZU9mZnNldFggLSBzdHJva2VXaWR0aDIgLSBwYWRkaW5nWDsKICAgICAgX3RvcCA9IHRvcCArIGhlaWdodCArIHNjYWxlT2Zmc2V0U2l6ZVkgKyBzdHJva2VXaWR0aDIgKyBwYWRkaW5nWTsKICAgICAgY3R4LmNsZWFyUmVjdChfbGVmdCwgX3RvcCwgc2l6ZVgsIHNpemVZKTsKICAgICAgY3R4W21ldGhvZE5hbWVdKF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOyAvLyBib3R0b20tcmlnaHQKCiAgICAgIF9sZWZ0ID0gbGVmdCArIHdpZHRoICsgc2NhbGVPZmZzZXRTaXplWCArIHN0cm9rZVdpZHRoMiArIHBhZGRpbmdYOwogICAgICBfdG9wID0gdG9wICsgaGVpZ2h0ICsgc2NhbGVPZmZzZXRTaXplWSArIHN0cm9rZVdpZHRoMiArIHBhZGRpbmdZOwogICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICBjdHhbbWV0aG9kTmFtZV0oX2xlZnQsIF90b3AsIHNpemVYLCBzaXplWSk7CgogICAgICBpZiAoIXRoaXMubG9ja1VuaVNjYWxpbmcpIHsKICAgICAgICAvLyBtaWRkbGUtdG9wCiAgICAgICAgX2xlZnQgPSBsZWZ0ICsgd2lkdGggLyAyIC0gc2NhbGVPZmZzZXRYOwogICAgICAgIF90b3AgPSB0b3AgLSBzY2FsZU9mZnNldFkgLSBzdHJva2VXaWR0aDIgLSBwYWRkaW5nWTsKICAgICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICAgIGN0eFttZXRob2ROYW1lXShfbGVmdCwgX3RvcCwgc2l6ZVgsIHNpemVZKTsgLy8gbWlkZGxlLWJvdHRvbQoKICAgICAgICBfbGVmdCA9IGxlZnQgKyB3aWR0aCAvIDIgLSBzY2FsZU9mZnNldFg7CiAgICAgICAgX3RvcCA9IHRvcCArIGhlaWdodCArIHNjYWxlT2Zmc2V0U2l6ZVkgKyBzdHJva2VXaWR0aDIgKyBwYWRkaW5nWTsKICAgICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICAgIGN0eFttZXRob2ROYW1lXShfbGVmdCwgX3RvcCwgc2l6ZVgsIHNpemVZKTsgLy8gbWlkZGxlLXJpZ2h0CgogICAgICAgIF9sZWZ0ID0gbGVmdCArIHdpZHRoICsgc2NhbGVPZmZzZXRTaXplWCArIHN0cm9rZVdpZHRoMiArIHBhZGRpbmdYOwogICAgICAgIF90b3AgPSB0b3AgKyBoZWlnaHQgLyAyIC0gc2NhbGVPZmZzZXRZOwogICAgICAgIGN0eC5jbGVhclJlY3QoX2xlZnQsIF90b3AsIHNpemVYLCBzaXplWSk7CiAgICAgICAgY3R4W21ldGhvZE5hbWVdKF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOyAvLyBtaWRkbGUtbGVmdAoKICAgICAgICBfbGVmdCA9IGxlZnQgLSBzY2FsZU9mZnNldFggLSBzdHJva2VXaWR0aDIgLSBwYWRkaW5nWDsKICAgICAgICBfdG9wID0gdG9wICsgaGVpZ2h0IC8gMiAtIHNjYWxlT2Zmc2V0WTsKICAgICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICAgIGN0eFttZXRob2ROYW1lXShfbGVmdCwgX3RvcCwgc2l6ZVgsIHNpemVZKTsKICAgICAgfSAvLyBtaWRkbGUtdG9wLXJvdGF0ZQoKCiAgICAgIGlmICh0aGlzLmhhc1JvdGF0aW5nUG9pbnQpIHsKICAgICAgICBfbGVmdCA9IGxlZnQgKyB3aWR0aCAvIDIgLSBzY2FsZU9mZnNldFg7CiAgICAgICAgX3RvcCA9IHRoaXMuZmxpcFkgPyB0b3AgKyBoZWlnaHQgKyB0aGlzLnJvdGF0aW5nUG9pbnRPZmZzZXQgLyB0aGlzLnNjYWxlWSAtIHNpemVZIC8gMiArIHN0cm9rZVdpZHRoMiArIHBhZGRpbmdZIDogdG9wIC0gdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0IC8gdGhpcy5zY2FsZVkgLSBzaXplWSAvIDIgLSBzdHJva2VXaWR0aDIgLSBwYWRkaW5nWTsKICAgICAgICBjdHguY2xlYXJSZWN0KF9sZWZ0LCBfdG9wLCBzaXplWCwgc2l6ZVkpOwogICAgICAgIGN0eFttZXRob2ROYW1lXShfbGVmdCwgX3RvcCwgc2l6ZVgsIHNpemVZKTsKICAgICAgfQoKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2xvbmVzIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIGNsb25lCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyBvYmplY3QKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IGNsb25lIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZShvcHRpb25zKSB7CiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yLmZyb21PYmplY3QpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5mcm9tT2JqZWN0KHRoaXMudG9PYmplY3QoKSwgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgZmFicmljLk9iamVjdCh0aGlzLnRvT2JqZWN0KCkpOwogICAgfSwKCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgZmFicmljLkltYWdlIG91dCBvZiBhbiBvYmplY3QKICAgICAqIEBtZXRob2QgY2xvbmVBc0ltYWdlCiAgICAgKiBAcGFyYW0gY2FsbGJhY2sge0Z1bmN0aW9ufSBjYWxsYmFjaywgaW52b2tlZCB3aXRoIGFuIGluc3RhbmNlIGFzIGEgZmlyc3QgYXJndW1lbnQKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgY2xvbmVBc0ltYWdlOiBmdW5jdGlvbiBjbG9uZUFzSW1hZ2UoY2FsbGJhY2spIHsKICAgICAgaWYgKGZhYnJpYy5JbWFnZSkgewogICAgICAgIHZhciBpID0gbmV3IEltYWdlKCk7CiAgICAgICAgLyoqIEBpZ25vcmUgKi8KCiAgICAgICAgaS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgY2FsbGJhY2sobmV3IGZhYnJpYy5JbWFnZShpKSwgb3JpZyk7CiAgICAgICAgICB9CgogICAgICAgICAgaSA9IGkub25sb2FkID0gbnVsbDsKICAgICAgICB9OwoKICAgICAgICB2YXIgb3JpZyA9IHsKICAgICAgICAgIGFuZ2xlOiB0aGlzLmdldCgnYW5nbGUnKSwKICAgICAgICAgIGZsaXBYOiB0aGlzLmdldCgnZmxpcFgnKSwKICAgICAgICAgIGZsaXBZOiB0aGlzLmdldCgnZmxpcFknKQogICAgICAgIH07IC8vIG5vcm1hbGl6ZSBhbmdsZQoKICAgICAgICB0aGlzLnNldCgnYW5nbGUnLCAwKS5zZXQoJ2ZsaXBYJywgZmFsc2UpLnNldCgnZmxpcFknLCBmYWxzZSk7CiAgICAgICAgdGhpcy50b0RhdGFVUkwoZnVuY3Rpb24gKGRhdGFVUkwpIHsKICAgICAgICAgIGkuc3JjID0gZGF0YVVSTDsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQ29udmVydHMgYW4gb2JqZWN0IGludG8gYSBkYXRhLXVybC1saWtlIHN0cmluZwogICAgICogQG1ldGhvZCB0b0RhdGFVUkwKICAgICAqIEByZXR1cm4ge1N0cmluZ30gc3RyaW5nIG9mIGRhdGEKICAgICAqLwogICAgdG9EYXRhVVJMOiBmdW5jdGlvbiB0b0RhdGFVUkwoY2FsbGJhY2spIHsKICAgICAgdmFyIGVsID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwoKICAgICAgaWYgKCFlbC5nZXRDb250ZXh0ICYmIHR5cGVvZiBHX3ZtbENhbnZhc01hbmFnZXIgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBHX3ZtbENhbnZhc01hbmFnZXIuaW5pdEVsZW1lbnQoZWwpOwogICAgICB9CgogICAgICBlbC53aWR0aCA9IHRoaXMuZ2V0Qm91bmRpbmdSZWN0V2lkdGgoKTsKICAgICAgZWwuaGVpZ2h0ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3RIZWlnaHQoKTsKICAgICAgZmFicmljLnV0aWwud3JhcEVsZW1lbnQoZWwsICdkaXYnKTsKICAgICAgdmFyIGNhbnZhcyA9IG5ldyBmYWJyaWMuQ2FudmFzKGVsKTsKICAgICAgY2FudmFzLmJhY2tncm91bmRDb2xvciA9ICd0cmFuc3BhcmVudCc7CiAgICAgIGNhbnZhcy5yZW5kZXJBbGwoKTsKCiAgICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yLmFzeW5jKSB7CiAgICAgICAgdGhpcy5jbG9uZShwcm9jZWVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcm9jZWVkKHRoaXMuY2xvbmUoKSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHByb2NlZWQoY2xvbmUpIHsKICAgICAgICBjbG9uZS5sZWZ0ID0gZWwud2lkdGggLyAyOwogICAgICAgIGNsb25lLnRvcCA9IGVsLmhlaWdodCAvIDI7CiAgICAgICAgY2xvbmUuc2V0QWN0aXZlKGZhbHNlKTsKICAgICAgICBjYW52YXMuYWRkKGNsb25lKTsKICAgICAgICB2YXIgZGF0YSA9IGNhbnZhcy50b0RhdGFVUkwoJ3BuZycpOwogICAgICAgIGNhbnZhcy5kaXNwb3NlKCk7CiAgICAgICAgY2FudmFzID0gY2xvbmUgPSBudWxsOwogICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGRhdGEpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBoYXNTdGF0ZUNoYW5nZWQKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgaW5zdGFuY2UnIHN0YXRlIGhhcyBjaGFuZ2VkCiAgICAgKi8KICAgIGhhc1N0YXRlQ2hhbmdlZDogZnVuY3Rpb24gaGFzU3RhdGVDaGFuZ2VkKCkgewogICAgICByZXR1cm4gdGhpcy5zdGF0ZVByb3BlcnRpZXMuc29tZShmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiB0aGlzW3Byb3BdICE9PSB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF07CiAgICAgIH0sIHRoaXMpOwogICAgfSwKCiAgICAvKioKICAgICAqIEBtZXRob2Qgc2F2ZVN0YXRlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNhdmVTdGF0ZTogZnVuY3Rpb24gc2F2ZVN0YXRlKCkgewogICAgICB0aGlzLnN0YXRlUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgICAgdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdID0gdGhpcy5nZXQocHJvcCk7CiAgICAgIH0sIHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIHNldHVwU3RhdGUKICAgICAqLwogICAgc2V0dXBTdGF0ZTogZnVuY3Rpb24gc2V0dXBTdGF0ZSgpIHsKICAgICAgdGhpcy5vcmlnaW5hbFN0YXRlID0ge307CiAgICAgIHRoaXMuc2F2ZVN0YXRlKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIG9iamVjdCBpbnRlcnNlY3RzIHdpdGggYW4gYXJlYSBmb3JtZWQgYnkgMiBwb2ludHMKICAgICAqIEBtZXRob2QgaW50ZXJzZWN0c1dpdGhSZWN0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VsZWN0aW9uVEwKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZWxlY3Rpb25CUgogICAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgICAqLwogICAgaW50ZXJzZWN0c1dpdGhSZWN0OiBmdW5jdGlvbiBpbnRlcnNlY3RzV2l0aFJlY3Qoc2VsZWN0aW9uVEwsIHNlbGVjdGlvbkJSKSB7CiAgICAgIHZhciBvQ29vcmRzID0gdGhpcy5vQ29vcmRzLAogICAgICAgICAgdGwgPSBuZXcgZmFicmljLlBvaW50KG9Db29yZHMudGwueCwgb0Nvb3Jkcy50bC55KSwKICAgICAgICAgIHRyID0gbmV3IGZhYnJpYy5Qb2ludChvQ29vcmRzLnRyLngsIG9Db29yZHMudHIueSksCiAgICAgICAgICBibCA9IG5ldyBmYWJyaWMuUG9pbnQob0Nvb3Jkcy5ibC54LCBvQ29vcmRzLmJsLnkpLAogICAgICAgICAgYnIgPSBuZXcgZmFicmljLlBvaW50KG9Db29yZHMuYnIueCwgb0Nvb3Jkcy5ici55KTsKICAgICAgdmFyIGludGVyc2VjdGlvbiA9IGZhYnJpYy5JbnRlcnNlY3Rpb24uaW50ZXJzZWN0UG9seWdvblJlY3RhbmdsZShbdGwsIHRyLCBiciwgYmxdLCBzZWxlY3Rpb25UTCwgc2VsZWN0aW9uQlIpOwogICAgICByZXR1cm4gaW50ZXJzZWN0aW9uLnN0YXR1cyA9PT0gJ0ludGVyc2VjdGlvbic7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIG9iamVjdCBpbnRlcnNlY3RzIHdpdGggYW5vdGhlciBvYmplY3QKICAgICAqIEBtZXRob2QgaW50ZXJzZWN0c1dpdGhPYmplY3QKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlciBPYmplY3QgdG8gdGVzdAogICAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgICAqLwogICAgaW50ZXJzZWN0c1dpdGhPYmplY3Q6IGZ1bmN0aW9uIGludGVyc2VjdHNXaXRoT2JqZWN0KG90aGVyKSB7CiAgICAgIC8vIGV4dHJhY3RzIGNvb3JkcwogICAgICBmdW5jdGlvbiBnZXRDb29yZHMob0Nvb3JkcykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0bDogbmV3IGZhYnJpYy5Qb2ludChvQ29vcmRzLnRsLngsIG9Db29yZHMudGwueSksCiAgICAgICAgICB0cjogbmV3IGZhYnJpYy5Qb2ludChvQ29vcmRzLnRyLngsIG9Db29yZHMudHIueSksCiAgICAgICAgICBibDogbmV3IGZhYnJpYy5Qb2ludChvQ29vcmRzLmJsLngsIG9Db29yZHMuYmwueSksCiAgICAgICAgICBicjogbmV3IGZhYnJpYy5Qb2ludChvQ29vcmRzLmJyLngsIG9Db29yZHMuYnIueSkKICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgdGhpc0Nvb3JkcyA9IGdldENvb3Jkcyh0aGlzLm9Db29yZHMpLAogICAgICAgICAgb3RoZXJDb29yZHMgPSBnZXRDb29yZHMob3RoZXIub0Nvb3Jkcyk7CiAgICAgIHZhciBpbnRlcnNlY3Rpb24gPSBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdFBvbHlnb25Qb2x5Z29uKFt0aGlzQ29vcmRzLnRsLCB0aGlzQ29vcmRzLnRyLCB0aGlzQ29vcmRzLmJyLCB0aGlzQ29vcmRzLmJsXSwgW290aGVyQ29vcmRzLnRsLCBvdGhlckNvb3Jkcy50ciwgb3RoZXJDb29yZHMuYnIsIG90aGVyQ29vcmRzLmJsXSk7CiAgICAgIHJldHVybiBpbnRlcnNlY3Rpb24uc3RhdHVzID09PSAnSW50ZXJzZWN0aW9uJzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgb2JqZWN0IGlzIGZ1bGx5IGNvbnRhaW5lZCB3aXRoaW4gYXJlYSBvZiBhbm90aGVyIG9iamVjdAogICAgICogQG1ldGhvZCBpc0NvbnRhaW5lZFdpdGhpbk9iamVjdAogICAgICogQHBhcmFtIHtPYmplY3R9IG90aGVyIE9iamVjdCB0byB0ZXN0CiAgICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAgICovCiAgICBpc0NvbnRhaW5lZFdpdGhpbk9iamVjdDogZnVuY3Rpb24gaXNDb250YWluZWRXaXRoaW5PYmplY3Qob3RoZXIpIHsKICAgICAgcmV0dXJuIHRoaXMuaXNDb250YWluZWRXaXRoaW5SZWN0KG90aGVyLm9Db29yZHMudGwsIG90aGVyLm9Db29yZHMuYnIpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBvYmplY3QgaXMgZnVsbHkgY29udGFpbmVkIHdpdGhpbiBhcmVhIGZvcm1lZCBieSAyIHBvaW50cwogICAgICogQG1ldGhvZCBpc0NvbnRhaW5lZFdpdGhpblJlY3QKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZWxlY3Rpb25UTAogICAgICogQHBhcmFtIHtPYmplY3R9IHNlbGVjdGlvbkJSCiAgICAgKiBAcmV0dXJuIHtCb29sZWFufQogICAgICovCiAgICBpc0NvbnRhaW5lZFdpdGhpblJlY3Q6IGZ1bmN0aW9uIGlzQ29udGFpbmVkV2l0aGluUmVjdChzZWxlY3Rpb25UTCwgc2VsZWN0aW9uQlIpIHsKICAgICAgdmFyIG9Db29yZHMgPSB0aGlzLm9Db29yZHMsCiAgICAgICAgICB0bCA9IG5ldyBmYWJyaWMuUG9pbnQob0Nvb3Jkcy50bC54LCBvQ29vcmRzLnRsLnkpLAogICAgICAgICAgdHIgPSBuZXcgZmFicmljLlBvaW50KG9Db29yZHMudHIueCwgb0Nvb3Jkcy50ci55KSwKICAgICAgICAgIGJsID0gbmV3IGZhYnJpYy5Qb2ludChvQ29vcmRzLmJsLngsIG9Db29yZHMuYmwueSksCiAgICAgICAgICBiciA9IG5ldyBmYWJyaWMuUG9pbnQob0Nvb3Jkcy5ici54LCBvQ29vcmRzLmJyLnkpOwogICAgICByZXR1cm4gdGwueCA+IHNlbGVjdGlvblRMLnggJiYgdHIueCA8IHNlbGVjdGlvbkJSLnggJiYgdGwueSA+IHNlbGVjdGlvblRMLnkgJiYgYmwueSA8IHNlbGVjdGlvbkJSLnk7CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBpc1R5cGUKICAgICAqIEBwYXJhbSB0eXBlIHtTdHJpbmd9IHR5cGUgdG8gY2hlY2sgYWdhaW5zdAogICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBzcGVjaWZpZWQgdHlwZSBpcyBpZGVudGljYWwgdG8gdGhlIHR5cGUgb2YgaW5zdGFuY2UKICAgICAqLwogICAgaXNUeXBlOiBmdW5jdGlvbiBpc1R5cGUodHlwZSkgewogICAgICByZXR1cm4gdGhpcy50eXBlID09PSB0eXBlOwogICAgfSwKCiAgICAvKioKICAgICAqIERldGVybWluZXMgd2hpY2ggb25lIG9mIHRoZSBmb3VyIGNvcm5lcnMgaGFzIGJlZW4gY2xpY2tlZAogICAgICogQG1ldGhvZCBfZmluZFRhcmdldENvcm5lcgogICAgICogQHByaXZhdGUKICAgICAqIEBwYXJhbSBlIHtFdmVudH0gZXZlbnQgb2JqZWN0CiAgICAgKiBAcGFyYW0gb2Zmc2V0IHtPYmplY3R9IGNhbnZhcyBvZmZzZXQKICAgICAqIEByZXR1cm4ge1N0cmluZ3xCb29sZWFufSBjb3JuZXIgY29kZSAodGwsIHRyLCBibCwgYnIsIGV0Yy4pLCBvciBmYWxzZSBpZiBub3RoaW5nIGlzIGZvdW5kCiAgICAgKi8KICAgIF9maW5kVGFyZ2V0Q29ybmVyOiBmdW5jdGlvbiBfZmluZFRhcmdldENvcm5lcihlLCBvZmZzZXQpIHsKICAgICAgaWYgKCF0aGlzLmhhc0NvbnRyb2xzIHx8ICF0aGlzLmFjdGl2ZSkgcmV0dXJuIGZhbHNlOwogICAgICB2YXIgcG9pbnRlciA9IGdldFBvaW50ZXIoZSksCiAgICAgICAgICBleCA9IHBvaW50ZXIueCAtIG9mZnNldC5sZWZ0LAogICAgICAgICAgZXkgPSBwb2ludGVyLnkgLSBvZmZzZXQudG9wLAogICAgICAgICAgeHBvaW50cywKICAgICAgICAgIGxpbmVzOwoKICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLm9Db29yZHMpIHsKICAgICAgICBpZiAoaSA9PT0gJ210cicgJiYgIXRoaXMuaGFzUm90YXRpbmdQb2ludCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5sb2NrVW5pU2NhbGluZyAmJiAoaSA9PT0gJ210JyB8fCBpID09PSAnbXInIHx8IGkgPT09ICdtYicgfHwgaSA9PT0gJ21sJykpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgbGluZXMgPSB0aGlzLl9nZXRJbWFnZUxpbmVzKHRoaXMub0Nvb3Jkc1tpXS5jb3JuZXIsIGkpOyAvLyBkZWJ1Z2dpbmcKICAgICAgICAvLyBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChsaW5lcy5ib3R0b21saW5lLmQueCwgbGluZXMuYm90dG9tbGluZS5kLnksIDIsIDIpOwogICAgICAgIC8vIGNhbnZhcy5jb250ZXh0VG9wLmZpbGxSZWN0KGxpbmVzLmJvdHRvbWxpbmUuby54LCBsaW5lcy5ib3R0b21saW5lLm8ueSwgMiwgMik7CiAgICAgICAgLy8gY2FudmFzLmNvbnRleHRUb3AuZmlsbFJlY3QobGluZXMubGVmdGxpbmUuZC54LCBsaW5lcy5sZWZ0bGluZS5kLnksIDIsIDIpOwogICAgICAgIC8vIGNhbnZhcy5jb250ZXh0VG9wLmZpbGxSZWN0KGxpbmVzLmxlZnRsaW5lLm8ueCwgbGluZXMubGVmdGxpbmUuby55LCAyLCAyKTsKICAgICAgICAvLyBjYW52YXMuY29udGV4dFRvcC5maWxsUmVjdChsaW5lcy50b3BsaW5lLmQueCwgbGluZXMudG9wbGluZS5kLnksIDIsIDIpOwogICAgICAgIC8vIGNhbnZhcy5jb250ZXh0VG9wLmZpbGxSZWN0KGxpbmVzLnRvcGxpbmUuby54LCBsaW5lcy50b3BsaW5lLm8ueSwgMiwgMik7CiAgICAgICAgLy8gY2FudmFzLmNvbnRleHRUb3AuZmlsbFJlY3QobGluZXMucmlnaHRsaW5lLmQueCwgbGluZXMucmlnaHRsaW5lLmQueSwgMiwgMik7CiAgICAgICAgLy8gY2FudmFzLmNvbnRleHRUb3AuZmlsbFJlY3QobGluZXMucmlnaHRsaW5lLm8ueCwgbGluZXMucmlnaHRsaW5lLm8ueSwgMiwgMik7CgogICAgICAgIHhwb2ludHMgPSB0aGlzLl9maW5kQ3Jvc3NQb2ludHMoZXgsIGV5LCBsaW5lcyk7CgogICAgICAgIGlmICh4cG9pbnRzICUgMiA9PSAxICYmIHhwb2ludHMgIT0gMCkgewogICAgICAgICAgdGhpcy5fX2Nvcm5lciA9IGk7CiAgICAgICAgICByZXR1cm4gaTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGRldGVybWluZSBob3cgbWFueSBjcm9zcyBwb2ludHMgYXJlIGJldHdlZW4gdGhlIDQgaW1hZ2UgZWRnZXMKICAgICAqIGFuZCB0aGUgaG9yaXpvbnRhbCBsaW5lIGRldGVybWluZWQgYnkgdGhlIHBvc2l0aW9uIG9mIG91ciBtb3VzZSB3aGVuIGNsaWNrZWQgb24gY2FudmFzCiAgICAgKiBAbWV0aG9kIF9maW5kQ3Jvc3NQb2ludHMKICAgICAqIEBwcml2YXRlCiAgICAgKiBAcGFyYW0gZXgge051bWJlcn0geCBjb29yZGluYXRlIG9mIHRoZSBtb3VzZQogICAgICogQHBhcmFtIGV5IHtOdW1iZXJ9IHkgY29vcmRpbmF0ZSBvZiB0aGUgbW91c2UKICAgICAqIEBwYXJhbSBvQ29vcmRzIHtPYmplY3R9IENvb3JkaW5hdGVzIG9mIHRoZSBpbWFnZSBiZWluZyBldmFsdWF0ZWQKICAgICAqLwogICAgX2ZpbmRDcm9zc1BvaW50czogZnVuY3Rpb24gX2ZpbmRDcm9zc1BvaW50cyhleCwgZXksIG9Db29yZHMpIHsKICAgICAgdmFyIGIxLAogICAgICAgICAgYjIsCiAgICAgICAgICBhMSwKICAgICAgICAgIGEyLAogICAgICAgICAgeGksCiAgICAgICAgICB5aSwKICAgICAgICAgIHhjb3VudCA9IDAsCiAgICAgICAgICBpTGluZTsKCiAgICAgIGZvciAodmFyIGxpbmVLZXkgaW4gb0Nvb3JkcykgewogICAgICAgIGlMaW5lID0gb0Nvb3Jkc1tsaW5lS2V5XTsgLy8gb3B0aW1pc2F0aW9uIDE6IGxpbmUgYmVsb3cgZG90LiBubyBjcm9zcwoKICAgICAgICBpZiAoaUxpbmUuby55IDwgZXkgJiYgaUxpbmUuZC55IDwgZXkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gb3B0aW1pc2F0aW9uIDI6IGxpbmUgYWJvdmUgZG90LiBubyBjcm9zcwoKCiAgICAgICAgaWYgKGlMaW5lLm8ueSA+PSBleSAmJiBpTGluZS5kLnkgPj0gZXkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gb3B0aW1pc2F0aW9uIDM6IHZlcnRpY2FsIGxpbmUgY2FzZQoKCiAgICAgICAgaWYgKGlMaW5lLm8ueCA9PSBpTGluZS5kLnggJiYgaUxpbmUuby54ID49IGV4KSB7CiAgICAgICAgICB4aSA9IGlMaW5lLm8ueDsKICAgICAgICAgIHlpID0gZXk7CiAgICAgICAgfSAvLyBjYWxjdWxhdGUgdGhlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGVsc2UgewogICAgICAgICAgICBiMSA9IDA7CiAgICAgICAgICAgIGIyID0gKGlMaW5lLmQueSAtIGlMaW5lLm8ueSkgLyAoaUxpbmUuZC54IC0gaUxpbmUuby54KTsKICAgICAgICAgICAgYTEgPSBleSAtIGIxICogZXg7CiAgICAgICAgICAgIGEyID0gaUxpbmUuby55IC0gYjIgKiBpTGluZS5vLng7CiAgICAgICAgICAgIHhpID0gLShhMSAtIGEyKSAvIChiMSAtIGIyKTsKICAgICAgICAgICAgeWkgPSBhMSArIGIxICogeGk7CiAgICAgICAgICB9IC8vIGRvbnQgY291bnQgeGkgPCBleCBjYXNlcwoKCiAgICAgICAgaWYgKHhpID49IGV4KSB7CiAgICAgICAgICB4Y291bnQgKz0gMTsKICAgICAgICB9IC8vIG9wdGltaXNhdGlvbiA0OiBzcGVjaWZpYyBmb3Igc3F1YXJlIGltYWdlcwoKCiAgICAgICAgaWYgKHhjb3VudCA9PSAyKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB4Y291bnQ7CiAgICB9LAoKICAgIC8qKgogICAgICogTWV0aG9kIHRoYXQgcmV0dXJucyBhbiBvYmplY3Qgd2l0aCB0aGUgaW1hZ2UgbGluZXMgaW4gaXQgZ2l2ZW4gdGhlIGNvb3JkaW5hdGVzIG9mIHRoZSBjb3JuZXJzCiAgICAgKiBAbWV0aG9kIF9nZXRJbWFnZUxpbmVzCiAgICAgKiBAcHJpdmF0ZQogICAgICogQHBhcmFtIG9Db29yZHMge09iamVjdH0gY29vcmRpbmF0ZXMgb2YgdGhlIGltYWdlIGNvcm5lcnMKICAgICAqLwogICAgX2dldEltYWdlTGluZXM6IGZ1bmN0aW9uIF9nZXRJbWFnZUxpbmVzKG9Db29yZHMsIGkpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0b3BsaW5lOiB7CiAgICAgICAgICBvOiBvQ29vcmRzLnRsLAogICAgICAgICAgZDogb0Nvb3Jkcy50cgogICAgICAgIH0sCiAgICAgICAgcmlnaHRsaW5lOiB7CiAgICAgICAgICBvOiBvQ29vcmRzLnRyLAogICAgICAgICAgZDogb0Nvb3Jkcy5icgogICAgICAgIH0sCiAgICAgICAgYm90dG9tbGluZTogewogICAgICAgICAgbzogb0Nvb3Jkcy5iciwKICAgICAgICAgIGQ6IG9Db29yZHMuYmwKICAgICAgICB9LAogICAgICAgIGxlZnRsaW5lOiB7CiAgICAgICAgICBvOiBvQ29vcmRzLmJsLAogICAgICAgICAgZDogb0Nvb3Jkcy50bAogICAgICAgIH0KICAgICAgfTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgZHJhZ2dhYmxlIGJveGVzIGluIHRoZSBjb3JuZXJzIG9mCiAgICAgKiB0aGUgaW1hZ2UgdXNlZCB0byBzY2FsZS9yb3RhdGUgaXQuCiAgICAgKiBAbWV0aG9kIF9zZXRDb3JuZXJDb29yZHMKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIF9zZXRDb3JuZXJDb29yZHM6IGZ1bmN0aW9uIF9zZXRDb3JuZXJDb29yZHMoKSB7CiAgICAgIHZhciBjb29yZHMgPSB0aGlzLm9Db29yZHMsCiAgICAgICAgICB0aGV0YSA9IGRlZ3JlZXNUb1JhZGlhbnMoNDUgLSB0aGlzLmdldEFuZ2xlKCkpLAogICAgICAgICAgY29ybmVySHlwb3RlbnVzZSA9IE1hdGguc3FydCgyICogTWF0aC5wb3codGhpcy5jb3JuZXJzaXplLCAyKSkgLyAyLAogICAgICAgICAgY29zSGFsZk9mZnNldCA9IGNvcm5lckh5cG90ZW51c2UgKiBNYXRoLmNvcyh0aGV0YSksCiAgICAgICAgICBzaW5IYWxmT2Zmc2V0ID0gY29ybmVySHlwb3RlbnVzZSAqIE1hdGguc2luKHRoZXRhKSwKICAgICAgICAgIHNpblRoID0gTWF0aC5zaW4odGhpcy5fdGhldGEpLAogICAgICAgICAgY29zVGggPSBNYXRoLmNvcyh0aGlzLl90aGV0YSk7CiAgICAgIGNvb3Jkcy50bC5jb3JuZXIgPSB7CiAgICAgICAgdGw6IHsKICAgICAgICAgIHg6IGNvb3Jkcy50bC54IC0gc2luSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy50bC55IC0gY29zSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgdHI6IHsKICAgICAgICAgIHg6IGNvb3Jkcy50bC54ICsgY29zSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy50bC55IC0gc2luSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgYmw6IHsKICAgICAgICAgIHg6IGNvb3Jkcy50bC54IC0gY29zSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy50bC55ICsgc2luSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgYnI6IHsKICAgICAgICAgIHg6IGNvb3Jkcy50bC54ICsgc2luSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy50bC55ICsgY29zSGFsZk9mZnNldAogICAgICAgIH0KICAgICAgfTsKICAgICAgY29vcmRzLnRyLmNvcm5lciA9IHsKICAgICAgICB0bDogewogICAgICAgICAgeDogY29vcmRzLnRyLnggLSBzaW5IYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLnRyLnkgLSBjb3NIYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICB0cjogewogICAgICAgICAgeDogY29vcmRzLnRyLnggKyBjb3NIYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLnRyLnkgLSBzaW5IYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBicjogewogICAgICAgICAgeDogY29vcmRzLnRyLnggKyBzaW5IYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLnRyLnkgKyBjb3NIYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBibDogewogICAgICAgICAgeDogY29vcmRzLnRyLnggLSBjb3NIYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLnRyLnkgKyBzaW5IYWxmT2Zmc2V0CiAgICAgICAgfQogICAgICB9OwogICAgICBjb29yZHMuYmwuY29ybmVyID0gewogICAgICAgIHRsOiB7CiAgICAgICAgICB4OiBjb29yZHMuYmwueCAtIHNpbkhhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMuYmwueSAtIGNvc0hhbGZPZmZzZXQKICAgICAgICB9LAogICAgICAgIGJsOiB7CiAgICAgICAgICB4OiBjb29yZHMuYmwueCAtIGNvc0hhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMuYmwueSArIHNpbkhhbGZPZmZzZXQKICAgICAgICB9LAogICAgICAgIGJyOiB7CiAgICAgICAgICB4OiBjb29yZHMuYmwueCArIHNpbkhhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMuYmwueSArIGNvc0hhbGZPZmZzZXQKICAgICAgICB9LAogICAgICAgIHRyOiB7CiAgICAgICAgICB4OiBjb29yZHMuYmwueCArIGNvc0hhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMuYmwueSAtIHNpbkhhbGZPZmZzZXQKICAgICAgICB9CiAgICAgIH07CiAgICAgIGNvb3Jkcy5ici5jb3JuZXIgPSB7CiAgICAgICAgdHI6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5ici54ICsgY29zSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5ici55IC0gc2luSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgYmw6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5ici54IC0gY29zSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5ici55ICsgc2luSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgYnI6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5ici54ICsgc2luSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5ici55ICsgY29zSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgdGw6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5ici54IC0gc2luSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5ici55IC0gY29zSGFsZk9mZnNldAogICAgICAgIH0KICAgICAgfTsKICAgICAgY29vcmRzLm1sLmNvcm5lciA9IHsKICAgICAgICB0bDogewogICAgICAgICAgeDogY29vcmRzLm1sLnggLSBzaW5IYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1sLnkgLSBjb3NIYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICB0cjogewogICAgICAgICAgeDogY29vcmRzLm1sLnggKyBjb3NIYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1sLnkgLSBzaW5IYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBibDogewogICAgICAgICAgeDogY29vcmRzLm1sLnggLSBjb3NIYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1sLnkgKyBzaW5IYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBicjogewogICAgICAgICAgeDogY29vcmRzLm1sLnggKyBzaW5IYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1sLnkgKyBjb3NIYWxmT2Zmc2V0CiAgICAgICAgfQogICAgICB9OwogICAgICBjb29yZHMubXQuY29ybmVyID0gewogICAgICAgIHRsOiB7CiAgICAgICAgICB4OiBjb29yZHMubXQueCAtIHNpbkhhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMubXQueSAtIGNvc0hhbGZPZmZzZXQKICAgICAgICB9LAogICAgICAgIHRyOiB7CiAgICAgICAgICB4OiBjb29yZHMubXQueCArIGNvc0hhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMubXQueSAtIHNpbkhhbGZPZmZzZXQKICAgICAgICB9LAogICAgICAgIGJsOiB7CiAgICAgICAgICB4OiBjb29yZHMubXQueCAtIGNvc0hhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMubXQueSArIHNpbkhhbGZPZmZzZXQKICAgICAgICB9LAogICAgICAgIGJyOiB7CiAgICAgICAgICB4OiBjb29yZHMubXQueCArIHNpbkhhbGZPZmZzZXQsCiAgICAgICAgICB5OiBjb29yZHMubXQueSArIGNvc0hhbGZPZmZzZXQKICAgICAgICB9CiAgICAgIH07CiAgICAgIGNvb3Jkcy5tci5jb3JuZXIgPSB7CiAgICAgICAgdGw6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5tci54IC0gc2luSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5tci55IC0gY29zSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgdHI6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5tci54ICsgY29zSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5tci55IC0gc2luSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgYmw6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5tci54IC0gY29zSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5tci55ICsgc2luSGFsZk9mZnNldAogICAgICAgIH0sCiAgICAgICAgYnI6IHsKICAgICAgICAgIHg6IGNvb3Jkcy5tci54ICsgc2luSGFsZk9mZnNldCwKICAgICAgICAgIHk6IGNvb3Jkcy5tci55ICsgY29zSGFsZk9mZnNldAogICAgICAgIH0KICAgICAgfTsKICAgICAgY29vcmRzLm1iLmNvcm5lciA9IHsKICAgICAgICB0bDogewogICAgICAgICAgeDogY29vcmRzLm1iLnggLSBzaW5IYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1iLnkgLSBjb3NIYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICB0cjogewogICAgICAgICAgeDogY29vcmRzLm1iLnggKyBjb3NIYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1iLnkgLSBzaW5IYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBibDogewogICAgICAgICAgeDogY29vcmRzLm1iLnggLSBjb3NIYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1iLnkgKyBzaW5IYWxmT2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBicjogewogICAgICAgICAgeDogY29vcmRzLm1iLnggKyBzaW5IYWxmT2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm1iLnkgKyBjb3NIYWxmT2Zmc2V0CiAgICAgICAgfQogICAgICB9OwogICAgICBjb29yZHMubXRyLmNvcm5lciA9IHsKICAgICAgICB0bDogewogICAgICAgICAgeDogY29vcmRzLm10ci54IC0gc2luSGFsZk9mZnNldCArIHNpblRoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm10ci55IC0gY29zSGFsZk9mZnNldCAtIGNvc1RoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0CiAgICAgICAgfSwKICAgICAgICB0cjogewogICAgICAgICAgeDogY29vcmRzLm10ci54ICsgY29zSGFsZk9mZnNldCArIHNpblRoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm10ci55IC0gc2luSGFsZk9mZnNldCAtIGNvc1RoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBibDogewogICAgICAgICAgeDogY29vcmRzLm10ci54IC0gY29zSGFsZk9mZnNldCArIHNpblRoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm10ci55ICsgc2luSGFsZk9mZnNldCAtIGNvc1RoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0CiAgICAgICAgfSwKICAgICAgICBicjogewogICAgICAgICAgeDogY29vcmRzLm10ci54ICsgc2luSGFsZk9mZnNldCArIHNpblRoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0LAogICAgICAgICAgeTogY29vcmRzLm10ci55ICsgY29zSGFsZk9mZnNldCAtIGNvc1RoICogdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0CiAgICAgICAgfQogICAgICB9OwogICAgfSwKCiAgICAvKioKICAgICAqIE1ha2VzIG9iamVjdCdzIGNvbG9yIGdyYXlzY2FsZQogICAgICogQG1ldGhvZCB0b0dyYXlzY2FsZQogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICovCiAgICB0b0dyYXlzY2FsZTogZnVuY3Rpb24gdG9HcmF5c2NhbGUoKSB7CiAgICAgIHZhciBmaWxsVmFsdWUgPSB0aGlzLmdldCgnZmlsbCcpOwoKICAgICAgaWYgKGZpbGxWYWx1ZSkgewogICAgICAgIHRoaXMuc2V0KCdvdmVybGF5RmlsbCcsIG5ldyBmYWJyaWMuQ29sb3IoZmlsbFZhbHVlKS50b0dyYXlzY2FsZSgpLnRvUmdiKCkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIGNvbXBsZXhpdHkKICAgICAqIEByZXR1cm4ge051bWJlcn0KICAgICAqLwogICAgY29tcGxleGl0eTogZnVuY3Rpb24gY29tcGxleGl0eSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9KU09OCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGpzb24KICAgICAqLwogICAgdG9KU09OOiBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICAgIC8vIGRlbGVnYXRlLCBub3QgYWxpYXMKICAgICAgcmV0dXJuIHRoaXMudG9PYmplY3QoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIHNldEdyYWRpZW50RmlsbAogICAgICovCiAgICBzZXRHcmFkaWVudEZpbGw6IGZ1bmN0aW9uIHNldEdyYWRpZW50RmlsbChvcHRpb25zKSB7CiAgICAgIHRoaXMuc2V0KCdmaWxsJywgZmFicmljLkdyYWRpZW50LmZvck9iamVjdCh0aGlzLCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBhbmltYXRlCiAgICAgKgogICAgICogQXMgb2JqZWN0IOKAlCBtdWx0aXBsZSBwcm9wZXJ0aWVzCiAgICAgKgogICAgICogb2JqZWN0LmFuaW1hdGUoeyBsZWZ0OiAuLi4sIHRvcDogLi4uIH0pOwogICAgICogb2JqZWN0LmFuaW1hdGUoeyBsZWZ0OiAuLi4sIHRvcDogLi4uIH0sIHsgZHVyYXRpb246IC4uLiB9KTsKICAgICAqCiAgICAgKiBBcyBzdHJpbmcg4oCUIG9uZSBwcm9wZXJ0eQogICAgICoKICAgICAqIG9iamVjdC5hbmltYXRlKCdsZWZ0JywgLi4uKTsKICAgICAqIG9iamVjdC5hbmltYXRlKCdsZWZ0JywgeyBkdXJhdGlvbjogLi4uIH0pOwogICAgICoKICAgICAqLwogICAgYW5pbWF0ZTogZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgaWYgKGFyZ3VtZW50c1swXSAmJiBfdHlwZW9mKGFyZ3VtZW50c1swXSkgPT0gJ29iamVjdCcpIHsKICAgICAgICBmb3IgKHZhciBwcm9wIGluIGFyZ3VtZW50c1swXSkgewogICAgICAgICAgdGhpcy5fYW5pbWF0ZShwcm9wLCBhcmd1bWVudHNbMF1bcHJvcF0sIGFyZ3VtZW50c1sxXSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX2FuaW1hdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2FuaW1hdGUKICAgICAqLwogICAgX2FuaW1hdGU6IGZ1bmN0aW9uIF9hbmltYXRlKHByb3BlcnR5LCB0bywgb3B0aW9ucykgewogICAgICB2YXIgb2JqID0gdGhpczsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIGlmICghKCdmcm9tJyBpbiBvcHRpb25zKSkgewogICAgICAgIG9wdGlvbnMuZnJvbSA9IHRoaXMuZ2V0KHByb3BlcnR5KTsKICAgICAgfQoKICAgICAgaWYgKC9bKy1dLy50ZXN0KCh0byArICcnKS5jaGFyQXQoMCkpKSB7CiAgICAgICAgdG8gPSB0aGlzLmdldChwcm9wZXJ0eSkgKyBwYXJzZUZsb2F0KHRvKTsKICAgICAgfQoKICAgICAgZmFicmljLnV0aWwuYW5pbWF0ZSh7CiAgICAgICAgc3RhcnRWYWx1ZTogb3B0aW9ucy5mcm9tLAogICAgICAgIGVuZFZhbHVlOiB0bywKICAgICAgICBieVZhbHVlOiBvcHRpb25zLmJ5LAogICAgICAgIGVhc2luZzogb3B0aW9ucy5lYXNpbmcsCiAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24sCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHZhbHVlKSB7CiAgICAgICAgICBvYmouc2V0KHByb3BlcnR5LCB2YWx1ZSk7CiAgICAgICAgICBvcHRpb25zLm9uQ2hhbmdlICYmIG9wdGlvbnMub25DaGFuZ2UoKTsKICAgICAgICB9LAogICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uIG9uQ29tcGxldGUoKSB7CiAgICAgICAgICBvYmouc2V0Q29vcmRzKCk7CiAgICAgICAgICBvcHRpb25zLm9uQ29tcGxldGUgJiYgb3B0aW9ucy5vbkNvbXBsZXRlKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDZW50ZXJzIG9iamVjdCBob3Jpem9udGFsbHkgb24gY2FudmFzIHRvIHdoaWNoIGl0IHdhcyBhZGRlZCBsYXN0CiAgICAgKiBAbWV0aG9kIGNlbnRlckgKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgICAqLwogICAgY2VudGVySDogZnVuY3Rpb24gY2VudGVySCgpIHsKICAgICAgdGhpcy5jYW52YXMuY2VudGVyT2JqZWN0SCh0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2VudGVycyBvYmplY3QgdmVydGljYWxseSBvbiBjYW52YXMgdG8gd2hpY2ggaXQgd2FzIGFkZGVkIGxhc3QKICAgICAqIEBtZXRob2QgY2VudGVyVgogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBjZW50ZXJWOiBmdW5jdGlvbiBjZW50ZXJWKCkgewogICAgICB0aGlzLmNhbnZhcy5jZW50ZXJPYmplY3RWKHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDZW50ZXJzIG9iamVjdCB2ZXJ0aWNhbGx5IGFuZCBob3Jpem9udGFsbHkgb24gY2FudmFzIHRvIHdoaWNoIGlzIHdhcyBhZGRlZCBsYXN0CiAgICAgKiBAbWV0aG9kIGNlbnRlcgogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBjZW50ZXI6IGZ1bmN0aW9uIGNlbnRlcigpIHsKICAgICAgcmV0dXJuIHRoaXMuY2VudGVySCgpLmNlbnRlclYoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZW1vdmVzIG9iamVjdCBmcm9tIGNhbnZhcyB0byB3aGljaCBpdCB3YXMgYWRkZWQgbGFzdAogICAgICogQG1ldGhvZCByZW1vdmUKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoKSB7CiAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7CiAgICB9LAoKICAgIC8qKgogICAgICogTW92ZXMgYW4gb2JqZWN0IHRvIHRoZSBib3R0b20gb2YgdGhlIHN0YWNrIG9mIGRyYXduIG9iamVjdHMKICAgICAqIEBtZXRob2Qgc2VuZFRvQmFjawogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZW5kVG9CYWNrOiBmdW5jdGlvbiBzZW5kVG9CYWNrKCkgewogICAgICB0aGlzLmNhbnZhcy5zZW5kVG9CYWNrKHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBNb3ZlcyBhbiBvYmplY3QgdG8gdGhlIHRvcCBvZiB0aGUgc3RhY2sgb2YgZHJhd24gb2JqZWN0cwogICAgICogQG1ldGhvZCBicmluZ1RvRnJvbnQKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgYnJpbmdUb0Zyb250OiBmdW5jdGlvbiBicmluZ1RvRnJvbnQoKSB7CiAgICAgIHRoaXMuY2FudmFzLmJyaW5nVG9Gcm9udCh0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogTW92ZXMgYW4gb2JqZWN0IG9uZSBsZXZlbCBkb3duIGluIHN0YWNrIG9mIGRyYXduIG9iamVjdHMKICAgICAqIEBtZXRob2Qgc2VuZEJhY2t3YXJkcwogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZW5kQmFja3dhcmRzOiBmdW5jdGlvbiBzZW5kQmFja3dhcmRzKCkgewogICAgICB0aGlzLmNhbnZhcy5zZW5kQmFja3dhcmRzKHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBNb3ZlcyBhbiBvYmplY3Qgb25lIGxldmVsIHVwIGluIHN0YWNrIG9mIGRyYXduIG9iamVjdHMKICAgICAqIEBtZXRob2QgYnJpbmdGb3J3YXJkCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGJyaW5nRm9yd2FyZDogZnVuY3Rpb24gYnJpbmdGb3J3YXJkKCkgewogICAgICB0aGlzLmNhbnZhcy5icmluZ0ZvcndhcmQodGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0pOwogIC8qKgogICAqIEBhbGlhcyByb3RhdGUgLT4gc2V0QW5nbGUKICAgKi8KCiAgZmFicmljLk9iamVjdC5wcm90b3R5cGUucm90YXRlID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0QW5nbGU7CiAgdmFyIHByb3RvID0gZmFicmljLk9iamVjdC5wcm90b3R5cGU7CgogIGZvciAodmFyIGkgPSBwcm90by5zdGF0ZVByb3BlcnRpZXMubGVuZ3RoOyBpLS07KSB7CiAgICB2YXIgcHJvcE5hbWUgPSBwcm90by5zdGF0ZVByb3BlcnRpZXNbaV0sCiAgICAgICAgY2FwaXRhbGl6ZWRQcm9wTmFtZSA9IHByb3BOYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvcE5hbWUuc2xpY2UoMSksCiAgICAgICAgc2V0dGVyTmFtZSA9ICdzZXQnICsgY2FwaXRhbGl6ZWRQcm9wTmFtZSwKICAgICAgICBnZXR0ZXJOYW1lID0gJ2dldCcgKyBjYXBpdGFsaXplZFByb3BOYW1lOyAvLyB1c2luZyBgbmV3IEZ1bmN0aW9uYCBmb3IgYmV0dGVyIGludHJvc3BlY3Rpb24KCiAgICBpZiAoIXByb3RvW2dldHRlck5hbWVdKSB7CiAgICAgIHByb3RvW2dldHRlck5hbWVdID0gZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMuZ2V0KCInICsgcHJvcGVydHkgKyAnIiknKTsKICAgICAgfShwcm9wTmFtZSk7CiAgICB9CgogICAgaWYgKCFwcm90b1tzZXR0ZXJOYW1lXSkgewogICAgICBwcm90b1tzZXR0ZXJOYW1lXSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSkgewogICAgICAgIHJldHVybiBuZXcgRnVuY3Rpb24oJ3ZhbHVlJywgJ3JldHVybiB0aGlzLnNldCgiJyArIHByb3BlcnR5ICsgJyIsIHZhbHVlKScpOwogICAgICB9KHByb3BOYW1lKTsKICAgIH0KICB9CgogIGV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwgZmFicmljLk9ic2VydmFibGUpOwogIGV4dGVuZChmYWJyaWMuT2JqZWN0LCB7CiAgICAvKioKICAgICAqIEBzdGF0aWMKICAgICAqIEBjb25zdGFudAogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIE5VTV9GUkFDVElPTl9ESUdJVFM6IDIsCgogICAgLyoqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAY29uc3RhbnQKICAgICAqIEB0eXBlIE51bWJlcgogICAgICovCiAgICBNSU5fU0NBTEVfTElNSVQ6IDAuMQogIH0pOwp9KSh0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyA/IGV4cG9ydHMgOiB0aGlzKTsKCihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgZmFicmljID0gZ2xvYmFsLmZhYnJpYyB8fCAoZ2xvYmFsLmZhYnJpYyA9IHt9KSwKICAgICAgZXh0ZW5kID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCwKICAgICAgcGFyZW50U2V0ID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0LAogICAgICBjb29yZFByb3BzID0gewogICAgJ3gxJzogMSwKICAgICd4Mic6IDEsCiAgICAneTEnOiAxLAogICAgJ3kyJzogMQogIH07CgogIGlmIChmYWJyaWMuTGluZSkgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5MaW5lIGlzIGFscmVhZHkgZGVmaW5lZCcpOwogICAgcmV0dXJuOwogIH0KICAvKioKICAgKiBAY2xhc3MgTGluZQogICAqIEBleHRlbmRzIGZhYnJpYy5PYmplY3QKICAgKi8KCgogIGZhYnJpYy5MaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwKICAvKiogQHNjb3BlIGZhYnJpYy5MaW5lLnByb3RvdHlwZSAqLwogIHsKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdHlwZTogJ2xpbmUnLAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IKICAgICAqIEBtZXRob2QgaW5pdGlhbGl6ZQogICAgICogQHBhcmFtIHtBcnJheX0gcG9pbnRzIEFycmF5IG9mIHBvaW50cwogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAgICogQHJldHVybiB7ZmFicmljLkxpbmV9IHRoaXNBcmcKICAgICAqLwogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShwb2ludHMsIG9wdGlvbnMpIHsKICAgICAgaWYgKCFwb2ludHMpIHsKICAgICAgICBwb2ludHMgPSBbMCwgMCwgMCwgMF07CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7CiAgICAgIHRoaXMuc2V0KCd4MScsIHBvaW50c1swXSk7CiAgICAgIHRoaXMuc2V0KCd5MScsIHBvaW50c1sxXSk7CiAgICAgIHRoaXMuc2V0KCd4MicsIHBvaW50c1syXSk7CiAgICAgIHRoaXMuc2V0KCd5MicsIHBvaW50c1szXSk7CgogICAgICB0aGlzLl9zZXRXaWR0aEhlaWdodChvcHRpb25zKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfc2V0V2lkdGhIZWlnaHQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICAgKi8KICAgIF9zZXRXaWR0aEhlaWdodDogZnVuY3Rpb24gX3NldFdpZHRoSGVpZ2h0KG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdGhpcy5zZXQoJ3dpZHRoJywgdGhpcy54MiAtIHRoaXMueDEgfHwgMSk7CiAgICAgIHRoaXMuc2V0KCdoZWlnaHQnLCB0aGlzLnkyIC0gdGhpcy55MSB8fCAxKTsKICAgICAgdGhpcy5zZXQoJ2xlZnQnLCAnbGVmdCcgaW4gb3B0aW9ucyA/IG9wdGlvbnMubGVmdCA6IHRoaXMueDEgKyB0aGlzLndpZHRoIC8gMik7CiAgICAgIHRoaXMuc2V0KCd0b3AnLCAndG9wJyBpbiBvcHRpb25zID8gb3B0aW9ucy50b3AgOiB0aGlzLnkxICsgdGhpcy5oZWlnaHQgLyAyKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfc2V0CiAgICAgKiBAcGFyYW0ge1N0cmluZ30ga2V5CiAgICAgKiBAcGFyYW0ge0FueX0gdmFsdWUKICAgICAqLwogICAgX3NldDogZnVuY3Rpb24gX3NldChrZXksIHZhbHVlKSB7CiAgICAgIHRoaXNba2V5XSA9IHZhbHVlOwoKICAgICAgaWYgKGtleSBpbiBjb29yZFByb3BzKSB7CiAgICAgICAgdGhpcy5fc2V0V2lkdGhIZWlnaHQoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX3JlbmRlcgogICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvbgogICAgICovCiAgICBfcmVuZGVyOiBmdW5jdGlvbiBfcmVuZGVyKGN0eCkgewogICAgICBjdHguYmVnaW5QYXRoKCk7CgogICAgICBpZiAodGhpcy5ncm91cCkgewogICAgICAgIGN0eC50cmFuc2xhdGUoLXRoaXMuZ3JvdXAud2lkdGggLyAyICsgdGhpcy5sZWZ0LCAtdGhpcy5ncm91cC5oZWlnaHQgLyAyICsgdGhpcy50b3ApOwogICAgICB9IC8vIG1vdmUgZnJvbSBjZW50ZXIgKG9mIHZpcnR1YWwgYm94KSB0byBpdHMgbGVmdC90b3AgY29ybmVyCgoKICAgICAgY3R4Lm1vdmVUbyh0aGlzLndpZHRoID09PSAxID8gMCA6IC10aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQgPT09IDEgPyAwIDogLXRoaXMuaGVpZ2h0IC8gMik7CiAgICAgIGN0eC5saW5lVG8odGhpcy53aWR0aCA9PT0gMSA/IDAgOiB0aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQgPT09IDEgPyAwIDogdGhpcy5oZWlnaHQgLyAyKTsKICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuc3Ryb2tlV2lkdGg7IC8vIFRPRE86IHRlc3QgdGhpcwogICAgICAvLyBtYWtlIHN1cmUgc2V0dGluZyAiZmlsbCIgY2hhbmdlcyBjb2xvciBvZiBhIGxpbmUKICAgICAgLy8gKGJ5IGNvcHlpbmcgZmlsbFN0eWxlIHRvIHN0cm9rZVN0eWxlLCBzaW5jZSBsaW5lIGlzIHN0cm9rZWQsIG5vdCBmaWxsZWQpCgogICAgICB2YXIgb3JpZ1N0cm9rZVN0eWxlID0gY3R4LnN0cm9rZVN0eWxlOwogICAgICBjdHguc3Ryb2tlU3R5bGUgPSBjdHguZmlsbFN0eWxlOwogICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IG9yaWdTdHJva2VTdHlsZTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGNvbXBsZXhpdHkgb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgY29tcGxleGl0eQogICAgICogQHJldHVybiB7TnVtYmVyfSBjb21wbGV4aXR5CiAgICAgKi8KICAgIGNvbXBsZXhpdHk6IGZ1bmN0aW9uIGNvbXBsZXhpdHkoKSB7CiAgICAgIHJldHVybiAxOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aGQgdG9PYmplY3QKICAgICAqIEByZXR1cm4ge09iamVjdH0KICAgICAqLwogICAgdG9PYmplY3Q6IGZ1bmN0aW9uIHRvT2JqZWN0KCkgewogICAgICByZXR1cm4gZXh0ZW5kKHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpLCB7CiAgICAgICAgeDE6IHRoaXMuZ2V0KCd4MScpLAogICAgICAgIHkxOiB0aGlzLmdldCgneTEnKSwKICAgICAgICB4MjogdGhpcy5nZXQoJ3gyJyksCiAgICAgICAgeTI6IHRoaXMuZ2V0KCd5MicpCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHJldHVybiBbJzxsaW5lICcsICd4MT0iJywgdGhpcy5nZXQoJ3gxJyksICciICcsICd5MT0iJywgdGhpcy5nZXQoJ3kxJyksICciICcsICd4Mj0iJywgdGhpcy5nZXQoJ3gyJyksICciICcsICd5Mj0iJywgdGhpcy5nZXQoJ3kyJyksICciICcsICdzdHlsZT0iJywgdGhpcy5nZXRTdmdTdHlsZXMoKSwgJyIgJywgJy8+J10uam9pbignJyk7CiAgICB9CiAgfSk7CiAgLyoqCiAgICogTGlzdCBvZiBhdHRyaWJ1dGUgbmFtZXMgdG8gYWNjb3VudCBmb3Igd2hlbiBwYXJzaW5nIFNWRyBlbGVtZW50ICh1c2VkIGJ5IGBmYWJyaWMuTGluZS5mcm9tRWxlbWVudGApCiAgICogQHN0YXRpYwogICAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHL3NoYXBlcy5odG1sI0xpbmVFbGVtZW50CiAgICovCgogIGZhYnJpYy5MaW5lLkFUVFJJQlVURV9OQU1FUyA9ICd4MSB5MSB4MiB5MiBzdHJva2Ugc3Ryb2tlLXdpZHRoIHRyYW5zZm9ybScuc3BsaXQoJyAnKTsKICAvKioKICAgKiBSZXR1cm5zIGZhYnJpYy5MaW5lIGluc3RhbmNlIGZyb20gYW4gU1ZHIGVsZW1lbnQKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuTGluZS5mcm9tRWxlbWVudAogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZWxlbWVudCBFbGVtZW50IHRvIHBhcnNlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqIEByZXR1cm4ge2ZhYnJpYy5MaW5lfSBpbnN0YW5jZSBvZiBmYWJyaWMuTGluZQogICAqLwoKICBmYWJyaWMuTGluZS5mcm9tRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB2YXIgcGFyc2VkQXR0cmlidXRlcyA9IGZhYnJpYy5wYXJzZUF0dHJpYnV0ZXMoZWxlbWVudCwgZmFicmljLkxpbmUuQVRUUklCVVRFX05BTUVTKTsKICAgIHZhciBwb2ludHMgPSBbcGFyc2VkQXR0cmlidXRlcy54MSB8fCAwLCBwYXJzZWRBdHRyaWJ1dGVzLnkxIHx8IDAsIHBhcnNlZEF0dHJpYnV0ZXMueDIgfHwgMCwgcGFyc2VkQXR0cmlidXRlcy55MiB8fCAwXTsKICAgIHJldHVybiBuZXcgZmFicmljLkxpbmUocG9pbnRzLCBleHRlbmQocGFyc2VkQXR0cmlidXRlcywgb3B0aW9ucykpOwogIH07CiAgLyoqCiAgICogUmV0dXJucyBmYWJyaWMuTGluZSBpbnN0YW5jZSBmcm9tIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbgogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZhYnJpYy5MaW5lLmZyb21PYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbQogICAqIEByZXR1cm4ge2ZhYnJpYy5MaW5lfSBpbnN0YW5jZSBvZiBmYWJyaWMuTGluZQogICAqLwoKCiAgZmFicmljLkxpbmUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHsKICAgIHZhciBwb2ludHMgPSBbb2JqZWN0LngxLCBvYmplY3QueTEsIG9iamVjdC54Miwgb2JqZWN0LnkyXTsKICAgIHJldHVybiBuZXcgZmFicmljLkxpbmUocG9pbnRzLCBvYmplY3QpOwogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBmYWJyaWMgPSBnbG9iYWwuZmFicmljIHx8IChnbG9iYWwuZmFicmljID0ge30pLAogICAgICBwaUJ5MiA9IE1hdGguUEkgKiAyLAogICAgICBleHRlbmQgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kOwoKICBpZiAoZmFicmljLkNpcmNsZSkgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5DaXJjbGUgaXMgYWxyZWFkeSBkZWZpbmVkLicpOwogICAgcmV0dXJuOwogIH0KICAvKioKICAgKiBAY2xhc3MgQ2lyY2xlCiAgICogQGV4dGVuZHMgZmFicmljLk9iamVjdAogICAqLwoKCiAgZmFicmljLkNpcmNsZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3QsCiAgLyoqIEBzY29wZSBmYWJyaWMuQ2lyY2xlLnByb3RvdHlwZSAqLwogIHsKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdHlwZTogJ2NpcmNsZScsCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICogQG1ldGhvZCBpbml0aWFsaXplCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2lyY2xlfSB0aGlzQXJnCiAgICAgKi8KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgdGhpcy5zZXQoJ3JhZGl1cycsIG9wdGlvbnMucmFkaXVzIHx8IDApOwogICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpOwogICAgICB2YXIgZGlhbWV0ZXIgPSB0aGlzLmdldCgncmFkaXVzJykgKiAyOwogICAgICB0aGlzLnNldCgnd2lkdGgnLCBkaWFtZXRlcikuc2V0KCdoZWlnaHQnLCBkaWFtZXRlcik7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9PYmplY3QKICAgICAqIEByZXR1cm4ge09iamVjdH0gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIHRvT2JqZWN0OiBmdW5jdGlvbiB0b09iamVjdCgpIHsKICAgICAgcmV0dXJuIGV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnKSwgewogICAgICAgIHJhZGl1czogdGhpcy5nZXQoJ3JhZGl1cycpCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHJldHVybiAnPGNpcmNsZSAnICsgJ2N4PSIwIiBjeT0iMCIgJyArICdyPSInICsgdGhpcy5yYWRpdXMgKyAnIiAnICsgJ3N0eWxlPSInICsgdGhpcy5nZXRTdmdTdHlsZXMoKSArICciICcgKyAndHJhbnNmb3JtPSInICsgdGhpcy5nZXRTdmdUcmFuc2Zvcm0oKSArICciICcgKyAnLz4nOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXIKICAgICAqIEBwYXJhbSBjdHgge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgsIG5vVHJhbnNmb3JtKSB7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsgLy8gbXVsdGlwbHkgYnkgY3VycmVudGx5IHNldCBhbHBoYSAodGhlIG9uZSB0aGF0IHdhcyBzZXQgYnkgcGF0aCBncm91cCB3aGVyZSB0aGlzIG9iamVjdCBpcyBjb250YWluZWQsIGZvciBleGFtcGxlKQoKICAgICAgY3R4Lmdsb2JhbEFscGhhICo9IHRoaXMub3BhY2l0eTsKICAgICAgY3R4LmFyYyhub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IDAsIG5vVHJhbnNmb3JtID8gdGhpcy50b3AgOiAwLCB0aGlzLnJhZGl1cywgMCwgcGlCeTIsIGZhbHNlKTsKICAgICAgY3R4LmNsb3NlUGF0aCgpOwoKICAgICAgaWYgKHRoaXMuZmlsbCkgewogICAgICAgIGN0eC5maWxsKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnN0cm9rZSkgewogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgaG9yaXpvbnRhbCByYWRpdXMgb2YgYW4gb2JqZWN0IChhY2NvcmRpbmcgdG8gaG93IGFuIG9iamVjdCBpcyBzY2FsZWQpCiAgICAgKiBAbWV0aG9kIGdldFJhZGl1c1gKICAgICAqIEByZXR1cm4ge051bWJlcn0KICAgICAqLwogICAgZ2V0UmFkaXVzWDogZnVuY3Rpb24gZ2V0UmFkaXVzWCgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdyYWRpdXMnKSAqIHRoaXMuZ2V0KCdzY2FsZVgnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHZlcnRpY2FsIHJhZGl1cyBvZiBhbiBvYmplY3QgKGFjY29yZGluZyB0byBob3cgYW4gb2JqZWN0IGlzIHNjYWxlZCkKICAgICAqIEBtZXRob2QgZ2V0UmFkaXVzWQogICAgICogQHJldHVybiB7TnVtYmVyfQogICAgICovCiAgICBnZXRSYWRpdXNZOiBmdW5jdGlvbiBnZXRSYWRpdXNZKCkgewogICAgICByZXR1cm4gdGhpcy5nZXQoJ3JhZGl1cycpICogdGhpcy5nZXQoJ3NjYWxlWScpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgcmFkaXVzIG9mIGFuIG9iamVjdCAoYW5kIHVwZGF0ZXMgd2lkdGggYWNjb3JkaW5nbHkpCiAgICAgKiBAbWV0aG9kIHNldFJhZGl1cwogICAgICogQHJldHVybiB7TnVtYmVyfQogICAgICovCiAgICBzZXRSYWRpdXM6IGZ1bmN0aW9uIHNldFJhZGl1cyh2YWx1ZSkgewogICAgICB0aGlzLnJhZGl1cyA9IHZhbHVlOwogICAgICB0aGlzLnNldCgnd2lkdGgnLCB2YWx1ZSAqIDIpLnNldCgnaGVpZ2h0JywgdmFsdWUgKiAyKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGNvbXBsZXhpdHkgb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgY29tcGxleGl0eQogICAgICogQHJldHVybiB7TnVtYmVyfSBjb21wbGV4aXR5IG9mIHRoaXMgaW5zdGFuY2UKICAgICAqLwogICAgY29tcGxleGl0eTogZnVuY3Rpb24gY29tcGxleGl0eSgpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9CiAgfSk7CiAgLyoqCiAgICogTGlzdCBvZiBhdHRyaWJ1dGUgbmFtZXMgdG8gYWNjb3VudCBmb3Igd2hlbiBwYXJzaW5nIFNWRyBlbGVtZW50ICh1c2VkIGJ5IHtAbGluayBmYWJyaWMuQ2lyY2xlLmZyb21FbGVtZW50fSkKICAgKiBAc3RhdGljCiAgICogQHNlZTogaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHL3NoYXBlcy5odG1sI0NpcmNsZUVsZW1lbnQKICAgKi8KCiAgZmFicmljLkNpcmNsZS5BVFRSSUJVVEVfTkFNRVMgPSAnY3ggY3kgciBmaWxsIGZpbGwtb3BhY2l0eSBvcGFjaXR5IHN0cm9rZSBzdHJva2Utd2lkdGggdHJhbnNmb3JtJy5zcGxpdCgnICcpOwogIC8qKgogICAqIFJldHVybnMge0BsaW5rIGZhYnJpYy5DaXJjbGV9IGluc3RhbmNlIGZyb20gYW4gU1ZHIGVsZW1lbnQKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuQ2lyY2xlLmZyb21FbGVtZW50CiAgICogQHBhcmFtIGVsZW1lbnQge1NWR0VsZW1lbnR9IGVsZW1lbnQgdG8gcGFyc2UKICAgKiBAcGFyYW0gb3B0aW9ucyB7T2JqZWN0fSBvcHRpb25zIG9iamVjdAogICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB2YWx1ZSBvZiBgcmAgYXR0cmlidXRlIGlzIG1pc3Npbmcgb3IgaW52YWxpZAogICAqIEByZXR1cm4ge09iamVjdH0gaW5zdGFuY2Ugb2YgZmFicmljLkNpcmNsZQogICAqLwoKICBmYWJyaWMuQ2lyY2xlLmZyb21FbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB2YXIgcGFyc2VkQXR0cmlidXRlcyA9IGZhYnJpYy5wYXJzZUF0dHJpYnV0ZXMoZWxlbWVudCwgZmFicmljLkNpcmNsZS5BVFRSSUJVVEVfTkFNRVMpOwoKICAgIGlmICghaXNWYWxpZFJhZGl1cyhwYXJzZWRBdHRyaWJ1dGVzKSkgewogICAgICB0aHJvdyBFcnJvcigndmFsdWUgb2YgYHJgIGF0dHJpYnV0ZSBpcyByZXF1aXJlZCBhbmQgY2FuIG5vdCBiZSBuZWdhdGl2ZScpOwogICAgfQoKICAgIGlmICgnbGVmdCcgaW4gcGFyc2VkQXR0cmlidXRlcykgewogICAgICBwYXJzZWRBdHRyaWJ1dGVzLmxlZnQgLT0gb3B0aW9ucy53aWR0aCAvIDIgfHwgMDsKICAgIH0KCiAgICBpZiAoJ3RvcCcgaW4gcGFyc2VkQXR0cmlidXRlcykgewogICAgICBwYXJzZWRBdHRyaWJ1dGVzLnRvcCAtPSBvcHRpb25zLmhlaWdodCAvIDIgfHwgMDsKICAgIH0KCiAgICByZXR1cm4gbmV3IGZhYnJpYy5DaXJjbGUoZXh0ZW5kKHBhcnNlZEF0dHJpYnV0ZXMsIG9wdGlvbnMpKTsKICB9OwogIC8qKgogICAqIEBwcml2YXRlCiAgICovCgoKICBmdW5jdGlvbiBpc1ZhbGlkUmFkaXVzKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiAncmFkaXVzJyBpbiBhdHRyaWJ1dGVzICYmIGF0dHJpYnV0ZXMucmFkaXVzID4gMDsKICB9CiAgLyoqCiAgICogUmV0dXJucyB7QGxpbmsgZmFicmljLkNpcmNsZX0gaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24KICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuQ2lyY2xlLmZyb21PYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbQogICAqIEByZXR1cm4ge09iamVjdH0gSW5zdGFuY2Ugb2YgZmFicmljLkNpcmNsZQogICAqLwoKCiAgZmFicmljLkNpcmNsZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgcmV0dXJuIG5ldyBmYWJyaWMuQ2lyY2xlKG9iamVjdCk7CiAgfTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSk7CgogIGlmIChmYWJyaWMuVHJpYW5nbGUpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuVHJpYW5nbGUgaXMgYWxyZWFkeSBkZWZpbmVkJyk7CiAgICByZXR1cm47CiAgfQogIC8qKiAKICAgKiBAY2xhc3MgVHJpYW5nbGUKICAgKiBAZXh0ZW5kcyBmYWJyaWMuT2JqZWN0CiAgICovCgoKICBmYWJyaWMuVHJpYW5nbGUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuT2JqZWN0LAogIC8qKiBAc2NvcGUgZmFicmljLlRyaWFuZ2xlLnByb3RvdHlwZSAqLwogIHsKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdHlwZTogJ3RyaWFuZ2xlJywKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAbWV0aG9kIGluaXRpYWxpemUKICAgICAqIEBwYXJhbSBvcHRpb25zIHtPYmplY3R9IG9wdGlvbnMgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoaXNBcmcKICAgICAqLwogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpOwogICAgICB0aGlzLnNldCgnd2lkdGgnLCBvcHRpb25zLndpZHRoIHx8IDEwMCkuc2V0KCdoZWlnaHQnLCBvcHRpb25zLmhlaWdodCB8fCAxMDApOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXIKICAgICAqIEBwYXJhbSBjdHgge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gQ29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgpIHsKICAgICAgdmFyIHdpZHRoQnkyID0gdGhpcy53aWR0aCAvIDIsCiAgICAgICAgICBoZWlnaHRCeTIgPSB0aGlzLmhlaWdodCAvIDI7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgY3R4Lm1vdmVUbygtd2lkdGhCeTIsIGhlaWdodEJ5Mik7CiAgICAgIGN0eC5saW5lVG8oMCwgLWhlaWdodEJ5Mik7CiAgICAgIGN0eC5saW5lVG8od2lkdGhCeTIsIGhlaWdodEJ5Mik7CiAgICAgIGN0eC5jbG9zZVBhdGgoKTsKCiAgICAgIGlmICh0aGlzLmZpbGwpIHsKICAgICAgICBjdHguZmlsbCgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdHJva2UpIHsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGNvbXBsZXhpdHkgb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgY29tcGxleGl0eQogICAgICogQHJldHVybiB7TnVtYmVyfSBjb21wbGV4aXR5IG9mIHRoaXMgaW5zdGFuY2UKICAgICAqLwogICAgY29tcGxleGl0eTogZnVuY3Rpb24gY29tcGxleGl0eSgpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBzdmcgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9TVkcKICAgICAqIEByZXR1cm4ge3N0cmluZ30gc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIHRvU1ZHOiBmdW5jdGlvbiB0b1NWRygpIHsKICAgICAgdmFyIHdpZHRoQnkyID0gdGhpcy53aWR0aCAvIDIsCiAgICAgICAgICBoZWlnaHRCeTIgPSB0aGlzLmhlaWdodCAvIDI7CiAgICAgIHZhciBwb2ludHMgPSBbLXdpZHRoQnkyICsgIiAiICsgaGVpZ2h0QnkyLCAiMCAiICsgLWhlaWdodEJ5Miwgd2lkdGhCeTIgKyAiICIgKyBoZWlnaHRCeTJdLmpvaW4oIiwiKTsKICAgICAgcmV0dXJuICc8cG9seWdvbiAnICsgJ3BvaW50cz0iJyArIHBvaW50cyArICciICcgKyAnc3R5bGU9IicgKyB0aGlzLmdldFN2Z1N0eWxlcygpICsgJyIgJyArICd0cmFuc2Zvcm09IicgKyB0aGlzLmdldFN2Z1RyYW5zZm9ybSgpICsgJyIgJyArICcvPic7CiAgICB9CiAgfSk7CiAgLyoqCiAgICogUmV0dXJucyBmYWJyaWMuVHJpYW5nbGUgaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24KICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBDYW52YXMuVHJhbmdsZS5mcm9tT2JqZWN0CiAgICogQHBhcmFtIG9iamVjdCB7T2JqZWN0fSBvYmplY3QgdG8gY3JlYXRlIGFuIGluc3RhbmNlIGZyb20KICAgKiBAcmV0dXJuIHtPYmplY3R9IGluc3RhbmNlIG9mIENhbnZhcy5UcmlhbmdsZQogICAqLwoKICBmYWJyaWMuVHJpYW5nbGUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHsKICAgIHJldHVybiBuZXcgZmFicmljLlRyaWFuZ2xlKG9iamVjdCk7CiAgfTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSksCiAgICAgIHBpQnkyID0gTWF0aC5QSSAqIDIsCiAgICAgIGV4dGVuZCA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQ7CgogIGlmIChmYWJyaWMuRWxsaXBzZSkgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5FbGxpcHNlIGlzIGFscmVhZHkgZGVmaW5lZC4nKTsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIEVsbGlwc2UKICAgKiBAZXh0ZW5kcyBmYWJyaWMuT2JqZWN0CiAgICovCgoKICBmYWJyaWMuRWxsaXBzZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3QsCiAgLyoqIEBzY29wZSBmYWJyaWMuRWxsaXBzZS5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIHR5cGU6ICdlbGxpcHNlJywKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAbWV0aG9kIGluaXRpYWxpemUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QKICAgICAqIEByZXR1cm4ge09iamVjdH0gdGhpc0FyZwogICAgICovCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7CiAgICAgIHRoaXMuc2V0KCdyeCcsIG9wdGlvbnMucnggfHwgMCk7CiAgICAgIHRoaXMuc2V0KCdyeScsIG9wdGlvbnMucnkgfHwgMCk7CiAgICAgIHRoaXMuc2V0KCd3aWR0aCcsIHRoaXMuZ2V0KCdyeCcpICogMik7CiAgICAgIHRoaXMuc2V0KCdoZWlnaHQnLCB0aGlzLmdldCgncnknKSAqIDIpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvT2JqZWN0CiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b09iamVjdDogZnVuY3Rpb24gdG9PYmplY3QoKSB7CiAgICAgIHJldHVybiBleHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHsKICAgICAgICByeDogdGhpcy5nZXQoJ3J4JyksCiAgICAgICAgcnk6IHRoaXMuZ2V0KCdyeScpCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHJldHVybiBbJzxlbGxpcHNlICcsICdyeD0iJywgdGhpcy5nZXQoJ3J4JyksICciICcsICdyeT0iJywgdGhpcy5nZXQoJ3J5JyksICciICcsICdzdHlsZT0iJywgdGhpcy5nZXRTdmdTdHlsZXMoKSwgJyIgJywgJ3RyYW5zZm9ybT0iJywgdGhpcy5nZXRTdmdUcmFuc2Zvcm0oKSwgJyIgJywgJy8+J10uam9pbignJyk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVuZGVycyB0aGlzIGluc3RhbmNlIG9uIGEgZ2l2ZW4gY29udGV4dAogICAgICogQG1ldGhvZCByZW5kZXIKICAgICAqIEBwYXJhbSBjdHgge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCB0byByZW5kZXIgb24KICAgICAqIEBwYXJhbSBub1RyYW5zZm9ybSB7Qm9vbGVhbn0gY29udGV4dCBpcyBub3QgdHJhbnNmb3JtZWQgd2hlbiBzZXQgdG8gdHJ1ZQogICAgICovCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihjdHgsIG5vVHJhbnNmb3JtKSB7CiAgICAgIC8vIGRvIG5vdCB1c2UgYGdldGAgZm9yIHBlcmYuIHJlYXNvbnMKICAgICAgaWYgKHRoaXMucnggPT09IDAgfHwgdGhpcy5yeSA9PT0gMCkgcmV0dXJuOwogICAgICByZXR1cm4gdGhpcy5jYWxsU3VwZXIoJ3JlbmRlcicsIGN0eCwgbm9UcmFuc2Zvcm0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXIKICAgICAqIEBwYXJhbSBjdHgge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgsIG5vVHJhbnNmb3JtKSB7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgY3R4LnNhdmUoKTsKICAgICAgY3R4Lmdsb2JhbEFscGhhICo9IHRoaXMub3BhY2l0eTsKCiAgICAgIGlmICh0aGlzLnRyYW5zZm9ybU1hdHJpeCAmJiB0aGlzLmdyb3VwKSB7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSh0aGlzLmN4LCB0aGlzLmN5KTsKICAgICAgfQoKICAgICAgY3R4LnRyYW5zZm9ybSgxLCAwLCAwLCB0aGlzLnJ5IC8gdGhpcy5yeCwgMCwgMCk7CiAgICAgIGN0eC5hcmMobm9UcmFuc2Zvcm0gPyB0aGlzLmxlZnQgOiAwLCBub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogMCwgdGhpcy5yeCwgMCwgcGlCeTIsIGZhbHNlKTsKCiAgICAgIGlmICh0aGlzLnN0cm9rZSkgewogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmlsbCkgewogICAgICAgIGN0eC5maWxsKCk7CiAgICAgIH0KCiAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjb21wbGV4aXR5IG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIGNvbXBsZXhpdHkKICAgICAqIEByZXR1cm4ge051bWJlcn0gY29tcGxleGl0eQogICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gMTsKICAgIH0KICB9KTsKICAvKioKICAgKiBMaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0byBhY2NvdW50IGZvciB3aGVuIHBhcnNpbmcgU1ZHIGVsZW1lbnQgKHVzZWQgYnkge0BsaW5rIGZhYnJpYy5FbGxpcHNlLmZyb21FbGVtZW50fSkKICAgKiBAc3RhdGljCiAgICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcvc2hhcGVzLmh0bWwjRWxsaXBzZUVsZW1lbnQKICAgKi8KCiAgZmFicmljLkVsbGlwc2UuQVRUUklCVVRFX05BTUVTID0gJ2N4IGN5IHJ4IHJ5IGZpbGwgZmlsbC1vcGFjaXR5IG9wYWNpdHkgc3Ryb2tlIHN0cm9rZS13aWR0aCB0cmFuc2Zvcm0nLnNwbGl0KCcgJyk7CiAgLyoqCiAgICogUmV0dXJucyB7QGxpbmsgZmFicmljLkVsbGlwc2V9IGluc3RhbmNlIGZyb20gYW4gU1ZHIGVsZW1lbnQKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuRWxsaXBzZS5mcm9tRWxlbWVudAogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZWxlbWVudCBFbGVtZW50IHRvIHBhcnNlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqIEByZXR1cm4ge2ZhYnJpYy5FbGxpcHNlfQogICAqLwoKICBmYWJyaWMuRWxsaXBzZS5mcm9tRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgdmFyIHBhcnNlZEF0dHJpYnV0ZXMgPSBmYWJyaWMucGFyc2VBdHRyaWJ1dGVzKGVsZW1lbnQsIGZhYnJpYy5FbGxpcHNlLkFUVFJJQlVURV9OQU1FUyk7CiAgICB2YXIgY3ggPSBwYXJzZWRBdHRyaWJ1dGVzLmxlZnQ7CiAgICB2YXIgY3kgPSBwYXJzZWRBdHRyaWJ1dGVzLnRvcDsKCiAgICBpZiAoJ2xlZnQnIGluIHBhcnNlZEF0dHJpYnV0ZXMpIHsKICAgICAgcGFyc2VkQXR0cmlidXRlcy5sZWZ0IC09IG9wdGlvbnMud2lkdGggLyAyIHx8IDA7CiAgICB9CgogICAgaWYgKCd0b3AnIGluIHBhcnNlZEF0dHJpYnV0ZXMpIHsKICAgICAgcGFyc2VkQXR0cmlidXRlcy50b3AgLT0gb3B0aW9ucy5oZWlnaHQgLyAyIHx8IDA7CiAgICB9CgogICAgdmFyIGVsbGlwc2UgPSBuZXcgZmFicmljLkVsbGlwc2UoZXh0ZW5kKHBhcnNlZEF0dHJpYnV0ZXMsIG9wdGlvbnMpKTsKICAgIGVsbGlwc2UuY3ggPSBjeCB8fCAwOwogICAgZWxsaXBzZS5jeSA9IGN5IHx8IDA7CiAgICByZXR1cm4gZWxsaXBzZTsKICB9OwogIC8qKgogICAqIFJldHVybnMgZmFicmljLkVsbGlwc2UgaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24KICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuRWxsaXBzZS5mcm9tT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY3JlYXRlIGFuIGluc3RhbmNlIGZyb20KICAgKiBAcmV0dXJuIHtmYWJyaWMuRWxsaXBzZX0KICAgKi8KCgogIGZhYnJpYy5FbGxpcHNlLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICByZXR1cm4gbmV3IGZhYnJpYy5FbGxpcHNlKG9iamVjdCk7CiAgfTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSk7CgogIGlmIChmYWJyaWMuUmVjdCkgewogICAgY29uc29sZS53YXJuKCdmYWJyaWMuUmVjdCBpcyBhbHJlYWR5IGRlZmluZWQnKTsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIFJlY3QKICAgKiBAZXh0ZW5kcyBmYWJyaWMuT2JqZWN0CiAgICovCgoKICBmYWJyaWMuUmVjdCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3QsCiAgLyoqIEBzY29wZSBmYWJyaWMuUmVjdC5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIHR5cGU6ICdyZWN0JywKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIHJ4OiAwLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgcnk6IDAsCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICogQG1ldGhvZCBpbml0aWFsaXplCiAgICAgKiBAcGFyYW0gb3B0aW9ucyB7T2JqZWN0fSBvcHRpb25zIG9iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fSB0aGlzQXJnCiAgICAgKi8KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykgewogICAgICB0aGlzLl9pbml0U3RhdGVQcm9wZXJ0aWVzKCk7CgogICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpOwoKICAgICAgdGhpcy5faW5pdFJ4UnkoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGBzdGF0ZVByb3BlcnRpZXNgIGxpc3Qgb24gYW4gaW5zdGFuY2UsIGFuZCBhZGRzIGBmYWJyaWMuUmVjdGAgLXNwZWNpZmljIG9uZXMgdG8gaXQKICAgICAqIChzdWNoIGFzICJyeCIsICJyeSIsIGV0Yy4pCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfaW5pdFN0YXRlUHJvcGVydGllcwogICAgICovCiAgICBfaW5pdFN0YXRlUHJvcGVydGllczogZnVuY3Rpb24gX2luaXRTdGF0ZVByb3BlcnRpZXMoKSB7CiAgICAgIHRoaXMuc3RhdGVQcm9wZXJ0aWVzID0gdGhpcy5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFsncngnLCAncnknXSk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2luaXRSeFJ5CiAgICAgKi8KICAgIF9pbml0UnhSeTogZnVuY3Rpb24gX2luaXRSeFJ5KCkgewogICAgICBpZiAodGhpcy5yeCAmJiAhdGhpcy5yeSkgewogICAgICAgIHRoaXMucnkgPSB0aGlzLnJ4OwogICAgICB9IGVsc2UgaWYgKHRoaXMucnkgJiYgIXRoaXMucngpIHsKICAgICAgICB0aGlzLnJ4ID0gdGhpcy5yeTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXIKICAgICAqIEBwYXJhbSBjdHgge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgpIHsKICAgICAgdmFyIHJ4ID0gdGhpcy5yeCB8fCAwLAogICAgICAgICAgcnkgPSB0aGlzLnJ5IHx8IDAsCiAgICAgICAgICB4ID0gLXRoaXMud2lkdGggLyAyLAogICAgICAgICAgeSA9IC10aGlzLmhlaWdodCAvIDIsCiAgICAgICAgICB3ID0gdGhpcy53aWR0aCwKICAgICAgICAgIGggPSB0aGlzLmhlaWdodDsKICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICBjdHguZ2xvYmFsQWxwaGEgKj0gdGhpcy5vcGFjaXR5OwoKICAgICAgaWYgKHRoaXMudHJhbnNmb3JtTWF0cml4ICYmIHRoaXMuZ3JvdXApIHsKICAgICAgICBjdHgudHJhbnNsYXRlKHRoaXMud2lkdGggLyAyICsgdGhpcy54LCB0aGlzLmhlaWdodCAvIDIgKyB0aGlzLnkpOwogICAgICB9CgogICAgICBpZiAoIXRoaXMudHJhbnNmb3JtTWF0cml4ICYmIHRoaXMuZ3JvdXApIHsKICAgICAgICBjdHgudHJhbnNsYXRlKC10aGlzLmdyb3VwLndpZHRoIC8gMiArIHRoaXMud2lkdGggLyAyICsgdGhpcy54LCAtdGhpcy5ncm91cC5oZWlnaHQgLyAyICsgdGhpcy5oZWlnaHQgLyAyICsgdGhpcy55KTsKICAgICAgfQoKICAgICAgY3R4Lm1vdmVUbyh4ICsgcngsIHkpOwogICAgICBjdHgubGluZVRvKHggKyB3IC0gcngsIHkpOwogICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh4ICsgdywgeSwgeCArIHcsIHkgKyByeSwgeCArIHcsIHkgKyByeSk7CiAgICAgIGN0eC5saW5lVG8oeCArIHcsIHkgKyBoIC0gcnkpOwogICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh4ICsgdywgeSArIGgsIHggKyB3IC0gcngsIHkgKyBoLCB4ICsgdyAtIHJ4LCB5ICsgaCk7CiAgICAgIGN0eC5saW5lVG8oeCArIHJ4LCB5ICsgaCk7CiAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHgsIHkgKyBoLCB4LCB5ICsgaCAtIHJ5LCB4LCB5ICsgaCAtIHJ5KTsKICAgICAgY3R4LmxpbmVUbyh4LCB5ICsgcnkpOwogICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh4LCB5LCB4ICsgcngsIHksIHggKyByeCwgeSk7CiAgICAgIGN0eC5jbG9zZVBhdGgoKTsKCiAgICAgIGlmICh0aGlzLmZpbGwpIHsKICAgICAgICBjdHguZmlsbCgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdHJva2VEYXNoQXJyYXkpIHsKICAgICAgICB0aGlzLl9yZW5kZXJEYXNoZWRTdHJva2UoY3R4KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLnN0cm9rZSkgewogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQogICAgfSwKICAgIC8vIHNpbmNlIG91ciBjb29yZGluYXRlIHN5c3RlbSBkaWZmZXJzIGZyb20gdGhhdCBvZiBTVkcKICAgIF9ub3JtYWxpemVMZWZ0VG9wUHJvcGVydGllczogZnVuY3Rpb24gX25vcm1hbGl6ZUxlZnRUb3BQcm9wZXJ0aWVzKHBhcnNlZEF0dHJpYnV0ZXMpIHsKICAgICAgaWYgKHBhcnNlZEF0dHJpYnV0ZXMubGVmdCkgewogICAgICAgIHRoaXMuc2V0KCdsZWZ0JywgcGFyc2VkQXR0cmlidXRlcy5sZWZ0ICsgdGhpcy5nZXRXaWR0aCgpIC8gMik7CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0KCd4JywgcGFyc2VkQXR0cmlidXRlcy5sZWZ0IHx8IDApOwoKICAgICAgaWYgKHBhcnNlZEF0dHJpYnV0ZXMudG9wKSB7CiAgICAgICAgdGhpcy5zZXQoJ3RvcCcsIHBhcnNlZEF0dHJpYnV0ZXMudG9wICsgdGhpcy5nZXRIZWlnaHQoKSAvIDIpOwogICAgICB9CgogICAgICB0aGlzLnNldCgneScsIHBhcnNlZEF0dHJpYnV0ZXMudG9wIHx8IDApOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIGNvbXBsZXhpdHkKICAgICAqIEByZXR1cm4ge051bWJlcn0gY29tcGxleGl0eQogICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gMTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqLwogICAgdG9PYmplY3Q6IGZ1bmN0aW9uIHRvT2JqZWN0KCkgewogICAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnKSwgewogICAgICAgIHJ4OiB0aGlzLmdldCgncngnKSB8fCAwLAogICAgICAgIHJ5OiB0aGlzLmdldCgncnknKSB8fCAwCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHJldHVybiAnPHJlY3QgJyArICd4PSInICsgLTEgKiB0aGlzLndpZHRoIC8gMiArICciIHk9IicgKyAtMSAqIHRoaXMuaGVpZ2h0IC8gMiArICciICcgKyAncng9IicgKyB0aGlzLmdldCgncngnKSArICciIHJ5PSInICsgdGhpcy5nZXQoJ3J5JykgKyAnIiAnICsgJ3dpZHRoPSInICsgdGhpcy53aWR0aCArICciIGhlaWdodD0iJyArIHRoaXMuaGVpZ2h0ICsgJyIgJyArICdzdHlsZT0iJyArIHRoaXMuZ2V0U3ZnU3R5bGVzKCkgKyAnIiAnICsgJ3RyYW5zZm9ybT0iJyArIHRoaXMuZ2V0U3ZnVHJhbnNmb3JtKCkgKyAnIiAnICsgJy8+JzsKICAgIH0KICB9KTsgLy8gVE9ETyAoa2FuZ2F4KTogaW1wbGVtZW50IHJvdW5kZWQgcmVjdGFuZ2xlcyAoYm90aCBwYXJzaW5nIGFuZCByZW5kZXJpbmcpCgogIC8qKgogICAqIExpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRvIGFjY291bnQgZm9yIHdoZW4gcGFyc2luZyBTVkcgZWxlbWVudCAodXNlZCBieSBgZmFicmljLlJlY3QuZnJvbUVsZW1lbnRgKQogICAqIEBzdGF0aWMKICAgKi8KCiAgZmFicmljLlJlY3QuQVRUUklCVVRFX05BTUVTID0gJ3ggeSB3aWR0aCBoZWlnaHQgcnggcnkgZmlsbCBmaWxsLW9wYWNpdHkgb3BhY2l0eSBzdHJva2Ugc3Ryb2tlLXdpZHRoIHRyYW5zZm9ybScuc3BsaXQoJyAnKTsKICAvKioKICAgKiBAcHJpdmF0ZQogICAqLwoKICBmdW5jdGlvbiBfc2V0RGVmYXVsdExlZnRUb3BWYWx1ZXMoYXR0cmlidXRlcykgewogICAgYXR0cmlidXRlcy5sZWZ0ID0gYXR0cmlidXRlcy5sZWZ0IHx8IDA7CiAgICBhdHRyaWJ1dGVzLnRvcCA9IGF0dHJpYnV0ZXMudG9wIHx8IDA7CiAgICByZXR1cm4gYXR0cmlidXRlczsKICB9CiAgLyoqCiAgICogUmV0dXJucyBmYWJyaWMuUmVjdCBpbnN0YW5jZSBmcm9tIGFuIFNWRyBlbGVtZW50CiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgZmFicmljLlJlY3QuZnJvbUVsZW1lbnQKICAgKiBAcGFyYW0gZWxlbWVudCB7U1ZHRWxlbWVudH0gZWxlbWVudCB0byBwYXJzZQogICAqIEBwYXJhbSBvcHRpb25zIHtPYmplY3R9IG9wdGlvbnMgb2JqZWN0CiAgICogQHJldHVybiB7ZmFicmljLlJlY3R9IGluc3RhbmNlIG9mIGZhYnJpYy5SZWN0CiAgICovCgoKICBmYWJyaWMuUmVjdC5mcm9tRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdmFyIHBhcnNlZEF0dHJpYnV0ZXMgPSBmYWJyaWMucGFyc2VBdHRyaWJ1dGVzKGVsZW1lbnQsIGZhYnJpYy5SZWN0LkFUVFJJQlVURV9OQU1FUyk7CiAgICBwYXJzZWRBdHRyaWJ1dGVzID0gX3NldERlZmF1bHRMZWZ0VG9wVmFsdWVzKHBhcnNlZEF0dHJpYnV0ZXMpOwogICAgdmFyIHJlY3QgPSBuZXcgZmFicmljLlJlY3QoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zID8gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKG9wdGlvbnMpIDoge30sIHBhcnNlZEF0dHJpYnV0ZXMpKTsKCiAgICByZWN0Ll9ub3JtYWxpemVMZWZ0VG9wUHJvcGVydGllcyhwYXJzZWRBdHRyaWJ1dGVzKTsKCiAgICByZXR1cm4gcmVjdDsKICB9OwogIC8qKgogICAqIFJldHVybnMgZmFicmljLlJlY3QgaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24KICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuUmVjdC5mcm9tT2JqZWN0CiAgICogQHBhcmFtIG9iamVjdCB7T2JqZWN0fSBvYmplY3QgdG8gY3JlYXRlIGFuIGluc3RhbmNlIGZyb20KICAgKiBAcmV0dXJuIHtPYmplY3R9IGluc3RhbmNlIG9mIGZhYnJpYy5SZWN0CiAgICovCgoKICBmYWJyaWMuUmVjdC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgcmV0dXJuIG5ldyBmYWJyaWMuUmVjdChvYmplY3QpOwogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBmYWJyaWMgPSBnbG9iYWwuZmFicmljIHx8IChnbG9iYWwuZmFicmljID0ge30pLAogICAgICB0b0ZpeGVkID0gZmFicmljLnV0aWwudG9GaXhlZDsKCiAgaWYgKGZhYnJpYy5Qb2x5bGluZSkgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5Qb2x5bGluZSBpcyBhbHJlYWR5IGRlZmluZWQnKTsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIFBvbHlsaW5lCiAgICogQGV4dGVuZHMgZmFicmljLk9iamVjdAogICAqLwoKCiAgZmFicmljLlBvbHlsaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwKICAvKiogQHNjb3BlIGZhYnJpYy5Qb2x5bGluZS5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIHR5cGU6ICdwb2x5bGluZScsCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICogQG1ldGhvZCBpbml0aWFsaXplCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwb2ludHMgYXJyYXkgb2YgcG9pbnRzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoaXNBcmcKICAgICAqLwogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShwb2ludHMsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIHRoaXMuc2V0KCdwb2ludHMnLCBwb2ludHMpOwogICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpOwoKICAgICAgdGhpcy5fY2FsY0RpbWVuc2lvbnMoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfY2FsY0RpbWVuc2lvbnMKICAgICAqLwogICAgX2NhbGNEaW1lbnNpb25zOiBmdW5jdGlvbiBfY2FsY0RpbWVuc2lvbnMoKSB7CiAgICAgIHJldHVybiBmYWJyaWMuUG9seWdvbi5wcm90b3R5cGUuX2NhbGNEaW1lbnNpb25zLmNhbGwodGhpcyk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9PYmplY3QKICAgICAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIHRvT2JqZWN0OiBmdW5jdGlvbiB0b09iamVjdCgpIHsKICAgICAgcmV0dXJuIGZhYnJpYy5Qb2x5Z29uLnByb3RvdHlwZS50b09iamVjdC5jYWxsKHRoaXMpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHZhciBwb2ludHMgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHBvaW50cy5wdXNoKHRvRml4ZWQodGhpcy5wb2ludHNbaV0ueCwgMiksICcsJywgdG9GaXhlZCh0aGlzLnBvaW50c1tpXS55LCAyKSwgJyAnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFsnPHBvbHlsaW5lICcsICdwb2ludHM9IicsIHBvaW50cy5qb2luKCcnKSwgJyIgJywgJ3N0eWxlPSInLCB0aGlzLmdldFN2Z1N0eWxlcygpLCAnIiAnLCAndHJhbnNmb3JtPSInLCB0aGlzLmdldFN2Z1RyYW5zZm9ybSgpLCAnIiAnLCAnLz4nXS5qb2luKCcnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfcmVuZGVyCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uCiAgICAgKi8KICAgIF9yZW5kZXI6IGZ1bmN0aW9uIF9yZW5kZXIoY3R4KSB7CiAgICAgIHZhciBwb2ludDsKICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICBjdHgubW92ZVRvKHRoaXMucG9pbnRzWzBdLngsIHRoaXMucG9pbnRzWzBdLnkpOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMucG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgcG9pbnQgPSB0aGlzLnBvaW50c1tpXTsKICAgICAgICBjdHgubGluZVRvKHBvaW50LngsIHBvaW50LnkpOwogICAgICB9CgogICAgICBpZiAodGhpcy5maWxsKSB7CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3Ryb2tlKSB7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBjb21wbGV4aXR5IG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIGNvbXBsZXhpdHkKICAgICAqIEByZXR1cm4ge051bWJlcn0gY29tcGxleGl0eQogICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gdGhpcy5nZXQoJ3BvaW50cycpLmxlbmd0aDsKICAgIH0KICB9KTsKICAvKioKICAgKiBMaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0byBhY2NvdW50IGZvciB3aGVuIHBhcnNpbmcgU1ZHIGVsZW1lbnQgKHVzZWQgYnkgYGZhYnJpYy5Qb2x5bGluZS5mcm9tRWxlbWVudGApCiAgICogQHN0YXRpYwogICAqIEBzZWU6IGh0dHA6Ly93d3cudzMub3JnL1RSL1NWRy9zaGFwZXMuaHRtbCNQb2x5bGluZUVsZW1lbnQKICAgKi8KCiAgZmFicmljLlBvbHlsaW5lLkFUVFJJQlVURV9OQU1FUyA9ICdmaWxsIGZpbGwtb3BhY2l0eSBvcGFjaXR5IHN0cm9rZSBzdHJva2Utd2lkdGggdHJhbnNmb3JtJy5zcGxpdCgnICcpOwogIC8qKgogICAqIFJldHVybnMgZmFicmljLlBvbHlsaW5lIGluc3RhbmNlIGZyb20gYW4gU1ZHIGVsZW1lbnQKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuUG9seWxpbmUuZnJvbUVsZW1lbnQKICAgKiBAcGFyYW0ge1NWR0VsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBwYXJzZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QKICAgKiBAcmV0dXJuIHtPYmplY3R9IGluc3RhbmNlIG9mIGZhYnJpYy5Qb2x5bGluZQogICAqLwoKICBmYWJyaWMuUG9seWxpbmUuZnJvbUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgewogICAgaWYgKCFlbGVtZW50KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB2YXIgcG9pbnRzID0gZmFicmljLnBhcnNlUG9pbnRzQXR0cmlidXRlKGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdwb2ludHMnKSksCiAgICAgICAgcGFyc2VkQXR0cmlidXRlcyA9IGZhYnJpYy5wYXJzZUF0dHJpYnV0ZXMoZWxlbWVudCwgZmFicmljLlBvbHlsaW5lLkFUVFJJQlVURV9OQU1FUyk7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAvLyBub3JtYWxpemUgY29vcmRpbmF0ZXMsIGFjY29yZGluZyB0byBjb250YWluaW5nIGJveCAoZGltZW5zaW9ucyBvZiB3aGljaCBhcmUgcGFzc2VkIHZpYSBgb3B0aW9uc2ApCiAgICAgIHBvaW50c1tpXS54IC09IG9wdGlvbnMud2lkdGggLyAyIHx8IDA7CiAgICAgIHBvaW50c1tpXS55IC09IG9wdGlvbnMuaGVpZ2h0IC8gMiB8fCAwOwogICAgfQoKICAgIHJldHVybiBuZXcgZmFicmljLlBvbHlsaW5lKHBvaW50cywgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChwYXJzZWRBdHRyaWJ1dGVzLCBvcHRpb25zKSk7CiAgfTsKICAvKioKICAgKiBSZXR1cm5zIGZhYnJpYy5Qb2x5bGluZSBpbnN0YW5jZSBmcm9tIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbgogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZhYnJpYy5Qb2x5bGluZS5mcm9tT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIE9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbQogICAqIEByZXR1cm4ge2ZhYnJpYy5Qb2x5bGluZX0KICAgKi8KCgogIGZhYnJpYy5Qb2x5bGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgdmFyIHBvaW50cyA9IG9iamVjdC5wb2ludHM7CiAgICByZXR1cm4gbmV3IGZhYnJpYy5Qb2x5bGluZShwb2ludHMsIG9iamVjdCk7CiAgfTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSksCiAgICAgIGV4dGVuZCA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQsCiAgICAgIG1pbiA9IGZhYnJpYy51dGlsLmFycmF5Lm1pbiwKICAgICAgbWF4ID0gZmFicmljLnV0aWwuYXJyYXkubWF4LAogICAgICB0b0ZpeGVkID0gZmFicmljLnV0aWwudG9GaXhlZDsKCiAgaWYgKGZhYnJpYy5Qb2x5Z29uKSB7CiAgICBmYWJyaWMud2FybignZmFicmljLlBvbHlnb24gaXMgYWxyZWFkeSBkZWZpbmVkJyk7CiAgICByZXR1cm47CiAgfQoKICBmdW5jdGlvbiBieVgocCkgewogICAgcmV0dXJuIHAueDsKICB9CgogIGZ1bmN0aW9uIGJ5WShwKSB7CiAgICByZXR1cm4gcC55OwogIH0KICAvKioKICAgKiBAY2xhc3MgUG9seWdvbgogICAqIEBleHRlbmRzIGZhYnJpYy5PYmplY3QKICAgKi8KCgogIGZhYnJpYy5Qb2x5Z29uID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwKICAvKiogQHNjb3BlIGZhYnJpYy5Qb2x5Z29uLnByb3RvdHlwZSAqLwogIHsKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdHlwZTogJ3BvbHlnb24nLAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IKICAgICAqIEBtZXRob2QgaW5pdGlhbGl6ZQogICAgICogQHBhcmFtIHtBcnJheX0gcG9pbnRzIEFycmF5IG9mIHBvaW50cwogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgT3B0aW9ucyBvYmplY3QKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5Qb2x5Z29ufSB0aGlzQXJnCiAgICAgKi8KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUocG9pbnRzLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICB0aGlzLnBvaW50cyA9IHBvaW50czsKICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBvcHRpb25zKTsKCiAgICAgIHRoaXMuX2NhbGNEaW1lbnNpb25zKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2NhbGNEaW1lbnNpb25zCiAgICAgKi8KICAgIF9jYWxjRGltZW5zaW9uczogZnVuY3Rpb24gX2NhbGNEaW1lbnNpb25zKCkgewogICAgICB2YXIgcG9pbnRzID0gdGhpcy5wb2ludHMsCiAgICAgICAgICBtaW5YID0gbWluKHBvaW50cywgJ3gnKSwKICAgICAgICAgIG1pblkgPSBtaW4ocG9pbnRzLCAneScpLAogICAgICAgICAgbWF4WCA9IG1heChwb2ludHMsICd4JyksCiAgICAgICAgICBtYXhZID0gbWF4KHBvaW50cywgJ3knKTsKICAgICAgdGhpcy53aWR0aCA9IG1heFggLSBtaW5YIHx8IDE7CiAgICAgIHRoaXMuaGVpZ2h0ID0gbWF4WSAtIG1pblkgfHwgMTsKICAgICAgdGhpcy5taW5YID0gbWluWDsKICAgICAgdGhpcy5taW5ZID0gbWluWTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqLwogICAgdG9PYmplY3Q6IGZ1bmN0aW9uIHRvT2JqZWN0KCkgewogICAgICByZXR1cm4gZXh0ZW5kKHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpLCB7CiAgICAgICAgcG9pbnRzOiB0aGlzLnBvaW50cy5jb25jYXQoKQogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b1NWRwogICAgICogQHJldHVybiB7c3RyaW5nfSBzdmcgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqLwogICAgdG9TVkc6IGZ1bmN0aW9uIHRvU1ZHKCkgewogICAgICB2YXIgcG9pbnRzID0gW107CgogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5wb2ludHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBwb2ludHMucHVzaCh0b0ZpeGVkKHRoaXMucG9pbnRzW2ldLngsIDIpLCAnLCcsIHRvRml4ZWQodGhpcy5wb2ludHNbaV0ueSwgMiksICcgJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBbJzxwb2x5Z29uICcsICdwb2ludHM9IicsIHBvaW50cy5qb2luKCcnKSwgJyIgJywgJ3N0eWxlPSInLCB0aGlzLmdldFN2Z1N0eWxlcygpLCAnIiAnLCAndHJhbnNmb3JtPSInLCB0aGlzLmdldFN2Z1RyYW5zZm9ybSgpLCAnIiAnLCAnLz4nXS5qb2luKCcnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfcmVuZGVyCiAgICAgKiBAcGFyYW0gY3R4IHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGNvbnRleHQgdG8gcmVuZGVyIG9uCiAgICAgKi8KICAgIF9yZW5kZXI6IGZ1bmN0aW9uIF9yZW5kZXIoY3R4KSB7CiAgICAgIHZhciBwb2ludDsKICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICBjdHgubW92ZVRvKHRoaXMucG9pbnRzWzBdLngsIHRoaXMucG9pbnRzWzBdLnkpOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMucG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgcG9pbnQgPSB0aGlzLnBvaW50c1tpXTsKICAgICAgICBjdHgubGluZVRvKHBvaW50LngsIHBvaW50LnkpOwogICAgICB9CgogICAgICBpZiAodGhpcy5maWxsKSB7CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3Ryb2tlKSB7CiAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgY29tcGxleGl0eSBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCBjb21wbGV4aXR5CiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGNvbXBsZXhpdHkgb2YgdGhpcyBpbnN0YW5jZQogICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gdGhpcy5wb2ludHMubGVuZ3RoOwogICAgfQogIH0pOwogIC8qKgogICAqIExpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRvIGFjY291bnQgZm9yIHdoZW4gcGFyc2luZyBTVkcgZWxlbWVudCAodXNlZCBieSBgZmFicmljLlBvbHlnb24uZnJvbUVsZW1lbnRgKQogICAqIEBzdGF0aWMKICAgKiBAc2VlOiBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcvc2hhcGVzLmh0bWwjUG9seWdvbkVsZW1lbnQKICAgKi8KCiAgZmFicmljLlBvbHlnb24uQVRUUklCVVRFX05BTUVTID0gJ2ZpbGwgZmlsbC1vcGFjaXR5IG9wYWNpdHkgc3Ryb2tlIHN0cm9rZS13aWR0aCB0cmFuc2Zvcm0nLnNwbGl0KCcgJyk7CiAgLyoqCiAgICogUmV0dXJucyBmYWJyaWMuUG9seWdvbiBpbnN0YW5jZSBmcm9tIGFuIFNWRyBlbGVtZW50CiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgZmFicmljLlBvbHlnb24uZnJvbUVsZW1lbnQKICAgKiBAcGFyYW0ge1NWR0VsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBwYXJzZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0CiAgICogQHJldHVybiB7ZmFicmljLlBvbHlnb259CiAgICovCgogIGZhYnJpYy5Qb2x5Z29uLmZyb21FbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgIGlmICghZWxlbWVudCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgdmFyIHBvaW50cyA9IGZhYnJpYy5wYXJzZVBvaW50c0F0dHJpYnV0ZShlbGVtZW50LmdldEF0dHJpYnV0ZSgncG9pbnRzJykpLAogICAgICAgIHBhcnNlZEF0dHJpYnV0ZXMgPSBmYWJyaWMucGFyc2VBdHRyaWJ1dGVzKGVsZW1lbnQsIGZhYnJpYy5Qb2x5Z29uLkFUVFJJQlVURV9OQU1FUyk7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAvLyBub3JtYWxpemUgY29vcmRpbmF0ZXMsIGFjY29yZGluZyB0byBjb250YWluaW5nIGJveCAoZGltZW5zaW9ucyBvZiB3aGljaCBhcmUgcGFzc2VkIHZpYSBgb3B0aW9uc2ApCiAgICAgIHBvaW50c1tpXS54IC09IG9wdGlvbnMud2lkdGggLyAyIHx8IDA7CiAgICAgIHBvaW50c1tpXS55IC09IG9wdGlvbnMuaGVpZ2h0IC8gMiB8fCAwOwogICAgfQoKICAgIHJldHVybiBuZXcgZmFicmljLlBvbHlnb24ocG9pbnRzLCBleHRlbmQocGFyc2VkQXR0cmlidXRlcywgb3B0aW9ucykpOwogIH07CiAgLyoqCiAgICogUmV0dXJucyBmYWJyaWMuUG9seWdvbiBpbnN0YW5jZSBmcm9tIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbgogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZhYnJpYy5Qb2x5Z29uLmZyb21PYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbQogICAqIEByZXR1cm4ge2ZhYnJpYy5Qb2x5Z29ufQogICAqLwoKCiAgZmFicmljLlBvbHlnb24uZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHsKICAgIHJldHVybiBuZXcgZmFicmljLlBvbHlnb24ob2JqZWN0LnBvaW50cywgb2JqZWN0KTsKICB9Owp9KSh0eXBlb2YgZXhwb3J0cyAhPSAndW5kZWZpbmVkJyA/IGV4cG9ydHMgOiB0aGlzKTsKCihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgdmFyIGNvbW1hbmRMZW5ndGhzID0gewogICAgbTogMiwKICAgIGw6IDIsCiAgICBoOiAxLAogICAgdjogMSwKICAgIGM6IDYsCiAgICBzOiA0LAogICAgcTogNCwKICAgIHQ6IDIsCiAgICBhOiA3CiAgfTsKCiAgZnVuY3Rpb24gZHJhd0FyYyhjdHgsIHgsIHksIGNvb3JkcykgewogICAgdmFyIHJ4ID0gY29vcmRzWzBdOwogICAgdmFyIHJ5ID0gY29vcmRzWzFdOwogICAgdmFyIHJvdCA9IGNvb3Jkc1syXTsKICAgIHZhciBsYXJnZSA9IGNvb3Jkc1szXTsKICAgIHZhciBzd2VlcCA9IGNvb3Jkc1s0XTsKICAgIHZhciBleCA9IGNvb3Jkc1s1XTsKICAgIHZhciBleSA9IGNvb3Jkc1s2XTsKICAgIHZhciBzZWdzID0gYXJjVG9TZWdtZW50cyhleCwgZXksIHJ4LCByeSwgbGFyZ2UsIHN3ZWVwLCByb3QsIHgsIHkpOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2Vncy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgYmV6ID0gc2VnbWVudFRvQmV6aWVyLmFwcGx5KHRoaXMsIHNlZ3NbaV0pOwogICAgICBjdHguYmV6aWVyQ3VydmVUby5hcHBseShjdHgsIGJleik7CiAgICB9CiAgfQoKICB2YXIgYXJjVG9TZWdtZW50c0NhY2hlID0ge30sCiAgICAgIHNlZ21lbnRUb0JlemllckNhY2hlID0ge30sCiAgICAgIF9qb2luID0gQXJyYXkucHJvdG90eXBlLmpvaW4sCiAgICAgIGFyZ3NTdHJpbmc7IC8vIENvcGllZCBmcm9tIElua3NjYXBlIHN2Z3RvcGRmLCB0aGFua3MhCgogIGZ1bmN0aW9uIGFyY1RvU2VnbWVudHMoeCwgeSwgcngsIHJ5LCBsYXJnZSwgc3dlZXAsIHJvdGF0ZVgsIG94LCBveSkgewogICAgYXJnc1N0cmluZyA9IF9qb2luLmNhbGwoYXJndW1lbnRzKTsKCiAgICBpZiAoYXJjVG9TZWdtZW50c0NhY2hlW2FyZ3NTdHJpbmddKSB7CiAgICAgIHJldHVybiBhcmNUb1NlZ21lbnRzQ2FjaGVbYXJnc1N0cmluZ107CiAgICB9CgogICAgdmFyIHRoID0gcm90YXRlWCAqIChNYXRoLlBJIC8gMTgwKTsKICAgIHZhciBzaW5fdGggPSBNYXRoLnNpbih0aCk7CiAgICB2YXIgY29zX3RoID0gTWF0aC5jb3ModGgpOwogICAgcnggPSBNYXRoLmFicyhyeCk7CiAgICByeSA9IE1hdGguYWJzKHJ5KTsKICAgIHZhciBweCA9IGNvc190aCAqIChveCAtIHgpICogMC41ICsgc2luX3RoICogKG95IC0geSkgKiAwLjU7CiAgICB2YXIgcHkgPSBjb3NfdGggKiAob3kgLSB5KSAqIDAuNSAtIHNpbl90aCAqIChveCAtIHgpICogMC41OwogICAgdmFyIHBsID0gcHggKiBweCAvIChyeCAqIHJ4KSArIHB5ICogcHkgLyAocnkgKiByeSk7CgogICAgaWYgKHBsID4gMSkgewogICAgICBwbCA9IE1hdGguc3FydChwbCk7CiAgICAgIHJ4ICo9IHBsOwogICAgICByeSAqPSBwbDsKICAgIH0KCiAgICB2YXIgYTAwID0gY29zX3RoIC8gcng7CiAgICB2YXIgYTAxID0gc2luX3RoIC8gcng7CiAgICB2YXIgYTEwID0gLXNpbl90aCAvIHJ5OwogICAgdmFyIGExMSA9IGNvc190aCAvIHJ5OwogICAgdmFyIHgwID0gYTAwICogb3ggKyBhMDEgKiBveTsKICAgIHZhciB5MCA9IGExMCAqIG94ICsgYTExICogb3k7CiAgICB2YXIgeDEgPSBhMDAgKiB4ICsgYTAxICogeTsKICAgIHZhciB5MSA9IGExMCAqIHggKyBhMTEgKiB5OwogICAgdmFyIGQgPSAoeDEgLSB4MCkgKiAoeDEgLSB4MCkgKyAoeTEgLSB5MCkgKiAoeTEgLSB5MCk7CiAgICB2YXIgc2ZhY3Rvcl9zcSA9IDEgLyBkIC0gMC4yNTsKICAgIGlmIChzZmFjdG9yX3NxIDwgMCkgc2ZhY3Rvcl9zcSA9IDA7CiAgICB2YXIgc2ZhY3RvciA9IE1hdGguc3FydChzZmFjdG9yX3NxKTsKICAgIGlmIChzd2VlcCA9PSBsYXJnZSkgc2ZhY3RvciA9IC1zZmFjdG9yOwogICAgdmFyIHhjID0gMC41ICogKHgwICsgeDEpIC0gc2ZhY3RvciAqICh5MSAtIHkwKTsKICAgIHZhciB5YyA9IDAuNSAqICh5MCArIHkxKSArIHNmYWN0b3IgKiAoeDEgLSB4MCk7CiAgICB2YXIgdGgwID0gTWF0aC5hdGFuMih5MCAtIHljLCB4MCAtIHhjKTsKICAgIHZhciB0aDEgPSBNYXRoLmF0YW4yKHkxIC0geWMsIHgxIC0geGMpOwogICAgdmFyIHRoX2FyYyA9IHRoMSAtIHRoMDsKCiAgICBpZiAodGhfYXJjIDwgMCAmJiBzd2VlcCA9PSAxKSB7CiAgICAgIHRoX2FyYyArPSAyICogTWF0aC5QSTsKICAgIH0gZWxzZSBpZiAodGhfYXJjID4gMCAmJiBzd2VlcCA9PSAwKSB7CiAgICAgIHRoX2FyYyAtPSAyICogTWF0aC5QSTsKICAgIH0KCiAgICB2YXIgc2VnbWVudHMgPSBNYXRoLmNlaWwoTWF0aC5hYnModGhfYXJjIC8gKE1hdGguUEkgKiAwLjUgKyAwLjAwMSkpKTsKICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRzOyBpKyspIHsKICAgICAgdmFyIHRoMiA9IHRoMCArIGkgKiB0aF9hcmMgLyBzZWdtZW50czsKICAgICAgdmFyIHRoMyA9IHRoMCArIChpICsgMSkgKiB0aF9hcmMgLyBzZWdtZW50czsKICAgICAgcmVzdWx0W2ldID0gW3hjLCB5YywgdGgyLCB0aDMsIHJ4LCByeSwgc2luX3RoLCBjb3NfdGhdOwogICAgfQoKICAgIHJldHVybiBhcmNUb1NlZ21lbnRzQ2FjaGVbYXJnc1N0cmluZ10gPSByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBzZWdtZW50VG9CZXppZXIoY3gsIGN5LCB0aDAsIHRoMSwgcngsIHJ5LCBzaW5fdGgsIGNvc190aCkgewogICAgYXJnc1N0cmluZyA9IF9qb2luLmNhbGwoYXJndW1lbnRzKTsKCiAgICBpZiAoc2VnbWVudFRvQmV6aWVyQ2FjaGVbYXJnc1N0cmluZ10pIHsKICAgICAgcmV0dXJuIHNlZ21lbnRUb0JlemllckNhY2hlW2FyZ3NTdHJpbmddOwogICAgfQoKICAgIHZhciBhMDAgPSBjb3NfdGggKiByeDsKICAgIHZhciBhMDEgPSAtc2luX3RoICogcnk7CiAgICB2YXIgYTEwID0gc2luX3RoICogcng7CiAgICB2YXIgYTExID0gY29zX3RoICogcnk7CiAgICB2YXIgdGhfaGFsZiA9IDAuNSAqICh0aDEgLSB0aDApOwogICAgdmFyIHQgPSA4IC8gMyAqIE1hdGguc2luKHRoX2hhbGYgKiAwLjUpICogTWF0aC5zaW4odGhfaGFsZiAqIDAuNSkgLyBNYXRoLnNpbih0aF9oYWxmKTsKICAgIHZhciB4MSA9IGN4ICsgTWF0aC5jb3ModGgwKSAtIHQgKiBNYXRoLnNpbih0aDApOwogICAgdmFyIHkxID0gY3kgKyBNYXRoLnNpbih0aDApICsgdCAqIE1hdGguY29zKHRoMCk7CiAgICB2YXIgeDMgPSBjeCArIE1hdGguY29zKHRoMSk7CiAgICB2YXIgeTMgPSBjeSArIE1hdGguc2luKHRoMSk7CiAgICB2YXIgeDIgPSB4MyArIHQgKiBNYXRoLnNpbih0aDEpOwogICAgdmFyIHkyID0geTMgLSB0ICogTWF0aC5jb3ModGgxKTsKICAgIHJldHVybiBzZWdtZW50VG9CZXppZXJDYWNoZVthcmdzU3RyaW5nXSA9IFthMDAgKiB4MSArIGEwMSAqIHkxLCBhMTAgKiB4MSArIGExMSAqIHkxLCBhMDAgKiB4MiArIGEwMSAqIHkyLCBhMTAgKiB4MiArIGExMSAqIHkyLCBhMDAgKiB4MyArIGEwMSAqIHkzLCBhMTAgKiB4MyArIGExMSAqIHkzXTsKICB9CgogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGZhYnJpYyA9IGdsb2JhbC5mYWJyaWMgfHwgKGdsb2JhbC5mYWJyaWMgPSB7fSksCiAgICAgIG1pbiA9IGZhYnJpYy51dGlsLmFycmF5Lm1pbiwKICAgICAgbWF4ID0gZmFicmljLnV0aWwuYXJyYXkubWF4LAogICAgICBleHRlbmQgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kLAogICAgICBfdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKICBpZiAoZmFicmljLlBhdGgpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuUGF0aCBpcyBhbHJlYWR5IGRlZmluZWQnKTsKICAgIHJldHVybjsKICB9CgogIGlmICghZmFicmljLk9iamVjdCkgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5QYXRoIHJlcXVpcmVzIGZhYnJpYy5PYmplY3QnKTsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQHByaXZhdGUKICAgKi8KCgogIGZ1bmN0aW9uIGdldFgoaXRlbSkgewogICAgaWYgKGl0ZW1bMF0gPT09ICdIJykgewogICAgICByZXR1cm4gaXRlbVsxXTsKICAgIH0KCiAgICByZXR1cm4gaXRlbVtpdGVtLmxlbmd0aCAtIDJdOwogIH0KICAvKioKICAgKiBAcHJpdmF0ZQogICAqLwoKCiAgZnVuY3Rpb24gZ2V0WShpdGVtKSB7CiAgICBpZiAoaXRlbVswXSA9PT0gJ1YnKSB7CiAgICAgIHJldHVybiBpdGVtWzFdOwogICAgfQoKICAgIHJldHVybiBpdGVtW2l0ZW0ubGVuZ3RoIC0gMV07CiAgfQogIC8qKgogICAqIEBjbGFzcyBQYXRoCiAgICogQGV4dGVuZHMgZmFicmljLk9iamVjdAogICAqLwoKCiAgZmFicmljLlBhdGggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuT2JqZWN0LAogIC8qKiBAc2NvcGUgZmFicmljLlBhdGgucHJvdG90eXBlICovCiAgewogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICB0eXBlOiAncGF0aCcsCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICogQG1ldGhvZCBpbml0aWFsaXplCiAgICAgKiBAcGFyYW0ge0FycmF5fFN0cmluZ30gcGF0aCBQYXRoIGRhdGEgKHNlcXVlbmNlIG9mIGNvb3JkaW5hdGVzIGFuZCBjb3JyZXNwb25kaW5nICJjb21tYW5kIiB0b2tlbnMpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0CiAgICAgKi8KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUocGF0aCwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwoKICAgICAgaWYgKCFwYXRoKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoJ2BwYXRoYCBhcmd1bWVudCBpcyByZXF1aXJlZCcpOwogICAgICB9CgogICAgICB2YXIgZnJvbUFycmF5ID0gX3RvU3RyaW5nLmNhbGwocGF0aCkgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICAgIHRoaXMucGF0aCA9IGZyb21BcnJheSA/IHBhdGggLy8gb25lIG9mIGNvbW1hbmRzIChtLE0sbCxMLHEsUSxjLEMsZXRjLikgZm9sbG93ZWQgYnkgbm9uLWNvbW1hbmQgY2hhcmFjdGVycyAoaS5lLiBjb21tYW5kIHZhbHVlcykKICAgICAgOiBwYXRoLm1hdGNoICYmIHBhdGgubWF0Y2goL1ttemxodmNzcXRhXVtebXpsaHZjc3F0YV0qL2dpKTsKICAgICAgaWYgKCF0aGlzLnBhdGgpIHJldHVybjsKCiAgICAgIGlmICghZnJvbUFycmF5KSB7CiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZUZyb21TdHJpbmcob3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnNvdXJjZVBhdGgpIHsKICAgICAgICB0aGlzLnNldFNvdXJjZVBhdGgob3B0aW9ucy5zb3VyY2VQYXRoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9pbml0aWFsaXplRnJvbVN0cmluZwogICAgICovCiAgICBfaW5pdGlhbGl6ZUZyb21TdHJpbmc6IGZ1bmN0aW9uIF9pbml0aWFsaXplRnJvbVN0cmluZyhvcHRpb25zKSB7CiAgICAgIHZhciBpc1dpZHRoU2V0ID0gKCd3aWR0aCcgaW4gb3B0aW9ucyksCiAgICAgICAgICBpc0hlaWdodFNldCA9ICgnaGVpZ2h0JyBpbiBvcHRpb25zKTsKICAgICAgdGhpcy5wYXRoID0gdGhpcy5fcGFyc2VQYXRoKCk7CgogICAgICBpZiAoIWlzV2lkdGhTZXQgfHwgIWlzSGVpZ2h0U2V0KSB7CiAgICAgICAgZXh0ZW5kKHRoaXMsIHRoaXMuX3BhcnNlRGltZW5zaW9ucygpKTsKCiAgICAgICAgaWYgKGlzV2lkdGhTZXQpIHsKICAgICAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzSGVpZ2h0U2V0KSB7CiAgICAgICAgICB0aGlzLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0OwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXIKICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgpIHsKICAgICAgdmFyIGN1cnJlbnQsCiAgICAgICAgICAvLyBjdXJyZW50IGluc3RydWN0aW9uCiAgICAgIHByZXZpb3VzID0gbnVsbCwKICAgICAgICAgIHggPSAwLAogICAgICAgICAgLy8gY3VycmVudCB4CiAgICAgIHkgPSAwLAogICAgICAgICAgLy8gY3VycmVudCB5CiAgICAgIGNvbnRyb2xYID0gMCwKICAgICAgICAgIC8vIGN1cnJlbnQgY29udHJvbCBwb2ludCB4CiAgICAgIGNvbnRyb2xZID0gMCwKICAgICAgICAgIC8vIGN1cnJlbnQgY29udHJvbCBwb2ludCB5CiAgICAgIHRlbXBYLAogICAgICAgICAgdGVtcFksCiAgICAgICAgICB0ZW1wQ29udHJvbFgsCiAgICAgICAgICB0ZW1wQ29udHJvbFksCiAgICAgICAgICBsID0gLSh0aGlzLndpZHRoIC8gMiksCiAgICAgICAgICB0ID0gLSh0aGlzLmhlaWdodCAvIDIpOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMucGF0aC5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgIGN1cnJlbnQgPSB0aGlzLnBhdGhbaV07CgogICAgICAgIHN3aXRjaCAoY3VycmVudFswXSkgewogICAgICAgICAgLy8gZmlyc3QgbGV0dGVyCiAgICAgICAgICBjYXNlICdsJzoKICAgICAgICAgICAgLy8gbGluZXRvLCByZWxhdGl2ZQogICAgICAgICAgICB4ICs9IGN1cnJlbnRbMV07CiAgICAgICAgICAgIHkgKz0gY3VycmVudFsyXTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh4ICsgbCwgeSArIHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdMJzoKICAgICAgICAgICAgLy8gbGluZXRvLCBhYnNvbHV0ZQogICAgICAgICAgICB4ID0gY3VycmVudFsxXTsKICAgICAgICAgICAgeSA9IGN1cnJlbnRbMl07CiAgICAgICAgICAgIGN0eC5saW5lVG8oeCArIGwsIHkgKyB0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnaCc6CiAgICAgICAgICAgIC8vIGhvcml6b250YWwgbGluZXRvLCByZWxhdGl2ZQogICAgICAgICAgICB4ICs9IGN1cnJlbnRbMV07CiAgICAgICAgICAgIGN0eC5saW5lVG8oeCArIGwsIHkgKyB0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnSCc6CiAgICAgICAgICAgIC8vIGhvcml6b250YWwgbGluZXRvLCBhYnNvbHV0ZQogICAgICAgICAgICB4ID0gY3VycmVudFsxXTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh4ICsgbCwgeSArIHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICd2JzoKICAgICAgICAgICAgLy8gdmVydGljYWwgbGluZXRvLCByZWxhdGl2ZQogICAgICAgICAgICB5ICs9IGN1cnJlbnRbMV07CiAgICAgICAgICAgIGN0eC5saW5lVG8oeCArIGwsIHkgKyB0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnVic6CiAgICAgICAgICAgIC8vIHZlcmljYWwgbGluZXRvLCBhYnNvbHV0ZQogICAgICAgICAgICB5ID0gY3VycmVudFsxXTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh4ICsgbCwgeSArIHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdtJzoKICAgICAgICAgICAgLy8gbW92ZVRvLCByZWxhdGl2ZQogICAgICAgICAgICB4ICs9IGN1cnJlbnRbMV07CiAgICAgICAgICAgIHkgKz0gY3VycmVudFsyXTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyh4ICsgbCwgeSArIHQpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdNJzoKICAgICAgICAgICAgLy8gbW92ZVRvLCBhYnNvbHV0ZQogICAgICAgICAgICB4ID0gY3VycmVudFsxXTsKICAgICAgICAgICAgeSA9IGN1cnJlbnRbMl07CiAgICAgICAgICAgIGN0eC5tb3ZlVG8oeCArIGwsIHkgKyB0KTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnYyc6CiAgICAgICAgICAgIC8vIGJlemllckN1cnZlVG8sIHJlbGF0aXZlCiAgICAgICAgICAgIHRlbXBYID0geCArIGN1cnJlbnRbNV07CiAgICAgICAgICAgIHRlbXBZID0geSArIGN1cnJlbnRbNl07CiAgICAgICAgICAgIGNvbnRyb2xYID0geCArIGN1cnJlbnRbM107CiAgICAgICAgICAgIGNvbnRyb2xZID0geSArIGN1cnJlbnRbNF07CiAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKHggKyBjdXJyZW50WzFdICsgbCwgLy8geDEKICAgICAgICAgICAgeSArIGN1cnJlbnRbMl0gKyB0LCAvLyB5MQogICAgICAgICAgICBjb250cm9sWCArIGwsIC8vIHgyCiAgICAgICAgICAgIGNvbnRyb2xZICsgdCwgLy8geTIKICAgICAgICAgICAgdGVtcFggKyBsLCB0ZW1wWSArIHQpOwogICAgICAgICAgICB4ID0gdGVtcFg7CiAgICAgICAgICAgIHkgPSB0ZW1wWTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnQyc6CiAgICAgICAgICAgIC8vIGJlemllckN1cnZlVG8sIGFic29sdXRlCiAgICAgICAgICAgIHggPSBjdXJyZW50WzVdOwogICAgICAgICAgICB5ID0gY3VycmVudFs2XTsKICAgICAgICAgICAgY29udHJvbFggPSBjdXJyZW50WzNdOwogICAgICAgICAgICBjb250cm9sWSA9IGN1cnJlbnRbNF07CiAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKGN1cnJlbnRbMV0gKyBsLCBjdXJyZW50WzJdICsgdCwgY29udHJvbFggKyBsLCBjb250cm9sWSArIHQsIHggKyBsLCB5ICsgdCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3MnOgogICAgICAgICAgICAvLyBzaG9ydGhhbmQgY3ViaWMgYmV6aWVyQ3VydmVUbywgcmVsYXRpdmUKICAgICAgICAgICAgLy8gdHJhbnNmb3JtIHRvIGFic29sdXRlIHgseQogICAgICAgICAgICB0ZW1wWCA9IHggKyBjdXJyZW50WzNdOwogICAgICAgICAgICB0ZW1wWSA9IHkgKyBjdXJyZW50WzRdOyAvLyBjYWxjdWxhdGUgcmVmbGVjdGlvbiBvZiBwcmV2aW91cyBjb250cm9sIHBvaW50cwoKICAgICAgICAgICAgY29udHJvbFggPSAyICogeCAtIGNvbnRyb2xYOwogICAgICAgICAgICBjb250cm9sWSA9IDIgKiB5IC0gY29udHJvbFk7CiAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKGNvbnRyb2xYICsgbCwgY29udHJvbFkgKyB0LCB4ICsgY3VycmVudFsxXSArIGwsIHkgKyBjdXJyZW50WzJdICsgdCwgdGVtcFggKyBsLCB0ZW1wWSArIHQpOyAvLyBzZXQgY29udHJvbCBwb2ludCB0byAybmQgb25lIG9mIHRoaXMgY29tbWFuZAogICAgICAgICAgICAvLyAiLi4uIHRoZSBmaXJzdCBjb250cm9sIHBvaW50IGlzIGFzc3VtZWQgdG8gYmUgdGhlIHJlZmxlY3Rpb24gb2YgdGhlIHNlY29uZCBjb250cm9sIHBvaW50IG9uIHRoZSBwcmV2aW91cyBjb21tYW5kIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBvaW50LiIKCiAgICAgICAgICAgIGNvbnRyb2xYID0geCArIGN1cnJlbnRbMV07CiAgICAgICAgICAgIGNvbnRyb2xZID0geSArIGN1cnJlbnRbMl07CiAgICAgICAgICAgIHggPSB0ZW1wWDsKICAgICAgICAgICAgeSA9IHRlbXBZOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdTJzoKICAgICAgICAgICAgLy8gc2hvcnRoYW5kIGN1YmljIGJlemllckN1cnZlVG8sIGFic29sdXRlCiAgICAgICAgICAgIHRlbXBYID0gY3VycmVudFszXTsKICAgICAgICAgICAgdGVtcFkgPSBjdXJyZW50WzRdOyAvLyBjYWxjdWxhdGUgcmVmbGVjdGlvbiBvZiBwcmV2aW91cyBjb250cm9sIHBvaW50cwoKICAgICAgICAgICAgY29udHJvbFggPSAyICogeCAtIGNvbnRyb2xYOwogICAgICAgICAgICBjb250cm9sWSA9IDIgKiB5IC0gY29udHJvbFk7CiAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKGNvbnRyb2xYICsgbCwgY29udHJvbFkgKyB0LCBjdXJyZW50WzFdICsgbCwgY3VycmVudFsyXSArIHQsIHRlbXBYICsgbCwgdGVtcFkgKyB0KTsKICAgICAgICAgICAgeCA9IHRlbXBYOwogICAgICAgICAgICB5ID0gdGVtcFk7IC8vIHNldCBjb250cm9sIHBvaW50IHRvIDJuZCBvbmUgb2YgdGhpcyBjb21tYW5kCiAgICAgICAgICAgIC8vICIuLi4gdGhlIGZpcnN0IGNvbnRyb2wgcG9pbnQgaXMgYXNzdW1lZCB0byBiZSB0aGUgcmVmbGVjdGlvbiBvZiB0aGUgc2Vjb25kIGNvbnRyb2wgcG9pbnQgb24gdGhlIHByZXZpb3VzIGNvbW1hbmQgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcG9pbnQuIgoKICAgICAgICAgICAgY29udHJvbFggPSBjdXJyZW50WzFdOwogICAgICAgICAgICBjb250cm9sWSA9IGN1cnJlbnRbMl07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3EnOgogICAgICAgICAgICAvLyBxdWFkcmF0aWNDdXJ2ZVRvLCByZWxhdGl2ZQogICAgICAgICAgICAvLyB0cmFuc2Zvcm0gdG8gYWJzb2x1dGUgeCx5CiAgICAgICAgICAgIHRlbXBYID0geCArIGN1cnJlbnRbM107CiAgICAgICAgICAgIHRlbXBZID0geSArIGN1cnJlbnRbNF07CiAgICAgICAgICAgIGNvbnRyb2xYID0geCArIGN1cnJlbnRbMV07CiAgICAgICAgICAgIGNvbnRyb2xZID0geSArIGN1cnJlbnRbMl07CiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKGNvbnRyb2xYICsgbCwgY29udHJvbFkgKyB0LCB0ZW1wWCArIGwsIHRlbXBZICsgdCk7CiAgICAgICAgICAgIHggPSB0ZW1wWDsKICAgICAgICAgICAgeSA9IHRlbXBZOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdRJzoKICAgICAgICAgICAgLy8gcXVhZHJhdGljQ3VydmVUbywgYWJzb2x1dGUKICAgICAgICAgICAgdGVtcFggPSBjdXJyZW50WzNdOwogICAgICAgICAgICB0ZW1wWSA9IGN1cnJlbnRbNF07CiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKGN1cnJlbnRbMV0gKyBsLCBjdXJyZW50WzJdICsgdCwgdGVtcFggKyBsLCB0ZW1wWSArIHQpOwogICAgICAgICAgICB4ID0gdGVtcFg7CiAgICAgICAgICAgIHkgPSB0ZW1wWTsKICAgICAgICAgICAgY29udHJvbFggPSBjdXJyZW50WzFdOwogICAgICAgICAgICBjb250cm9sWSA9IGN1cnJlbnRbMl07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgICAvLyBzaG9ydGhhbmQgcXVhZHJhdGljQ3VydmVUbywgcmVsYXRpdmUKICAgICAgICAgICAgLy8gdHJhbnNmb3JtIHRvIGFic29sdXRlIHgseQogICAgICAgICAgICB0ZW1wWCA9IHggKyBjdXJyZW50WzFdOwogICAgICAgICAgICB0ZW1wWSA9IHkgKyBjdXJyZW50WzJdOwoKICAgICAgICAgICAgaWYgKHByZXZpb3VzWzBdLm1hdGNoKC9bUXFUdF0vKSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIHByZXZpb3VzIGNvbW1hbmQgb3IgaWYgdGhlIHByZXZpb3VzIGNvbW1hbmQgd2FzIG5vdCBhIFEsIHEsIFQgb3IgdCwKICAgICAgICAgICAgICAvLyBhc3N1bWUgdGhlIGNvbnRyb2wgcG9pbnQgaXMgY29pbmNpZGVudCB3aXRoIHRoZSBjdXJyZW50IHBvaW50CiAgICAgICAgICAgICAgY29udHJvbFggPSB4OwogICAgICAgICAgICAgIGNvbnRyb2xZID0geTsKICAgICAgICAgICAgfSBlbHNlIGlmIChwcmV2aW91c1swXSA9PT0gJ3QnKSB7CiAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIHJlZmxlY3Rpb24gb2YgcHJldmlvdXMgY29udHJvbCBwb2ludHMgZm9yIHQKICAgICAgICAgICAgICBjb250cm9sWCA9IDIgKiB4IC0gdGVtcENvbnRyb2xYOwogICAgICAgICAgICAgIGNvbnRyb2xZID0gMiAqIHkgLSB0ZW1wQ29udHJvbFk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJldmlvdXNbMF0gPT09ICdxJykgewogICAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSByZWZsZWN0aW9uIG9mIHByZXZpb3VzIGNvbnRyb2wgcG9pbnRzIGZvciBxCiAgICAgICAgICAgICAgY29udHJvbFggPSAyICogeCAtIGNvbnRyb2xYOwogICAgICAgICAgICAgIGNvbnRyb2xZID0gMiAqIHkgLSBjb250cm9sWTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGVtcENvbnRyb2xYID0gY29udHJvbFg7CiAgICAgICAgICAgIHRlbXBDb250cm9sWSA9IGNvbnRyb2xZOwogICAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhjb250cm9sWCArIGwsIGNvbnRyb2xZICsgdCwgdGVtcFggKyBsLCB0ZW1wWSArIHQpOwogICAgICAgICAgICB4ID0gdGVtcFg7CiAgICAgICAgICAgIHkgPSB0ZW1wWTsKICAgICAgICAgICAgY29udHJvbFggPSB4ICsgY3VycmVudFsxXTsKICAgICAgICAgICAgY29udHJvbFkgPSB5ICsgY3VycmVudFsyXTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAnVCc6CiAgICAgICAgICAgIHRlbXBYID0gY3VycmVudFsxXTsKICAgICAgICAgICAgdGVtcFkgPSBjdXJyZW50WzJdOyAvLyBjYWxjdWxhdGUgcmVmbGVjdGlvbiBvZiBwcmV2aW91cyBjb250cm9sIHBvaW50cwoKICAgICAgICAgICAgY29udHJvbFggPSAyICogeCAtIGNvbnRyb2xYOwogICAgICAgICAgICBjb250cm9sWSA9IDIgKiB5IC0gY29udHJvbFk7CiAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKGNvbnRyb2xYICsgbCwgY29udHJvbFkgKyB0LCB0ZW1wWCArIGwsIHRlbXBZICsgdCk7CiAgICAgICAgICAgIHggPSB0ZW1wWDsKICAgICAgICAgICAgeSA9IHRlbXBZOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICdhJzoKICAgICAgICAgICAgLy8gVE9ETzogb3B0aW1pemUgdGhpcwogICAgICAgICAgICBkcmF3QXJjKGN0eCwgeCArIGwsIHkgKyB0LCBbY3VycmVudFsxXSwgY3VycmVudFsyXSwgY3VycmVudFszXSwgY3VycmVudFs0XSwgY3VycmVudFs1XSwgY3VycmVudFs2XSArIHggKyBsLCBjdXJyZW50WzddICsgeSArIHRdKTsKICAgICAgICAgICAgeCArPSBjdXJyZW50WzZdOwogICAgICAgICAgICB5ICs9IGN1cnJlbnRbN107CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgJ0EnOgogICAgICAgICAgICAvLyBUT0RPOiBvcHRpbWl6ZSB0aGlzCiAgICAgICAgICAgIGRyYXdBcmMoY3R4LCB4ICsgbCwgeSArIHQsIFtjdXJyZW50WzFdLCBjdXJyZW50WzJdLCBjdXJyZW50WzNdLCBjdXJyZW50WzRdLCBjdXJyZW50WzVdLCBjdXJyZW50WzZdICsgbCwgY3VycmVudFs3XSArIHRdKTsKICAgICAgICAgICAgeCA9IGN1cnJlbnRbNl07CiAgICAgICAgICAgIHkgPSBjdXJyZW50WzddOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICd6JzoKICAgICAgICAgIGNhc2UgJ1onOgogICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgcHJldmlvdXMgPSBjdXJyZW50OwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogUmVuZGVycyBwYXRoIG9uIGEgc3BlY2lmaWVkIGNvbnRleHQKICAgICAqIEBtZXRob2QgcmVuZGVyCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IGNvbnRleHQgdG8gcmVuZGVyIHBhdGggb24KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gbm9UcmFuc2Zvcm0gV2hlbiB0cnVlLCBjb250ZXh0IGlzIG5vdCB0cmFuc2Zvcm1lZAogICAgICovCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihjdHgsIG5vVHJhbnNmb3JtKSB7CiAgICAgIGN0eC5zYXZlKCk7CiAgICAgIHZhciBtID0gdGhpcy50cmFuc2Zvcm1NYXRyaXg7CgogICAgICBpZiAobSkgewogICAgICAgIGN0eC50cmFuc2Zvcm0obVswXSwgbVsxXSwgbVsyXSwgbVszXSwgbVs0XSwgbVs1XSk7CiAgICAgIH0KCiAgICAgIGlmICghbm9UcmFuc2Zvcm0pIHsKICAgICAgICB0aGlzLnRyYW5zZm9ybShjdHgpOwogICAgICB9IC8vIGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSB0aGlzLmZpbGxSdWxlOwoKCiAgICAgIGlmICh0aGlzLm92ZXJsYXlGaWxsKSB7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMub3ZlcmxheUZpbGw7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5maWxsKSB7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuZmlsbC50b0xpdmVHcmFkaWVudCA/IHRoaXMuZmlsbC50b0xpdmVHcmFkaWVudChjdHgpIDogdGhpcy5maWxsOwogICAgICB9CgogICAgICBpZiAodGhpcy5zdHJva2UpIHsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLnN0cm9rZTsKICAgICAgfQoKICAgICAgY3R4LmJlZ2luUGF0aCgpOwoKICAgICAgdGhpcy5fcmVuZGVyKGN0eCk7CgogICAgICBpZiAodGhpcy5maWxsKSB7CiAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3Ryb2tlKSB7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5zdHJva2U7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuc3Ryb2tlV2lkdGg7CiAgICAgICAgY3R4LmxpbmVDYXAgPSBjdHgubGluZUpvaW4gPSAncm91bmQnOwogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQoKICAgICAgaWYgKCFub1RyYW5zZm9ybSAmJiB0aGlzLmFjdGl2ZSkgewogICAgICAgIHRoaXMuZHJhd0JvcmRlcnMoY3R4KTsKICAgICAgICB0aGlzLmhpZGVDb3JuZXJzIHx8IHRoaXMuZHJhd0Nvcm5lcnMoY3R4KTsKICAgICAgfQoKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b1N0cmluZwogICAgICogQHJldHVybiB7U3RyaW5nfSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqLwogICAgdG9TdHJpbmc6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gJyM8ZmFicmljLlBhdGggKCcgKyB0aGlzLmNvbXBsZXhpdHkoKSArICcpOiB7ICJ0b3AiOiAnICsgdGhpcy50b3AgKyAnLCAibGVmdCI6ICcgKyB0aGlzLmxlZnQgKyAnIH0+JzsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCiAgICB0b09iamVjdDogZnVuY3Rpb24gdG9PYmplY3QoKSB7CiAgICAgIHZhciBvID0gZXh0ZW5kKHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpLCB7CiAgICAgICAgcGF0aDogdGhpcy5wYXRoCiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMuc291cmNlUGF0aCkgewogICAgICAgIG8uc291cmNlUGF0aCA9IHRoaXMuc291cmNlUGF0aDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHJhbnNmb3JtTWF0cml4KSB7CiAgICAgICAgby50cmFuc2Zvcm1NYXRyaXggPSB0aGlzLnRyYW5zZm9ybU1hdHJpeDsKICAgICAgfQoKICAgICAgcmV0dXJuIG87CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBkYXRhbGVzcyBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9EYXRhbGVzc09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fQogICAgICovCiAgICB0b0RhdGFsZXNzT2JqZWN0OiBmdW5jdGlvbiB0b0RhdGFsZXNzT2JqZWN0KCkgewogICAgICB2YXIgbyA9IHRoaXMudG9PYmplY3QoKTsKCiAgICAgIGlmICh0aGlzLnNvdXJjZVBhdGgpIHsKICAgICAgICBvLnBhdGggPSB0aGlzLnNvdXJjZVBhdGg7CiAgICAgIH0KCiAgICAgIGRlbGV0ZSBvLnNvdXJjZVBhdGg7CiAgICAgIHJldHVybiBvOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHZhciBjaHVua3MgPSBbXTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLnBhdGgubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBjaHVua3MucHVzaCh0aGlzLnBhdGhbaV0uam9pbignICcpKTsKICAgICAgfQoKICAgICAgdmFyIHBhdGggPSBjaHVua3Muam9pbignICcpOwogICAgICByZXR1cm4gWyc8ZyB0cmFuc2Zvcm09IicsIHRoaXMuZ2V0U3ZnVHJhbnNmb3JtKCksICciPicsICc8cGF0aCAnLCAnd2lkdGg9IicsIHRoaXMud2lkdGgsICciIGhlaWdodD0iJywgdGhpcy5oZWlnaHQsICciICcsICdkPSInLCBwYXRoLCAnIiAnLCAnc3R5bGU9IicsIHRoaXMuZ2V0U3ZnU3R5bGVzKCksICciICcsICd0cmFuc2Zvcm09InRyYW5zbGF0ZSgnLCAtdGhpcy53aWR0aCAvIDIsICcgJywgLXRoaXMuaGVpZ2h0IC8gMiwgJykiIC8+JywgJzwvZz4nXS5qb2luKCcnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG51bWJlciByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZSBjb21wbGV4aXR5CiAgICAgKiBAbWV0aG9kIGNvbXBsZXhpdHkKICAgICAqIEByZXR1cm4ge051bWJlcn0gY29tcGxleGl0eQogICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gdGhpcy5wYXRoLmxlbmd0aDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfcGFyc2VQYXRoCiAgICAgKi8KICAgIF9wYXJzZVBhdGg6IGZ1bmN0aW9uIF9wYXJzZVBhdGgoKSB7CiAgICAgIHZhciByZXN1bHQgPSBbXSwKICAgICAgICAgIGN1cnJlbnRQYXRoLAogICAgICAgICAgY2h1bmtzLAogICAgICAgICAgcGFyc2VkOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGosIGNodW5rc1BhcnNlZCwgbGVuID0gdGhpcy5wYXRoLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgY3VycmVudFBhdGggPSB0aGlzLnBhdGhbaV07CiAgICAgICAgY2h1bmtzID0gY3VycmVudFBhdGguc2xpY2UoMSkudHJpbSgpLnJlcGxhY2UoLyhcZCktL2csICckMSMjIy0nKS5zcGxpdCgvXHN8LHwjIyMvKTsKICAgICAgICBjaHVua3NQYXJzZWQgPSBbY3VycmVudFBhdGguY2hhckF0KDApXTsKCiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpsZW4gPSBjaHVua3MubGVuZ3RoOyBqIDwgamxlbjsgaisrKSB7CiAgICAgICAgICBwYXJzZWQgPSBwYXJzZUZsb2F0KGNodW5rc1tqXSk7CgogICAgICAgICAgaWYgKCFpc05hTihwYXJzZWQpKSB7CiAgICAgICAgICAgIGNodW5rc1BhcnNlZC5wdXNoKHBhcnNlZCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgY29tbWFuZCA9IGNodW5rc1BhcnNlZFswXS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICBjb21tYW5kTGVuZ3RoID0gY29tbWFuZExlbmd0aHNbY29tbWFuZF07CgogICAgICAgIGlmIChjaHVua3NQYXJzZWQubGVuZ3RoIC0gMSA+IGNvbW1hbmRMZW5ndGgpIHsKICAgICAgICAgIGZvciAodmFyIGsgPSAxLCBrbGVuID0gY2h1bmtzUGFyc2VkLmxlbmd0aDsgayA8IGtsZW47IGsgKz0gY29tbWFuZExlbmd0aCkgewogICAgICAgICAgICByZXN1bHQucHVzaChbY2h1bmtzUGFyc2VkWzBdXS5jb25jYXQoY2h1bmtzUGFyc2VkLnNsaWNlKGssIGsgKyBjb21tYW5kTGVuZ3RoKSkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQucHVzaChjaHVua3NQYXJzZWQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIF9wYXJzZURpbWVuc2lvbnMKICAgICAqLwogICAgX3BhcnNlRGltZW5zaW9uczogZnVuY3Rpb24gX3BhcnNlRGltZW5zaW9ucygpIHsKICAgICAgdmFyIGFYID0gW10sCiAgICAgICAgICBhWSA9IFtdLAogICAgICAgICAgcHJldmlvdXNYLAogICAgICAgICAgcHJldmlvdXNZLAogICAgICAgICAgaXNMb3dlckNhc2UgPSBmYWxzZSwKICAgICAgICAgIHgsCiAgICAgICAgICB5OwogICAgICB0aGlzLnBhdGguZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICAgIGlmIChpdGVtWzBdICE9PSAnSCcpIHsKICAgICAgICAgIHByZXZpb3VzWCA9IGkgPT09IDAgPyBnZXRYKGl0ZW0pIDogZ2V0WCh0aGlzLnBhdGhbaSAtIDFdKTsKICAgICAgICB9CgogICAgICAgIGlmIChpdGVtWzBdICE9PSAnVicpIHsKICAgICAgICAgIHByZXZpb3VzWSA9IGkgPT09IDAgPyBnZXRZKGl0ZW0pIDogZ2V0WSh0aGlzLnBhdGhbaSAtIDFdKTsKICAgICAgICB9IC8vIGxvd2VyY2FzZWQgbGV0dGVyIGRlbm90ZXMgcmVsYXRpdmUgcG9zaXRpb247CiAgICAgICAgLy8gdHJhbnNmb3JtIHRvIGFic29sdXRlCgoKICAgICAgICBpZiAoaXRlbVswXSA9PT0gaXRlbVswXS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICBpc0xvd2VyQ2FzZSA9IHRydWU7CiAgICAgICAgfSAvLyBsYXN0IDIgaXRlbXMgaW4gYW4gYXJyYXkgb2YgY29vcmRpbmF0ZXMgYXJlIHRoZSBhY3R1YWx5IHgveSAoZXhjZXB0IEgvVik7CiAgICAgICAgLy8gY29sbGVjdCB0aGVtCiAgICAgICAgLy8gVE9ETyAoa2FuZ2F4KTogc3VwcG9ydCByZWxhdGl2ZSBoL3YgY29tbWFuZHMKCgogICAgICAgIHggPSBpc0xvd2VyQ2FzZSA/IHByZXZpb3VzWCArIGdldFgoaXRlbSkgOiBpdGVtWzBdID09PSAnVicgPyBwcmV2aW91c1ggOiBnZXRYKGl0ZW0pOwogICAgICAgIHkgPSBpc0xvd2VyQ2FzZSA/IHByZXZpb3VzWSArIGdldFkoaXRlbSkgOiBpdGVtWzBdID09PSAnSCcgPyBwcmV2aW91c1kgOiBnZXRZKGl0ZW0pOwogICAgICAgIHZhciB2YWwgPSBwYXJzZUludCh4LCAxMCk7CiAgICAgICAgaWYgKCFpc05hTih2YWwpKSBhWC5wdXNoKHZhbCk7CiAgICAgICAgdmFsID0gcGFyc2VJbnQoeSwgMTApOwogICAgICAgIGlmICghaXNOYU4odmFsKSkgYVkucHVzaCh2YWwpOwogICAgICB9LCB0aGlzKTsKICAgICAgdmFyIG1pblggPSBtaW4oYVgpLAogICAgICAgICAgbWluWSA9IG1pbihhWSksCiAgICAgICAgICBkZWx0YVggPSAwLAogICAgICAgICAgZGVsdGFZID0gMDsKICAgICAgdmFyIG8gPSB7CiAgICAgICAgdG9wOiBtaW5ZIC0gZGVsdGFZLAogICAgICAgIGxlZnQ6IG1pblggLSBkZWx0YVgsCiAgICAgICAgYm90dG9tOiBtYXgoYVkpIC0gZGVsdGFZLAogICAgICAgIHJpZ2h0OiBtYXgoYVgpIC0gZGVsdGFYCiAgICAgIH07CiAgICAgIG8ud2lkdGggPSBvLnJpZ2h0IC0gby5sZWZ0OwogICAgICBvLmhlaWdodCA9IG8uYm90dG9tIC0gby50b3A7CiAgICAgIHJldHVybiBvOwogICAgfQogIH0pOwogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgZmFicmljLlBhdGggZnJvbSBhbiBvYmplY3QKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuUGF0aC5mcm9tT2JqZWN0CiAgICogQHJldHVybiB7ZmFicmljLlBhdGh9IEluc3RhbmNlIG9mIGZhYnJpYy5QYXRoCiAgICovCgogIGZhYnJpYy5QYXRoLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICByZXR1cm4gbmV3IGZhYnJpYy5QYXRoKG9iamVjdC5wYXRoLCBvYmplY3QpOwogIH07CiAgLyoqCiAgICogTGlzdCBvZiBhdHRyaWJ1dGUgbmFtZXMgdG8gYWNjb3VudCBmb3Igd2hlbiBwYXJzaW5nIFNWRyBlbGVtZW50ICh1c2VkIGJ5IGBmYWJyaWMuUGF0aC5mcm9tRWxlbWVudGApCiAgICogQHN0YXRpYwogICAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHL3BhdGhzLmh0bWwjUGF0aEVsZW1lbnQKICAgKi8KCgogIGZhYnJpYy5QYXRoLkFUVFJJQlVURV9OQU1FUyA9ICdkIGZpbGwgZmlsbC1vcGFjaXR5IG9wYWNpdHkgZmlsbC1ydWxlIHN0cm9rZSBzdHJva2Utd2lkdGggdHJhbnNmb3JtJy5zcGxpdCgnICcpOwogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgZmFicmljLlBhdGggZnJvbSBhbiBTVkcgPHBhdGg+IGVsZW1lbnQKICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmYWJyaWMuUGF0aC5mcm9tRWxlbWVudAogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZWxlbWVudCB0byBwYXJzZQogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIG9iamVjdAogICAqIEByZXR1cm4ge2ZhYnJpYy5QYXRofSBJbnN0YW5jZSBvZiBmYWJyaWMuUGF0aAogICAqLwoKICBmYWJyaWMuUGF0aC5mcm9tRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zKSB7CiAgICB2YXIgcGFyc2VkQXR0cmlidXRlcyA9IGZhYnJpYy5wYXJzZUF0dHJpYnV0ZXMoZWxlbWVudCwgZmFicmljLlBhdGguQVRUUklCVVRFX05BTUVTKTsKICAgIHJldHVybiBuZXcgZmFicmljLlBhdGgocGFyc2VkQXR0cmlidXRlcy5kLCBleHRlbmQocGFyc2VkQXR0cmlidXRlcywgb3B0aW9ucykpOwogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBmYWJyaWMgPSBnbG9iYWwuZmFicmljIHx8IChnbG9iYWwuZmFicmljID0ge30pLAogICAgICBleHRlbmQgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kLAogICAgICBpbnZva2UgPSBmYWJyaWMudXRpbC5hcnJheS5pbnZva2UsCiAgICAgIHBhcmVudFNldCA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnNldCwKICAgICAgcGFyZW50VG9PYmplY3QgPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS50b09iamVjdCwKICAgICAgY2FtZWxpemUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUsCiAgICAgIGNhcGl0YWxpemUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZTsKCiAgaWYgKGZhYnJpYy5QYXRoR3JvdXApIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuUGF0aEdyb3VwIGlzIGFscmVhZHkgZGVmaW5lZCcpOwogICAgcmV0dXJuOwogIH0KICAvKioKICAgKiBAY2xhc3MgUGF0aEdyb3VwCiAgICogQGV4dGVuZHMgZmFicmljLlBhdGgKICAgKi8KCgogIGZhYnJpYy5QYXRoR3JvdXAgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuUGF0aCwKICAvKiogQHNjb3BlIGZhYnJpYy5QYXRoR3JvdXAucHJvdG90eXBlICovCiAgewogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICB0eXBlOiAncGF0aC1ncm91cCcsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBmaWxsOiAnJywKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBmb3JjZUZpbGxPdmVyd3JpdGU6IGZhbHNlLAoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IKICAgICAqIEBtZXRob2QgaW5pdGlhbGl6ZQogICAgICogQHBhcmFtIHtBcnJheX0gcGF0aHMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5QYXRoR3JvdXB9IHRoaXNBcmcKICAgICAqLwogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShwYXRocywgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgdGhpcy5wYXRocyA9IHBhdGhzIHx8IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IHRoaXMucGF0aHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgdGhpcy5wYXRoc1tpXS5ncm91cCA9IHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgICAgdGhpcy5zZXRDb29yZHMoKTsKCiAgICAgIGlmIChvcHRpb25zLnNvdXJjZVBhdGgpIHsKICAgICAgICB0aGlzLnNldFNvdXJjZVBhdGgob3B0aW9ucy5zb3VyY2VQYXRoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJlbmRlcnMgdGhpcyBncm91cCBvbiBhIHNwZWNpZmllZCBjb250ZXh0CiAgICAgKiBAbWV0aG9kIHJlbmRlcgogICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciB0aGlzIGluc3RhbmNlIG9uCiAgICAgKi8KICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGN0eCkgewogICAgICBjdHguc2F2ZSgpOwogICAgICB2YXIgbSA9IHRoaXMudHJhbnNmb3JtTWF0cml4OwoKICAgICAgaWYgKG0pIHsKICAgICAgICBjdHgudHJhbnNmb3JtKG1bMF0sIG1bMV0sIG1bMl0sIG1bM10sIG1bNF0sIG1bNV0pOwogICAgICB9CgogICAgICB0aGlzLnRyYW5zZm9ybShjdHgpOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLnBhdGhzLmxlbmd0aDsgaSA8IGw7ICsraSkgewogICAgICAgIHRoaXMucGF0aHNbaV0ucmVuZGVyKGN0eCwgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmFjdGl2ZSkgewogICAgICAgIHRoaXMuZHJhd0JvcmRlcnMoY3R4KTsKICAgICAgICB0aGlzLmhpZGVDb3JuZXJzIHx8IHRoaXMuZHJhd0Nvcm5lcnMoY3R4KTsKICAgICAgfQoKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIGNlcnRhaW4gcHJvcGVydHkgdG8gYSBjZXJ0YWluIHZhbHVlCiAgICAgKiBAbWV0aG9kIF9zZXQKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wCiAgICAgKiBAcGFyYW0ge0FueX0gdmFsdWUKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5QYXRoR3JvdXB9IHRoaXNBcmcKICAgICAqLwogICAgX3NldDogZnVuY3Rpb24gX3NldChwcm9wLCB2YWx1ZSkgewogICAgICBpZiAoKHByb3AgPT09ICdmaWxsJyB8fCBwcm9wID09PSAnb3ZlcmxheUZpbGwnKSAmJiB2YWx1ZSAmJiB0aGlzLmlzU2FtZUNvbG9yKCkpIHsKICAgICAgICB2YXIgaSA9IHRoaXMucGF0aHMubGVuZ3RoOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICB0aGlzLnBhdGhzW2ldLl9zZXQocHJvcCwgdmFsdWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuY2FsbFN1cGVyKCdfc2V0JywgcHJvcCwgdmFsdWUpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcGF0aCBncm91cAogICAgICogQG1ldGhvZCB0b09iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqLwogICAgdG9PYmplY3Q6IGZ1bmN0aW9uIHRvT2JqZWN0KCkgewogICAgICByZXR1cm4gZXh0ZW5kKHBhcmVudFRvT2JqZWN0LmNhbGwodGhpcyksIHsKICAgICAgICBwYXRoczogaW52b2tlKHRoaXMuZ2V0T2JqZWN0cygpLCAnY2xvbmUnKSwKICAgICAgICBzb3VyY2VQYXRoOiB0aGlzLnNvdXJjZVBhdGgKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBkYXRhbGVzcyBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBwYXRoIGdyb3VwCiAgICAgKiBAbWV0aG9kIHRvRGF0YWxlc3NPYmplY3QKICAgICAqIEByZXR1cm4ge09iamVjdH0gZGF0YWxlc3Mgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIHRvRGF0YWxlc3NPYmplY3Q6IGZ1bmN0aW9uIHRvRGF0YWxlc3NPYmplY3QoKSB7CiAgICAgIHZhciBvID0gdGhpcy50b09iamVjdCgpOwoKICAgICAgaWYgKHRoaXMuc291cmNlUGF0aCkgewogICAgICAgIG8ucGF0aHMgPSB0aGlzLnNvdXJjZVBhdGg7CiAgICAgIH0KCiAgICAgIHJldHVybiBvOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHZhciBvYmplY3RzID0gdGhpcy5nZXRPYmplY3RzKCk7CiAgICAgIHZhciBtYXJrdXAgPSBbJzxnICcsICd3aWR0aD0iJywgdGhpcy53aWR0aCwgJyIgJywgJ2hlaWdodD0iJywgdGhpcy5oZWlnaHQsICciICcsICdzdHlsZT0iJywgdGhpcy5nZXRTdmdTdHlsZXMoKSwgJyIgJywgJ3RyYW5zZm9ybT0iJywgdGhpcy5nZXRTdmdUcmFuc2Zvcm0oKSwgJyIgJywgJz4nXTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBvYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgbWFya3VwLnB1c2gob2JqZWN0c1tpXS50b1NWRygpKTsKICAgICAgfQoKICAgICAgbWFya3VwLnB1c2goJzwvZz4nKTsKICAgICAgcmV0dXJuIG1hcmt1cC5qb2luKCcnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgcGF0aCBncm91cAogICAgICogQG1ldGhvZCB0b1N0cmluZwogICAgICogQHJldHVybiB7U3RyaW5nfSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0CiAgICAgKi8KICAgIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuICcjPGZhYnJpYy5QYXRoR3JvdXAgKCcgKyB0aGlzLmNvbXBsZXhpdHkoKSArICcpOiB7IHRvcDogJyArIHRoaXMudG9wICsgJywgbGVmdDogJyArIHRoaXMubGVmdCArICcgfT4nOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBhbGwgcGF0aHMgaW4gdGhpcyBncm91cCBhcmUgb2Ygc2FtZSBjb2xvcgogICAgICogQG1ldGhvZCBpc1NhbWVDb2xvcgogICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBhbGwgcGF0aHMgYXJlIG9mIHRoZSBzYW1lIGNvbG9yIChgZmlsbGApCiAgICAgKi8KICAgIGlzU2FtZUNvbG9yOiBmdW5jdGlvbiBpc1NhbWVDb2xvcigpIHsKICAgICAgdmFyIGZpcnN0UGF0aEZpbGwgPSB0aGlzLmdldE9iamVjdHMoKVswXS5nZXQoJ2ZpbGwnKTsKICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0cygpLmV2ZXJ5KGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgICAgcmV0dXJuIHBhdGguZ2V0KCdmaWxsJykgPT09IGZpcnN0UGF0aEZpbGw7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAgKiBSZXR1cm5zIG51bWJlciByZXByZXNlbnRhdGlvbiBvZiBvYmplY3QncyBjb21wbGV4aXR5CiAgICAgICogQG1ldGhvZCBjb21wbGV4aXR5CiAgICAgICogQHJldHVybiB7TnVtYmVyfSBjb21wbGV4aXR5CiAgICAgICovCiAgICBjb21wbGV4aXR5OiBmdW5jdGlvbiBjb21wbGV4aXR5KCkgewogICAgICByZXR1cm4gdGhpcy5wYXRocy5yZWR1Y2UoZnVuY3Rpb24gKHRvdGFsLCBwYXRoKSB7CiAgICAgICAgcmV0dXJuIHRvdGFsICsgKHBhdGggJiYgcGF0aC5jb21wbGV4aXR5ID8gcGF0aC5jb21wbGV4aXR5KCkgOiAwKTsKICAgICAgfSwgMCk7CiAgICB9LAoKICAgIC8qKgogICAgICAqIE1ha2VzIHBhdGggZ3JvdXAgZ3JheXNjYWxlCiAgICAgICogQG1ldGhvZCB0b0dyYXlzY2FsZQogICAgICAqIEByZXR1cm4ge2ZhYnJpYy5QYXRoR3JvdXB9IHRoaXNBcmcKICAgICAgKi8KICAgIHRvR3JheXNjYWxlOiBmdW5jdGlvbiB0b0dyYXlzY2FsZSgpIHsKICAgICAgdmFyIGkgPSB0aGlzLnBhdGhzLmxlbmd0aDsKCiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB0aGlzLnBhdGhzW2ldLnRvR3JheXNjYWxlKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHBhdGhzIGluIHRoaXMgcGF0aCBncm91cAogICAgICogQG1ldGhvZCBnZXRPYmplY3RzCiAgICAgKiBAcmV0dXJuIHtBcnJheX0gYXJyYXkgb2YgcGF0aCBvYmplY3RzIGluY2x1ZGVkIGluIHRoaXMgcGF0aCBncm91cAogICAgICovCiAgICBnZXRPYmplY3RzOiBmdW5jdGlvbiBnZXRPYmplY3RzKCkgewogICAgICByZXR1cm4gdGhpcy5wYXRoczsKICAgIH0KICB9KTsKICAvKioKICAgKiBAcHJpdmF0ZQogICAqIEBtZXRob2QgaW5zdGFudGlhdGVQYXRocwogICAqLwoKICBmdW5jdGlvbiBpbnN0YW50aWF0ZVBhdGhzKHBhdGhzKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGF0aHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgaWYgKCEocGF0aHNbaV0gaW5zdGFuY2VvZiBmYWJyaWMuT2JqZWN0KSkgewogICAgICAgIHZhciBrbGFzc05hbWUgPSBjYW1lbGl6ZShjYXBpdGFsaXplKHBhdGhzW2ldLnR5cGUpKTsKICAgICAgICBwYXRoc1tpXSA9IGZhYnJpY1trbGFzc05hbWVdLmZyb21PYmplY3QocGF0aHNbaV0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHBhdGhzOwogIH0KICAvKioKICAgKiBDcmVhdGVzIGZhYnJpYy5UcmlhbmdsZSBpbnN0YW5jZSBmcm9tIGFuIG9iamVjdCByZXByZXNlbnRhdGlvbgogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZhYnJpYy5QYXRoR3JvdXAuZnJvbU9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QKICAgKiBAcmV0dXJuIHtmYWJyaWMuUGF0aEdyb3VwfQogICAqLwoKCiAgZmFicmljLlBhdGhHcm91cC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgdmFyIHBhdGhzID0gaW5zdGFudGlhdGVQYXRocyhvYmplY3QucGF0aHMpOwogICAgcmV0dXJuIG5ldyBmYWJyaWMuUGF0aEdyb3VwKHBhdGhzLCBvYmplY3QpOwogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBmYWJyaWMgPSBnbG9iYWwuZmFicmljIHx8IChnbG9iYWwuZmFicmljID0ge30pLAogICAgICBleHRlbmQgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kLAogICAgICBtaW4gPSBmYWJyaWMudXRpbC5hcnJheS5taW4sCiAgICAgIG1heCA9IGZhYnJpYy51dGlsLmFycmF5Lm1heCwKICAgICAgaW52b2tlID0gZmFicmljLnV0aWwuYXJyYXkuaW52b2tlLAogICAgICByZW1vdmVGcm9tQXJyYXkgPSBmYWJyaWMudXRpbC5yZW1vdmVGcm9tQXJyYXk7CgogIGlmIChmYWJyaWMuR3JvdXApIHsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIEdyb3VwCiAgICogQGV4dGVuZHMgZmFicmljLk9iamVjdAogICAqLwoKCiAgZmFicmljLkdyb3VwID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwKICAvKiogQHNjb3BlIGZhYnJpYy5Hcm91cC5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIHR5cGU6ICdncm91cCcsCgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvcgogICAgICogQG1ldGhvZCBpbml0aWFsaXplZAogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdHMgR3JvdXAgb2JqZWN0cwogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAgICogQHJldHVybiB7T2JqZWN0fSB0aGlzQXJnCiAgICAgKi8KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob2JqZWN0cywgb3B0aW9ucykgewogICAgICB0aGlzLm9iamVjdHMgPSBvYmplY3RzIHx8IFtdOwogICAgICB0aGlzLm9yaWdpbmFsU3RhdGUgPSB7fTsKICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnKTsKCiAgICAgIHRoaXMuX2NhbGNCb3VuZHMoKTsKCiAgICAgIHRoaXMuX3VwZGF0ZU9iamVjdHNDb29yZHMoKTsKCiAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgZXh0ZW5kKHRoaXMsIG9wdGlvbnMpOwogICAgICB9CgogICAgICB0aGlzLl9zZXRPcGFjaXR5SWZTYW1lKCk7IC8vIGdyb3VwIGlzIGFjdGl2ZSBieSBkZWZhdWx0CgoKICAgICAgdGhpcy5zZXRDb29yZHModHJ1ZSk7CiAgICAgIHRoaXMuc2F2ZUNvb3JkcygpOyAvL3RoaXMuYWN0aXZhdGVBbGxPYmplY3RzKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX3VwZGF0ZU9iamVjdHNDb29yZHMKICAgICAqLwogICAgX3VwZGF0ZU9iamVjdHNDb29yZHM6IGZ1bmN0aW9uIF91cGRhdGVPYmplY3RzQ29vcmRzKCkgewogICAgICB2YXIgZ3JvdXBEZWx0YVggPSB0aGlzLmxlZnQsCiAgICAgICAgICBncm91cERlbHRhWSA9IHRoaXMudG9wOwogICAgICB0aGlzLmZvckVhY2hPYmplY3QoZnVuY3Rpb24gKG9iamVjdCkgewogICAgICAgIHZhciBvYmplY3RMZWZ0ID0gb2JqZWN0LmdldCgnbGVmdCcpLAogICAgICAgICAgICBvYmplY3RUb3AgPSBvYmplY3QuZ2V0KCd0b3AnKTsKICAgICAgICBvYmplY3Quc2V0KCdvcmlnaW5hbExlZnQnLCBvYmplY3RMZWZ0KTsKICAgICAgICBvYmplY3Quc2V0KCdvcmlnaW5hbFRvcCcsIG9iamVjdFRvcCk7CiAgICAgICAgb2JqZWN0LnNldCgnbGVmdCcsIG9iamVjdExlZnQgLSBncm91cERlbHRhWCk7CiAgICAgICAgb2JqZWN0LnNldCgndG9wJywgb2JqZWN0VG9wIC0gZ3JvdXBEZWx0YVkpOwogICAgICAgIG9iamVjdC5zZXRDb29yZHMoKTsgLy8gZG8gbm90IGRpc3BsYXkgY29ybmVycyBvZiBvYmplY3RzIGVuY2xvc2VkIGluIGEgZ3JvdXAKCiAgICAgICAgb2JqZWN0LmhpZGVDb3JuZXJzID0gdHJ1ZTsKICAgICAgfSwgdGhpcyk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBzdHJpbmcgcmVwcmVzZW5hdGlvbiBvZiBhIGdyb3VwCiAgICAgKiBAbWV0aG9kIHRvU3RyaW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9CiAgICAgKi8KICAgIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0cmluZygpIHsKICAgICAgcmV0dXJuICcjPGZhYnJpYy5Hcm91cDogKCcgKyB0aGlzLmNvbXBsZXhpdHkoKSArICcpPic7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBhbiBhcnJheSBvZiBhbGwgb2JqZWN0cyBpbiB0aGlzIGdyb3VwCiAgICAgKiBAbWV0aG9kIGdldE9iamVjdHMKICAgICAqIEByZXR1cm4ge0FycmF5fSBncm91cCBvYmplY3RzCiAgICAgKi8KICAgIGdldE9iamVjdHM6IGZ1bmN0aW9uIGdldE9iamVjdHMoKSB7CiAgICAgIHJldHVybiB0aGlzLm9iamVjdHM7CiAgICB9LAoKICAgIC8qKgogICAgICogQWRkcyBhbiBvYmplY3QgdG8gYSBncm91cDsgVGhlbiByZWNhbGN1bGF0ZXMgZ3JvdXAncyBkaW1lbnNpb24sIHBvc2l0aW9uLgogICAgICogQG1ldGhvZCBhZGRXaXRoVXBkYXRlCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgYWRkV2l0aFVwZGF0ZTogZnVuY3Rpb24gYWRkV2l0aFVwZGF0ZShvYmplY3QpIHsKICAgICAgdGhpcy5fcmVzdG9yZU9iamVjdHNTdGF0ZSgpOwoKICAgICAgdGhpcy5vYmplY3RzLnB1c2gob2JqZWN0KTsKCiAgICAgIHRoaXMuX2NhbGNCb3VuZHMoKTsKCiAgICAgIHRoaXMuX3VwZGF0ZU9iamVjdHNDb29yZHMoKTsKCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFJlbW92ZXMgYW4gb2JqZWN0IGZyb20gYSBncm91cDsgVGhlbiByZWNhbGN1bGF0ZXMgZ3JvdXAncyBkaW1lbnNpb24sIHBvc2l0aW9uLgogICAgICogQG1ldGhvZCByZW1vdmVXaXRoVXBkYXRlCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgcmVtb3ZlV2l0aFVwZGF0ZTogZnVuY3Rpb24gcmVtb3ZlV2l0aFVwZGF0ZShvYmplY3QpIHsKICAgICAgdGhpcy5fcmVzdG9yZU9iamVjdHNTdGF0ZSgpOwoKICAgICAgcmVtb3ZlRnJvbUFycmF5KHRoaXMub2JqZWN0cywgb2JqZWN0KTsKICAgICAgb2JqZWN0LnNldEFjdGl2ZShmYWxzZSk7CgogICAgICB0aGlzLl9jYWxjQm91bmRzKCk7CgogICAgICB0aGlzLl91cGRhdGVPYmplY3RzQ29vcmRzKCk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBBZGRzIGFuIG9iamVjdCB0byBhIGdyb3VwCiAgICAgKiBAbWV0aG9kIGFkZAogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdAogICAgICogQHJldHVybiB7ZmFicmljLkdyb3VwfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGFkZDogZnVuY3Rpb24gYWRkKG9iamVjdCkgewogICAgICB0aGlzLm9iamVjdHMucHVzaChvYmplY3QpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZW1vdmVzIGFuIG9iamVjdCBmcm9tIGEgZ3JvdXAKICAgICAqIEBtZXRob2QgcmVtb3ZlCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUob2JqZWN0KSB7CiAgICAgIHJlbW92ZUZyb21BcnJheSh0aGlzLm9iamVjdHMsIG9iamVjdCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgYSBzaXplIG9mIGEgZ3JvdXAgKGkuZTogbGVuZ3RoIG9mIGFuIGFycmF5IGNvbnRhaW5pbmcgaXRzIG9iamVjdHMpCiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IEdyb3VwIHNpemUKICAgICAqLwogICAgc2l6ZTogZnVuY3Rpb24gc2l6ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0cygpLmxlbmd0aDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBfc2V0OiBmdW5jdGlvbiBfc2V0KGtleSwgdmFsdWUpIHsKICAgICAgaWYgKGtleSA9PT0gJ2ZpbGwnIHx8IGtleSA9PT0gJ29wYWNpdHknKSB7CiAgICAgICAgdmFyIGkgPSB0aGlzLm9iamVjdHMubGVuZ3RoOwogICAgICAgIHRoaXNba2V5XSA9IHZhbHVlOwoKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICB0aGlzLm9iamVjdHNbaV0uc2V0KGtleSwgdmFsdWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiBhIGdyb3VwIGNvbnRhaW5zIGFuIG9iamVjdAogICAgICogQG1ldGhvZCBjb250YWlucwogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY2hlY2sgYWdhaW5zdAogICAgICogQHJldHVybiB7Qm9vbGVhbn0gYHRydWVgIGlmIGdyb3VwIGNvbnRhaW5zIGFuIG9iamVjdAogICAgICovCiAgICBjb250YWluczogZnVuY3Rpb24gY29udGFpbnMob2JqZWN0KSB7CiAgICAgIHJldHVybiB0aGlzLm9iamVjdHMuaW5kZXhPZihvYmplY3QpID4gLTE7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9PYmplY3QKICAgICAqIEByZXR1cm4ge09iamVjdH0gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIHRvT2JqZWN0OiBmdW5jdGlvbiB0b09iamVjdCgpIHsKICAgICAgcmV0dXJuIGV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnKSwgewogICAgICAgIG9iamVjdHM6IGludm9rZSh0aGlzLm9iamVjdHMsICd0b09iamVjdCcpCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJlbmRlcnMgaW5zdGFuY2Ugb24gYSBnaXZlbiBjb250ZXh0CiAgICAgKiBAbWV0aG9kIHJlbmRlcgogICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBjb250ZXh0IHRvIHJlbmRlciBpbnN0YW5jZSBvbgogICAgICovCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihjdHgsIG5vVHJhbnNmb3JtKSB7CiAgICAgIGN0eC5zYXZlKCk7CiAgICAgIHRoaXMudHJhbnNmb3JtKGN0eCk7CiAgICAgIHZhciBncm91cFNjYWxlRmFjdG9yID0gTWF0aC5tYXgodGhpcy5zY2FsZVgsIHRoaXMuc2NhbGVZKTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLm9iamVjdHMubGVuZ3RoLCBvYmplY3Q7IG9iamVjdCA9IHRoaXMub2JqZWN0c1tpXTsgaSsrKSB7CiAgICAgICAgdmFyIG9yaWdpbmFsU2NhbGVGYWN0b3IgPSBvYmplY3QuYm9yZGVyU2NhbGVGYWN0b3I7CiAgICAgICAgb2JqZWN0LmJvcmRlclNjYWxlRmFjdG9yID0gZ3JvdXBTY2FsZUZhY3RvcjsKICAgICAgICBvYmplY3QucmVuZGVyKGN0eCk7CiAgICAgICAgb2JqZWN0LmJvcmRlclNjYWxlRmFjdG9yID0gb3JpZ2luYWxTY2FsZUZhY3RvcjsKICAgICAgfQoKICAgICAgaWYgKCFub1RyYW5zZm9ybSAmJiB0aGlzLmFjdGl2ZSkgewogICAgICAgIHRoaXMuZHJhd0JvcmRlcnMoY3R4KTsKICAgICAgICB0aGlzLmhpZGVDb3JuZXJzIHx8IHRoaXMuZHJhd0Nvcm5lcnMoY3R4KTsKICAgICAgfQoKICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgdGhpcy5zZXRDb29yZHMoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG9iamVjdCBmcm9tIHRoZSBncm91cCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4CiAgICAgKiBAbWV0aG9kIGl0ZW0KICAgICAqIEBwYXJhbSBpbmRleCB7TnVtYmVyfSBpbmRleCBvZiBpdGVtIHRvIGdldAogICAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0KICAgICAqLwogICAgaXRlbTogZnVuY3Rpb24gaXRlbShpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5nZXRPYmplY3RzKClbaW5kZXhdOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgY29tcGxleGl0eSBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCBjb21wbGV4aXR5CiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGNvbXBsZXhpdHkKICAgICAqLwogICAgY29tcGxleGl0eTogZnVuY3Rpb24gY29tcGxleGl0eSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0T2JqZWN0cygpLnJlZHVjZShmdW5jdGlvbiAodG90YWwsIG9iamVjdCkgewogICAgICAgIHRvdGFsICs9IHR5cGVvZiBvYmplY3QuY29tcGxleGl0eSA9PSAnZnVuY3Rpb24nID8gb2JqZWN0LmNvbXBsZXhpdHkoKSA6IDA7CiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgICB9LCAwKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXRvcmVzIG9yaWdpbmFsIHN0YXRlIG9mIGVhY2ggb2YgZ3JvdXAgb2JqZWN0cyAob3JpZ2luYWwgc3RhdGUgaXMgdGhhdCB3aGljaCB3YXMgYmVmb3JlIGdyb3VwIHdhcyBjcmVhdGVkKS4KICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZXN0b3JlT2JqZWN0c1N0YXRlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgX3Jlc3RvcmVPYmplY3RzU3RhdGU6IGZ1bmN0aW9uIF9yZXN0b3JlT2JqZWN0c1N0YXRlKCkgewogICAgICB0aGlzLm9iamVjdHMuZm9yRWFjaCh0aGlzLl9yZXN0b3JlT2JqZWN0U3RhdGUsIHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXN0b3JlcyBvcmlnaW5hbCBzdGF0ZSBvZiBhIHNwZWNpZmllZCBvYmplY3QgaW4gZ3JvdXAKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZXN0b3JlT2JqZWN0U3RhdGUKICAgICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gb2JqZWN0CiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqLwogICAgX3Jlc3RvcmVPYmplY3RTdGF0ZTogZnVuY3Rpb24gX3Jlc3RvcmVPYmplY3RTdGF0ZShvYmplY3QpIHsKICAgICAgdmFyIGdyb3VwTGVmdCA9IHRoaXMuZ2V0KCdsZWZ0JyksCiAgICAgICAgICBncm91cFRvcCA9IHRoaXMuZ2V0KCd0b3AnKSwKICAgICAgICAgIGdyb3VwQW5nbGUgPSB0aGlzLmdldEFuZ2xlKCkgKiAoTWF0aC5QSSAvIDE4MCksCiAgICAgICAgICBvYmplY3RMZWZ0ID0gb2JqZWN0LmdldCgnb3JpZ2luYWxMZWZ0JyksCiAgICAgICAgICBvYmplY3RUb3AgPSBvYmplY3QuZ2V0KCdvcmlnaW5hbFRvcCcpLAogICAgICAgICAgcm90YXRlZFRvcCA9IE1hdGguY29zKGdyb3VwQW5nbGUpICogb2JqZWN0LmdldCgndG9wJykgKyBNYXRoLnNpbihncm91cEFuZ2xlKSAqIG9iamVjdC5nZXQoJ2xlZnQnKSwKICAgICAgICAgIHJvdGF0ZWRMZWZ0ID0gLU1hdGguc2luKGdyb3VwQW5nbGUpICogb2JqZWN0LmdldCgndG9wJykgKyBNYXRoLmNvcyhncm91cEFuZ2xlKSAqIG9iamVjdC5nZXQoJ2xlZnQnKTsKICAgICAgb2JqZWN0LnNldEFuZ2xlKG9iamVjdC5nZXRBbmdsZSgpICsgdGhpcy5nZXRBbmdsZSgpKTsKICAgICAgb2JqZWN0LnNldCgnbGVmdCcsIGdyb3VwTGVmdCArIHJvdGF0ZWRMZWZ0ICogdGhpcy5nZXQoJ3NjYWxlWCcpKTsKICAgICAgb2JqZWN0LnNldCgndG9wJywgZ3JvdXBUb3AgKyByb3RhdGVkVG9wICogdGhpcy5nZXQoJ3NjYWxlWScpKTsKICAgICAgb2JqZWN0LnNldCgnc2NhbGVYJywgb2JqZWN0LmdldCgnc2NhbGVYJykgKiB0aGlzLmdldCgnc2NhbGVYJykpOwogICAgICBvYmplY3Quc2V0KCdzY2FsZVknLCBvYmplY3QuZ2V0KCdzY2FsZVknKSAqIHRoaXMuZ2V0KCdzY2FsZVknKSk7CiAgICAgIG9iamVjdC5zZXRDb29yZHMoKTsKICAgICAgb2JqZWN0LmhpZGVDb3JuZXJzID0gZmFsc2U7CiAgICAgIG9iamVjdC5zZXRBY3RpdmUoZmFsc2UpOwogICAgICBvYmplY3Quc2V0Q29vcmRzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIERlc3Ryb3lzIGEgZ3JvdXAgKHJlc3RvcmluZyBzdGF0ZSBvZiBpdHMgb2JqZWN0cykKICAgICAqIEBtZXRob2QgZGVzdHJveQogICAgICogQHJldHVybiB7ZmFicmljLkdyb3VwfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgIHJldHVybiB0aGlzLl9yZXN0b3JlT2JqZWN0c1N0YXRlKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2F2ZXMgY29vcmRpbmF0ZXMgb2YgdGhpcyBpbnN0YW5jZSAodG8gYmUgdXNlZCB0b2dldGhlciB3aXRoIGBoYXNNb3ZlZGApCiAgICAgKiBAc2F2ZUNvb3JkcwogICAgICogQHJldHVybiB7ZmFicmljLkdyb3VwfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIHNhdmVDb29yZHM6IGZ1bmN0aW9uIHNhdmVDb29yZHMoKSB7CiAgICAgIHRoaXMuX29yaWdpbmFsTGVmdCA9IHRoaXMuZ2V0KCdsZWZ0Jyk7CiAgICAgIHRoaXMuX29yaWdpbmFsVG9wID0gdGhpcy5nZXQoJ3RvcCcpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBDaGVja3Mgd2hldGhlciB0aGlzIGdyb3VwIHdhcyBtb3ZlZCAoc2luY2UgYHNhdmVDb29yZHNgIHdhcyBjYWxsZWQgbGFzdCkKICAgICAqIEBtZXRob2QgaGFzTW92ZWQKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgYW4gb2JqZWN0IHdhcyBtb3ZlZCAoc2luY2UgZmFicmljLkdyb3VwI3NhdmVDb29yZHMgd2FzIGNhbGxlZCkKICAgICAqLwogICAgaGFzTW92ZWQ6IGZ1bmN0aW9uIGhhc01vdmVkKCkgewogICAgICByZXR1cm4gdGhpcy5fb3JpZ2luYWxMZWZ0ICE9PSB0aGlzLmdldCgnbGVmdCcpIHx8IHRoaXMuX29yaWdpbmFsVG9wICE9PSB0aGlzLmdldCgndG9wJyk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyBjb29yZGluYXRlcyBvZiBhbGwgZ3JvdXAgb2JqZWN0cwogICAgICogQG1ldGhvZCBzZXRPYmplY3RzQ29vcmRzCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2V0T2JqZWN0c0Nvb3JkczogZnVuY3Rpb24gc2V0T2JqZWN0c0Nvb3JkcygpIHsKICAgICAgdGhpcy5mb3JFYWNoT2JqZWN0KGZ1bmN0aW9uIChvYmplY3QpIHsKICAgICAgICBvYmplY3Quc2V0Q29vcmRzKCk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBBY3RpdmF0ZXMgKG1ha2VzIGFjdGl2ZSkgYWxsIGdyb3VwIG9iamVjdHMKICAgICAqIEBtZXRob2QgYWN0aXZhdGVBbGxPYmplY3RzCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgYWN0aXZhdGVBbGxPYmplY3RzOiBmdW5jdGlvbiBhY3RpdmF0ZUFsbE9iamVjdHMoKSB7CiAgICAgIHRoaXMuZm9yRWFjaE9iamVjdChmdW5jdGlvbiAob2JqZWN0KSB7CiAgICAgICAgb2JqZWN0LnNldEFjdGl2ZSgpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogRXhlY3V0ZXMgZ2l2ZW4gZnVuY3Rpb24gZm9yIGVhY2ggb2JqZWN0IGluIHRoaXMgZ3JvdXAKICAgICAqIEBtZXRob2QgZm9yRWFjaE9iamVjdAogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sKICAgICAqICAgICAgICAgICAgICAgICAgIENhbGxiYWNrIGludm9rZWQgd2l0aCBjdXJyZW50IG9iamVjdCBhcyBmaXJzdCBhcmd1bWVudCwKICAgICAqICAgICAgICAgICAgICAgICAgIGluZGV4IC0gYXMgc2Vjb25kIGFuZCBhbiBhcnJheSBvZiBhbGwgb2JqZWN0cyAtIGFzIHRoaXJkLgogICAgICogICAgICAgICAgICAgICAgICAgSXRlcmF0aW9uIGhhcHBlbnMgaW4gcmV2ZXJzZSBvcmRlciAoZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnMpLgogICAgICogICAgICAgICAgICAgICAgICAgQ2FsbGJhY2sgaXMgaW52b2tlZCBpbiBhIGNvbnRleHQgb2YgR2xvYmFsIE9iamVjdCAoZS5nLiBgd2luZG93YCkKICAgICAqICAgICAgICAgICAgICAgICAgIHdoZW4gbm8gYGNvbnRleHRgIGFyZ3VtZW50IGlzIGdpdmVuCiAgICAgKgogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQgQ29udGV4dCAoYWthIHRoaXNPYmplY3QpCiAgICAgKgogICAgICogQHJldHVybiB7ZmFicmljLkdyb3VwfSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIGZvckVhY2hPYmplY3Q6IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLmZvckVhY2hPYmplY3QsCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfc2V0T3BhY2l0eUlmU2FtZQogICAgICovCiAgICBfc2V0T3BhY2l0eUlmU2FtZTogZnVuY3Rpb24gX3NldE9wYWNpdHlJZlNhbWUoKSB7CiAgICAgIHZhciBvYmplY3RzID0gdGhpcy5nZXRPYmplY3RzKCksCiAgICAgICAgICBmaXJzdFZhbHVlID0gb2JqZWN0c1swXSA/IG9iamVjdHNbMF0uZ2V0KCdvcGFjaXR5JykgOiAxOwogICAgICB2YXIgaXNTYW1lT3BhY2l0eSA9IG9iamVjdHMuZXZlcnkoZnVuY3Rpb24gKG8pIHsKICAgICAgICByZXR1cm4gby5nZXQoJ29wYWNpdHknKSA9PT0gZmlyc3RWYWx1ZTsKICAgICAgfSk7CgogICAgICBpZiAoaXNTYW1lT3BhY2l0eSkgewogICAgICAgIHRoaXMub3BhY2l0eSA9IGZpcnN0VmFsdWU7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfY2FsY0JvdW5kcwogICAgICovCiAgICBfY2FsY0JvdW5kczogZnVuY3Rpb24gX2NhbGNCb3VuZHMoKSB7CiAgICAgIHZhciBhWCA9IFtdLAogICAgICAgICAgYVkgPSBbXSwKICAgICAgICAgIG1pblgsCiAgICAgICAgICBtaW5ZLAogICAgICAgICAgbWF4WCwKICAgICAgICAgIG1heFksCiAgICAgICAgICBvLAogICAgICAgICAgd2lkdGgsCiAgICAgICAgICBoZWlnaHQsCiAgICAgICAgICBpID0gMCwKICAgICAgICAgIGxlbiA9IHRoaXMub2JqZWN0cy5sZW5ndGg7CgogICAgICBmb3IgKDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgbyA9IHRoaXMub2JqZWN0c1tpXTsKICAgICAgICBvLnNldENvb3JkcygpOwoKICAgICAgICBmb3IgKHZhciBwcm9wIGluIG8ub0Nvb3JkcykgewogICAgICAgICAgYVgucHVzaChvLm9Db29yZHNbcHJvcF0ueCk7CiAgICAgICAgICBhWS5wdXNoKG8ub0Nvb3Jkc1twcm9wXS55KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIDsKICAgICAgbWluWCA9IG1pbihhWCk7CiAgICAgIG1heFggPSBtYXgoYVgpOwogICAgICBtaW5ZID0gbWluKGFZKTsKICAgICAgbWF4WSA9IG1heChhWSk7CiAgICAgIHdpZHRoID0gbWF4WCAtIG1pblggfHwgMDsKICAgICAgaGVpZ2h0ID0gbWF4WSAtIG1pblkgfHwgMDsKICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgICAgdGhpcy5sZWZ0ID0gbWluWCArIHdpZHRoIC8gMiB8fCAwOwogICAgICB0aGlzLnRvcCA9IG1pblkgKyBoZWlnaHQgLyAyIHx8IDA7CiAgICB9LAoKICAgIC8qKgogICAgICogQ2hlY2tzIGlmIHBvaW50IGlzIGNvbnRhaW5lZCB3aXRoaW4gdGhlIGdyb3VwCiAgICAgKiBAbWV0aG9kIGNvbnRhaW5zUG9pbnQKICAgICAqIEBwYXJhbSB7ZmFicmljLlBvaW50fSBwb2ludCBwb2ludCB3aXRoIGB4YCBhbmQgYHlgIHByb3BlcnRpZXMKICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgcG9pbnQgaXMgY29udGFpbmVkIHdpdGhpbiBncm91cAogICAgICovCiAgICBjb250YWluc1BvaW50OiBmdW5jdGlvbiBjb250YWluc1BvaW50KHBvaW50KSB7CiAgICAgIHZhciBoYWxmV2lkdGggPSB0aGlzLmdldCgnd2lkdGgnKSAvIDIsCiAgICAgICAgICBoYWxmSGVpZ2h0ID0gdGhpcy5nZXQoJ2hlaWdodCcpIC8gMiwKICAgICAgICAgIGNlbnRlclggPSB0aGlzLmdldCgnbGVmdCcpLAogICAgICAgICAgY2VudGVyWSA9IHRoaXMuZ2V0KCd0b3AnKTsKICAgICAgcmV0dXJuIGNlbnRlclggLSBoYWxmV2lkdGggPCBwb2ludC54ICYmIGNlbnRlclggKyBoYWxmV2lkdGggPiBwb2ludC54ICYmIGNlbnRlclkgLSBoYWxmSGVpZ2h0IDwgcG9pbnQueSAmJiBjZW50ZXJZICsgaGFsZkhlaWdodCA+IHBvaW50Lnk7CiAgICB9LAoKICAgIC8qKgogICAgICogTWFrZXMgYWxsIG9mIHRoaXMgZ3JvdXAncyBvYmplY3RzIGdyYXlzY2FsZSAoaS5lLiBjYWxsaW5nIGB0b0dyYXlzY2FsZWAgb24gdGhlbSkKICAgICAqIEBtZXRob2QgdG9HcmF5c2NhbGUKICAgICAqLwogICAgdG9HcmF5c2NhbGU6IGZ1bmN0aW9uIHRvR3JheXNjYWxlKCkgewogICAgICB2YXIgaSA9IHRoaXMub2JqZWN0cy5sZW5ndGg7CgogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgdGhpcy5vYmplY3RzW2ldLnRvR3JheXNjYWxlKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCB0b1NWRwogICAgICogQHJldHVybiB7c3RyaW5nfSBzdmcgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqLwogICAgdG9TVkc6IGZ1bmN0aW9uIHRvU1ZHKCkgewogICAgICB2YXIgb2JqZWN0c01hcmt1cCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMub2JqZWN0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIG9iamVjdHNNYXJrdXAucHVzaCh0aGlzLm9iamVjdHNbaV0udG9TVkcoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiAnPGcgdHJhbnNmb3JtPSInICsgdGhpcy5nZXRTdmdUcmFuc2Zvcm0oKSArICciPicgKyBvYmplY3RzTWFya3VwLmpvaW4oJycpICsgJzwvZz4nOwogICAgfQogIH0pOwogIC8qKgogICAqIFJldHVybnMgZmFicmljLkdyb3VwIGluc3RhbmNlIGZyb20gYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uCiAgICogQHN0YXRpYwogICAqIEBtZXRob2QgZmFicmljLkdyb3VwLmZyb21PYmplY3QKICAgKiBAcGFyYW0gb2JqZWN0IHtPYmplY3R9IG9iamVjdCB0byBjcmVhdGUgYSBncm91cCBmcm9tCiAgICogQHBhcmFtIG9wdGlvbnMge09iamVjdH0gb3B0aW9ucyBvYmplY3QKICAgKiBAcmV0dXJuIHtmYWJyaWMuR3JvdXB9IGFuIGluc3RhbmNlIG9mIGZhYnJpYy5Hcm91cAogICAqLwoKICBmYWJyaWMuR3JvdXAuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7CiAgICBmYWJyaWMudXRpbC5lbmxpdmVuT2JqZWN0cyhvYmplY3Qub2JqZWN0cywgZnVuY3Rpb24gKGVubGl2ZW5lZE9iamVjdHMpIHsKICAgICAgZGVsZXRlIG9iamVjdC5vYmplY3RzOwogICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhuZXcgZmFicmljLkdyb3VwKGVubGl2ZW5lZE9iamVjdHMsIG9iamVjdCkpOwogICAgfSk7CiAgfTsKCiAgZmFicmljLkdyb3VwLmFzeW5jID0gdHJ1ZTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIGV4dGVuZCA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQ7CgogIGlmICghZ2xvYmFsLmZhYnJpYykgewogICAgZ2xvYmFsLmZhYnJpYyA9IHt9OwogIH0KCiAgaWYgKGdsb2JhbC5mYWJyaWMuSW1hZ2UpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuSW1hZ2UgaXMgYWxyZWFkeSBkZWZpbmVkLicpOwogICAgcmV0dXJuOwogIH0KCiAgOwoKICBpZiAoIWZhYnJpYy5PYmplY3QpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuT2JqZWN0IGlzIHJlcXVpcmVkIGZvciBmYWJyaWMuSW1hZ2UgaW5pdGlhbGl6YXRpb24nKTsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIEltYWdlCiAgICogQGV4dGVuZHMgZmFicmljLk9iamVjdAogICAqLwoKCiAgZmFicmljLkltYWdlID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwKICAvKiogQHNjb3BlIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgQm9vbGVhbgogICAgICovCiAgICBhY3RpdmU6IGZhbHNlLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIGJvcmRlcnZpc2liaWxpdHk6IGZhbHNlLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIGNvcm5lcnZpc2liaWxpdHk6IGZhbHNlLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdHlwZTogJ2ltYWdlJywKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAcGFyYW0ge0hUTUxJbWFnZUVsZW1lbnQgfCBTdHJpbmd9IGVsZW1lbnQgSW1hZ2UgZWxlbWVudAogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgb3B0aW9uYWwKICAgICAqLwogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShlbGVtZW50LCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7CgogICAgICB0aGlzLl9pbml0RWxlbWVudChlbGVtZW50KTsKCiAgICAgIHRoaXMuX29yaWdpbmFsSW1hZ2UgPSB0aGlzLmdldEVsZW1lbnQoKTsKCiAgICAgIHRoaXMuX2luaXRDb25maWcob3B0aW9ucyk7CgogICAgICB0aGlzLmZpbHRlcnMgPSBbXTsKCiAgICAgIGlmIChvcHRpb25zLmZpbHRlcnMpIHsKICAgICAgICB0aGlzLmZpbHRlcnMgPSBvcHRpb25zLmZpbHRlcnM7CiAgICAgICAgdGhpcy5hcHBseUZpbHRlcnMoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgaW1hZ2UgZWxlbWVudCB3aGljaCB0aGlzIGluc3RhbmNlIGlmIGJhc2VkIG9uCiAgICAgKiBAbWV0aG9kIGdldEVsZW1lbnQKICAgICAqIEByZXR1cm4ge0hUTUxJbWFnZUVsZW1lbnR9IGltYWdlIGVsZW1lbnQKICAgICAqLwogICAgZ2V0RWxlbWVudDogZnVuY3Rpb24gZ2V0RWxlbWVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyBpbWFnZSBlbGVtZW50IGZvciB0aGlzIGluc3RhbmNlIHRvIGEgc3BlY2lmaWVkIG9uZQogICAgICogQG1ldGhvZCBzZXRFbGVtZW50CiAgICAgKiBAcGFyYW0ge0hUTUxJbWFnZUVsZW1lbnR9IGVsZW1lbnQKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5JbWFnZX0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbiBzZXRFbGVtZW50KGVsZW1lbnQpIHsKICAgICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7CgogICAgICB0aGlzLl9pbml0Q29uZmlnKCk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXR1cm5zIG9yaWdpbmFsIHNpemUgb2YgYW4gaW1hZ2UKICAgICAqIEBtZXRob2QgZ2V0T3JpZ2luYWxTaXplCiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IG9iamVjdCB3aXRoICJ3aWR0aCIgYW5kICJoZWlnaHQiIHByb3BlcnRpZXMKICAgICAqLwogICAgZ2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbiBnZXRPcmlnaW5hbFNpemUoKSB7CiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5nZXRFbGVtZW50KCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IGVsZW1lbnQud2lkdGgsCiAgICAgICAgaGVpZ2h0OiBlbGVtZW50LmhlaWdodAogICAgICB9OwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgYm9yZGVyIHZpc2liaWxpdHkKICAgICAqIEBtZXRob2Qgc2V0Qm9yZGVyVmlzaWJpbGl0eQogICAgICogQHBhcmFtIHtCb29sZWFufSB2aXNpYmxlIFdoZW4gdHJ1ZSwgYm9yZGVyIGlzIHNldCB0byBiZSB2aXNpYmxlCiAgICAgKi8KICAgIHNldEJvcmRlclZpc2liaWxpdHk6IGZ1bmN0aW9uIHNldEJvcmRlclZpc2liaWxpdHkodmlzaWJsZSkgewogICAgICB0aGlzLl9yZXNldFdpZHRoSGVpZ2h0KCk7CgogICAgICB0aGlzLl9hZGp1c3RXaWR0aEhlaWdodFRvQm9yZGVycyhzaG93Qm9yZGVyKTsKCiAgICAgIHRoaXMuc2V0Q29vcmRzKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyBjb3JuZXIgdmlzaWJpbGl0eQogICAgICogQG1ldGhvZCBzZXRDb3JuZXJzVmlzaWJpbGl0eQogICAgICogQHBhcmFtIHtCb29sZWFufSB2aXNpYmxlIFdoZW4gdHJ1ZSwgY29ybmVycyBhcmUgc2V0IHRvIGJlIHZpc2libGUKICAgICAqLwogICAgc2V0Q29ybmVyc1Zpc2liaWxpdHk6IGZ1bmN0aW9uIHNldENvcm5lcnNWaXNpYmlsaXR5KHZpc2libGUpIHsKICAgICAgdGhpcy5jb3JuZXJ2aXNpYmlsaXR5ID0gISF2aXNpYmxlOwogICAgfSwKCiAgICAvKioKICAgICAqIFJlbmRlcnMgaW1hZ2Ugb24gYSBzcGVjaWZpZWQgY29udGV4dAogICAgICogQG1ldGhvZCByZW5kZXIKICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoY3R4LCBub1RyYW5zZm9ybSkgewogICAgICBjdHguc2F2ZSgpOwogICAgICB2YXIgbSA9IHRoaXMudHJhbnNmb3JtTWF0cml4OwoKICAgICAgdGhpcy5fcmVzZXRXaWR0aEhlaWdodCgpOwoKICAgICAgaWYgKHRoaXMuZ3JvdXApIHsKICAgICAgICBjdHgudHJhbnNsYXRlKC10aGlzLmdyb3VwLndpZHRoIC8gMiArIHRoaXMud2lkdGggLyAyLCAtdGhpcy5ncm91cC5oZWlnaHQgLyAyICsgdGhpcy5oZWlnaHQgLyAyKTsKICAgICAgfQoKICAgICAgaWYgKG0pIHsKICAgICAgICBjdHgudHJhbnNmb3JtKG1bMF0sIG1bMV0sIG1bMl0sIG1bM10sIG1bNF0sIG1bNV0pOwogICAgICB9CgogICAgICBpZiAoIW5vVHJhbnNmb3JtKSB7CiAgICAgICAgdGhpcy50cmFuc2Zvcm0oY3R4KTsKICAgICAgfQoKICAgICAgdGhpcy5fcmVuZGVyKGN0eCk7CgogICAgICBpZiAodGhpcy5hY3RpdmUgJiYgIW5vVHJhbnNmb3JtKSB7CiAgICAgICAgdGhpcy5kcmF3Qm9yZGVycyhjdHgpOwogICAgICAgIHRoaXMuaGlkZUNvcm5lcnMgfHwgdGhpcy5kcmF3Q29ybmVycyhjdHgpOwogICAgICB9CgogICAgICBjdHgucmVzdG9yZSgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvT2JqZWN0CiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IE9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b09iamVjdDogZnVuY3Rpb24gdG9PYmplY3QoKSB7CiAgICAgIHJldHVybiBleHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHsKICAgICAgICBzcmM6IHRoaXMuX29yaWdpbmFsSW1hZ2Uuc3JjIHx8IHRoaXMuX29yaWdpbmFsSW1hZ2UuX3NyYywKICAgICAgICBmaWx0ZXJzOiB0aGlzLmZpbHRlcnMuY29uY2F0KCkKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBzdmcgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgdG9TVkcKICAgICAqIEByZXR1cm4ge3N0cmluZ30gc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKi8KICAgIHRvU1ZHOiBmdW5jdGlvbiB0b1NWRygpIHsKICAgICAgcmV0dXJuICc8ZyB0cmFuc2Zvcm09IicgKyB0aGlzLmdldFN2Z1RyYW5zZm9ybSgpICsgJyI+JyArICc8aW1hZ2UgeGxpbms6aHJlZj0iJyArIHRoaXMuZ2V0U3ZnU3JjKCkgKyAnIiAnICsgJ3N0eWxlPSInICsgdGhpcy5nZXRTdmdTdHlsZXMoKSArICciICcgKyAvLyB3ZSdyZSBlc3NlbnRpYWxseSBtb3Zpbmcgb3JpZ2luIG9mIHRyYW5zZm9ybWF0aW9uIGZyb20gdG9wL2xlZnQgY29ybmVyIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNoYXBlCiAgICAgIC8vIGJ5IHdyYXBwaW5nIGl0IGluIGNvbnRhaW5lciA8Zz4gZWxlbWVudCB3aXRoIGFjdHVhbCB0cmFuc2Zvcm1hdGlvbiwgdGhlbiBvZmZzZXR0aW5nIG9iamVjdCB0byB0aGUgdG9wL2xlZnQKICAgICAgLy8gc28gdGhhdCBvYmplY3QncyBjZW50ZXIgYWxpZ25zIHdpdGggY29udGFpbmVyJ3MgbGVmdC90b3AKICAgICAgJ3RyYW5zZm9ybT0idHJhbnNsYXRlKCcgKyAtdGhpcy53aWR0aCAvIDIgKyAnICcgKyAtdGhpcy5oZWlnaHQgLyAyICsgJykiICcgKyAnd2lkdGg9IicgKyB0aGlzLndpZHRoICsgJyIgJyArICdoZWlnaHQ9IicgKyB0aGlzLmhlaWdodCArICciJyArICcvPicgKyAnPC9nPic7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBzb3VyY2Ugb2YgYW4gaW1hZ2UKICAgICAqIEBtZXRob2QgZ2V0U3JjCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFNvdXJjZSBvZiBhbiBpbWFnZQogICAgICovCiAgICBnZXRTcmM6IGZ1bmN0aW9uIGdldFNyYygpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudCgpLnNyYyB8fCB0aGlzLmdldEVsZW1lbnQoKS5fc3JjOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU3RyaW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiAnIzxmYWJyaWMuSW1hZ2U6IHsgc3JjOiAiJyArIHRoaXMuZ2V0U3JjKCkgKyAnIiB9Pic7CiAgICB9LAoKICAgIC8qKgogICAgICogUmV0dXJucyBhIGNsb25lIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbXRob2QgY2xvbmUKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGlzIGludm9rZWQgd2l0aCBhIGNsb25lIGFzIGEgZmlyc3QgYXJndW1lbnQKICAgICAqLwogICAgY2xvbmU6IGZ1bmN0aW9uIGNsb25lKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuY29uc3RydWN0b3IuZnJvbU9iamVjdCh0aGlzLnRvT2JqZWN0KCksIGNhbGxiYWNrKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBBcHBsaWVzIGZpbHRlcnMgYXNzaWduZWQgdG8gdGhpcyBpbWFnZSAoZnJvbSAiZmlsdGVycyIgYXJyYXkpCiAgICAgKiBAbXRob2QgYXBwbHlGaWx0ZXJzCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBpcyBpbnZva2VkIHdoZW4gYWxsIGZpbHRlcnMgaGF2ZSBiZWVuIGFwcGxpZWQgYW5kIG5ldyBpbWFnZSBpcyBnZW5lcmF0ZWQKICAgICAqLwogICAgYXBwbHlGaWx0ZXJzOiBmdW5jdGlvbiBhcHBseUZpbHRlcnMoY2FsbGJhY2spIHsKICAgICAgaWYgKHRoaXMuZmlsdGVycy5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnNldEVsZW1lbnQodGhpcy5fb3JpZ2luYWxJbWFnZSk7CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBpc0xpa2VseU5vZGUgPSB0eXBlb2YgQnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJywKICAgICAgICAgIGltZ0VsID0gdGhpcy5fb3JpZ2luYWxJbWFnZSwKICAgICAgICAgIGNhbnZhc0VsID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLAogICAgICAgICAgcmVwbGFjZW1lbnQgPSBpc0xpa2VseU5vZGUgPyBuZXcgKHJlcXVpcmUoJ2NhbnZhcycpLkltYWdlKSgpIDogZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpLAogICAgICAgICAgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKCFjYW52YXNFbC5nZXRDb250ZXh0ICYmIHR5cGVvZiBHX3ZtbENhbnZhc01hbmFnZXIgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBHX3ZtbENhbnZhc01hbmFnZXIuaW5pdEVsZW1lbnQoY2FudmFzRWwpOwogICAgICB9CgogICAgICBjYW52YXNFbC53aWR0aCA9IGltZ0VsLndpZHRoOwogICAgICBjYW52YXNFbC5oZWlnaHQgPSBpbWdFbC5oZWlnaHQ7CiAgICAgIGNhbnZhc0VsLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKGltZ0VsLCAwLCAwLCBpbWdFbC53aWR0aCwgaW1nRWwuaGVpZ2h0KTsKICAgICAgdGhpcy5maWx0ZXJzLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikgewogICAgICAgIGZpbHRlciAmJiBmaWx0ZXIuYXBwbHlUbyhjYW52YXNFbCk7CiAgICAgIH0pOwogICAgICAvKiogQGlnbm9yZSAqLwoKICAgICAgcmVwbGFjZW1lbnQub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLl9lbGVtZW50ID0gcmVwbGFjZW1lbnQ7CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsKICAgICAgICByZXBsYWNlbWVudC5vbmxvYWQgPSBjYW52YXNFbCA9IGltZ0VsID0gbnVsbDsKICAgICAgfTsKCiAgICAgIHJlcGxhY2VtZW50LndpZHRoID0gaW1nRWwud2lkdGg7CiAgICAgIHJlcGxhY2VtZW50LmhlaWdodCA9IGltZ0VsLmhlaWdodDsKCiAgICAgIGlmIChpc0xpa2VseU5vZGUpIHsKICAgICAgICB2YXIgYmFzZTY0c3RyID0gY2FudmFzRWwudG9EYXRhVVJMKCdpbWFnZS9wbmcnKS5yZXBsYWNlKC9kYXRhOmltYWdlXC9wbmc7YmFzZTY0LC8sICcnKTsKICAgICAgICByZXBsYWNlbWVudC5zcmMgPSBuZXcgQnVmZmVyKGJhc2U2NHN0ciwgJ2Jhc2U2NCcpOwogICAgICAgIF90aGlzLl9lbGVtZW50ID0gcmVwbGFjZW1lbnQ7IC8vIG9ubG9hZCBkb2Vzbid0IGZpcmUgaW4gbm9kZSwgc28gd2UgaW52b2tlIGNhbGxiYWNrIG1hbnVhbGx5CgogICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVwbGFjZW1lbnQuc3JjID0gY2FudmFzRWwudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgpIHsKICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLmdldEVsZW1lbnQoKSwgLXRoaXMud2lkdGggLyAyLCAtdGhpcy5oZWlnaHQgLyAyLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgX2FkanVzdFdpZHRoSGVpZ2h0VG9Cb3JkZXJzOiBmdW5jdGlvbiBfYWRqdXN0V2lkdGhIZWlnaHRUb0JvcmRlcnMoc2hvd0JvcmRlcikgewogICAgICBpZiAoc2hvd0JvcmRlcikgewogICAgICAgIHRoaXMuY3VycmVudEJvcmRlciA9IHRoaXMuYm9yZGVyd2lkdGg7CiAgICAgICAgdGhpcy53aWR0aCArPSAyICogdGhpcy5jdXJyZW50Qm9yZGVyOwogICAgICAgIHRoaXMuaGVpZ2h0ICs9IDIgKiB0aGlzLmN1cnJlbnRCb3JkZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jdXJyZW50Qm9yZGVyID0gMDsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIF9yZXNldFdpZHRoSGVpZ2h0OiBmdW5jdGlvbiBfcmVzZXRXaWR0aEhlaWdodCgpIHsKICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoKTsKICAgICAgdGhpcy5zZXQoJ3dpZHRoJywgZWxlbWVudC53aWR0aCk7CiAgICAgIHRoaXMuc2V0KCdoZWlnaHQnLCBlbGVtZW50LmhlaWdodCk7CiAgICB9LAoKICAgIC8qKgogICAgICogVGhlIEltYWdlIGNsYXNzJ3MgaW5pdGlhbGl6YXRpb24gbWV0aG9kLiBUaGlzIG1ldGhvZCBpcyBhdXRvbWF0aWNhbGx5CiAgICAgKiBjYWxsZWQgYnkgdGhlIGNvbnN0cnVjdG9yLgogICAgICogQG1ldGhvZCBfaW5pdEVsZW1lbnQKICAgICAqIEBwYXJhbSB7SFRNTEltYWdlRWxlbWVudHxTdHJpbmd9IGVsIFRoZSBlbGVtZW50IHJlcHJlc2VudGluZyB0aGUgaW1hZ2UKICAgICAqLwogICAgX2luaXRFbGVtZW50OiBmdW5jdGlvbiBfaW5pdEVsZW1lbnQoZWxlbWVudCkgewogICAgICB0aGlzLnNldEVsZW1lbnQoZmFicmljLnV0aWwuZ2V0QnlJZChlbGVtZW50KSk7CiAgICAgIGZhYnJpYy51dGlsLmFkZENsYXNzKHRoaXMuZ2V0RWxlbWVudCgpLCBmYWJyaWMuSW1hZ2UuQ1NTX0NBTlZBUyk7CiAgICB9LAoKICAgIC8qKgogICAgICogQG1ldGhvZCBfaW5pdENvbmZpZwogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgT3B0aW9ucyBvYmplY3QKICAgICAqLwogICAgX2luaXRDb25maWc6IGZ1bmN0aW9uIF9pbml0Q29uZmlnKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwoKICAgICAgdGhpcy5fc2V0Qm9yZGVyKCk7CgogICAgICB0aGlzLl9zZXRXaWR0aEhlaWdodChvcHRpb25zKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAbWV0aG9kIF9pbml0RmlsdGVycwogICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBPYmplY3Qgd2l0aCBmaWx0ZXJzIHByb3BlcnR5CiAgICAgKi8KICAgIF9pbml0RmlsdGVyczogZnVuY3Rpb24gX2luaXRGaWx0ZXJzKG9iamVjdCkgewogICAgICBpZiAob2JqZWN0LmZpbHRlcnMgJiYgb2JqZWN0LmZpbHRlcnMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5maWx0ZXJzID0gb2JqZWN0LmZpbHRlcnMubWFwKGZ1bmN0aW9uIChmaWx0ZXJPYmopIHsKICAgICAgICAgIHJldHVybiBmaWx0ZXJPYmogJiYgZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyT2JqLnR5cGVdLmZyb21PYmplY3QoZmlsdGVyT2JqKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIF9zZXRCb3JkZXI6IGZ1bmN0aW9uIF9zZXRCb3JkZXIoKSB7CiAgICAgIGlmICh0aGlzLmJvcmRlcnZpc2liaWxpdHkpIHsKICAgICAgICB0aGlzLmN1cnJlbnRCb3JkZXIgPSB0aGlzLmJvcmRlcndpZHRoOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY3VycmVudEJvcmRlciA9IDA7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBfc2V0V2lkdGhIZWlnaHQ6IGZ1bmN0aW9uIF9zZXRXaWR0aEhlaWdodChvcHRpb25zKSB7CiAgICAgIHZhciBzaWRlc0JvcmRlcldpZHRoID0gMiAqIHRoaXMuY3VycmVudEJvcmRlcjsKICAgICAgdGhpcy53aWR0aCA9ICd3aWR0aCcgaW4gb3B0aW9ucyA/IG9wdGlvbnMud2lkdGggOiAodGhpcy5nZXRFbGVtZW50KCkud2lkdGggfHwgMCkgKyBzaWRlc0JvcmRlcldpZHRoOwogICAgICB0aGlzLmhlaWdodCA9ICdoZWlnaHQnIGluIG9wdGlvbnMgPyBvcHRpb25zLmhlaWdodCA6ICh0aGlzLmdldEVsZW1lbnQoKS5oZWlnaHQgfHwgMCkgKyBzaWRlc0JvcmRlcldpZHRoOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgY29tcGxleGl0eSBvZiBhbiBpbnN0YW5jZQogICAgICogQG1ldGhvZCBjb21wbGV4aXR5CiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGNvbXBsZXhpdHkKICAgICAqLwogICAgY29tcGxleGl0eTogZnVuY3Rpb24gY29tcGxleGl0eSgpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9CiAgfSk7CiAgLyoqCiAgICogRGVmYXVsdCBDU1MgY2xhc3MgbmFtZSBmb3IgY2FudmFzCiAgICogQHN0YXRpYwogICAqIEB0eXBlIFN0cmluZwogICAqLwoKICBmYWJyaWMuSW1hZ2UuQ1NTX0NBTlZBUyA9ICJjYW52YXMtaW1nIjsKICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmdldFN2Z1NyYyA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuZ2V0U3JjOwogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgZmFicmljLkltYWdlIGZyb20gaXRzIG9iamVjdCByZXByZXNlbnRhdGlvbgogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZyb21PYmplY3QKICAgKiBAcGFyYW0gb2JqZWN0IHtPYmplY3R9CiAgICogQHBhcmFtIGNhbGxiYWNrIHtGdW5jdGlvbn0gb3B0aW9uYWwKICAgKi8KCiAgZmFicmljLkltYWdlLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykgewogICAgdmFyIGltZyA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKSwKICAgICAgICBzcmMgPSBvYmplY3Quc3JjOwoKICAgIGlmIChvYmplY3Qud2lkdGgpIHsKICAgICAgaW1nLndpZHRoID0gb2JqZWN0LndpZHRoOwogICAgfQoKICAgIGlmIChvYmplY3QuaGVpZ2h0KSB7CiAgICAgIGltZy5oZWlnaHQgPSBvYmplY3QuaGVpZ2h0OwogICAgfQogICAgLyoqIEBpZ25vcmUgKi8KCgogICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZmFicmljLkltYWdlLnByb3RvdHlwZS5faW5pdEZpbHRlcnMuY2FsbChvYmplY3QsIG9iamVjdCk7CgogICAgICB2YXIgaW5zdGFuY2UgPSBuZXcgZmFicmljLkltYWdlKGltZywgb2JqZWN0KTsKICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soaW5zdGFuY2UpOwogICAgICBpbWcgPSBpbWcub25sb2FkID0gbnVsbDsKICAgIH07CgogICAgaW1nLnNyYyA9IHNyYzsKICB9OwogIC8qKgogICAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgZmFicmljLkltYWdlIGZyb20gYW4gVVJMIHN0cmluZwogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZyb21VUkwKICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIFVSTCB0byBjcmVhdGUgYW4gaW1hZ2UgZnJvbQogICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgdG8gaW52b2tlIHdoZW4gaW1hZ2UgaXMgY3JlYXRlZCAobmV3bHkgY3JlYXRlZCBpbWFnZSBpcyBwYXNzZWQgYXMgYSBmaXJzdCBhcmd1bWVudCkKICAgKiBAcGFyYW0ge09iamVjdH0gW2ltZ09wdGlvbnNdIE9wdGlvbnMgb2JqZWN0CiAgICovCgoKICBmYWJyaWMuSW1hZ2UuZnJvbVVSTCA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCBpbWdPcHRpb25zKSB7CiAgICB2YXIgaW1nID0gZmFicmljLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgLyoqIEBpZ25vcmUgKi8KCiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFjayhuZXcgZmFicmljLkltYWdlKGltZywgaW1nT3B0aW9ucykpOwogICAgICB9CgogICAgICBpbWcgPSBpbWcub25sb2FkID0gbnVsbDsKICAgIH07CgogICAgaW1nLnNyYyA9IHVybDsKICB9OwogIC8qKgogICAqIExpc3Qgb2YgYXR0cmlidXRlIG5hbWVzIHRvIGFjY291bnQgZm9yIHdoZW4gcGFyc2luZyBTVkcgZWxlbWVudCAodXNlZCBieSB7QGxpbmsgZmFicmljLkltYWdlLmZyb21FbGVtZW50fSkKICAgKiBAc3RhdGljCiAgICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcvc3RydWN0Lmh0bWwjSW1hZ2VFbGVtZW50CiAgICovCgoKICBmYWJyaWMuSW1hZ2UuQVRUUklCVVRFX05BTUVTID0gJ3ggeSB3aWR0aCBoZWlnaHQgZmlsbCBmaWxsLW9wYWNpdHkgb3BhY2l0eSBzdHJva2Ugc3Ryb2tlLXdpZHRoIHRyYW5zZm9ybSB4bGluazpocmVmJy5zcGxpdCgnICcpOwogIC8qKgogICAqIFJldHVybnMge0BsaW5rIGZhYnJpYy5JbWFnZX0gaW5zdGFuY2UgZnJvbSBhbiBTVkcgZWxlbWVudAogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZhYnJpYy5JbWFnZS5mcm9tRWxlbWVudAogICAqIEBwYXJhbSB7U1ZHRWxlbWVudH0gZWxlbWVudCBFbGVtZW50IHRvIHBhcnNlCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gZXhlY3V0ZSB3aGVuIGZhYnJpYy5JbWFnZSBvYmplY3QgaXMgY3JlYXRlZAogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QKICAgKiBAcmV0dXJuIHtmYWJyaWMuSW1hZ2V9CiAgICovCgogIGZhYnJpYy5JbWFnZS5mcm9tRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50LCBjYWxsYmFjaywgb3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBwYXJzZWRBdHRyaWJ1dGVzID0gZmFicmljLnBhcnNlQXR0cmlidXRlcyhlbGVtZW50LCBmYWJyaWMuSW1hZ2UuQVRUUklCVVRFX05BTUVTKTsKICAgIGZhYnJpYy5JbWFnZS5mcm9tVVJMKHBhcnNlZEF0dHJpYnV0ZXNbJ3hsaW5rOmhyZWYnXSwgY2FsbGJhY2ssIGV4dGVuZChwYXJzZWRBdHRyaWJ1dGVzLCBvcHRpb25zKSk7CiAgfTsKCiAgZmFicmljLkltYWdlLmFzeW5jID0gdHJ1ZTsKfSkodHlwZW9mIGV4cG9ydHMgIT0gJ3VuZGVmaW5lZCcgPyBleHBvcnRzIDogdGhpcyk7CgpmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7CiAgLyoqCiAgICogQG1ldGhvZCBfZ2V0QW5nbGVWYWx1ZUZvclN0cmFpZ2h0ZW4KICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGFuZ2xlIHZhbHVlCiAgICogQHByaXZhdGUKICAgKi8KICBfZ2V0QW5nbGVWYWx1ZUZvclN0cmFpZ2h0ZW46IGZ1bmN0aW9uIF9nZXRBbmdsZVZhbHVlRm9yU3RyYWlnaHRlbigpIHsKICAgIHZhciBhbmdsZSA9IHRoaXMuZ2V0KCdhbmdsZScpOyAvLyBUT0RPIChrYW5nYXgpOiBjYW4gdGhpcyBiZSBzaW1wbGlmaWVkPwoKICAgIGlmIChhbmdsZSA+IC0yMjUgJiYgYW5nbGUgPD0gLTEzNSkgewogICAgICByZXR1cm4gLTE4MDsKICAgIH0gZWxzZSBpZiAoYW5nbGUgPiAtMTM1ICYmIGFuZ2xlIDw9IC00NSkgewogICAgICByZXR1cm4gLTkwOwogICAgfSBlbHNlIGlmIChhbmdsZSA+IC00NSAmJiBhbmdsZSA8PSA0NSkgewogICAgICByZXR1cm4gMDsKICAgIH0gZWxzZSBpZiAoYW5nbGUgPiA0NSAmJiBhbmdsZSA8PSAxMzUpIHsKICAgICAgcmV0dXJuIDkwOwogICAgfSBlbHNlIGlmIChhbmdsZSA+IDEzNSAmJiBhbmdsZSA8PSAyMjUpIHsKICAgICAgcmV0dXJuIDE4MDsKICAgIH0gZWxzZSBpZiAoYW5nbGUgPiAyMjUgJiYgYW5nbGUgPD0gMzE1KSB7CiAgICAgIHJldHVybiAyNzA7CiAgICB9IGVsc2UgaWYgKGFuZ2xlID4gMzE1KSB7CiAgICAgIHJldHVybiAzNjA7CiAgICB9CgogICAgcmV0dXJuIDA7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCBzdHJhaWdodGVuCiAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZwogICAqIEBjaGFpbmFibGUKICAgKi8KICBzdHJhaWdodGVuOiBmdW5jdGlvbiBzdHJhaWdodGVuKCkgewogICAgdmFyIGFuZ2xlID0gdGhpcy5fZ2V0QW5nbGVWYWx1ZUZvclN0cmFpZ2h0ZW4oKTsKCiAgICB0aGlzLnNldEFuZ2xlKGFuZ2xlKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAqIEBtZXRob2QgZnhTdHJhaWdodGVuCiAgICogQHBhcmFtIHtPYmplY3R9IGNhbGxiYWNrcwogICAqICAgICAgICAgICAgICAgICAgLSBvbkNvbXBsZXRlOiBpbnZva2VkIG9uIGNvbXBsZXRpb24KICAgKiAgICAgICAgICAgICAgICAgIC0gb25DaGFuZ2U6IGludm9rZWQgb24gZXZlcnkgc3RlcCBvZiBhbmltYXRpb24KICAgKgogICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmcKICAgKiBAY2hhaW5hYmxlCiAgICovCiAgZnhTdHJhaWdodGVuOiBmdW5jdGlvbiBmeFN0cmFpZ2h0ZW4oY2FsbGJhY2tzKSB7CiAgICBjYWxsYmFja3MgPSBjYWxsYmFja3MgfHwge307CgogICAgdmFyIGVtcHR5ID0gZnVuY3Rpb24gZW1wdHkoKSB7fSwKICAgICAgICBfb25Db21wbGV0ZTQgPSBjYWxsYmFja3Mub25Db21wbGV0ZSB8fCBlbXB0eSwKICAgICAgICBfb25DaGFuZ2U0ID0gY2FsbGJhY2tzLm9uQ2hhbmdlIHx8IGVtcHR5LAogICAgICAgIF90aGlzID0gdGhpczsKCiAgICBmYWJyaWMudXRpbC5hbmltYXRlKHsKICAgICAgc3RhcnRWYWx1ZTogdGhpcy5nZXQoJ2FuZ2xlJyksCiAgICAgIGVuZFZhbHVlOiB0aGlzLl9nZXRBbmdsZVZhbHVlRm9yU3RyYWlnaHRlbigpLAogICAgICBkdXJhdGlvbjogdGhpcy5GWF9EVVJBVElPTiwKICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKHZhbHVlKSB7CiAgICAgICAgX3RoaXMuc2V0QW5nbGUodmFsdWUpOwoKICAgICAgICBfb25DaGFuZ2U0KCk7CiAgICAgIH0sCiAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uIG9uQ29tcGxldGUoKSB7CiAgICAgICAgX3RoaXMuc2V0Q29vcmRzKCk7CgogICAgICAgIF9vbkNvbXBsZXRlNCgpOwogICAgICB9LAogICAgICBvblN0YXJ0OiBmdW5jdGlvbiBvblN0YXJ0KCkgewogICAgICAgIF90aGlzLnNldEFjdGl2ZShmYWxzZSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHRoaXM7CiAgfQp9KTsKZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwgewogIC8qKgogICAqIFN0cmFpZ2h0ZW5zIG9iamVjdCwgdGhlbiByZXJlbmRlcnMgY2FudmFzCiAgICogQG1ldGhvZCBzdHJhaWdodGVuT2JqZWN0CiAgICogQHBhcmFtIHtmYWJyaWMuT2JqZWN0fSBvYmplY3QgT2JqZWN0IHRvIHN0cmFpZ2h0ZW4KICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICogQGNoYWluYWJsZQogICAqLwogIHN0cmFpZ2h0ZW5PYmplY3Q6IGZ1bmN0aW9uIHN0cmFpZ2h0ZW5PYmplY3Qob2JqZWN0KSB7CiAgICBvYmplY3Quc3RyYWlnaHRlbigpOwogICAgdGhpcy5yZW5kZXJBbGwoKTsKICAgIHJldHVybiB0aGlzOwogIH0sCgogIC8qKgogICAqIFNhbWUgYXMgYGZhYnJpYy5DYW52YXMjc3RyYWlnaHRlbk9iamVjdGAsIGJ1dCBhbmltYXRlZAogICAqIEBtZXRob2QgZnhTdHJhaWdodGVuT2JqZWN0CiAgICogQHBhcmFtIHtmYWJyaWMuT2JqZWN0fSBvYmplY3QgT2JqZWN0IHRvIHN0cmFpZ2h0ZW4KICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnCiAgICogQGNoYWluYWJsZQogICAqLwogIGZ4U3RyYWlnaHRlbk9iamVjdDogZnVuY3Rpb24gZnhTdHJhaWdodGVuT2JqZWN0KG9iamVjdCkgewogICAgb2JqZWN0LmZ4U3RyYWlnaHRlbih7CiAgICAgIG9uQ2hhbmdlOiB0aGlzLnJlbmRlckFsbC5iaW5kKHRoaXMpCiAgICB9KTsKICAgIHJldHVybiB0aGlzOwogIH0KfSk7Ci8qKgogKiBAbmFtZXNwYWNlCiAqLwoKZmFicmljLkltYWdlLmZpbHRlcnMgPSB7fTsKLyoqCiAqIEBjbGFzcyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5HcmF5c2NhbGUKICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzCiAqLwoKZmFicmljLkltYWdlLmZpbHRlcnMuR3JheXNjYWxlID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoCi8qKiBAc2NvcGUgZmFicmljLkltYWdlLmZpbHRlcnMuR3JheXNjYWxlLnByb3RvdHlwZSAqLwp7CiAgLyoqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKi8KICB0eXBlOiAiR3JheXNjYWxlIiwKCiAgLyoqCiAgICogQG1ldGhvZCBhcHBseVRvCiAgICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkdyYXlzY2FsZS5wcm90b3R5cGUKICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICBpTGVuID0gaW1hZ2VEYXRhLndpZHRoLAogICAgICAgIGpMZW4gPSBpbWFnZURhdGEuaGVpZ2h0LAogICAgICAgIGluZGV4LAogICAgICAgIGF2ZXJhZ2UsCiAgICAgICAgaSwKICAgICAgICBqOwoKICAgIGZvciAoaSA9IDA7IGkgPCBpTGVuOyBpKyspIHsKICAgICAgZm9yIChqID0gMDsgaiA8IGpMZW47IGorKykgewogICAgICAgIGluZGV4ID0gaSAqIDQgKiBqTGVuICsgaiAqIDQ7CiAgICAgICAgYXZlcmFnZSA9IChkYXRhW2luZGV4XSArIGRhdGFbaW5kZXggKyAxXSArIGRhdGFbaW5kZXggKyAyXSkgLyAzOwogICAgICAgIGRhdGFbaW5kZXhdID0gYXZlcmFnZTsKICAgICAgICBkYXRhW2luZGV4ICsgMV0gPSBhdmVyYWdlOwogICAgICAgIGRhdGFbaW5kZXggKyAyXSA9IGF2ZXJhZ2U7CiAgICAgIH0KICAgIH0KCiAgICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogIH0sCgogIC8qKgogICAqIEBtZXRob2QgdG9KU09OCiAgICogQHJldHVybiB7U3RyaW5nfSBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGZpbHRlcgogICAqLwogIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogdGhpcy50eXBlCiAgICB9OwogIH0KfSk7CgpmYWJyaWMuSW1hZ2UuZmlsdGVycy5HcmF5c2NhbGUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkdyYXlzY2FsZSgpOwp9OwovKioKICogQGNsYXNzIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlCiAqIEBtZW1iZXJPZiBmYWJyaWMuSW1hZ2UuZmlsdGVycwogKi8KCgpmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKAovKiogQHNjb3BlIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlLnByb3RvdHlwZSAqLwp7CiAgLyoqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKi8KICB0eXBlOiAiUmVtb3ZlV2hpdGUiLAoKICAvKioKICAgKiBAbWVtYmVyT2YgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGUucHJvdG90eXBlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqLwogIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHRoaXMudGhyZXNob2xkID0gb3B0aW9ucy50aHJlc2hvbGQgfHwgMzA7CiAgICB0aGlzLmRpc3RhbmNlID0gb3B0aW9ucy5kaXN0YW5jZSB8fCAyMDsKICB9LAoKICAvKioKICAgKiBAbWV0aG9kIGFwcGx5VG8KICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICB0aHJlc2hvbGQgPSB0aGlzLnRocmVzaG9sZCwKICAgICAgICBkaXN0YW5jZSA9IHRoaXMuZGlzdGFuY2UsCiAgICAgICAgbGltaXQgPSAyNTUgLSB0aHJlc2hvbGQsCiAgICAgICAgYWJzID0gTWF0aC5hYnMsCiAgICAgICAgciwKICAgICAgICBnLAogICAgICAgIGI7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDQpIHsKICAgICAgciA9IGRhdGFbaV07CiAgICAgIGcgPSBkYXRhW2kgKyAxXTsKICAgICAgYiA9IGRhdGFbaSArIDJdOwoKICAgICAgaWYgKHIgPiBsaW1pdCAmJiBnID4gbGltaXQgJiYgYiA+IGxpbWl0ICYmIGFicyhyIC0gZykgPCBkaXN0YW5jZSAmJiBhYnMociAtIGIpIDwgZGlzdGFuY2UgJiYgYWJzKGcgLSBiKSA8IGRpc3RhbmNlKSB7CiAgICAgICAgZGF0YVtpICsgM10gPSAxOwogICAgICB9CiAgICB9CgogICAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsKICB9LAoKICAvKioKICAgKiBAbWV0aG9kIHRvSlNPTgogICAqIEByZXR1cm4ge1N0cmluZ30ganNvbiByZXByZXNlbnRhdGlvbiBvZiBmaWx0ZXIKICAgKi8KICB0b0pTT046IGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IHRoaXMudHlwZSwKICAgICAgdGhyZXNob2xkOiB0aGlzLnRocmVzaG9sZCwKICAgICAgZGlzdGFuY2U6IHRoaXMuZGlzdGFuY2UKICAgIH07CiAgfQp9KTsKCmZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZShvYmplY3QpOwp9OwovKioKICogQGNsYXNzIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkludmVydAogKiBAbWVtYmVyT2YgZmFicmljLkltYWdlLmZpbHRlcnMKICovCgoKZmFicmljLkltYWdlLmZpbHRlcnMuSW52ZXJ0ID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoCi8qKiBAc2NvcGUgZmFicmljLkltYWdlLmZpbHRlcnMuSW52ZXJ0LnByb3RvdHlwZSAqLwp7CiAgLyoqCiAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUKICAgKi8KICB0eXBlOiAiSW52ZXJ0IiwKCiAgLyoqCiAgICogQG1ldGhvZCBhcHBseVRvCiAgICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkludmVydC5wcm90b3R5cGUKICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICBpTGVuID0gZGF0YS5sZW5ndGgsCiAgICAgICAgaTsKCiAgICBmb3IgKGkgPSAwOyBpIDwgaUxlbjsgaSArPSA0KSB7CiAgICAgIGRhdGFbaV0gPSAyNTUgLSBkYXRhW2ldOwogICAgICBkYXRhW2kgKyAxXSA9IDI1NSAtIGRhdGFbaSArIDFdOwogICAgICBkYXRhW2kgKyAyXSA9IDI1NSAtIGRhdGFbaSArIDJdOwogICAgfQoKICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCB0b0pTT04KICAgKiBAcmV0dXJuIHtTdHJpbmd9IGpzb24gcmVwcmVzZW50YXRpb24gb2YgZmlsdGVyCiAgICovCiAgdG9KU09OOiBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICByZXR1cm4gewogICAgICB0eXBlOiB0aGlzLnR5cGUKICAgIH07CiAgfQp9KTsKCmZhYnJpYy5JbWFnZS5maWx0ZXJzLkludmVydC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuSW52ZXJ0KCk7Cn07Ci8qKgogKiBAY2xhc3MgZmFicmljLkltYWdlLmZpbHRlcnMuU2VwaWEKICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzCiAqLwoKCmZhYnJpYy5JbWFnZS5maWx0ZXJzLlNlcGlhID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoCi8qKiBAc2NvcGUgZmFicmljLkltYWdlLmZpbHRlcnMuU2VwaWEucHJvdG90eXBlICovCnsKICAvKioKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqLwogIHR5cGU6ICJTZXBpYSIsCgogIC8qKgogICAqIEBtZXRob2QgYXBwbHlUbwogICAqIEBtZW1iZXJPZiBmYWJyaWMuSW1hZ2UuZmlsdGVycy5TZXBpYS5wcm90b3R5cGUKICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICBpTGVuID0gZGF0YS5sZW5ndGgsCiAgICAgICAgaSwKICAgICAgICBhdmc7CgogICAgZm9yIChpID0gMDsgaSA8IGlMZW47IGkgKz0gNCkgewogICAgICBhdmcgPSAwLjMgKiBkYXRhW2ldICsgMC41OSAqIGRhdGFbaSArIDFdICsgMC4xMSAqIGRhdGFbaSArIDJdOwogICAgICBkYXRhW2ldID0gYXZnICsgMTAwOwogICAgICBkYXRhW2kgKyAxXSA9IGF2ZyArIDUwOwogICAgICBkYXRhW2kgKyAyXSA9IGF2ZyArIDI1NTsKICAgIH0KCiAgICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogIH0sCgogIC8qKgogICAqIEBtZXRob2QgdG9KU09OCiAgICogQHJldHVybiB7U3RyaW5nfSBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGZpbHRlcgogICAqLwogIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogdGhpcy50eXBlCiAgICB9OwogIH0KfSk7CgpmYWJyaWMuSW1hZ2UuZmlsdGVycy5TZXBpYS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuU2VwaWEoKTsKfTsKLyoqCiAqIEBjbGFzcyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5TZXBpYTIKICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzCiAqLwoKCmZhYnJpYy5JbWFnZS5maWx0ZXJzLlNlcGlhMiA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKAovKiogQHNjb3BlIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlNlcGlhMi5wcm90b3R5cGUgKi8KewogIC8qKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICovCiAgdHlwZTogIlNlcGlhMiIsCgogIC8qKgogICAqIEBtZXRob2QgYXBwbHlUbwogICAqIEBtZW1iZXJPZiBmYWJyaWMuSW1hZ2UuZmlsdGVycy5TZXBpYS5wcm90b3R5cGUKICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICBpTGVuID0gZGF0YS5sZW5ndGgsCiAgICAgICAgaSwKICAgICAgICByLAogICAgICAgIGcsCiAgICAgICAgYjsKCiAgICBmb3IgKGkgPSAwOyBpIDwgaUxlbjsgaSArPSA0KSB7CiAgICAgIHIgPSBkYXRhW2ldOwogICAgICBnID0gZGF0YVtpICsgMV07CiAgICAgIGIgPSBkYXRhW2kgKyAyXTsKICAgICAgZGF0YVtpXSA9IChyICogMC4zOTMgKyBnICogMC43NjkgKyBiICogMC4xODkpIC8gMS4zNTE7CiAgICAgIGRhdGFbaSArIDFdID0gKHIgKiAwLjM0OSArIGcgKiAwLjY4NiArIGIgKiAwLjE2OCkgLyAxLjIwMzsKICAgICAgZGF0YVtpICsgMl0gPSAociAqIDAuMjcyICsgZyAqIDAuNTM0ICsgYiAqIDAuMTMxKSAvIDIuMTQwOwogICAgfQoKICAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCB0b0pTT04KICAgKiBAcmV0dXJuIHtTdHJpbmd9IGpzb24gcmVwcmVzZW50YXRpb24gb2YgZmlsdGVyCiAgICovCiAgdG9KU09OOiBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICByZXR1cm4gewogICAgICB0eXBlOiB0aGlzLnR5cGUKICAgIH07CiAgfQp9KTsKCmZhYnJpYy5JbWFnZS5maWx0ZXJzLlNlcGlhMi5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuU2VwaWEyKCk7Cn07Ci8qKgogKiBAY2xhc3MgZmFicmljLkltYWdlLmZpbHRlcnMuQnJpZ2h0bmVzcwogKiBAbWVtYmVyT2YgZmFicmljLkltYWdlLmZpbHRlcnMKICovCgoKZmFicmljLkltYWdlLmZpbHRlcnMuQnJpZ2h0bmVzcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKAovKiogQHNjb3BlIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJyaWdodG5lc3MucHJvdG90eXBlICovCnsKICAvKioKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqLwogIHR5cGU6ICJCcmlnaHRuZXNzIiwKCiAgLyoqCiAgICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJyaWdodG5lc3MucHJvdG90eXBlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqLwogIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHRoaXMuYnJpZ2h0bmVzcyA9IG9wdGlvbnMuYnJpZ2h0bmVzcyB8fCAxMDA7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCBhcHBseVRvCiAgICogQHBhcmFtIHtPYmplY3R9IGNhbnZhc0VsIENhbnZhcyBlbGVtZW50IHRvIGFwcGx5IGZpbHRlciB0bwogICAqLwogIGFwcGx5VG86IGZ1bmN0aW9uIGFwcGx5VG8oY2FudmFzRWwpIHsKICAgIHZhciBjb250ZXh0ID0gY2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKSwKICAgICAgICBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNFbC53aWR0aCwgY2FudmFzRWwuaGVpZ2h0KSwKICAgICAgICBkYXRhID0gaW1hZ2VEYXRhLmRhdGEsCiAgICAgICAgYnJpZ2h0bmVzcyA9IHRoaXMuYnJpZ2h0bmVzczsKCiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkgKz0gNCkgewogICAgICBkYXRhW2ldICs9IGJyaWdodG5lc3M7CiAgICAgIGRhdGFbaSArIDFdICs9IGJyaWdodG5lc3M7CiAgICAgIGRhdGFbaSArIDJdICs9IGJyaWdodG5lc3M7CiAgICB9CgogICAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsKICB9LAoKICAvKioKICAgKiBAbWV0aG9kIHRvSlNPTgogICAqIEByZXR1cm4ge1N0cmluZ30ganNvbiByZXByZXNlbnRhdGlvbiBvZiBmaWx0ZXIKICAgKi8KICB0b0pTT046IGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IHRoaXMudHlwZSwKICAgICAgYnJpZ2h0bmVzczogdGhpcy5icmlnaHRuZXNzCiAgICB9OwogIH0KfSk7CgpmYWJyaWMuSW1hZ2UuZmlsdGVycy5CcmlnaHRuZXNzLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5CcmlnaHRuZXNzKG9iamVjdCk7Cn07Ci8qKgogKiBAY2xhc3MgZmFicmljLkltYWdlLmZpbHRlcnMuQnJpZ2h0bmVzcwogKiBAbWVtYmVyT2YgZmFicmljLkltYWdlLmZpbHRlcnMKICovCgoKZmFicmljLkltYWdlLmZpbHRlcnMuTm9pc2UgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcygKLyoqIEBzY29wZSBmYWJyaWMuSW1hZ2UuZmlsdGVycy5Ob2lzZS5wcm90b3R5cGUgKi8KewogIC8qKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICovCiAgdHlwZTogIk5vaXNlIiwKCiAgLyoqCiAgICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJyaWdodG5lc3MucHJvdG90eXBlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqLwogIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHRoaXMubm9pc2UgPSBvcHRpb25zLm5vaXNlIHx8IDEwMDsKICB9LAoKICAvKioKICAgKiBAbWV0aG9kIGFwcGx5VG8KICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICBub2lzZSA9IHRoaXMubm9pc2UsCiAgICAgICAgcmFuZDsKCiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkgKz0gNCkgewogICAgICByYW5kID0gKDAuNSAtIE1hdGgucmFuZG9tKCkpICogbm9pc2U7CiAgICAgIGRhdGFbaV0gKz0gcmFuZDsKICAgICAgZGF0YVtpICsgMV0gKz0gcmFuZDsKICAgICAgZGF0YVtpICsgMl0gKz0gcmFuZDsKICAgIH0KCiAgICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogIH0sCgogIC8qKgogICAqIEBtZXRob2QgdG9KU09OCiAgICogQHJldHVybiB7U3RyaW5nfSBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGZpbHRlcgogICAqLwogIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogdGhpcy50eXBlLAogICAgICBub2lzZTogdGhpcy5ub2lzZQogICAgfTsKICB9Cn0pOwoKZmFicmljLkltYWdlLmZpbHRlcnMuTm9pc2UuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHsKICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLk5vaXNlKG9iamVjdCk7Cn07Ci8qKgogKiBAY2xhc3MgZmFicmljLkltYWdlLmZpbHRlcnMuQnJpZ2h0bmVzcwogKiBAbWVtYmVyT2YgZmFicmljLkltYWdlLmZpbHRlcnMKICovCgoKZmFicmljLkltYWdlLmZpbHRlcnMuR3JhZGllbnRUcmFuc3BhcmVuY3kgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcygKLyoqIEBzY29wZSBmYWJyaWMuSW1hZ2UuZmlsdGVycy5HcmFkaWVudFRyYW5zcGFyZW5jeS5wcm90b3R5cGUgKi8KewogIC8qKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICovCiAgdHlwZTogIkdyYWRpZW50VHJhbnNwYXJlbmN5IiwKCiAgLyoqCiAgICogQG1lbWJlck9mIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkdyYWRpZW50VHJhbnNwYXJlbmN5LnByb3RvdHlwZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3QKICAgKi8KICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB0aGlzLnRocmVzaG9sZCA9IG9wdGlvbnMudGhyZXNob2xkIHx8IDEwMDsKICB9LAoKICAvKioKICAgKiBAbWV0aG9kIGFwcGx5VG8KICAgKiBAcGFyYW0ge09iamVjdH0gY2FudmFzRWwgQ2FudmFzIGVsZW1lbnQgdG8gYXBwbHkgZmlsdGVyIHRvCiAgICovCiAgYXBwbHlUbzogZnVuY3Rpb24gYXBwbHlUbyhjYW52YXNFbCkgewogICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLAogICAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLAogICAgICAgIGRhdGEgPSBpbWFnZURhdGEuZGF0YSwKICAgICAgICB0aHJlc2hvbGQgPSB0aGlzLnRocmVzaG9sZCwKICAgICAgICB0b3RhbCA9IGRhdGEubGVuZ3RoOwoKICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSArPSA0KSB7CiAgICAgIGRhdGFbaSArIDNdID0gdGhyZXNob2xkICsgMjU1ICogKHRvdGFsIC0gaSkgLyB0b3RhbDsKICAgIH0KCiAgICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogIH0sCgogIC8qKgogICAqIEBtZXRob2QgdG9KU09OCiAgICogQHJldHVybiB7U3RyaW5nfSBqc29uIHJlcHJlc2VudGF0aW9uIG9mIGZpbHRlcgogICAqLwogIHRvSlNPTjogZnVuY3Rpb24gdG9KU09OKCkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogdGhpcy50eXBlLAogICAgICB0aHJlc2hvbGQ6IHRoaXMudGhyZXNob2xkCiAgICB9OwogIH0KfSk7CgpmYWJyaWMuSW1hZ2UuZmlsdGVycy5HcmFkaWVudFRyYW5zcGFyZW5jeS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkgewogIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuR3JhZGllbnRUcmFuc3BhcmVuY3kob2JqZWN0KTsKfTsKLyoqCiAqIEBjbGFzcyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5UaW50CiAqIEBtZW1iZXJPZiBmYWJyaWMuSW1hZ2UuZmlsdGVycwogKi8KCgpmYWJyaWMuSW1hZ2UuZmlsdGVycy5UaW50ID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoCi8qKiBAc2NvcGUgZmFicmljLkltYWdlLmZpbHRlcnMuVGludC5wcm90b3R5cGUgKi8KewogIC8qKgogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAgICovCiAgdHlwZTogIlRpbnQiLAoKICAvKioKICAgKiBAbWVtYmVyT2YgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGUucHJvdG90eXBlCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdAogICAqLwogIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHRoaXMuY29sb3IgPSBvcHRpb25zLmNvbG9yIHx8IDA7CiAgfSwKCiAgLyoqCiAgICogQG1ldGhvZCBhcHBseVRvCiAgICogQHBhcmFtIHtPYmplY3R9IGNhbnZhc0VsIENhbnZhcyBlbGVtZW50IHRvIGFwcGx5IGZpbHRlciB0bwogICAqLwogIGFwcGx5VG86IGZ1bmN0aW9uIGFwcGx5VG8oY2FudmFzRWwpIHsKICAgIHZhciBjb250ZXh0ID0gY2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKSwKICAgICAgICBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNFbC53aWR0aCwgY2FudmFzRWwuaGVpZ2h0KSwKICAgICAgICBkYXRhID0gaW1hZ2VEYXRhLmRhdGEsCiAgICAgICAgaUxlbiA9IGRhdGEubGVuZ3RoLAogICAgICAgIGksCiAgICAgICAgciwKICAgICAgICBnLAogICAgICAgIGIsCiAgICAgICAgYTsKICAgIHZhciByZ2IgPSBwYXJzZUludCh0aGlzLmNvbG9yKS50b1N0cmluZygxNik7CiAgICB2YXIgY3IgPSBwYXJzZUludCgnMHgnICsgcmdiLnN1YnN0cigwLCAyKSk7CiAgICB2YXIgY2cgPSBwYXJzZUludCgnMHgnICsgcmdiLnN1YnN0cigyLCAyKSk7CiAgICB2YXIgY2IgPSBwYXJzZUludCgnMHgnICsgcmdiLnN1YnN0cig0LCAyKSk7CgogICAgZm9yIChpID0gMDsgaSA8IGlMZW47IGkgKz0gNCkgewogICAgICBhID0gZGF0YVtpICsgM107CgogICAgICBpZiAoYSA+IDApIHsKICAgICAgICBkYXRhW2ldID0gY3I7CiAgICAgICAgZGF0YVtpICsgMV0gPSBjZzsKICAgICAgICBkYXRhW2kgKyAyXSA9IGNiOwogICAgICB9CiAgICB9CgogICAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsKICB9LAoKICAvKioKICAgKiBAbWV0aG9kIHRvSlNPTgogICAqIEByZXR1cm4ge1N0cmluZ30ganNvbiByZXByZXNlbnRhdGlvbiBvZiBmaWx0ZXIKICAgKi8KICB0b0pTT046IGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IHRoaXMudHlwZSwKICAgICAgY29sb3I6IHRoaXMuY29sb3IKICAgIH07CiAgfQp9KTsKCmZhYnJpYy5JbWFnZS5maWx0ZXJzLlRpbnQuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHsKICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLlRpbnQob2JqZWN0KTsKfTsKCihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgZmFicmljID0gZ2xvYmFsLmZhYnJpYyB8fCAoZ2xvYmFsLmZhYnJpYyA9IHt9KSwKICAgICAgZXh0ZW5kID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCwKICAgICAgY2xvbmUgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUsCiAgICAgIHRvRml4ZWQgPSBmYWJyaWMudXRpbC50b0ZpeGVkOwoKICBpZiAoZmFicmljLlRleHQpIHsKICAgIGZhYnJpYy53YXJuKCdmYWJyaWMuVGV4dCBpcyBhbHJlYWR5IGRlZmluZWQnKTsKICAgIHJldHVybjsKICB9CgogIGlmICghZmFicmljLk9iamVjdCkgewogICAgZmFicmljLndhcm4oJ2ZhYnJpYy5UZXh0IHJlcXVpcmVzIGZhYnJpYy5PYmplY3QnKTsKICAgIHJldHVybjsKICB9CiAgLyoqCiAgICogQGNsYXNzIFRleHQKICAgKiBAZXh0ZW5kcyBmYWJyaWMuT2JqZWN0CiAgICovCgoKICBmYWJyaWMuVGV4dCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3QsCiAgLyoqIEBzY29wZSBmYWJyaWMuVGV4dC5wcm90b3R5cGUgKi8KICB7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIGZvbnRTaXplOiA0MCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgTnVtYmVyCiAgICAgKi8KICAgIGZvbnRXZWlnaHQ6IDEwMCwKCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eQogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKi8KICAgIGZvbnRGYW1pbHk6ICdUaW1lcyBOZXcgUm9tYW4nLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdGV4dERlY29yYXRpb246ICcnLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcgfCBudWxsCiAgICAgKi8KICAgIHRleHRTaGFkb3c6ICcnLAoKICAgIC8qKgogICAgICogRGV0ZXJtaW5lcyB0ZXh0IGFsaWdubWVudC4gUG9zc2libGUgdmFsdWVzOiAibGVmdCIsICJjZW50ZXIiLCBvciAicmlnaHQiLgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgdGV4dEFsaWduOiAnbGVmdCcsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBmb250U3R5bGU6ICcnLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgbGluZUhlaWdodDogMS4zLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqLwogICAgc3Ryb2tlU3R5bGU6ICcnLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBOdW1iZXIKICAgICAqLwogICAgc3Ryb2tlV2lkdGg6IDEsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICBiYWNrZ3JvdW5kQ29sb3I6ICcnLAoKICAgIC8qKgogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBTdHJpbmcgfCBudWxsCiAgICAgKi8KICAgIHBhdGg6IG51bGwsCgogICAgLyoqCiAgICAgKiBAcHJvcGVydHkKICAgICAqIEB0eXBlIFN0cmluZwogICAgICovCiAgICB0eXBlOiAndGV4dCcsCgogICAgLyoqCiAgICAgKiBJbmRpY2F0ZXMgd2hldGhlciBjYW52YXMgbmF0aXZlIHRleHQgbWV0aG9kcyBzaG91bGQgYmUgdXNlZCB0byByZW5kZXIgdGV4dCAob3RoZXJ3aXNlLCBDdWZvbiBpcyB1c2VkKQogICAgICogQHByb3BlcnR5CiAgICAgKiBAdHlwZSBCb29sZWFuCiAgICAgKi8KICAgIHVzZU5hdGl2ZTogdHJ1ZSwKCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yCiAgICAgKiBAbWV0aG9kIGluaXRpYWxpemUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuVGV4dH0gdGhpc0FyZwogICAgICovCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKHRleHQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5faW5pdFN0YXRlUHJvcGVydGllcygpOwoKICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMgfHwge30pOwogICAgICB0aGlzLl90aGV0YSA9IHRoaXMuYW5nbGUgKiBNYXRoLlBJIC8gMTgwOwoKICAgICAgdGhpcy5faW5pdERpbWVuc2lvbnMoKTsKCiAgICAgIHRoaXMuc2V0Q29vcmRzKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVuZGVycyB0ZXh0IG9iamVjdCBvbiBvZmZzY3JlZW4gY2FudmFzLCBzbyB0aGF0IGl0IHdvdWxkIGdldCBkaW1lbnNpb25zCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfaW5pdERpbWVuc2lvbnMKICAgICAqLwogICAgX2luaXREaW1lbnNpb25zOiBmdW5jdGlvbiBfaW5pdERpbWVuc2lvbnMoKSB7CiAgICAgIHZhciBjYW52YXNFbCA9IGZhYnJpYy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKCiAgICAgIGlmICghY2FudmFzRWwuZ2V0Q29udGV4dCAmJiB0eXBlb2YgR192bWxDYW52YXNNYW5hZ2VyICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgR192bWxDYW52YXNNYW5hZ2VyLmluaXRFbGVtZW50KGNhbnZhc0VsKTsKICAgICAgfQoKICAgICAgdGhpcy5fcmVuZGVyKGNhbnZhc0VsLmdldENvbnRleHQoJzJkJykpOwogICAgfSwKCiAgICAvKioKICAgICAqIENyZWF0ZXMgYHN0YXRlUHJvcGVydGllc2AgbGlzdCBvbiBhbiBpbnN0YW5jZSwgYW5kIGFkZHMgYGZhYnJpYy5UZXh0YCAtc3BlY2lmaWMgb25lcyB0byBpdAogICAgICogKHN1Y2ggYXMgImZvbnRGYW1pbHkiLCAiZm9udFdlaWdodCIsIGV0Yy4pCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfaW5pdFN0YXRlUHJvcGVydGllcwogICAgICovCiAgICBfaW5pdFN0YXRlUHJvcGVydGllczogZnVuY3Rpb24gX2luaXRTdGF0ZVByb3BlcnRpZXMoKSB7CiAgICAgIHRoaXMuc3RhdGVQcm9wZXJ0aWVzID0gdGhpcy5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KCk7CiAgICAgIHRoaXMuc3RhdGVQcm9wZXJ0aWVzLnB1c2goJ2ZvbnRGYW1pbHknLCAnZm9udFdlaWdodCcsICdmb250U2l6ZScsICdwYXRoJywgJ3RleHQnLCAndGV4dERlY29yYXRpb24nLCAndGV4dFNoYWRvdycsICd0ZXh0QWxpZ24nLCAnZm9udFN0eWxlJywgJ2xpbmVIZWlnaHQnLCAnc3Ryb2tlU3R5bGUnLCAnc3Ryb2tlV2lkdGgnLCAnYmFja2dyb3VuZENvbG9yJywgJ3VzZU5hdGl2ZScpOwogICAgICBmYWJyaWMudXRpbC5yZW1vdmVGcm9tQXJyYXkodGhpcy5zdGF0ZVByb3BlcnRpZXMsICd3aWR0aCcpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU3RyaW5nCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0ZXh0IG9iamVjdAogICAgICovCiAgICB0b1N0cmluZzogZnVuY3Rpb24gdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiAnIzxmYWJyaWMuVGV4dCAoJyArIHRoaXMuY29tcGxleGl0eSgpICsgJyk6IHsgInRleHQiOiAiJyArIHRoaXMudGV4dCArICciLCAiZm9udEZhbWlseSI6ICInICsgdGhpcy5mb250RmFtaWx5ICsgJyIgfT4nOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXIKICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgX3JlbmRlcjogZnVuY3Rpb24gX3JlbmRlcihjdHgpIHsKICAgICAgaWYgKHR5cGVvZiBDdWZvbiA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy51c2VOYXRpdmUgPT09IHRydWUpIHsKICAgICAgICB0aGlzLl9yZW5kZXJWaWFOYXRpdmUoY3R4KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9yZW5kZXJWaWFDdWZvbihjdHgpOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX3JlbmRlclZpYUN1Zm9uCiAgICAgKi8KICAgIF9yZW5kZXJWaWFDdWZvbjogZnVuY3Rpb24gX3JlbmRlclZpYUN1Zm9uKGN0eCkgewogICAgICB2YXIgbyA9IEN1Zm9uLnRleHRPcHRpb25zIHx8IChDdWZvbi50ZXh0T3B0aW9ucyA9IHt9KTsgLy8gZXhwb3J0IG9wdGlvbnMgdG8gYmUgdXNlZCBieSBjdWZvbi5qcwoKICAgICAgby5sZWZ0ID0gdGhpcy5sZWZ0OwogICAgICBvLnRvcCA9IHRoaXMudG9wOwogICAgICBvLmNvbnRleHQgPSBjdHg7CiAgICAgIG8uY29sb3IgPSB0aGlzLmZpbGw7CgogICAgICB2YXIgZWwgPSB0aGlzLl9pbml0RHVtbXlFbGVtZW50Rm9yQ3Vmb24oKTsgLy8gc2V0ICJjdXJzb3IiIHRvIHRvcC9sZWZ0IGNvcm5lcgoKCiAgICAgIHRoaXMudHJhbnNmb3JtKGN0eCk7IC8vIGRyYXcgdGV4dAoKICAgICAgQ3Vmb24ucmVwbGFjZUVsZW1lbnQoZWwsIHsKICAgICAgICBlbmdpbmU6ICdjYW52YXMnLAogICAgICAgIHNlcGFyYXRlOiAnbm9uZScsCiAgICAgICAgZm9udEZhbWlseTogdGhpcy5mb250RmFtaWx5LAogICAgICAgIGZvbnRXZWlnaHQ6IHRoaXMuZm9udFdlaWdodCwKICAgICAgICB0ZXh0RGVjb3JhdGlvbjogdGhpcy50ZXh0RGVjb3JhdGlvbiwKICAgICAgICB0ZXh0U2hhZG93OiB0aGlzLnRleHRTaGFkb3csCiAgICAgICAgdGV4dEFsaWduOiB0aGlzLnRleHRBbGlnbiwKICAgICAgICBmb250U3R5bGU6IHRoaXMuZm9udFN0eWxlLAogICAgICAgIGxpbmVIZWlnaHQ6IHRoaXMubGluZUhlaWdodCwKICAgICAgICBzdHJva2VTdHlsZTogdGhpcy5zdHJva2VTdHlsZSwKICAgICAgICBzdHJva2VXaWR0aDogdGhpcy5zdHJva2VXaWR0aCwKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yCiAgICAgIH0pOyAvLyB1cGRhdGUgd2lkdGgsIGhlaWdodAoKICAgICAgdGhpcy53aWR0aCA9IG8ud2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gby5oZWlnaHQ7CiAgICAgIHRoaXMuX3RvdGFsTGluZUhlaWdodCA9IG8udG90YWxMaW5lSGVpZ2h0OwogICAgICB0aGlzLl9mb250QXNjZW50ID0gby5mb250QXNjZW50OwogICAgICB0aGlzLl9ib3VuZGFyaWVzID0gby5ib3VuZGFyaWVzOwogICAgICB0aGlzLl9zaGFkb3dPZmZzZXRzID0gby5zaGFkb3dPZmZzZXRzOwogICAgICB0aGlzLl9zaGFkb3dzID0gby5zaGFkb3dzIHx8IFtdOwogICAgICBlbCA9IG51bGw7IC8vIG5lZWQgdG8gc2V0IGNvb3JkcyBfYWZ0ZXJfIHRoZSB3aWR0aC9oZWlnaHQgd2FzIHJldHJlaXZlZCBmcm9tIEN1Zm9uCgogICAgICB0aGlzLnNldENvb3JkcygpOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXJfbmF0aXZlCiAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uCiAgICAgKi8KICAgIF9yZW5kZXJWaWFOYXRpdmU6IGZ1bmN0aW9uIF9yZW5kZXJWaWFOYXRpdmUoY3R4KSB7CiAgICAgIHRoaXMudHJhbnNmb3JtKGN0eCk7CgogICAgICB0aGlzLl9zZXRUZXh0U3R5bGVzKGN0eCk7CgogICAgICB2YXIgdGV4dExpbmVzID0gdGhpcy50ZXh0LnNwbGl0KC9ccj9cbi8pOwogICAgICB0aGlzLndpZHRoID0gdGhpcy5fZ2V0VGV4dFdpZHRoKGN0eCwgdGV4dExpbmVzKTsKICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLl9nZXRUZXh0SGVpZ2h0KGN0eCwgdGV4dExpbmVzKTsKCiAgICAgIHRoaXMuX3JlbmRlclRleHRCYWNrZ3JvdW5kKGN0eCwgdGV4dExpbmVzKTsKCiAgICAgIGlmICh0aGlzLnRleHRBbGlnbiAhPT0gJ2xlZnQnKSB7CiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHgudHJhbnNsYXRlKHRoaXMudGV4dEFsaWduID09PSAnY2VudGVyJyA/IHRoaXMud2lkdGggLyAyIDogdGhpcy53aWR0aCwgMCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3NldFRleHRTaGFkb3coY3R4KTsKCiAgICAgIHRoaXMuX3JlbmRlclRleHRGaWxsKGN0eCwgdGV4dExpbmVzKTsKCiAgICAgIHRoaXMudGV4dFNoYWRvdyAmJiBjdHgucmVzdG9yZSgpOwoKICAgICAgdGhpcy5fcmVuZGVyVGV4dFN0cm9rZShjdHgsIHRleHRMaW5lcyk7CgogICAgICBpZiAodGhpcy50ZXh0QWxpZ24gIT09ICdsZWZ0JykgewogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3JlbmRlclRleHREZWNvcmF0aW9uKGN0eCwgdGV4dExpbmVzKTsKCiAgICAgIHRoaXMuX3NldEJvdW5kYXJpZXMoY3R4LCB0ZXh0TGluZXMpOwoKICAgICAgdGhpcy5fdG90YWxMaW5lSGVpZ2h0ID0gMDsKICAgICAgdGhpcy5zZXRDb29yZHMoKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfc2V0Qm91bmRhcmllcwogICAgICovCiAgICBfc2V0Qm91bmRhcmllczogZnVuY3Rpb24gX3NldEJvdW5kYXJpZXMoY3R4LCB0ZXh0TGluZXMpIHsKICAgICAgdGhpcy5fYm91bmRhcmllcyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRleHRMaW5lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBsaW5lV2lkdGggPSBjdHgubWVhc3VyZVRleHQodGV4dExpbmVzW2ldKS53aWR0aDsKCiAgICAgICAgdmFyIGxpbmVMZWZ0T2Zmc2V0ID0gdGhpcy5fZ2V0TGluZUxlZnRPZmZzZXQobGluZVdpZHRoKTsKCiAgICAgICAgdGhpcy5fYm91bmRhcmllcy5wdXNoKHsKICAgICAgICAgIGhlaWdodDogdGhpcy5mb250U2l6ZSwKICAgICAgICAgIHdpZHRoOiBsaW5lV2lkdGgsCiAgICAgICAgICBsZWZ0OiBsaW5lTGVmdE9mZnNldAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX3NldFRleHRTdHlsZXMKICAgICAqLwogICAgX3NldFRleHRTdHlsZXM6IGZ1bmN0aW9uIF9zZXRUZXh0U3R5bGVzKGN0eCkgewogICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5maWxsOwogICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLnN0cm9rZVN0eWxlOwogICAgICBjdHgubGluZVdpZHRoID0gdGhpcy5zdHJva2VXaWR0aDsKICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICd0b3AnOwogICAgICBjdHgudGV4dEFsaWduID0gdGhpcy50ZXh0QWxpZ247CiAgICAgIGN0eC5mb250ID0gdGhpcy5fZ2V0Rm9udERlY2xhcmF0aW9uKCk7CiAgICB9LAoKICAgIC8qKgogICAgICogQHByaXZhdGUKICAgICAqIEBtZXRob2QgX2dldFRleHRIZWlnaHQKICAgICAqLwogICAgX2dldFRleHRIZWlnaHQ6IGZ1bmN0aW9uIF9nZXRUZXh0SGVpZ2h0KGN0eCwgdGV4dExpbmVzKSB7CiAgICAgIHJldHVybiB0aGlzLmZvbnRTaXplICogdGV4dExpbmVzLmxlbmd0aCAqIHRoaXMubGluZUhlaWdodDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfZ2V0VGV4dFdpZHRoCiAgICAgKi8KICAgIF9nZXRUZXh0V2lkdGg6IGZ1bmN0aW9uIF9nZXRUZXh0V2lkdGgoY3R4LCB0ZXh0TGluZXMpIHsKICAgICAgdmFyIG1heFdpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KHRleHRMaW5lc1swXSkud2lkdGg7CgogICAgICBmb3IgKHZhciBpID0gMSwgbGVuID0gdGV4dExpbmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgdmFyIGN1cnJlbnRMaW5lV2lkdGggPSBjdHgubWVhc3VyZVRleHQodGV4dExpbmVzW2ldKS53aWR0aDsKCiAgICAgICAgaWYgKGN1cnJlbnRMaW5lV2lkdGggPiBtYXhXaWR0aCkgewogICAgICAgICAgbWF4V2lkdGggPSBjdXJyZW50TGluZVdpZHRoOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG1heFdpZHRoOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9zZXRUZXh0U2hhZG93CiAgICAgKi8KICAgIF9zZXRUZXh0U2hhZG93OiBmdW5jdGlvbiBfc2V0VGV4dFNoYWRvdyhjdHgpIHsKICAgICAgaWYgKHRoaXMudGV4dFNoYWRvdykgewogICAgICAgIC8vICJyZ2JhKDAsMCwwLDAuMikgMnB4IDJweCAxMHB4IgogICAgICAgIC8vICJyZ2IoMCwgMTAwLCAwKSAwIDAgNXB4IgogICAgICAgIC8vICJyZWQgMnB4IDJweCAxcHgiCiAgICAgICAgLy8gIiNmNTUgMTIzIDM0NSA1NjciCiAgICAgICAgdmFyIHJlT2Zmc2V0c0FuZEJsdXIgPSAvXHMrKC0/XGQrKSg/OnB4KT9ccysoLT9cZCspKD86cHgpP1xzKyhcZCspKD86cHgpP1xzKi87CiAgICAgICAgdmFyIHNoYWRvd0RlY2xhcmF0aW9uID0gdGhpcy50ZXh0U2hhZG93OwogICAgICAgIHZhciBvZmZzZXRzQW5kQmx1ciA9IHJlT2Zmc2V0c0FuZEJsdXIuZXhlYyh0aGlzLnRleHRTaGFkb3cpOwogICAgICAgIHZhciBzaGFkb3dDb2xvciA9IHNoYWRvd0RlY2xhcmF0aW9uLnJlcGxhY2UocmVPZmZzZXRzQW5kQmx1ciwgJycpOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gc2hhZG93Q29sb3I7CiAgICAgICAgY3R4LnNoYWRvd09mZnNldFggPSBwYXJzZUludChvZmZzZXRzQW5kQmx1clsxXSwgMTApOwogICAgICAgIGN0eC5zaGFkb3dPZmZzZXRZID0gcGFyc2VJbnQob2Zmc2V0c0FuZEJsdXJbMl0sIDEwKTsKICAgICAgICBjdHguc2hhZG93Qmx1ciA9IHBhcnNlSW50KG9mZnNldHNBbmRCbHVyWzNdLCAxMCk7CiAgICAgICAgdGhpcy5fc2hhZG93cyA9IFt7CiAgICAgICAgICBibHVyOiBjdHguc2hhZG93Qmx1ciwKICAgICAgICAgIGNvbG9yOiBjdHguc2hhZG93Q29sb3IsCiAgICAgICAgICBvZmZYOiBjdHguc2hhZG93T2Zmc2V0WCwKICAgICAgICAgIG9mZlk6IGN0eC5zaGFkb3dPZmZzZXRZCiAgICAgICAgfV07CiAgICAgICAgdGhpcy5fc2hhZG93T2Zmc2V0cyA9IFtbcGFyc2VJbnQoY3R4LnNoYWRvd09mZnNldFgsIDEwKSwgcGFyc2VJbnQoY3R4LnNoYWRvd09mZnNldFksIDEwKV1dOwogICAgICB9CiAgICB9LAogICAgX3JlbmRlclRleHRGaWxsOiBmdW5jdGlvbiBfcmVuZGVyVGV4dEZpbGwoY3R4LCB0ZXh0TGluZXMpIHsKICAgICAgdGhpcy5fYm91bmRhcmllcyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRleHRMaW5lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGN0eC5maWxsVGV4dCh0ZXh0TGluZXNbaV0sIC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMiArIGkgKiB0aGlzLmZvbnRTaXplICogdGhpcy5saW5lSGVpZ2h0KTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXJUZXh0U3Ryb2tlCiAgICAgKi8KICAgIF9yZW5kZXJUZXh0U3Ryb2tlOiBmdW5jdGlvbiBfcmVuZGVyVGV4dFN0cm9rZShjdHgsIHRleHRMaW5lcykgewogICAgICBpZiAodGhpcy5zdHJva2VTdHlsZSkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0ZXh0TGluZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGN0eC5zdHJva2VUZXh0KHRleHRMaW5lc1tpXSwgLXRoaXMud2lkdGggLyAyLCAtdGhpcy5oZWlnaHQgLyAyICsgaSAqIHRoaXMuZm9udFNpemUgKiB0aGlzLmxpbmVIZWlnaHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAX3JlbmRlclRleHRCYWNrZ3JvdW5kCiAgICAgKi8KICAgIF9yZW5kZXJUZXh0QmFja2dyb3VuZDogZnVuY3Rpb24gX3JlbmRlclRleHRCYWNrZ3JvdW5kKGN0eCwgdGV4dExpbmVzKSB7CiAgICAgIGlmICh0aGlzLmJhY2tncm91bmRDb2xvcikgewogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuYmFja2dyb3VuZENvbG9yOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGV4dExpbmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB2YXIgbGluZVdpZHRoID0gY3R4Lm1lYXN1cmVUZXh0KHRleHRMaW5lc1tpXSkud2lkdGg7CgogICAgICAgICAgdmFyIGxpbmVMZWZ0T2Zmc2V0ID0gdGhpcy5fZ2V0TGluZUxlZnRPZmZzZXQobGluZVdpZHRoKTsKCiAgICAgICAgICBjdHguZmlsbFJlY3QoLXRoaXMud2lkdGggLyAyICsgbGluZUxlZnRPZmZzZXQsIC10aGlzLmhlaWdodCAvIDIgKyBpICogdGhpcy5mb250U2l6ZSAqIHRoaXMubGluZUhlaWdodCwgbGluZVdpZHRoLCB0aGlzLmZvbnRTaXplKTsKICAgICAgICB9CgogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfZ2V0TGluZUxlZnRPZmZzZXQKICAgICAqLwogICAgX2dldExpbmVMZWZ0T2Zmc2V0OiBmdW5jdGlvbiBfZ2V0TGluZUxlZnRPZmZzZXQobGluZVdpZHRoKSB7CiAgICAgIGlmICh0aGlzLnRleHRBbGlnbiA9PT0gJ2NlbnRlcicpIHsKICAgICAgICByZXR1cm4gKHRoaXMud2lkdGggLSBsaW5lV2lkdGgpIC8gMjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudGV4dEFsaWduID09PSAncmlnaHQnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMud2lkdGggLSBsaW5lV2lkdGg7CiAgICAgIH0KCiAgICAgIHJldHVybiAwOwogICAgfSwKCiAgICAvKioKICAgICAqIEBwcml2YXRlCiAgICAgKiBAbWV0aG9kIF9yZW5kZXJUZXh0RGVjb3JhdGlvbgogICAgICovCiAgICBfcmVuZGVyVGV4dERlY29yYXRpb246IGZ1bmN0aW9uIF9yZW5kZXJUZXh0RGVjb3JhdGlvbihjdHgsIHRleHRMaW5lcykgewogICAgICB2YXIgaGFsZk9mVmVydGljYWxCb3ggPSB0aGlzLl9nZXRUZXh0SGVpZ2h0KGN0eCwgdGV4dExpbmVzKSAvIDI7CgogICAgICBmdW5jdGlvbiByZW5kZXJMaW5lc0F0T2Zmc2V0KG9mZnNldCkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0ZXh0TGluZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIHZhciBsaW5lV2lkdGggPSBjdHgubWVhc3VyZVRleHQodGV4dExpbmVzW2ldKS53aWR0aDsKCiAgICAgICAgICB2YXIgbGluZUxlZnRPZmZzZXQgPSB0aGlzLl9nZXRMaW5lTGVmdE9mZnNldChsaW5lV2lkdGgpOwoKICAgICAgICAgIGN0eC5maWxsUmVjdCgtdGhpcy53aWR0aCAvIDIgKyBsaW5lTGVmdE9mZnNldCwgb2Zmc2V0ICsgaSAqIHRoaXMuZm9udFNpemUgKiB0aGlzLmxpbmVIZWlnaHQgLSBoYWxmT2ZWZXJ0aWNhbEJveCwgbGluZVdpZHRoLCAxKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnRleHREZWNvcmF0aW9uLmluZGV4T2YoJ3VuZGVybGluZScpID4gLTEpIHsKICAgICAgICByZW5kZXJMaW5lc0F0T2Zmc2V0LmNhbGwodGhpcywgdGhpcy5mb250U2l6ZSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnRleHREZWNvcmF0aW9uLmluZGV4T2YoJ2xpbmUtdGhyb3VnaCcpID4gLTEpIHsKICAgICAgICByZW5kZXJMaW5lc0F0T2Zmc2V0LmNhbGwodGhpcywgdGhpcy5mb250U2l6ZSAvIDIpOwogICAgICB9CgogICAgICBpZiAodGhpcy50ZXh0RGVjb3JhdGlvbi5pbmRleE9mKCdvdmVybGluZScpID4gLTEpIHsKICAgICAgICByZW5kZXJMaW5lc0F0T2Zmc2V0LmNhbGwodGhpcywgMCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfZ2V0Rm9udERlY2xhcmF0aW9uCiAgICAgKi8KICAgIF9nZXRGb250RGVjbGFyYXRpb246IGZ1bmN0aW9uIF9nZXRGb250RGVjbGFyYXRpb24oKSB7CiAgICAgIHJldHVybiBbdGhpcy5mb250U3R5bGUsIHRoaXMuZm9udFdlaWdodCwgdGhpcy5mb250U2l6ZSArICdweCcsIGZhYnJpYy5pc0xpa2VseU5vZGUgPyAnIicgKyB0aGlzLmZvbnRGYW1pbHkgKyAnIicgOiB0aGlzLmZvbnRGYW1pbHldLmpvaW4oJyAnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBAcHJpdmF0ZQogICAgICogQG1ldGhvZCBfaW5pdER1bW15RWxlbWVudAogICAgICovCiAgICBfaW5pdER1bW15RWxlbWVudEZvckN1Zm9uOiBmdW5jdGlvbiBfaW5pdER1bW15RWxlbWVudEZvckN1Zm9uKCkgewogICAgICB2YXIgZWwgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJyksCiAgICAgICAgICBjb250YWluZXIgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7IC8vIEN1Zm9uIGRvZXNuJ3QgcGxheSBuaWNlIHdpdGggdGV4dERlY29yYXRpb249dW5kZXJsaW5lIGlmIGVsZW1lbnQgZG9lc24ndCBoYXZlIGEgcGFyZW50CgogICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWwpOwoKICAgICAgaWYgKHR5cGVvZiBHX3ZtbENhbnZhc01hbmFnZXIgPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBlbC5pbm5lckhUTUwgPSB0aGlzLnRleHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSUUgNyAmIDggZHJvcCBuZXdsaW5lcyBhbmQgd2hpdGUgc3BhY2Ugb24gdGV4dCBub2RlcwogICAgICAgIC8vIHNlZTogaHR0cDovL3dlYi5zdHVkZW50LnR1d2llbi5hYy5hdC9+ZTAyMjY0MzAvaW5uZXJIdG1sUXVpcmsuaHRtbAogICAgICAgIC8vIHNlZTogaHR0cDovL3d3dy53M3NjaG9vbHMuY29tL2RvbS9kb21fbW96aWxsYV92c19pZS5hc3AKICAgICAgICBlbC5pbm5lclRleHQgPSB0aGlzLnRleHQucmVwbGFjZSgvXHI/XG4vZ2ksICdccicpOwogICAgICB9CgogICAgICBlbC5zdHlsZS5mb250U2l6ZSA9IHRoaXMuZm9udFNpemUgKyAncHgnOwogICAgICBlbC5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gJ25vcm1hbCc7CiAgICAgIHJldHVybiBlbDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZW5kZXJzIHRleHQgaW5zdGFuY2Ugb24gYSBzcGVjaWZpZWQgY29udGV4dAogICAgICogQG1ldGhvZCByZW5kZXIKICAgICAqIEBwYXJhbSBjdHgge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCB0byByZW5kZXIgb24KICAgICAqLwogICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoY3R4LCBub1RyYW5zZm9ybSkgewogICAgICBjdHguc2F2ZSgpOwoKICAgICAgdGhpcy5fcmVuZGVyKGN0eCk7CgogICAgICBpZiAoIW5vVHJhbnNmb3JtICYmIHRoaXMuYWN0aXZlKSB7CiAgICAgICAgdGhpcy5kcmF3Qm9yZGVycyhjdHgpOwogICAgICAgIHRoaXMuaGlkZUNvcm5lcnMgfHwgdGhpcy5kcmF3Q29ybmVycyhjdHgpOwogICAgICB9CgogICAgICBjdHgucmVzdG9yZSgpOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvT2JqZWN0CiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IE9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0ZXh0IG9iamVjdAogICAgICovCiAgICB0b09iamVjdDogZnVuY3Rpb24gdG9PYmplY3QoKSB7CiAgICAgIHJldHVybiBleHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHsKICAgICAgICB0ZXh0OiB0aGlzLnRleHQsCiAgICAgICAgZm9udFNpemU6IHRoaXMuZm9udFNpemUsCiAgICAgICAgZm9udFdlaWdodDogdGhpcy5mb250V2VpZ2h0LAogICAgICAgIGZvbnRGYW1pbHk6IHRoaXMuZm9udEZhbWlseSwKICAgICAgICBmb250U3R5bGU6IHRoaXMuZm9udFN0eWxlLAogICAgICAgIGxpbmVIZWlnaHQ6IHRoaXMubGluZUhlaWdodCwKICAgICAgICB0ZXh0RGVjb3JhdGlvbjogdGhpcy50ZXh0RGVjb3JhdGlvbiwKICAgICAgICB0ZXh0U2hhZG93OiB0aGlzLnRleHRTaGFkb3csCiAgICAgICAgdGV4dEFsaWduOiB0aGlzLnRleHRBbGlnbiwKICAgICAgICBwYXRoOiB0aGlzLnBhdGgsCiAgICAgICAgc3Ryb2tlU3R5bGU6IHRoaXMuc3Ryb2tlU3R5bGUsCiAgICAgICAgc3Ryb2tlV2lkdGg6IHRoaXMuc3Ryb2tlV2lkdGgsCiAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGlzLmJhY2tncm91bmRDb2xvciwKICAgICAgICB1c2VOYXRpdmU6IHRoaXMudXNlTmF0aXZlCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgc3ZnIHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlCiAgICAgKiBAbWV0aG9kIHRvU1ZHCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHN2ZyByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZQogICAgICovCiAgICB0b1NWRzogZnVuY3Rpb24gdG9TVkcoKSB7CiAgICAgIHZhciB0ZXh0TGluZXMgPSB0aGlzLnRleHQuc3BsaXQoL1xyP1xuLyksCiAgICAgICAgICBsaW5lVG9wT2Zmc2V0ID0gdGhpcy51c2VOYXRpdmUgPyB0aGlzLmZvbnRTaXplICogdGhpcy5saW5lSGVpZ2h0IDogLXRoaXMuX2ZvbnRBc2NlbnQgLSB0aGlzLl9mb250QXNjZW50IC8gNSAqIHRoaXMubGluZUhlaWdodCwKICAgICAgICAgIHRleHRMZWZ0T2Zmc2V0ID0gLSh0aGlzLndpZHRoIC8gMiksCiAgICAgICAgICB0ZXh0VG9wT2Zmc2V0ID0gdGhpcy51c2VOYXRpdmUgPyB0aGlzLmZvbnRTaXplIC0gMSA6IHRoaXMuaGVpZ2h0IC8gMiAtIHRleHRMaW5lcy5sZW5ndGggKiB0aGlzLmZvbnRTaXplIC0gdGhpcy5fdG90YWxMaW5lSGVpZ2h0LAogICAgICAgICAgdGV4dEFuZEJnID0gdGhpcy5fZ2V0U1ZHVGV4dEFuZEJnKGxpbmVUb3BPZmZzZXQsIHRleHRMZWZ0T2Zmc2V0LCB0ZXh0TGluZXMpLAogICAgICAgICAgc2hhZG93U3BhbnMgPSB0aGlzLl9nZXRTVkdTaGFkb3dzKGxpbmVUb3BPZmZzZXQsIHRleHRMaW5lcyk7IC8vIG1vdmUgdG9wIG9mZnNldCBieSBhbiBhc2NlbnQKCgogICAgICB0ZXh0VG9wT2Zmc2V0ICs9IHRoaXMuX2ZvbnRBc2NlbnQgPyB0aGlzLl9mb250QXNjZW50IC8gNSAqIHRoaXMubGluZUhlaWdodCA6IDA7CiAgICAgIHJldHVybiBbJzxnIHRyYW5zZm9ybT0iJywgdGhpcy5nZXRTdmdUcmFuc2Zvcm0oKSwgJyI+JywgdGV4dEFuZEJnLnRleHRCZ1JlY3RzLmpvaW4oJycpLCAnPHRleHQgJywgdGhpcy5mb250RmFtaWx5ID8gJ2ZvbnQtZmFtaWx5PSJcJycgKyB0aGlzLmZvbnRGYW1pbHkgKyAnXCciICcgOiAnJywgdGhpcy5mb250U2l6ZSA/ICdmb250LXNpemU9IicgKyB0aGlzLmZvbnRTaXplICsgJyIgJyA6ICcnLCB0aGlzLmZvbnRTdHlsZSA/ICdmb250LXN0eWxlPSInICsgdGhpcy5mb250U3R5bGUgKyAnIiAnIDogJycsIHRoaXMuZm9udFdlaWdodCA/ICdmb250LXdlaWdodD0iJyArIHRoaXMuZm9udFdlaWdodCArICciICcgOiAnJywgdGhpcy50ZXh0RGVjb3JhdGlvbiA/ICd0ZXh0LWRlY29yYXRpb249IicgKyB0aGlzLnRleHREZWNvcmF0aW9uICsgJyIgJyA6ICcnLCAnc3R5bGU9IicsIHRoaXMuZ2V0U3ZnU3R5bGVzKCksICciICcsCiAgICAgIC8qIHN2ZyBzdGFydHMgZnJvbSBsZWZ0L2JvdHRvbSBjb3JuZXIgc28gd2Ugbm9ybWFsaXplIGhlaWdodCAqLwogICAgICAndHJhbnNmb3JtPSJ0cmFuc2xhdGUoJywgdG9GaXhlZCh0ZXh0TGVmdE9mZnNldCwgMiksICcgJywgdG9GaXhlZCh0ZXh0VG9wT2Zmc2V0LCAyKSwgJykiPicsIHNoYWRvd1NwYW5zLmpvaW4oJycpLCB0ZXh0QW5kQmcudGV4dFNwYW5zLmpvaW4oJycpLCAnPC90ZXh0PicsICc8L2c+J10uam9pbignJyk7CiAgICB9LAogICAgX2dldFNWR1NoYWRvd3M6IGZ1bmN0aW9uIF9nZXRTVkdTaGFkb3dzKGxpbmVUb3BPZmZzZXQsIHRleHRMaW5lcykgewogICAgICB2YXIgc2hhZG93U3BhbnMgPSBbXSwKICAgICAgICAgIGosCiAgICAgICAgICBpLAogICAgICAgICAgamxlbiwKICAgICAgICAgIGlsZW4sCiAgICAgICAgICBsaW5lVG9wT2Zmc2V0TXVsdGlwbGllciA9IDE7CgogICAgICBpZiAoIXRoaXMuX3NoYWRvd3MgfHwgIXRoaXMuX2JvdW5kYXJpZXMpIHsKICAgICAgICByZXR1cm4gc2hhZG93U3BhbnM7CiAgICAgIH0KCiAgICAgIGZvciAoaiA9IDAsIGpsZW4gPSB0aGlzLl9zaGFkb3dzLmxlbmd0aDsgaiA8IGpsZW47IGorKykgewogICAgICAgIGZvciAoaSA9IDAsIGlsZW4gPSB0ZXh0TGluZXMubGVuZ3RoOyBpIDwgaWxlbjsgaSsrKSB7CiAgICAgICAgICBpZiAodGV4dExpbmVzW2ldICE9PSAnJykgewogICAgICAgICAgICB2YXIgbGluZUxlZnRPZmZzZXQgPSB0aGlzLl9ib3VuZGFyaWVzICYmIHRoaXMuX2JvdW5kYXJpZXNbaV0gPyB0aGlzLl9ib3VuZGFyaWVzW2ldLmxlZnQgOiAwOwogICAgICAgICAgICBzaGFkb3dTcGFucy5wdXNoKCc8dHNwYW4geD0iJywgdG9GaXhlZChsaW5lTGVmdE9mZnNldCArIGxpbmVUb3BPZmZzZXRNdWx0aXBsaWVyICsgdGhpcy5fc2hhZG93T2Zmc2V0c1tqXVswXSwgMiksIGkgPT09IDAgfHwgdGhpcy51c2VOYXRpdmUgPyAnIiB5JyA6ICciIGR5JywgJz0iJywgdG9GaXhlZCh0aGlzLnVzZU5hdGl2ZSA/IGxpbmVUb3BPZmZzZXQgKiBpIC0gdGhpcy5oZWlnaHQgLyAyICsgdGhpcy5fc2hhZG93T2Zmc2V0c1tqXVsxXSA6IGxpbmVUb3BPZmZzZXQgKyAoaSA9PT0gMCA/IHRoaXMuX3NoYWRvd09mZnNldHNbal1bMV0gOiAwKSwgMiksICciICcsIHRoaXMuX2dldEZpbGxBdHRyaWJ1dGVzKHRoaXMuX3NoYWRvd3Nbal0uY29sb3IpLCAnPicsIGZhYnJpYy51dGlsLnN0cmluZy5lc2NhcGVYbWwodGV4dExpbmVzW2ldKSwgJzwvdHNwYW4+Jyk7CiAgICAgICAgICAgIGxpbmVUb3BPZmZzZXRNdWx0aXBsaWVyID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGluIHNvbWUgZW52aXJvbm1lbnRzIChlLmcuIElFIDcgJiA4KSBlbXB0eSB0c3BhbnMgYXJlIGNvbXBsZXRlbHkgaWdub3JlZCwgdXNpbmcgYSBsaW5lVG9wT2Zmc2V0TXVsdGlwbGllcgogICAgICAgICAgICAvLyBwcmV2ZW50cyBlbXB0eSB0c3BhbnMKICAgICAgICAgICAgbGluZVRvcE9mZnNldE11bHRpcGxpZXIrKzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaGFkb3dTcGFuczsKICAgIH0sCiAgICBfZ2V0U1ZHVGV4dEFuZEJnOiBmdW5jdGlvbiBfZ2V0U1ZHVGV4dEFuZEJnKGxpbmVUb3BPZmZzZXQsIHRleHRMZWZ0T2Zmc2V0LCB0ZXh0TGluZXMpIHsKICAgICAgdmFyIHRleHRTcGFucyA9IFtdLAogICAgICAgICAgdGV4dEJnUmVjdHMgPSBbXSwKICAgICAgICAgIGksCiAgICAgICAgICBsaW5lTGVmdE9mZnNldCwKICAgICAgICAgIGxlbiwKICAgICAgICAgIGxpbmVUb3BPZmZzZXRNdWx0aXBsaWVyID0gMTsgLy8gdGV4dCBhbmQgYmFja2dyb3VuZAoKICAgICAgZm9yIChpID0gMCwgbGVuID0gdGV4dExpbmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgaWYgKHRleHRMaW5lc1tpXSAhPT0gJycpIHsKICAgICAgICAgIGxpbmVMZWZ0T2Zmc2V0ID0gdGhpcy5fYm91bmRhcmllcyAmJiB0aGlzLl9ib3VuZGFyaWVzW2ldID8gdG9GaXhlZCh0aGlzLl9ib3VuZGFyaWVzW2ldLmxlZnQsIDIpIDogMDsKICAgICAgICAgIHRleHRTcGFucy5wdXNoKCc8dHNwYW4geD0iJywgbGluZUxlZnRPZmZzZXQsICciICcsIGkgPT09IDAgfHwgdGhpcy51c2VOYXRpdmUgPyAneScgOiAnZHknLCAnPSInLCB0b0ZpeGVkKHRoaXMudXNlTmF0aXZlID8gbGluZVRvcE9mZnNldCAqIGkgLSB0aGlzLmhlaWdodCAvIDIgOiBsaW5lVG9wT2Zmc2V0ICogbGluZVRvcE9mZnNldE11bHRpcGxpZXIsIDIpLCAnIiAnLCAvLyBkb2luZyB0aGlzIG9uIDx0c3Bhbj4gZWxlbWVudHMgc2luY2Ugc2V0dGluZyBvcGFjaXR5IG9uIGNvbnRhaW5pbmcgPHRleHQ+IG9uZSBkb2Vzbid0IHdvcmsgaW4gSWxsdXN0cmF0b3IKICAgICAgICAgIHRoaXMuX2dldEZpbGxBdHRyaWJ1dGVzKHRoaXMuZmlsbCksICc+JywgZmFicmljLnV0aWwuc3RyaW5nLmVzY2FwZVhtbCh0ZXh0TGluZXNbaV0pLCAnPC90c3Bhbj4nKTsKICAgICAgICAgIGxpbmVUb3BPZmZzZXRNdWx0aXBsaWVyID0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gaW4gc29tZSBlbnZpcm9ubWVudHMgKGUuZy4gSUUgNyAmIDgpIGVtcHR5IHRzcGFucyBhcmUgY29tcGxldGVseSBpZ25vcmVkLCB1c2luZyBhIGxpbmVUb3BPZmZzZXRNdWx0aXBsaWVyCiAgICAgICAgICAvLyBwcmV2ZW50cyBlbXB0eSB0c3BhbnMKICAgICAgICAgIGxpbmVUb3BPZmZzZXRNdWx0aXBsaWVyKys7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRoaXMuYmFja2dyb3VuZENvbG9yIHx8ICF0aGlzLl9ib3VuZGFyaWVzKSBjb250aW51ZTsKICAgICAgICB0ZXh0QmdSZWN0cy5wdXNoKCc8cmVjdCAnLCB0aGlzLl9nZXRGaWxsQXR0cmlidXRlcyh0aGlzLmJhY2tncm91bmRDb2xvciksICcgeD0iJywgdG9GaXhlZCh0ZXh0TGVmdE9mZnNldCArIHRoaXMuX2JvdW5kYXJpZXNbaV0ubGVmdCwgMiksICciIHk9IicsCiAgICAgICAgLyogYW4gb2Zmc2V0IHRoYXQgc2VlbXMgdG8gc3RyYWlnaHRlbiB0aGluZ3Mgb3V0ICovCiAgICAgICAgdG9GaXhlZChsaW5lVG9wT2Zmc2V0ICogaSAtIHRoaXMuaGVpZ2h0IC8gMiwgMiksICciIHdpZHRoPSInLCB0b0ZpeGVkKHRoaXMuX2JvdW5kYXJpZXNbaV0ud2lkdGgsIDIpLCAnIiBoZWlnaHQ9IicsIHRvRml4ZWQodGhpcy5fYm91bmRhcmllc1tpXS5oZWlnaHQsIDIpLCAnIj48L3JlY3Q+Jyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgdGV4dFNwYW5zOiB0ZXh0U3BhbnMsCiAgICAgICAgdGV4dEJnUmVjdHM6IHRleHRCZ1JlY3RzCiAgICAgIH07CiAgICB9LAogICAgLy8gQWRvYmUgSWxsdXN0cmF0b3IgKGF0IGxlYXN0IENTNSkgaXMgdW5hYmxlIHRvIHJlbmRlciByZ2JhKCktYmFzZWQgZmlsbCB2YWx1ZXMKICAgIC8vIHdlIHdvcmsgYXJvdW5kIGl0IGJ5ICJtb3ZpbmciIGFscGhhIGNoYW5uZWwgaW50byBvcGFjaXR5IGF0dHJpYnV0ZSBhbmQgc2V0dGluZyBmaWxsJ3MgYWxwaGEgdG8gMQogICAgX2dldEZpbGxBdHRyaWJ1dGVzOiBmdW5jdGlvbiBfZ2V0RmlsbEF0dHJpYnV0ZXModmFsdWUpIHsKICAgICAgdmFyIGZpbGxDb2xvciA9IHZhbHVlID8gbmV3IGZhYnJpYy5Db2xvcih2YWx1ZSkgOiAnJzsKCiAgICAgIGlmICghZmlsbENvbG9yIHx8ICFmaWxsQ29sb3IuZ2V0U291cmNlKCkgfHwgZmlsbENvbG9yLmdldEFscGhhKCkgPT09IDEpIHsKICAgICAgICByZXR1cm4gJ2ZpbGw9IicgKyB2YWx1ZSArICciJzsKICAgICAgfQoKICAgICAgcmV0dXJuICdvcGFjaXR5PSInICsgZmlsbENvbG9yLmdldEFscGhhKCkgKyAnIiBmaWxsPSInICsgZmlsbENvbG9yLnNldEFscGhhKDEpLnRvUmdiKCkgKyAnIic7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyAiY29sb3IiIG9mIGFuIGluc3RhbmNlIChhbGlhcyBvZiBgc2V0KCdmaWxsJywgJmhlbGxpcDspYCkKICAgICAqIEBtZXRob2Qgc2V0Q29sb3IKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZQogICAgICogQHJldHVybiB7ZmFicmljLlRleHR9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2V0Q29sb3I6IGZ1bmN0aW9uIHNldENvbG9yKHZhbHVlKSB7CiAgICAgIHRoaXMuc2V0KCdmaWxsJywgdmFsdWUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIGZvbnRTaXplIG9mIGFuIGluc3RhbmNlIGFuZCB1cGRhdGVzIGl0cyBjb29yZGluYXRlcwogICAgICogQG1ldGhvZCBzZXRGb250c2l6ZQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlCiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuVGV4dH0gdGhpc0FyZwogICAgICogQGNoYWluYWJsZQogICAgICovCiAgICBzZXRGb250c2l6ZTogZnVuY3Rpb24gc2V0Rm9udHNpemUodmFsdWUpIHsKICAgICAgdGhpcy5zZXQoJ2ZvbnRTaXplJywgdmFsdWUpOwoKICAgICAgdGhpcy5faW5pdERpbWVuc2lvbnMoKTsKCiAgICAgIHRoaXMuc2V0Q29vcmRzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKioKICAgICAqIFJldHVybnMgYWN0dWFsIHRleHQgdmFsdWUgb2YgYW4gaW5zdGFuY2UKICAgICAqIEBtZXRob2QgZ2V0VGV4dAogICAgICogQHJldHVybiB7U3RyaW5nfQogICAgICovCiAgICBnZXRUZXh0OiBmdW5jdGlvbiBnZXRUZXh0KCkgewogICAgICByZXR1cm4gdGhpcy50ZXh0OwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgdGV4dCBvZiBhbiBpbnN0YW5jZSwgYW5kIHVwZGF0ZXMgaXRzIGNvb3JkaW5hdGVzCiAgICAgKiBAbWV0aG9kIHNldFRleHQKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZQogICAgICogQHJldHVybiB7ZmFicmljLlRleHR9IHRoaXNBcmcKICAgICAqIEBjaGFpbmFibGUKICAgICAqLwogICAgc2V0VGV4dDogZnVuY3Rpb24gc2V0VGV4dCh2YWx1ZSkgewogICAgICB0aGlzLnNldCgndGV4dCcsIHZhbHVlKTsKCiAgICAgIHRoaXMuX2luaXREaW1lbnNpb25zKCk7CgogICAgICB0aGlzLnNldENvb3JkcygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBTZXRzIHNwZWNpZmllZCBwcm9wZXJ0eSB0byBhIHNwZWNpZmllZCB2YWx1ZQogICAgICogQG1ldGhvZCBzZXQKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lCiAgICAgKiBAcGFyYW0ge0FueX0gdmFsdWUKICAgICAqIEByZXR1cm4ge2ZhYnJpYy5UZXh0fSB0aGlzQXJnCiAgICAgKiBAY2hhaW5hYmxlCiAgICAgKi8KICAgIF9zZXQ6IGZ1bmN0aW9uIF9zZXQobmFtZSwgdmFsdWUpIHsKICAgICAgaWYgKG5hbWUgPT09ICdmb250RmFtaWx5JyAmJiB0aGlzLnBhdGgpIHsKICAgICAgICB0aGlzLnBhdGggPSB0aGlzLnBhdGgucmVwbGFjZSgvKC4qPykoW15cL10qKShcLmZvbnRcLmpzKS8sICckMScgKyB2YWx1ZSArICckMycpOwogICAgICB9CgogICAgICB0aGlzLmNhbGxTdXBlcignX3NldCcsIG5hbWUsIHZhbHVlKTsKICAgIH0KICB9KTsKICAvKioKICAgKiBMaXN0IG9mIGF0dHJpYnV0ZSBuYW1lcyB0byBhY2NvdW50IGZvciB3aGVuIHBhcnNpbmcgU1ZHIGVsZW1lbnQgKHVzZWQgYnkgYGZhYnJpYy5UZXh0LmZyb21FbGVtZW50YCkKICAgKiBAc3RhdGljCiAgICovCgogIGZhYnJpYy5UZXh0LkFUVFJJQlVURV9OQU1FUyA9ICgneCB5IGZpbGwgZmlsbC1vcGFjaXR5IG9wYWNpdHkgc3Ryb2tlIHN0cm9rZS13aWR0aCB0cmFuc2Zvcm0gJyArICdmb250LWZhbWlseSBmb250LXN0eWxlIGZvbnQtd2VpZ2h0IGZvbnQtc2l6ZSB0ZXh0LWRlY29yYXRpb24nKS5zcGxpdCgnICcpOwogIC8qKgogICAqIFJldHVybnMgZmFicmljLlRleHQgaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb24KICAgKiBAc3RhdGljCiAgICogQG1ldGhvZCBmcm9tT2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbQogICAqIEByZXR1cm4ge2ZhYnJpYy5UZXh0fSBhbiBpbnN0YW5jZQogICAqLwoKICBmYWJyaWMuVGV4dC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgcmV0dXJuIG5ldyBmYWJyaWMuVGV4dChvYmplY3QudGV4dCwgY2xvbmUob2JqZWN0KSk7CiAgfTsKICAvKioKICAgKiBSZXR1cm5zIGZhYnJpYy5UZXh0IGluc3RhbmNlIGZyb20gYW4gU1ZHIGVsZW1lbnQgKDxiPm5vdCB5ZXQgaW1wbGVtZW50ZWQ8L2I+KQogICAqIEBzdGF0aWMKICAgKiBAbWV0aG9kIGZhYnJpYy5UZXh0LmZyb21FbGVtZW50CiAgICogQHBhcmFtIGVsZW1lbnQKICAgKiBAcGFyYW0gb3B0aW9ucwogICAqIEByZXR1cm4ge2ZhYnJpYy5UZXh0fSBhbiBpbnN0YW5jZQogICAqLwoKCiAgZmFicmljLlRleHQuZnJvbUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykgewogICAgaWYgKCFlbGVtZW50KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHZhciBwYXJzZWRBdHRyaWJ1dGVzID0gZmFicmljLnBhcnNlQXR0cmlidXRlcyhlbGVtZW50LCBmYWJyaWMuVGV4dC5BVFRSSUJVVEVfTkFNRVMpOwogICAgdmFyIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9wdGlvbnMgPyBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUob3B0aW9ucykgOiB7fSwgcGFyc2VkQXR0cmlidXRlcyk7CiAgICB2YXIgdGV4dCA9IG5ldyBmYWJyaWMuVGV4dChlbGVtZW50LnRleHRDb250ZW50LCBvcHRpb25zKTsKICAgIHJldHVybiB0ZXh0OwogIH07Cn0pKHR5cGVvZiBleHBvcnRzICE9ICd1bmRlZmluZWQnID8gZXhwb3J0cyA6IHRoaXMpOwoKKGZ1bmN0aW9uICgpIHsKICBpZiAodHlwZW9mIGRvY3VtZW50ICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBET01QYXJzZXIgPSBuZXcgcmVxdWlyZSgneG1sZG9tJykuRE9NUGFyc2VyLAogICAgICBVUkwgPSByZXF1aXJlKCd1cmwnKSwKICAgICAgSFRUUCA9IHJlcXVpcmUoJ2h0dHAnKSwKICAgICAgQ2FudmFzID0gcmVxdWlyZSgnY2FudmFzJyksCiAgICAgIEltYWdlID0gcmVxdWlyZSgnY2FudmFzJykuSW1hZ2U7CgogIGZ1bmN0aW9uIHJlcXVlc3QodXJsLCBlbmNvZGluZywgY2FsbGJhY2spIHsKICAgIHZhciBvVVJMID0gVVJMLnBhcnNlKHVybCksCiAgICAgICAgY2xpZW50ID0gSFRUUC5jcmVhdGVDbGllbnQob1VSTC5wb3J0LCBvVVJMLmhvc3RuYW1lKSwKICAgICAgICByZXF1ZXN0ID0gY2xpZW50LnJlcXVlc3QoJ0dFVCcsIG9VUkwucGF0aG5hbWUsIHsKICAgICAgJ2hvc3QnOiBvVVJMLmhvc3RuYW1lCiAgICB9KTsKICAgIGNsaWVudC5hZGRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgIGlmIChlcnIuZXJybm8gPT09IHByb2Nlc3MuRUNPTk5SRUZVU0VEKSB7CiAgICAgICAgZmFicmljLmxvZygnRUNPTk5SRUZVU0VEOiBjb25uZWN0aW9uIHJlZnVzZWQgdG8gJyArIGNsaWVudC5ob3N0ICsgJzonICsgY2xpZW50LnBvcnQpOwogICAgICB9IGVsc2UgewogICAgICAgIGZhYnJpYy5sb2coZXJyLm1lc3NhZ2UpOwogICAgICB9CiAgICB9KTsKICAgIHJlcXVlc3QuZW5kKCk7CiAgICByZXF1ZXN0Lm9uKCdyZXNwb25zZScsIGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICB2YXIgYm9keSA9ICIiOwoKICAgICAgaWYgKGVuY29kaW5nKSB7CiAgICAgICAgcmVzcG9uc2Uuc2V0RW5jb2RpbmcoZW5jb2RpbmcpOwogICAgICB9CgogICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24gKCkgewogICAgICAgIGNhbGxiYWNrKGJvZHkpOwogICAgICB9KTsKICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHsKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PSAyMDApIHsKICAgICAgICAgIGJvZHkgKz0gY2h1bms7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0KCiAgZmFicmljLnV0aWwubG9hZEltYWdlID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2spIHsKICAgIHJlcXVlc3QodXJsLCAnYmluYXJ5JywgZnVuY3Rpb24gKGJvZHkpIHsKICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOwogICAgICBpbWcuc3JjID0gbmV3IEJ1ZmZlcihib2R5LCAnYmluYXJ5Jyk7IC8vIHByZXNlcnZpbmcgb3JpZ2luYWwgdXJsLCB3aGljaCBzZWVtcyB0byBiZSBsb3N0IGluIG5vZGUtY2FudmFzCgogICAgICBpbWcuX3NyYyA9IHVybDsKICAgICAgY2FsbGJhY2soaW1nKTsKICAgIH0pOwogIH07CgogIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTCA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7CiAgICB1cmwgPSB1cmwucmVwbGFjZSgvXlxuXHMqLywgJycpLnJlcGxhY2UoL1w/LiokLywgJycpLnRyaW0oKTsKICAgIHJlcXVlc3QodXJsLCAnJywgZnVuY3Rpb24gKGJvZHkpIHsKICAgICAgZmFicmljLmxvYWRTVkdGcm9tU3RyaW5nKGJvZHksIGNhbGxiYWNrKTsKICAgIH0pOwogIH07CgogIGZhYnJpYy5sb2FkU1ZHRnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzdHJpbmcsIGNhbGxiYWNrKSB7CiAgICB2YXIgZG9jID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhzdHJpbmcpOwogICAgZmFicmljLnBhcnNlU1ZHRG9jdW1lbnQoZG9jLmRvY3VtZW50RWxlbWVudCwgZnVuY3Rpb24gKHJlc3VsdHMsIG9wdGlvbnMpIHsKICAgICAgY2FsbGJhY2socmVzdWx0cywgb3B0aW9ucyk7CiAgICB9KTsKICB9OwoKICBmYWJyaWMudXRpbC5nZXRTY3JpcHQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykgewogICAgcmVxdWVzdCh1cmwsICcnLCBmdW5jdGlvbiAoYm9keSkgewogICAgICBldmFsKGJvZHkpOwogICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpOwogICAgfSk7CiAgfTsKCiAgZmFicmljLkltYWdlLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykgewogICAgZmFicmljLnV0aWwubG9hZEltYWdlKG9iamVjdC5zcmMsIGZ1bmN0aW9uIChpbWcpIHsKICAgICAgdmFyIG9JbWcgPSBuZXcgZmFicmljLkltYWdlKGltZyk7CgogICAgICBvSW1nLl9pbml0Q29uZmlnKG9iamVjdCk7CgogICAgICBvSW1nLl9pbml0RmlsdGVycyhvYmplY3QpOwoKICAgICAgY2FsbGJhY2sob0ltZyk7CiAgICB9KTsKICB9OwogIC8qKgogICAqIE9ubHkgYXZhaWxhYmxlIHdoZW4gcnVubmluZyBmYWJyaWMgb24gbm9kZS5qcwogICAqIEBtZXRob2QgY3JlYXRlQ2FudmFzRm9yTm9kZQogICAqIEBwYXJhbSB3aWR0aCBDYW52YXMgd2lkdGgKICAgKiBAcGFyYW0gaGVpZ2h0IENhbnZhcyBoZWlnaHQKICAgKiBAcmV0dXJuIHtPYmplY3R9IHdyYXBwZWQgY2FudmFzIGluc3RhbmNlCiAgICovCgoKICBmYWJyaWMuY3JlYXRlQ2FudmFzRm9yTm9kZSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7CiAgICB2YXIgY2FudmFzRWwgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyksCiAgICAgICAgbm9kZUNhbnZhcyA9IG5ldyBDYW52YXMod2lkdGggfHwgNjAwLCBoZWlnaHQgfHwgNjAwKTsgLy8ganNkb20gZG9lc24ndCBjcmVhdGUgc3R5bGUgb24gY2FudmFzIGVsZW1lbnQsIHNvIGhlcmUgYmUgdGVtcC4gd29ya2Fyb3VuZAoKICAgIGNhbnZhc0VsLnN0eWxlID0ge307CiAgICBjYW52YXNFbC53aWR0aCA9IG5vZGVDYW52YXMud2lkdGg7CiAgICBjYW52YXNFbC5oZWlnaHQgPSBub2RlQ2FudmFzLmhlaWdodDsKICAgIHZhciBjYW52YXMgPSBmYWJyaWMuQ2FudmFzIHx8IGZhYnJpYy5TdGF0aWNDYW52YXM7CiAgICB2YXIgZmFicmljQ2FudmFzID0gbmV3IGNhbnZhcyhjYW52YXNFbCk7CiAgICBmYWJyaWNDYW52YXMuY29udGV4dENvbnRhaW5lciA9IG5vZGVDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgIGZhYnJpY0NhbnZhcy5ub2RlQ2FudmFzID0gbm9kZUNhbnZhczsKICAgIHJldHVybiBmYWJyaWNDYW52YXM7CiAgfTsKCiAgZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUuY3JlYXRlUE5HU3RyZWFtID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMubm9kZUNhbnZhcy5jcmVhdGVQTkdTdHJlYW0oKTsKICB9OwoKICBpZiAoZmFicmljLkNhbnZhcykgewogICAgZmFicmljLkNhbnZhcy5wcm90b3R5cGUuY3JlYXRlUE5HU3RyZWFtOwogIH0KCiAgdmFyIG9yaWdTZXRXaWR0aCA9IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnNldFdpZHRoOwoKICBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5zZXRXaWR0aCA9IGZ1bmN0aW9uICh3aWR0aCkgewogICAgb3JpZ1NldFdpZHRoLmNhbGwodGhpcyk7CiAgICB0aGlzLm5vZGVDYW52YXMud2lkdGggPSB3aWR0aDsKICAgIHJldHVybiB0aGlzOwogIH07CgogIGlmIChmYWJyaWMuQ2FudmFzKSB7CiAgICBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5zZXRXaWR0aCA9IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnNldFdpZHRoOwogIH0KCiAgdmFyIG9yaWdTZXRIZWlnaHQgPSBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5zZXRIZWlnaHQ7CgogIGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnNldEhlaWdodCA9IGZ1bmN0aW9uIChoZWlnaHQpIHsKICAgIG9yaWdTZXRIZWlnaHQuY2FsbCh0aGlzKTsKICAgIHRoaXMubm9kZUNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICBpZiAoZmFicmljLkNhbnZhcykgewogICAgZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc2V0SGVpZ2h0ID0gZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUuc2V0SGVpZ2h0OwogIH0KfSkoKTs="},{"version":3,"sources":["C:/Users/icald/VueJS/store_app/src/editor/js/fabric.js"],"names":["fabric","version","exports","document","window","require","jsdom","createWindow","isTouchSupported","documentElement","isLikelyNode","Buffer","Cufon","api","replace","apply","arguments","DOM","ready","complete","readyStatus","loaded","queue","perform","fn","shift","addEventListener","opera","readyState","setTimeout","callee","createStyleSheet","body","doScroll","e","addEvent","listener","length","push","CSS","Size","value","base","parseFloat","unit","String","match","convert","convertFrom","toString","getStyle","el","Style","style","quotedList","cached","list","re","exec","styleElements","Object","prototype","propertyIsEnumerable","elementsByTagName","linkElements","linkStyles","link","i","l","disabled","rel","toLowerCase","styleSheets","supports","property","checker","createElement","undefined","textAlign","word","position","wordCount","get","textDecoration","types","underline","overline","search","parentNode","nodeType","foundAll","type","indexOf","textShadow","shadows","currentShadow","result","offCount","color","parsed","$0","$1","$2","opacity","textTransform","text","uppercase","lowercase","Font","data","face","glyphs","w","baseSize","parseInt","family","weight","viewBox","parts","bbox","split","box","minX","minY","maxX","maxY","width","height","join","ascent","descent","FontFamily","styles","mapping","oblique","italic","add","font","weights","normal","bold","up","alts","min","max","alt","sort","a","b","HoverHandler","contains","node","anotherNode","compareDocumentPosition","onOverOut","related","relatedTarget","trigger","onEnterLeave","sharedStorage","options","attach","onmouseenter","Storage","map","at","identify","cufid","id","custom","sizes","getSize","extend","attachEvent","call","event","storage","hover","hoverables","nodeName","hoverHandler","fun","cache","key","hasOwnProperty","getFont","families","fonts","query","getElementsByTagName","merge","merged","process","separate","engines","engine","fragment","createDocumentFragment","processed","separators","needsAligning","HAS_BROKEN_REGEXP","test","unshift","appendChild","replaceElement","nextNode","redraw","firstChild","nextSibling","className","G_vmlCanvasManager","replaceChild","removeChild","replaceHistory","defaultOptions","printable","selector","Sizzle","jQuery","dojo","$$","$","querySelectorAll","words","characters","now","refresh","currentHistory","splice","registerEngine","set","registerFont","elements","ignoreHistory","getOptions","option","HAS_INLINE_BLOCK","HAS_BROKEN_LINEHEIGHT","compatMode","doctype","publicId","styleSheet","textNode","createTextNode","setAttribute","cssText","generateFromVML","path","context","atX","atY","code","generate","c","m","interpret","line","size","letterSpacing","expandTop","expandRight","expandBottom","expandLeft","shadowOffsets","textOptions","shadow","x","offX","y","offY","chars","lastWidth","maxWidth","lines","lineWidths","glyph","missingGlyph","Number","Math","lineOffsets","wrapper","canvas","print","wStyle","cStyle","roundedHeight","ceil","roundingFactor","top","round","left","_width","wrapperWidth","_height","totalLineHeight","lineHeight","paddingLeft","paddingBottom","g","getContext","scale","fontAscent","boundaries","offsets","save","translate","offsetLeft","offsetTop","lineWidth","strokeStyle","beginPath","moveTo","lineTo","stroke","getTextDecoration","isItalic","fontStyle","renderBackground","fillStyle","backgroundColor","lineNum","topOffset","boundary","nextBoundary","charWidth","fillRect","restore","renderText","transform","d","fill","closePath","strokeWidth","namespaces","canvasEl","cvml","check","behavior","coordsize","write","getFontSizeInPixels","getSizeInPixels","runtimeStyle","currentStyle","pixelLeft","hasNext","computedFontSize","computedLSpacing","offsetX","advance","shape","k","fullWidth","shapeWidth","roundedShapeWidth","coordSize","coordOrigin","stretch","childNodes","stroked","coordorigin","fillcolor","sStyle","shadow1","shadow2","color1","color2","on","offset","offset2","JSON","f","n","Date","toJSON","isFinite","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Boolean","cx","escapable","gap","indent","meta","rep","quote","string","lastIndex","charCodeAt","slice","str","holder","v","mind","partial","stringify","replacer","space","Error","parse","reviver","j","walk","eval","SyntaxError","log","warn","console","Observable","observe","eventName","handler","__eventListeners","prop","stopObserving","util","removeFromArray","fire","listenersForEvent","len","off","array","idx","getRandomInt","floor","random","PiBy180","PI","degreesToRadians","degrees","toFixed","number","fractionDigits","falseFunction","animate","start","duration","finish","time","pos","onChange","abort","easing","t","cos","startValue","endValue","byValue","onStart","tick","currentTime","onComplete","requestAnimFrame","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","loadImage","url","img","Image","onload","src","enlivenObjects","objects","getKlass","camelize","capitalize","onLoaded","numLoadedObjects","numTotalObjects","enlivenedObjects","forEach","o","index","klass","async","fromObject","groupSVGElements","object","PathGroup","setSourcePath","Array","searchElement","TypeError","abs","every","some","filter","val","reduce","rv","invoke","method","args","byProperty","destination","source","clone","trim","character","toUpperCase","charAt","escapeXml","Function","dummy","bind","thisArg","bound","concat","emptyFunction","IS_DONTENUM_BUGGY","p","addMethods","parent","superclass","constructor","returnValue","subclass","createClass","properties","initialize","subclasses","global","areHostMethods","methodNames","getUniqueId","uniqueID","uid","__uniqueID","getElement","setElement","createListener","wrappedHandler","createWrappedHandler","createDispatcher","handlers","handlersForEvent","shouldUseAddListenerRemoveListener","shouldUseAttachEventDetachEvent","listeners","addListener","removeListener","removeEventListener","detachEvent","existingHandler","getPointer","pointerX","pointerY","docElement","scrollLeft","pageX","clientX","clientLeft","scrollTop","pageY","clientY","clientTop","touches","setStyle","elementStyle","setOpacity","normalizedProperty","styleFloat","parseEl","supportsOpacity","supportsFilters","view","defaultView","supportsGCS","getComputedStyle","reOpacity","es","hasLayout","zoom","_slice","getById","getElementById","toArray","arrayLike","sliceCanConvertNodelists","err","arr","makeElement","tagName","attributes","htmlFor","addClass","wrapElement","getElementOffset","valueT","valueL","offsetParent","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","getScript","headEl","scriptEl","loading","onreadystatechange","addParamToUrl","param","makeXHR","factories","ActiveXObject","XMLHttpRequest","req","emptyFn","request","parameters","open","setRequestHeader","send","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","sin","easeInOutSine","easeInExpo","pow","easeOutExpo","easeInOutExpo","easeInCirc","sqrt","easeOutCirc","easeInOutCirc","easeInElastic","s","asin","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","ease","attributesMap","normalizeAttr","attr","parseAttributes","parentAttributes","ownAttributes","memo","getAttribute","parseTransformAttribute","isNaN","getGlobalStylesForElement","parseStyleAttribute","rotateMatrix","matrix","angle","scaleMatrix","multiplierX","multiplierY","skewXMatrix","skewYMatrix","translateMatrix","iMatrix","comma_wsp","skewX","skewY","rotate","transforms","transform_list","reTransformList","RegExp","reTransform","attributeValue","operation","parsePointsAttribute","points","asPairs","parsedPoints","pair","oStyle","current","resolveGradients","instances","instanceFillValue","gradientId","gradientDefs","Gradient","fromElement","parseElements","checkIfDone","obj","message","getCSSRules","doc","allRules","rules","styleContents","textContent","rule","declaration","propertyValuePairs","cssRules","ruleMatchesElement","parseSVGDocument","reAllowedSVGTagNames","reNum","reViewBoxAttrValue","hasAncestorWithNodeName","startTime","descendants","selectNodes","viewBoxAttr","widthAttr","heightAttr","getGradientDefs","documentParsingTime","svgCache","has","name","loadSVGFromURL","hasUrl","enlivedRecord","_enlivenCachedObject","r","xml","responseXML","responseText","loadXML","results","cachedObject","loadSVGFromString","DOMParser","parser","parseFromString","createSVGFontFacesMarkup","markup","fontFamily","getColorStopFromStyle","keyValuePairs","pop","x1","y1","x2","y2","colorStops","toObject","toLiveGradient","ctx","gradient","createLinearGradient","colorValue","addColorStop","instance","colorStopEls","colorStopFromStyle","coords","_convertPercentUnitsToValues","forObject","percents","linearGradientEls","radialGradientEls","Point","init","that","addEquals","scalarAdd","scalar","scalarAddEquals","subtract","subtractEquals","scalarSubtract","scalarSubtractEquals","multiply","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","lerp","distanceFrom","dx","dy","setXY","setFromPoint","swap","Intersection","status","appendPoint","point","appendPoints","intersectLineLine","a1","a2","b1","b2","ua_t","ub_t","u_b","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","Color","setSource","_tryParsingColor","sourceFromHex","sourceFromRgb","getSource","_source","toRgb","toRgba","toHex","getAlpha","setAlpha","alpha","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherAlpha","otherSource","reRGBa","reHex","fromRgb","fromSource","fromRgba","fromHex","isShortNotation","substring","oColor","StaticCanvas","CANVAS_INIT_ERROR","_initStatic","activeInstance","backgroundImage","backgroundImageOpacity","backgroundImageStretch","includeDefaultValues","stateful","renderOnAddition","clipTo","controlsAboveOverlay","onBeforeScaleRotate","target","onFpsUpdate","_objects","_createLowerCanvas","_initOptions","overlayImage","setOverlayImage","renderAll","setBackgroundImage","calcOffset","_offset","lowerCanvasEl","_createCanvasElement","_initCanvasElement","initElement","interactive","_applyCanvasStyle","contextContainer","getWidth","getHeight","setWidth","_setDimension","setHeight","setDimensions","dimensions","upperCanvasEl","wrapperEl","getActiveObject","getActiveGroup","_draw","hasBorders","hasCorners","render","_initObject","setupState","setCoords","insertAt","nonSplicing","getObjects","clearContext","clearRect","clear","contextTop","allOnTop","canvasToDrawOn","activeGroup","clip","globalAlpha","drawImage","drawControls","elapsedTime","renderTop","selection","_groupSelector","_drawSelection","Group","drawBorders","drawCorners","active","toDataURL","format","quality","toDataURLWithMultiplier","multiplier","origWidth","origHeight","scaledWidth","scaledHeight","activeObject","_tempRemoveBordersCornersFromGroup","deactivateAll","dataURL","_restoreBordersCornersOnGroup","setActiveObject","group","origHideCorners","hideCorners","origBorderColor","borderColor","forEachObject","getCenter","centerObjectH","centerObjectV","centerObject","toDatalessJSON","toDatalessObject","_toObjectMethod","methodName","originalValue","background","toSVG","isEmpty","remove","discardActiveObject","sendToBack","bringToFront","sendBackwards","nextIntersectingIdx","intersectsWithObject","isContainedWithinObject","bringForward","item","complexity","dispose","_onMouseDown","_onMouseMove","_onResize","_resizeImageToFit","imgEl","imageWidth","offsetWidth","widthScaleFactor","EMPTY_JSON","imageData","getImageData","iLen","jLen","putImageData","cursorMap","utilMin","utilMax","atan2","STROKE_OFFSET","Canvas","_initInteractive","_createCacheCanvas","ProtoProxy","InteractiveMethods","selectionColor","selectionBorderColor","selectionLineWidth","freeDrawingColor","freeDrawingLineWidth","hoverCursor","moveCursor","defaultCursor","rotationCursor","containerClass","perPixelTargetFind","targetFindTolerance","_currentTransform","_freeDrawingXPoints","_freeDrawingYPoints","_initWrapperElement","_createUpperCanvas","_initEvents","_this","__onMouseDown","_onMouseUp","__onMouseUp","preventDefault","__onMouseMove","isDrawingMode","_isCurrentlyDrawing","_finalizeDrawingPath","_scaling","hasStateChanged","isMoving","_findSelectedObjects","setObjectsCoords","_setCursor","_setCursorFromEvent","isLeftClick","which","button","_prepareForDrawing","_captureDrawingPath","findTarget","pointer","corner","_shouldClearSelection","ex","ey","deactivateAllWithDispatch","saveState","_findTargetCorner","_setupCurrentTransform","shouldHandleGroupLogic","shiftKey","_handleGroupLogic","groupSelector","setActive","cursor","isActive","setCornersVisibility","action","_rotateObject","hasRotatingPoint","_scaleObject","_translateObject","containsPoint","xy","_normalizePointer","iLines","_getImageLines","oCoords","xpoints","_findCrossPoints","isObjectInGroup","_isTargetTransparent","cacheContext","contextCache","transparentCorners","isTransparent","temp","scaleX","scaleY","offsetY","theta","_theta","original","isType","removeWithUpdate","discardActiveGroup","addWithUpdate","_activeObject","setActiveGroup","saveCoords","lineCap","lineJoin","xPoint","yPoint","xPoints","yPoints","Path","lockMovementX","lockMovementY","by","lockScalingX","lockScalingY","lastLen","curLen","lockUniScaling","lockRotation","lastAngle","curAngle","aleft","atop","strokeRect","targetRegion","currentObject","selectionX1Y1","selectionX2Y2","intersectsWithRect","isContainedWithinRect","selectable","skipGroup","possibleTargets","cacheCanvasEl","getSelectionContext","getSelectionElement","_activeGroup","destroy","allObjects","Element","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","loadFromDatalessJSON","json","serialized","_enlivenDatalessObjects","onObjectLoaded","pathProp","paths","image","oImg","setAngle","useNative","Text","onscriptload","loadFromJSON","_enlivenObjects","_toDataURL","_toDataURLWithMultiplier","cloneWithoutData","flipX","flipY","cornersize","padding","cornerColor","fillRule","overlayFill","strokeDashArray","borderOpacityWhenMoving","borderScaleFactor","transformMatrix","hasControls","rotatingPointOffset","stateProperties","callSuper","setOptions","_initGradient","NUM_FRACTION_DIGITS","getAngle","_removeDefaultValues","getSvgStyles","getSvgTransform","_set","shouldConstrainValue","MIN_SCALE_LIMIT","toggle","sourcePath","noTransform","setTransform","_render","scaleToWidth","boundingRectFactor","getBoundingRectWidth","scaleToHeight","getBoundingRectHeight","currentWidth","currentHeight","_hypotenuse","_angle","atan","sinTh","cosTh","tl","tr","br","bl","ml","mt","mr","mb","mtr","_setCornerCoords","xCoords","yCoords","padding2","h","rotateHeight","rotateWidth","_renderDashedStroke","dashedArrayLength","renderSide","xMultiplier","yMultiplier","lineLength","sideLength","lengthOfSubPath","lengthDiff","size2","strokeWidth2","_left","_top","sizeX","sizeY","paddingX","paddingY","scaleOffsetY","scaleOffsetX","scaleOffsetSizeX","scaleOffsetSizeY","cloneAsImage","orig","proceed","originalState","selectionTL","selectionBR","intersection","other","getCoords","thisCoords","otherCoords","__corner","xi","yi","xcount","iLine","lineKey","topline","rightline","bottomline","leftline","cornerHypotenuse","cosHalfOffset","sinHalfOffset","fillValue","setGradientFill","_animate","to","from","centerH","centerV","center","proto","propName","capitalizedPropName","setterName","getterName","parentSet","coordProps","Line","_setWidthHeight","origStrokeStyle","ATTRIBUTE_NAMES","parsedAttributes","piBy2","Circle","radius","diameter","arc","getRadiusX","getRadiusY","setRadius","isValidRadius","Triangle","widthBy2","heightBy2","Ellipse","rx","ry","cy","ellipse","Rect","_initStateProperties","_initRxRy","quadraticCurveTo","_normalizeLeftTopProperties","_setDefaultLeftTopValues","rect","Polyline","_calcDimensions","Polygon","byX","byY","commandLengths","q","drawArc","rot","large","sweep","segs","arcToSegments","bez","segmentToBezier","bezierCurveTo","arcToSegmentsCache","segmentToBezierCache","_join","argsString","rotateX","ox","oy","th","sin_th","cos_th","px","py","pl","a00","a01","a10","a11","x0","y0","sfactor_sq","sfactor","xc","yc","th0","th1","th_arc","segments","th2","th3","th_half","x3","y3","_toString","getX","getY","fromArray","_initializeFromString","isWidthSet","isHeightSet","_parsePath","_parseDimensions","previous","controlX","controlY","tempX","tempY","tempControlX","tempControlY","chunks","currentPath","chunksParsed","jlen","command","commandLength","klen","aX","aY","previousX","previousY","isLowerCase","deltaX","deltaY","bottom","right","parentToObject","forceFillOverwrite","isSameColor","firstPathFill","total","instantiatePaths","klassName","_calcBounds","_updateObjectsCoords","_setOpacityIfSame","groupDeltaX","groupDeltaY","objectLeft","objectTop","_restoreObjectsState","groupScaleFactor","originalScaleFactor","_restoreObjectState","groupLeft","groupTop","groupAngle","rotatedTop","rotatedLeft","_originalLeft","_originalTop","hasMoved","activateAllObjects","firstValue","isSameOpacity","halfWidth","halfHeight","centerX","centerY","objectsMarkup","bordervisibility","cornervisibility","_initElement","_originalImage","_initConfig","filters","applyFilters","_element","getOriginalSize","setBorderVisibility","visible","_resetWidthHeight","_adjustWidthHeightToBorders","showBorder","_src","getSvgSrc","getSrc","replacement","applyTo","base64str","currentBorder","borderwidth","CSS_CANVAS","_setBorder","_initFilters","filterObj","sidesBorderWidth","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","Grayscale","RemoveWhite","distance","limit","Invert","Sepia","avg","Sepia2","Brightness","brightness","Noise","noise","rand","GradientTransparency","Tint","rgb","cr","substr","cg","cb","fontSize","fontWeight","_initDimensions","_renderViaNative","_renderViaCufon","_initDummyElementForCufon","_totalLineHeight","_fontAscent","_boundaries","_shadowOffsets","_shadows","_setTextStyles","textLines","_getTextWidth","_getTextHeight","_renderTextBackground","_setTextShadow","_renderTextFill","_renderTextStroke","_renderTextDecoration","_setBoundaries","measureText","lineLeftOffset","_getLineLeftOffset","textBaseline","_getFontDeclaration","currentLineWidth","reOffsetsAndBlur","shadowDeclaration","offsetsAndBlur","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","blur","fillText","strokeText","halfOfVerticalBox","renderLinesAtOffset","container","innerHTML","innerText","lineTopOffset","textLeftOffset","textTopOffset","textAndBg","_getSVGTextAndBg","shadowSpans","_getSVGShadows","textBgRects","textSpans","ilen","lineTopOffsetMultiplier","_getFillAttributes","fillColor","setColor","setFontsize","getText","setText","URL","HTTP","encoding","oURL","client","createClient","port","hostname","pathname","errno","ECONNREFUSED","host","end","response","setEncoding","chunk","statusCode","createCanvasForNode","nodeCanvas","fabricCanvas","createPNGStream","origSetWidth","origSetHeight"],"mappings":"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","sourcesContent":["/* build: `node build.js modules=ALL` */\n/*! Fabric.js Copyright 2008-2012, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: \"0.9.13\" };\n\nif (typeof exports != 'undefined') {\n  exports.fabric = fabric;\n}\n\nif (typeof document != 'undefined' && typeof window != 'undefined') {\n  fabric.document = document;\n  fabric.window = window;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  fabric.document = require(\"jsdom\").jsdom(\"<!DOCTYPE html><html><head></head><body></body></html>\");\n  fabric.window = fabric.document.createWindow();\n}\n\n/**\n * True when in environment that supports touch events\n * @property isTouchSupported\n * @type boolean\n */\nfabric.isTouchSupported = \"ontouchstart\" in fabric.document.documentElement;\n\n/**\n * True when in environment that's probably Node.js\n * @property isLikelyNode\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' && typeof window === 'undefined';\n/*!\n * Copyright (c) 2009 Simo Kinnunen.\n * Licensed under the MIT license.\n */\n\nvar Cufon = (function() {\n\n  var api = function() {\n    return api.replace.apply(null, arguments);\n  };\n\n  var DOM = api.DOM = {\n\n    ready: (function() {\n\n      var complete = false, readyStatus = { loaded: 1, complete: 1 };\n\n      var queue = [], perform = function() {\n        if (complete) return;\n        complete = true;\n        for (var fn; fn = queue.shift(); fn());\n      };\n\n      // Gecko, Opera, WebKit r26101+\n\n      if (fabric.document.addEventListener) {\n        fabric.document.addEventListener('DOMContentLoaded', perform, false);\n        fabric.window.addEventListener('pageshow', perform, false); // For cached Gecko pages\n      }\n\n      // Old WebKit, Internet Explorer\n\n      if (!fabric.window.opera && fabric.document.readyState) (function() {\n        readyStatus[fabric.document.readyState] ? perform() : setTimeout(arguments.callee, 10);\n      })();\n\n      // Internet Explorer\n\n      if (fabric.document.readyState && fabric.document.createStyleSheet) (function() {\n        try {\n          fabric.document.body.doScroll('left');\n          perform();\n        }\n        catch (e) {\n          setTimeout(arguments.callee, 1);\n        }\n      })();\n\n      addEvent(fabric.window, 'load', perform); // Fallback\n\n      return function(listener) {\n        if (!arguments.length) perform();\n        else complete ? listener() : queue.push(listener);\n      };\n\n    })()\n\n  };\n\n  var CSS = api.CSS = {\n\n    Size: function(value, base) {\n\n      this.value = parseFloat(value);\n      this.unit = String(value).match(/[a-z%]*$/)[0] || 'px';\n\n      this.convert = function(value) {\n        return value / base * this.value;\n      };\n\n      this.convertFrom = function(value) {\n        return value / this.value * base;\n      };\n\n      this.toString = function() {\n        return this.value + this.unit;\n      };\n\n    },\n\n    getStyle: function(el) {\n      return new Style(el.style);\n      /*\n      var view = document.defaultView;\n      if (view && view.getComputedStyle) return new Style(view.getComputedStyle(el, null));\n      if (el.currentStyle) return new Style(el.currentStyle);\n      return new Style(el.style);\n      */\n    },\n\n    quotedList: cached(function(value) {\n      // doesn't work properly with empty quoted strings (\"\"), but\n      // it's not worth the extra code.\n      var list = [], re = /\\s*(([\"'])([\\s\\S]*?[^\\\\])\\2|[^,]+)\\s*/g, match;\n      while (match = re.exec(value)) list.push(match[3] || match[1]);\n      return list;\n    }),\n\n    ready: (function() {\n\n      var complete = false;\n\n      var queue = [], perform = function() {\n        complete = true;\n        for (var fn; fn = queue.shift(); fn());\n      };\n\n      // Safari 2 does not include <style> elements in document.styleSheets.\n      // Safari 2 also does not support Object.prototype.propertyIsEnumerable.\n\n      var styleElements = Object.prototype.propertyIsEnumerable ? elementsByTagName('style') : { length: 0 };\n      var linkElements = elementsByTagName('link');\n\n      DOM.ready(function() {\n        // These checks are actually only needed for WebKit-based browsers, but don't really hurt other browsers.\n        var linkStyles = 0, link;\n        for (var i = 0, l = linkElements.length; link = linkElements[i], i < l; ++i) {\n          // WebKit does not load alternate stylesheets.\n          if (!link.disabled && link.rel.toLowerCase() == 'stylesheet') ++linkStyles;\n        }\n        if (fabric.document.styleSheets.length >= styleElements.length + linkStyles) perform();\n        else setTimeout(arguments.callee, 10);\n      });\n\n      return function(listener) {\n        if (complete) listener();\n        else queue.push(listener);\n      };\n\n    })(),\n\n    supports: function(property, value) {\n      var checker = fabric.document.createElement('span').style;\n      if (checker[property] === undefined) return false;\n      checker[property] = value;\n      return checker[property] === value;\n    },\n\n    textAlign: function(word, style, position, wordCount) {\n      if (style.get('textAlign') == 'right') {\n        if (position > 0) word = ' ' + word;\n      }\n      else if (position < wordCount - 1) word += ' ';\n      return word;\n    },\n\n    textDecoration: function(el, style) {\n      if (!style) style = this.getStyle(el);\n      var types = {\n        underline: null,\n        overline: null,\n        'line-through': null\n      };\n      for (var search = el; search.parentNode && search.parentNode.nodeType == 1; ) {\n        var foundAll = true;\n        for (var type in types) {\n          if (types[type]) continue;\n          if (style.get('textDecoration').indexOf(type) != -1) types[type] = style.get('color');\n          foundAll = false;\n        }\n        if (foundAll) break; // this is rather unlikely to happen\n        style = this.getStyle(search = search.parentNode);\n      }\n      return types;\n    },\n\n    textShadow: cached(function(value) {\n      if (value == 'none') return null;\n      var shadows = [], currentShadow = {}, result, offCount = 0;\n      var re = /(#[a-f0-9]+|[a-z]+\\(.*?\\)|[a-z]+)|(-?[\\d.]+[a-z%]*)|,/ig;\n      while (result = re.exec(value)) {\n        if (result[0] == ',') {\n          shadows.push(currentShadow);\n          currentShadow = {}, offCount = 0;\n        }\n        else if (result[1]) {\n          currentShadow.color = result[1];\n        }\n        else {\n          currentShadow[[ 'offX', 'offY', 'blur' ][offCount++]] = result[2];\n        }\n      }\n      shadows.push(currentShadow);\n      return shadows;\n    }),\n\n    color: cached(function(value) {\n      var parsed = {};\n      parsed.color = value.replace(/^rgba\\((.*?),\\s*([\\d.]+)\\)/, function($0, $1, $2) {\n        parsed.opacity = parseFloat($2);\n        return 'rgb(' + $1 + ')';\n      });\n      return parsed;\n    }),\n\n    textTransform: function(text, style) {\n      return text[{\n        uppercase: 'toUpperCase',\n        lowercase: 'toLowerCase'\n      }[style.get('textTransform')] || 'toString']();\n    }\n\n  };\n\n  function Font(data) {\n\n    var face = this.face = data.face;\n    this.glyphs = data.glyphs;\n    this.w = data.w;\n    this.baseSize = parseInt(face['units-per-em'], 10);\n\n    this.family = face['font-family'].toLowerCase();\n    this.weight = face['font-weight'];\n    this.style = face['font-style'] || 'normal';\n\n    this.viewBox = (function () {\n      var parts = face.bbox.split(/\\s+/);\n      var box = {\n        minX: parseInt(parts[0], 10),\n        minY: parseInt(parts[1], 10),\n        maxX: parseInt(parts[2], 10),\n        maxY: parseInt(parts[3], 10)\n      };\n      box.width = box.maxX - box.minX,\n      box.height = box.maxY - box.minY;\n      box.toString = function() {\n        return [ this.minX, this.minY, this.width, this.height ].join(' ');\n      };\n      return box;\n    })();\n\n    this.ascent = -parseInt(face.ascent, 10);\n    this.descent = -parseInt(face.descent, 10);\n\n    this.height = -this.ascent + this.descent;\n\n  }\n\n  function FontFamily() {\n\n    var styles = {}, mapping = {\n      oblique: 'italic',\n      italic: 'oblique'\n    };\n\n    this.add = function(font) {\n      (styles[font.style] || (styles[font.style] = {}))[font.weight] = font;\n    };\n\n    this.get = function(style, weight) {\n      var weights = styles[style] || styles[mapping[style]]\n        || styles.normal || styles.italic || styles.oblique;\n      if (!weights) return null;\n      // we don't have to worry about \"bolder\" and \"lighter\"\n      // because IE's currentStyle returns a numeric value for it,\n      // and other browsers use the computed value anyway\n      weight = {\n        normal: 400,\n        bold: 700\n      }[weight] || parseInt(weight, 10);\n      if (weights[weight]) return weights[weight];\n      // http://www.w3.org/TR/CSS21/fonts.html#propdef-font-weight\n      // Gecko uses x99/x01 for lighter/bolder\n      var up = {\n        1: 1,\n        99: 0\n      }[weight % 100], alts = [], min, max;\n      if (up === undefined) up = weight > 400;\n      if (weight == 500) weight = 400;\n      for (var alt in weights) {\n        alt = parseInt(alt, 10);\n        if (!min || alt < min) min = alt;\n        if (!max || alt > max) max = alt;\n        alts.push(alt);\n      }\n      if (weight < min) weight = min;\n      if (weight > max) weight = max;\n      alts.sort(function(a, b) {\n        return (up\n          ? (a > weight && b > weight) ? a < b : a > b\n          : (a < weight && b < weight) ? a > b : a < b) ? -1 : 1;\n      });\n      return weights[alts[0]];\n    };\n\n  }\n\n  function HoverHandler() {\n\n    function contains(node, anotherNode) {\n      if (node.contains) return node.contains(anotherNode);\n      return node.compareDocumentPosition(anotherNode) & 16;\n    }\n\n    function onOverOut(e) {\n      var related = e.relatedTarget;\n      if (!related || contains(this, related)) return;\n      trigger(this);\n    }\n\n    function onEnterLeave(e) {\n      trigger(this);\n    }\n\n    function trigger(el) {\n      // A timeout is needed so that the event can actually \"happen\"\n      // before replace is triggered. This ensures that styles are up\n      // to date.\n      setTimeout(function() {\n        api.replace(el, sharedStorage.get(el).options, true);\n      }, 10);\n    }\n\n    this.attach = function(el) {\n      if (el.onmouseenter === undefined) {\n        addEvent(el, 'mouseover', onOverOut);\n        addEvent(el, 'mouseout', onOverOut);\n      }\n      else {\n        addEvent(el, 'mouseenter', onEnterLeave);\n        addEvent(el, 'mouseleave', onEnterLeave);\n      }\n    };\n\n  }\n\n  function Storage() {\n\n    var map = {}, at = 0;\n\n    function identify(el) {\n      return el.cufid || (el.cufid = ++at);\n    }\n\n    this.get = function(el) {\n      var id = identify(el);\n      return map[id] || (map[id] = {});\n    };\n\n  }\n\n  function Style(style) {\n\n    var custom = {}, sizes = {};\n\n    this.get = function(property) {\n      return custom[property] != undefined ? custom[property] : style[property];\n    };\n\n    this.getSize = function(property, base) {\n      return sizes[property] || (sizes[property] = new CSS.Size(this.get(property), base));\n    };\n\n    this.extend = function(styles) {\n      for (var property in styles) custom[property] = styles[property];\n      return this;\n    };\n\n  }\n\n  function addEvent(el, type, listener) {\n    if (el.addEventListener) {\n      el.addEventListener(type, listener, false);\n    }\n    else if (el.attachEvent) {\n      el.attachEvent('on' + type, function() {\n        return listener.call(el, fabric.window.event);\n      });\n    }\n  }\n\n  function attach(el, options) {\n    var storage = sharedStorage.get(el);\n    if (storage.options) return el;\n    if (options.hover && options.hoverables[el.nodeName.toLowerCase()]) {\n      hoverHandler.attach(el);\n    }\n    storage.options = options;\n    return el;\n  }\n\n  function cached(fun) {\n    var cache = {};\n    return function(key) {\n      if (!cache.hasOwnProperty(key)) cache[key] = fun.apply(null, arguments);\n      return cache[key];\n    };\n  }\n\n  function getFont(el, style) {\n    if (!style) style = CSS.getStyle(el);\n    var families = CSS.quotedList(style.get('fontFamily').toLowerCase()), family;\n    for (var i = 0, l = families.length; i < l; ++i) {\n      family = families[i];\n      if (fonts[family]) return fonts[family].get(style.get('fontStyle'), style.get('fontWeight'));\n    }\n    return null;\n  }\n\n  function elementsByTagName(query) {\n    return fabric.document.getElementsByTagName(query);\n  }\n\n  function merge() {\n    var merged = {}, key;\n    for (var i = 0, l = arguments.length; i < l; ++i) {\n      for (key in arguments[i]) merged[key] = arguments[i][key];\n    }\n    return merged;\n  }\n\n  function process(font, text, style, options, node, el) {\n\n    var separate = options.separate;\n    if (separate == 'none') return engines[options.engine].apply(null, arguments);\n    var fragment = fabric.document.createDocumentFragment(), processed;\n    var parts = text.split(separators[separate]), needsAligning = (separate == 'words');\n    if (needsAligning && HAS_BROKEN_REGEXP) {\n      // @todo figure out a better way to do this\n      if (/^\\s/.test(text)) parts.unshift('');\n      if (/\\s$/.test(text)) parts.push('');\n    }\n    for (var i = 0, l = parts.length; i < l; ++i) {\n      processed = engines[options.engine](font,\n        needsAligning ? CSS.textAlign(parts[i], style, i, l) : parts[i],\n        style, options, node, el, i < l - 1);\n      if (processed) fragment.appendChild(processed);\n    }\n    return fragment;\n  }\n\n  function replaceElement(el, options) {\n    var font, style, nextNode, redraw;\n    for (var node = attach(el, options).firstChild; node; node = nextNode) {\n      nextNode = node.nextSibling;\n      redraw = false;\n      if (node.nodeType == 1) {\n        if (!node.firstChild) continue;\n        if (!/cufon/.test(node.className)) {\n          arguments.callee(node, options);\n          continue;\n        }\n        else redraw = true;\n      }\n      if (!style) style = CSS.getStyle(el).extend(options);\n      if (!font) font = getFont(el, style);\n\n      if (!font) continue;\n      if (redraw) {\n        engines[options.engine](font, null, style, options, node, el);\n        continue;\n      }\n      var text = node.data;\n      //for some reason, the carriage return is not stripped by IE but \"\\n\" is, so let's keep \\r as a new line marker...\n      if (typeof G_vmlCanvasManager != 'undefined') {\n          text = text.replace(/\\r/g, \"\\n\");\n      }\n      if (text === '') continue;\n      var processed = process(font, text, style, options, node, el);\n      if (processed) node.parentNode.replaceChild(processed, node);\n      else node.parentNode.removeChild(node);\n    }\n  }\n\n  var HAS_BROKEN_REGEXP = ' '.split(/\\s+/).length == 0;\n\n  var sharedStorage = new Storage();\n  var hoverHandler = new HoverHandler();\n  var replaceHistory = [];\n\n  var engines = {}, fonts = {}, defaultOptions = {\n    engine: null,\n    //fontScale: 1,\n    //fontScaling: false,\n    hover: false,\n    hoverables: {\n      a: true\n    },\n    printable: true,\n    //rotation: 0,\n    //selectable: false,\n    selector: (\n        fabric.window.Sizzle\n      ||  (fabric.window.jQuery && function(query) { return jQuery(query); }) // avoid noConflict issues\n      ||  (fabric.window.dojo && dojo.query)\n      ||  (fabric.window.$$ && function(query) { return $$(query); })\n      ||  (fabric.window.$ && function(query) { return $(query); })\n      ||  (fabric.document.querySelectorAll && function(query) { return fabric.document.querySelectorAll(query); })\n      ||  elementsByTagName\n    ),\n    separate: 'words', // 'none' and 'characters' are also accepted\n    textShadow: 'none'\n  };\n\n  var separators = {\n    words: /\\s+/,\n    characters: ''\n  };\n\n  api.now = function() {\n    DOM.ready();\n    return api;\n  };\n\n  api.refresh = function() {\n    var currentHistory = replaceHistory.splice(0, replaceHistory.length);\n    for (var i = 0, l = currentHistory.length; i < l; ++i) {\n      api.replace.apply(null, currentHistory[i]);\n    }\n    return api;\n  };\n\n  api.registerEngine = function(id, engine) {\n    if (!engine) return api;\n    engines[id] = engine;\n    return api.set('engine', id);\n  };\n\n  api.registerFont = function(data) {\n    var font = new Font(data), family = font.family;\n    if (!fonts[family]) fonts[family] = new FontFamily();\n    fonts[family].add(font);\n    return api.set('fontFamily', '\"' + family + '\"');\n  };\n\n  api.replace = function(elements, options, ignoreHistory) {\n    options = merge(defaultOptions, options);\n    if (!options.engine) return api; // there's no browser support so we'll just stop here\n    if (typeof options.textShadow == 'string' && options.textShadow)\n      options.textShadow = CSS.textShadow(options.textShadow);\n    if (!ignoreHistory) replaceHistory.push(arguments);\n    if (elements.nodeType || typeof elements == 'string') elements = [ elements ];\n    CSS.ready(function() {\n      for (var i = 0, l = elements.length; i < l; ++i) {\n        var el = elements[i];\n        if (typeof el == 'string') api.replace(options.selector(el), options, true);\n        else replaceElement(el, options);\n      }\n    });\n    return api;\n  };\n\n  api.replaceElement = function(el, options) {\n    options = merge(defaultOptions, options);\n    if (typeof options.textShadow == 'string' && options.textShadow)\n      options.textShadow = CSS.textShadow(options.textShadow);\n    return replaceElement(el, options);\n  };\n\n  // ==>\n  api.engines = engines;\n  api.fonts = fonts;\n  api.getOptions = function() {\n    return merge(defaultOptions);\n  }\n  // <==\n\n  api.set = function(option, value) {\n    defaultOptions[option] = value;\n    return api;\n  };\n\n  return api;\n\n})();\n\nCufon.registerEngine('canvas', (function() {\n\n  // Safari 2 doesn't support .apply() on native methods\n  var HAS_INLINE_BLOCK = Cufon.CSS.supports('display', 'inline-block');\n\n  // Firefox 2 w/ non-strict doctype (almost standards mode)\n  var HAS_BROKEN_LINEHEIGHT = !HAS_INLINE_BLOCK && (fabric.document.compatMode == 'BackCompat' || /frameset|transitional/i.test(fabric.document.doctype.publicId));\n\n  var styleSheet = fabric.document.createElement('style');\n  styleSheet.type = 'text/css';\n\n    var textNode = fabric.document.createTextNode(\n        '.cufon-canvas{text-indent:0}' +\n        '@media screen,projection{' +\n          '.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle' +\n          (HAS_BROKEN_LINEHEIGHT\n            ? ''\n            : ';font-size:1px;line-height:1px') +\n          '}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}' +\n          (HAS_INLINE_BLOCK\n            ? '.cufon-canvas canvas{position:relative}'\n            : '.cufon-canvas canvas{position:absolute}') +\n        '}' +\n        '@media print{' +\n          '.cufon-canvas{padding:0 !important}' +\n          '.cufon-canvas canvas{display:none}' +\n          '.cufon-canvas .cufon-alt{display:inline}' +\n        '}'\n      )\n\n  try {\n      styleSheet.appendChild(textNode);\n  } catch(e) {\n      //IE8- can't do this...\n      styleSheet.setAttribute(\"type\", \"text/css\");\n      styleSheet.styleSheet.cssText = textNode.data;\n  }\n  fabric.document.getElementsByTagName('head')[0].appendChild(styleSheet);\n\n  function generateFromVML(path, context) {\n    var atX = 0, atY = 0;\n    var code = [], re = /([mrvxe])([^a-z]*)/g, match;\n    generate: for (var i = 0; match = re.exec(path); ++i) {\n      var c = match[2].split(',');\n      switch (match[1]) {\n        case 'v':\n          code[i] = { m: 'bezierCurveTo', a: [ atX + ~~c[0], atY + ~~c[1], atX + ~~c[2], atY + ~~c[3], atX += ~~c[4], atY += ~~c[5] ] };\n          break;\n        case 'r':\n          code[i] = { m: 'lineTo', a: [ atX += ~~c[0], atY += ~~c[1] ] };\n          break;\n        case 'm':\n          code[i] = { m: 'moveTo', a: [ atX = ~~c[0], atY = ~~c[1] ] };\n          break;\n        case 'x':\n          code[i] = { m: 'closePath', a: [] };\n          break;\n        case 'e':\n          break generate;\n      }\n      context[code[i].m].apply(context, code[i].a);\n    }\n    return code;\n  }\n\n  function interpret(code, context) {\n    for (var i = 0, l = code.length; i < l; ++i) {\n      var line = code[i];\n      context[line.m].apply(context, line.a);\n    }\n  }\n\n  return function(font, text, style, options, node, el) {\n\n    var redraw = (text === null);\n\n    var viewBox = font.viewBox;\n\n    var size = style.getSize('fontSize', font.baseSize);\n\n    var letterSpacing = style.get('letterSpacing');\n    letterSpacing = (letterSpacing == 'normal') ? 0 : size.convertFrom(parseInt(letterSpacing, 10));\n\n    var expandTop = 0, expandRight = 0, expandBottom = 0, expandLeft = 0;\n    var shadows = options.textShadow, shadowOffsets = [];\n\n    Cufon.textOptions.shadowOffsets = [ ];\n    Cufon.textOptions.shadows = null;\n\n    if (shadows) {\n      Cufon.textOptions.shadows = shadows;\n      for (var i = 0, l = shadows.length; i < l; ++i) {\n        var shadow = shadows[i];\n        var x = size.convertFrom(parseFloat(shadow.offX));\n        var y = size.convertFrom(parseFloat(shadow.offY));\n        shadowOffsets[i] = [ x, y ];\n        //if (y < expandTop) expandTop = y;\n        //if (x > expandRight) expandRight = x;\n        //if (y > expandBottom) expandBottom = y;\n        //if (x < expandLeft) expandLeft = x;\n      }\n    }\n\n    var chars = Cufon.CSS.textTransform(redraw ? node.alt : text, style).split('');\n\n    var width = 0, lastWidth = null;\n\n    var maxWidth = 0, lines = 1, lineWidths = [ ];\n    for (var i = 0, l = chars.length; i < l; ++i) {\n      if (chars[i] === '\\n') {\n        lines++;\n        if (width > maxWidth) {\n          maxWidth = width;\n        }\n        lineWidths.push(width);\n        width = 0;\n        continue;\n      }\n      var glyph = font.glyphs[chars[i]] || font.missingGlyph;\n      if (!glyph) continue;\n      width += lastWidth = Number(glyph.w || font.w) + letterSpacing;\n    }\n    lineWidths.push(width);\n\n    width = Math.max(maxWidth, width);\n\n    var lineOffsets = [ ];\n    for (var i = lineWidths.length; i--; ) {\n      lineOffsets[i] = width - lineWidths[i];\n    }\n\n    if (lastWidth === null) return null; // there's nothing to render\n\n    expandRight += (viewBox.width - lastWidth);\n    expandLeft += viewBox.minX;\n\n    var wrapper, canvas;\n\n    if (redraw) {\n      wrapper = node;\n      canvas = node.firstChild;\n    }\n    else {\n      wrapper = fabric.document.createElement('span');\n      wrapper.className = 'cufon cufon-canvas';\n      wrapper.alt = text;\n\n      canvas = fabric.document.createElement('canvas');\n      wrapper.appendChild(canvas);\n\n      if (options.printable) {\n        var print = fabric.document.createElement('span');\n        print.className = 'cufon-alt';\n        print.appendChild(fabric.document.createTextNode(text));\n        wrapper.appendChild(print);\n      }\n    }\n\n    var wStyle = wrapper.style;\n    var cStyle = canvas.style || { };\n\n    var height = size.convert(viewBox.height - expandTop + expandBottom);\n    var roundedHeight = Math.ceil(height);\n    var roundingFactor = roundedHeight / height;\n\n    canvas.width = Math.ceil(size.convert(width + expandRight - expandLeft) * roundingFactor);\n    canvas.height = roundedHeight;\n\n    expandTop += viewBox.minY;\n\n    cStyle.top = Math.round(size.convert(expandTop - font.ascent)) + 'px';\n    cStyle.left = Math.round(size.convert(expandLeft)) + 'px';\n\n    var _width = Math.ceil(size.convert(width * roundingFactor));\n    var wrapperWidth = _width + 'px';\n    var _height = size.convert(font.height);\n    var totalLineHeight = (options.lineHeight - 1) * size.convert(-font.ascent / 5) * (lines - 1);\n\n    Cufon.textOptions.width = _width;\n    Cufon.textOptions.height = (_height * lines) + totalLineHeight;\n    Cufon.textOptions.lines = lines;\n    Cufon.textOptions.totalLineHeight = totalLineHeight;\n\n    if (HAS_INLINE_BLOCK) {\n      wStyle.width = wrapperWidth;\n      wStyle.height = _height + 'px';\n    }\n    else {\n      wStyle.paddingLeft = wrapperWidth;\n      wStyle.paddingBottom = (_height - 1) + 'px';\n    }\n\n    var g = Cufon.textOptions.context || canvas.getContext('2d'),\n        scale = roundedHeight / viewBox.height;\n\n    Cufon.textOptions.fontAscent = font.ascent * scale;\n    Cufon.textOptions.boundaries = null;\n\n    for (var offsets = Cufon.textOptions.shadowOffsets, i = shadowOffsets.length; i--; ) {\n      offsets[i] = [ shadowOffsets[i][0] * scale, shadowOffsets[i][1] * scale ];\n    }\n\n    g.save();\n    g.scale(scale, scale);\n\n    g.translate(\n      // we're at the center of an object and need to jump to the top left corner\n      // where first character is to be drawn\n      -expandLeft - ((1/scale * canvas.width) / 2) + (Cufon.fonts[font.family].offsetLeft || 0),\n      -expandTop - ((Cufon.textOptions.height / scale) / 2) + (Cufon.fonts[font.family].offsetTop || 0)\n    );\n\n    g.lineWidth = font.face['underline-thickness'];\n\n    g.save();\n\n    function line(y, color) {\n      g.strokeStyle = color;\n\n      g.beginPath();\n\n      g.moveTo(0, y);\n      g.lineTo(width, y);\n\n      g.stroke();\n    }\n\n    var textDecoration = Cufon.getTextDecoration(options),\n        isItalic = options.fontStyle === 'italic';\n\n    function renderBackground() {\n      g.save();\n\n      g.fillStyle = options.backgroundColor;\n\n      var left = 0, lineNum = 0, boundaries = [{ left: 0 }];\n\n      if (options.textAlign === 'right') {\n        g.translate(lineOffsets[lineNum], 0);\n        boundaries[0].left = lineOffsets[lineNum] * scale;\n      }\n      else if (options.textAlign === 'center') {\n        g.translate(lineOffsets[lineNum] / 2, 0);\n        boundaries[0].left = lineOffsets[lineNum] / 2 * scale;\n      }\n\n      for (var i = 0, l = chars.length; i < l; ++i) {\n        if (chars[i] === '\\n') {\n\n          lineNum++;\n\n          var topOffset = -font.ascent - ((font.ascent / 5) * options.lineHeight);\n          var boundary = boundaries[boundaries.length - 1];\n          var nextBoundary = { left: 0 };\n\n          boundary.width = left * scale;\n          boundary.height = (-font.ascent + font.descent) * scale;\n\n          if (options.textAlign === 'right') {\n            g.translate(-width, topOffset);\n            g.translate(lineOffsets[lineNum], 0);\n            nextBoundary.left = lineOffsets[lineNum] * scale;\n          }\n          else if (options.textAlign === 'center') {\n            // offset to the start of text in previous line AND half of its offset\n            // (essentially moving caret to the left edge of bounding box)\n            g.translate(-left - (lineOffsets[lineNum - 1] / 2), topOffset);\n            g.translate(lineOffsets[lineNum] / 2, 0);\n            nextBoundary.left = lineOffsets[lineNum] / 2 * scale;\n          }\n          else {\n            g.translate(-left, topOffset);\n          }\n\n          /* push next boundary (for the next line) */\n          boundaries.push(nextBoundary);\n\n          left = 0;\n\n          continue;\n        }\n        var glyph = font.glyphs[chars[i]] || font.missingGlyph;\n        if (!glyph) continue;\n\n        var charWidth = Number(glyph.w || font.w) + letterSpacing;\n\n        // only draw background when there's some kind of value\n        if (options.backgroundColor) {\n          g.save();\n          g.translate(0, font.ascent);\n          g.fillRect(0, 0, charWidth + 10, -font.ascent + font.descent);\n          g.restore();\n        }\n\n        g.translate(charWidth, 0);\n        left += charWidth;\n\n        if (i == l-1) {\n          boundaries[boundaries.length - 1].width = left * scale;\n          boundaries[boundaries.length - 1].height = (-font.ascent + font.descent) * scale;\n        }\n      }\n      g.restore();\n\n      Cufon.textOptions.boundaries = boundaries;\n    }\n\n    function renderText(color) {\n      g.fillStyle = color || Cufon.textOptions.color || style.get('color');\n\n      var left = 0, lineNum = 0;\n\n      if (options.textAlign === 'right') {\n        g.translate(lineOffsets[lineNum], 0);\n      }\n      else if (options.textAlign === 'center') {\n        g.translate(lineOffsets[lineNum] / 2, 0);\n      }\n\n      for (var i = 0, l = chars.length; i < l; ++i) {\n        if (chars[i] === '\\n') {\n\n          lineNum++;\n\n          var topOffset = -font.ascent - ((font.ascent / 5) * options.lineHeight);\n\n          if (options.textAlign === 'right') {\n            g.translate(-width, topOffset);\n            g.translate(lineOffsets[lineNum], 0);\n          }\n          else if (options.textAlign === 'center') {\n            // offset to the start of text in previous line AND half of its offset\n            // (essentially moving caret to the left edge of bounding box)\n            g.translate(-left - (lineOffsets[lineNum - 1] / 2), topOffset);\n            g.translate(lineOffsets[lineNum] / 2, 0);\n          }\n          else {\n            g.translate(-left, topOffset);\n          }\n\n          left = 0;\n\n          continue;\n        }\n        var glyph = font.glyphs[chars[i]] || font.missingGlyph;\n        if (!glyph) continue;\n\n        var charWidth = Number(glyph.w || font.w) + letterSpacing;\n\n        if (textDecoration) {\n          g.save();\n          g.strokeStyle = g.fillStyle;\n\n          // add 2x more thickness — closer to SVG rendering\n          g.lineWidth += g.lineWidth;\n\n          g.beginPath();\n          if (textDecoration.underline) {\n            g.moveTo(0, -font.face['underline-position'] + 0.5);\n            g.lineTo(charWidth, -font.face['underline-position'] + 0.5);\n          }\n          if (textDecoration.overline) {\n            g.moveTo(0, font.ascent + 0.5);\n            g.lineTo(charWidth, font.ascent + 0.5);\n          }\n          if (textDecoration['line-through']) {\n            g.moveTo(0, -font.descent + 0.5);\n            g.lineTo(charWidth, -font.descent + 0.5);\n          }\n          g.stroke();\n          g.restore();\n        }\n\n        if (isItalic) {\n          g.save();\n          g.transform(1, 0, -0.25, 1, 0, 0);\n        }\n\n        g.beginPath();\n        if (glyph.d) {\n          if (glyph.code) interpret(glyph.code, g);\n          else glyph.code = generateFromVML('m' + glyph.d, g);\n        }\n\n        g.fill();\n\n        if (options.strokeStyle) {\n          g.closePath();\n          g.save();\n          g.lineWidth = options.strokeWidth;\n          g.strokeStyle = options.strokeStyle;\n          g.stroke();\n          g.restore();\n        }\n\n        if (isItalic) {\n          g.restore();\n        }\n\n        g.translate(charWidth, 0);\n        left += charWidth;\n      }\n    }\n\n    g.save();\n    renderBackground();\n    if (shadows) {\n      for (var i = 0, l = shadows.length; i < l; ++i) {\n        var shadow = shadows[i];\n        g.save();\n        g.translate.apply(g, shadowOffsets[i]);\n        renderText(shadow.color);\n        g.restore();\n      }\n    }\n    renderText();\n    g.restore();\n    g.restore();\n    g.restore();\n\n    return wrapper;\n\n  };\n\n})());\n\nCufon.registerEngine('vml', (function() {\n\n  if (!fabric.document.namespaces) return;\n\n  var canvasEl = fabric.document.createElement('canvas');\n  if (canvasEl && canvasEl.getContext && canvasEl.getContext.apply) return;\n\n  if (fabric.document.namespaces.cvml == null) {\n    fabric.document.namespaces.add('cvml', 'urn:schemas-microsoft-com:vml');\n  }\n\n  var check = fabric.document.createElement('cvml:shape');\n  check.style.behavior = 'url(#default#VML)';\n  if (!check.coordsize) return; // VML isn't supported\n  check = null;\n\n  fabric.document.write('<style type=\"text/css\">' +\n    '.cufon-vml-canvas{text-indent:0}' +\n    '@media screen{' +\n      'cvml\\\\:shape,cvml\\\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}' +\n      '.cufon-vml-canvas{position:absolute;text-align:left}' +\n      '.cufon-vml{display:inline-block;position:relative;vertical-align:middle}' +\n      '.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}' +\n      'a .cufon-vml{cursor:pointer}' +\n    '}' +\n    '@media print{' +\n      '.cufon-vml *{display:none}' +\n      '.cufon-vml .cufon-alt{display:inline}' +\n    '}' +\n  '</style>');\n\n  function getFontSizeInPixels(el, value) {\n    return getSizeInPixels(el, /(?:em|ex|%)$/i.test(value) ? '1em' : value);\n  }\n\n  // Original by Dead Edwards.\n  // Combined with getFontSizeInPixels it also works with relative units.\n  function getSizeInPixels(el, value) {\n    if (/px$/i.test(value)) return parseFloat(value);\n    var style = el.style.left, runtimeStyle = el.runtimeStyle.left;\n    el.runtimeStyle.left = el.currentStyle.left;\n    el.style.left = value;\n    var result = el.style.pixelLeft;\n    el.style.left = style;\n    el.runtimeStyle.left = runtimeStyle;\n    return result;\n  }\n\n  return function(font, text, style, options, node, el, hasNext) {\n    var redraw = (text === null);\n\n    if (redraw) text = node.alt;\n\n    // @todo word-spacing, text-decoration\n\n    var viewBox = font.viewBox;\n\n    var size = style.computedFontSize ||\n      (style.computedFontSize = new Cufon.CSS.Size(getFontSizeInPixels(el, style.get('fontSize')) + 'px', font.baseSize));\n\n    var letterSpacing = style.computedLSpacing;\n\n    if (letterSpacing == undefined) {\n      letterSpacing = style.get('letterSpacing');\n      style.computedLSpacing = letterSpacing =\n        (letterSpacing == 'normal') ? 0 : ~~size.convertFrom(getSizeInPixels(el, letterSpacing));\n    }\n\n    var wrapper, canvas;\n\n    if (redraw) {\n      wrapper = node;\n      canvas = node.firstChild;\n    }\n    else {\n      wrapper = fabric.document.createElement('span');\n      wrapper.className = 'cufon cufon-vml';\n      wrapper.alt = text;\n\n      canvas = fabric.document.createElement('span');\n      canvas.className = 'cufon-vml-canvas';\n      wrapper.appendChild(canvas);\n\n      if (options.printable) {\n        var print = fabric.document.createElement('span');\n        print.className = 'cufon-alt';\n        print.appendChild(fabric.document.createTextNode(text));\n        wrapper.appendChild(print);\n      }\n\n      // ie6, for some reason, has trouble rendering the last VML element in the document.\n      // we can work around this by injecting a dummy element where needed.\n      // @todo find a better solution\n      if (!hasNext) wrapper.appendChild(fabric.document.createElement('cvml:shape'));\n    }\n\n    var wStyle = wrapper.style;\n    var cStyle = canvas.style;\n\n    var height = size.convert(viewBox.height), roundedHeight = Math.ceil(height);\n    var roundingFactor = roundedHeight / height;\n    var minX = viewBox.minX, minY = viewBox.minY;\n\n    cStyle.height = roundedHeight;\n    cStyle.top = Math.round(size.convert(minY - font.ascent));\n    cStyle.left = Math.round(size.convert(minX));\n\n    wStyle.height = size.convert(font.height) + 'px';\n\n    var textDecoration = Cufon.getTextDecoration(options);\n\n    var color = style.get('color');\n\n    var chars = Cufon.CSS.textTransform(text, style).split('');\n\n    var width = 0, offsetX = 0, advance = null;\n\n    var glyph, shape, shadows = options.textShadow;\n\n    // pre-calculate width\n    for (var i = 0, k = 0, l = chars.length; i < l; ++i) {\n      glyph = font.glyphs[chars[i]] || font.missingGlyph;\n      if (glyph) width += advance = ~~(glyph.w || font.w) + letterSpacing;\n    }\n\n    if (advance === null) return null;\n\n    var fullWidth = -minX + width + (viewBox.width - advance);\n\n    var shapeWidth = size.convert(fullWidth * roundingFactor), roundedShapeWidth = Math.round(shapeWidth);\n\n    var coordSize = fullWidth + ',' + viewBox.height, coordOrigin;\n    var stretch = 'r' + coordSize + 'nsnf';\n\n    for (i = 0; i < l; ++i) {\n\n      glyph = font.glyphs[chars[i]] || font.missingGlyph;\n      if (!glyph) continue;\n\n      if (redraw) {\n        // some glyphs may be missing so we can't use i\n        shape = canvas.childNodes[k];\n        if (shape.firstChild) shape.removeChild(shape.firstChild); // shadow\n      }\n      else {\n        shape = fabric.document.createElement('cvml:shape');\n        canvas.appendChild(shape);\n      }\n\n      shape.stroked = 'f';\n      shape.coordsize = coordSize;\n      shape.coordorigin = coordOrigin = (minX - offsetX) + ',' + minY;\n      shape.path = (glyph.d ? 'm' + glyph.d + 'xe' : '') + 'm' + coordOrigin + stretch;\n      shape.fillcolor = color;\n\n      // it's important to not set top/left or IE8 will grind to a halt\n      var sStyle = shape.style;\n      sStyle.width = roundedShapeWidth;\n      sStyle.height = roundedHeight;\n\n      if (shadows) {\n        // due to the limitations of the VML shadow element there\n        // can only be two visible shadows. opacity is shared\n        // for all shadows.\n        var shadow1 = shadows[0], shadow2 = shadows[1];\n        var color1 = Cufon.CSS.color(shadow1.color), color2;\n        var shadow = fabric.document.createElement('cvml:shadow');\n        shadow.on = 't';\n        shadow.color = color1.color;\n        shadow.offset = shadow1.offX + ',' + shadow1.offY;\n        if (shadow2) {\n          color2 = Cufon.CSS.color(shadow2.color);\n          shadow.type = 'double';\n          shadow.color2 = color2.color;\n          shadow.offset2 = shadow2.offX + ',' + shadow2.offY;\n        }\n        shadow.opacity = color1.opacity || (color2 && color2.opacity) || 1;\n        shape.appendChild(shadow);\n      }\n\n      offsetX += ~~(glyph.w || font.w) + letterSpacing;\n\n      ++k;\n\n    }\n\n    wStyle.width = Math.max(Math.ceil(size.convert(width * roundingFactor)), 0);\n\n    return wrapper;\n\n  };\n\n})());\n\nCufon.getTextDecoration = function(options) {\n  return {\n    underline: options.textDecoration === 'underline',\n    overline: options.textDecoration === 'overline',\n    'line-through': options.textDecoration === 'line-through'\n  };\n};\n\nif (typeof exports != 'undefined') {\n  exports.Cufon = Cufon;\n}\n\n/*\n    json2.js\n    2011-10-19\n\n    Public Domain.\n\n    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n    See http://www.JSON.org/js.html\n\n\n    This code should be minified before deployment.\n    See http://javascript.crockford.com/jsmin.html\n\n    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n    NOT CONTROL.\n\n\n    This file creates a global JSON object containing two methods: stringify\n    and parse.\n\n        JSON.stringify(value, replacer, space)\n            value       any JavaScript value, usually an object or array.\n\n            replacer    an optional parameter that determines how object\n                        values are stringified for objects. It can be a\n                        function or an array of strings.\n\n            space       an optional parameter that specifies the indentation\n                        of nested structures. If it is omitted, the text will\n                        be packed without extra whitespace. If it is a number,\n                        it will specify the number of spaces to indent at each\n                        level. If it is a string (such as '\\t' or '&nbsp;'),\n                        it contains the characters used to indent at each level.\n\n            This method produces a JSON text from a JavaScript value.\n\n            When an object value is found, if the object contains a toJSON\n            method, its toJSON method will be called and the result will be\n            stringified. A toJSON method does not serialize: it returns the\n            value represented by the name/value pair that should be serialized,\n            or undefined if nothing should be serialized. The toJSON method\n            will be passed the key associated with the value, and this will be\n            bound to the value\n\n            For example, this would serialize Dates as ISO strings.\n\n                Date.prototype.toJSON = function (key) {\n                    function f(n) {\n                        // Format integers to have at least two digits.\n                        return n < 10 ? '0' + n : n;\n                    }\n\n                    return this.getUTCFullYear()   + '-' +\n                         f(this.getUTCMonth() + 1) + '-' +\n                         f(this.getUTCDate())      + 'T' +\n                         f(this.getUTCHours())     + ':' +\n                         f(this.getUTCMinutes())   + ':' +\n                         f(this.getUTCSeconds())   + 'Z';\n                };\n\n            You can provide an optional replacer method. It will be passed the\n            key and value of each member, with this bound to the containing\n            object. The value that is returned from your method will be\n            serialized. If your method returns undefined, then the member will\n            be excluded from the serialization.\n\n            If the replacer parameter is an array of strings, then it will be\n            used to select the members to be serialized. It filters the results\n            such that only members with keys listed in the replacer array are\n            stringified.\n\n            Values that do not have JSON representations, such as undefined or\n            functions, will not be serialized. Such values in objects will be\n            dropped; in arrays they will be replaced with null. You can use\n            a replacer function to replace those with JSON values.\n            JSON.stringify(undefined) returns undefined.\n\n            The optional space parameter produces a stringification of the\n            value that is filled with line breaks and indentation to make it\n            easier to read.\n\n            If the space parameter is a non-empty string, then that string will\n            be used for indentation. If the space parameter is a number, then\n            the indentation will be that many spaces.\n\n            Example:\n\n            text = JSON.stringify(['e', {pluribus: 'unum'}]);\n            // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n\n\n            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\\t');\n            // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n\n            text = JSON.stringify([new Date()], function (key, value) {\n                return this[key] instanceof Date ?\n                    'Date(' + this[key] + ')' : value;\n            });\n            // text is '[\"Date(---current time---)\"]'\n\n\n        JSON.parse(text, reviver)\n            This method parses a JSON text to produce an object or array.\n            It can throw a SyntaxError exception.\n\n            The optional reviver parameter is a function that can filter and\n            transform the results. It receives each of the keys and values,\n            and its return value is used instead of the original value.\n            If it returns what it received, then the structure is not modified.\n            If it returns undefined then the member is deleted.\n\n            Example:\n\n            // Parse the text. Values that look like ISO date strings will\n            // be converted to Date objects.\n\n            myData = JSON.parse(text, function (key, value) {\n                var a;\n                if (typeof value === 'string') {\n                    a =\n/^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n                    if (a) {\n                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n                            +a[5], +a[6]));\n                    }\n                }\n                return value;\n            });\n\n            myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n                var d;\n                if (typeof value === 'string' &&\n                        value.slice(0, 5) === 'Date(' &&\n                        value.slice(-1) === ')') {\n                    d = new Date(value.slice(5, -1));\n                    if (d) {\n                        return d;\n                    }\n                }\n                return value;\n            });\n\n\n    This is a reference implementation. You are free to copy, modify, or\n    redistribute.\n*/\n\n/*jslint evil: true, regexp: true */\n\n/*members \"\", \"\\b\", \"\\t\", \"\\n\", \"\\f\", \"\\r\", \"\\\"\", JSON, \"\\\\\", apply,\n    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n    lastIndex, length, parse, prototype, push, replace, slice, stringify,\n    test, toJSON, toString, valueOf\n*/\n\n\n// Create a JSON object only if one does not already exist. We create the\n// methods in a closure to avoid creating global variables.\n\nvar JSON;\nif (!JSON) {\n    JSON = {};\n}\n\n(function () {\n    'use strict';\n\n    function f(n) {\n        // Format integers to have at least two digits.\n        return n < 10 ? '0' + n : n;\n    }\n\n    if (typeof Date.prototype.toJSON !== 'function') {\n\n        Date.prototype.toJSON = function (key) {\n\n            return isFinite(this.valueOf())\n                ? this.getUTCFullYear()     + '-' +\n                    f(this.getUTCMonth() + 1) + '-' +\n                    f(this.getUTCDate())      + 'T' +\n                    f(this.getUTCHours())     + ':' +\n                    f(this.getUTCMinutes())   + ':' +\n                    f(this.getUTCSeconds())   + 'Z'\n                : null;\n        };\n\n        String.prototype.toJSON      =\n            Number.prototype.toJSON  =\n            Boolean.prototype.toJSON = function (key) {\n                return this.valueOf();\n            };\n    }\n\n    var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        gap,\n        indent,\n        meta = {    // table of character substitutions\n            '\\b': '\\\\b',\n            '\\t': '\\\\t',\n            '\\n': '\\\\n',\n            '\\f': '\\\\f',\n            '\\r': '\\\\r',\n            '\"' : '\\\\\"',\n            '\\\\': '\\\\\\\\'\n        },\n        rep;\n\n\n    function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n        escapable.lastIndex = 0;\n        return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n            var c = meta[a];\n            return typeof c === 'string'\n                ? c\n                : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n        }) + '\"' : '\"' + string + '\"';\n    }\n\n\n    function str(key, holder) {\n\n// Produce a string from holder[key].\n\n        var i,          // The loop counter.\n            k,          // The member key.\n            v,          // The member value.\n            length,\n            mind = gap,\n            partial,\n            value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n        if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n            value = value.toJSON(key);\n        }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n        if (typeof rep === 'function') {\n            value = rep.call(holder, key, value);\n        }\n\n// What happens next depends on the value's type.\n\n        switch (typeof value) {\n        case 'string':\n            return quote(value);\n\n        case 'number':\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n            return isFinite(value) ? String(value) : 'null';\n\n        case 'boolean':\n        case 'null':\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce 'null'. The case is included here in\n// the remote chance that this gets fixed someday.\n\n            return String(value);\n\n// If the type is 'object', we might be dealing with an object or an array or\n// null.\n\n        case 'object':\n\n// Due to a specification blunder in ECMAScript, typeof null is 'object',\n// so watch out for that case.\n\n            if (!value) {\n                return 'null';\n            }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n            gap += indent;\n            partial = [];\n\n// Is the value an array?\n\n            if (Object.prototype.toString.apply(value) === '[object Array]') {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                length = value.length;\n                for (i = 0; i < length; i += 1) {\n                    partial[i] = str(i, value) || 'null';\n                }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                v = partial.length === 0\n                    ? '[]'\n                    : gap\n                    ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                    : '[' + partial.join(',') + ']';\n                gap = mind;\n                return v;\n            }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n            if (rep && typeof rep === 'object') {\n                length = rep.length;\n                for (i = 0; i < length; i += 1) {\n                    if (typeof rep[i] === 'string') {\n                        k = rep[i];\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                        }\n                    }\n                }\n            } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                for (k in value) {\n                    if (Object.prototype.hasOwnProperty.call(value, k)) {\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                        }\n                    }\n                }\n            }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n            v = partial.length === 0\n                ? '{}'\n                : gap\n                ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                : '{' + partial.join(',') + '}';\n            gap = mind;\n            return v;\n        }\n    }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n    if (typeof JSON.stringify !== 'function') {\n        JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n            var i;\n            gap = '';\n            indent = '';\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n            if (typeof space === 'number') {\n                for (i = 0; i < space; i += 1) {\n                    indent += ' ';\n                }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n            } else if (typeof space === 'string') {\n                indent = space;\n            }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n            rep = replacer;\n            if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                    typeof replacer.length !== 'number')) {\n                throw new Error('JSON.stringify');\n            }\n\n// Make a fake root object containing our value under the key of ''.\n// Return the result of stringifying the value.\n\n            return str('', {'': value});\n        };\n    }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n    if (typeof JSON.parse !== 'function') {\n        JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n            var j;\n\n            function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                var k, v, value = holder[key];\n                if (value && typeof value === 'object') {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n            text = String(text);\n            cx.lastIndex = 0;\n            if (cx.test(text)) {\n                text = text.replace(cx, function (a) {\n                    return '\\\\u' +\n                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with '()' and 'new'\n// because they can cause invocation, and '=' because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n// replace all simple value tokens with ']' characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or ']' or\n// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n            if (/^[\\],:{}\\s]*$/\n                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                        .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                        .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                j = eval('(' + text + ')');\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                return typeof reviver === 'function'\n                    ? walk({'': j}, '')\n                    : j;\n            }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n            throw new SyntaxError('JSON.parse');\n        };\n    }\n}());\n/**\n * Wrapper around `console.log` (when available)\n * @method log\n * @param {Any} Values to log\n */\nfabric.log = function() { };\n\n/**\n * Wrapper around `console.warn` (when available)\n * @method warn\n * @param {Any} Values to log as a warning\n */\nfabric.warn = function() { };\n\nif (typeof console !== 'undefined') {\n  if (typeof console.log !== 'undefined' && console.log.apply) {\n    fabric.log = function() { \n      return console.log.apply(console, arguments);\n    };\n  }\n  if (typeof console.warn !== 'undefined' && console.warn.apply) {\n    fabric.warn = function() { \n      return console.warn.apply(console, arguments);\n    };\n  }\n}\n\n/**\n * @namespace\n */\nfabric.Observable = {\n\n  /**\n   * Observes specified event\n   * @method observe\n   * @depracated Since 0.8.34. Use `on` instead.\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  observe: function(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [ ];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n  },\n\n  /**\n   * Stops event observing for a particular event handler\n   * @method stopObserving\n   * @depracated Since 0.8.34. Use `off` instead.\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  stopObserving: function(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    if (this.__eventListeners[eventName]) {\n      fabric.util.removeFromArray(this.__eventListeners[eventName], handler);\n    }\n  },\n\n  /**\n   * Fires event with an optional options object\n   * @method fire\n   * @param {String} eventName\n   * @param {Object} [options]\n   */\n  fire: function(eventName, options) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { }\n    }\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) return;\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      // avoiding try/catch for perf. reasons\n      listenersForEvent[i](options || { });\n    }\n  }\n};\n\n/**\n * Alias for observe\n * @method observe\n * @memberOf fabric.Observable\n */\nfabric.Observable.on = fabric.Observable.observe;\n\n/**\n * Alias for stopObserving\n * @method off\n */\nfabric.Observable.off = fabric.Observable.stopObserving;\n(function() {\n\n  /**\n   * @namespace\n   */\n  fabric.util = { };\n\n  /**\n   * Removes value from an array.\n   * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n   * @static\n   * @memberOf fabric.util\n   * @method removeFromArray\n   * @param {Array} array\n   * @param {Any} value\n   * @return {Array} original array\n   */\n  function removeFromArray(array, value) {\n    var idx = array.indexOf(value);\n    if (idx !== -1) {\n      array.splice(idx, 1);\n    }\n    return array;\n  };\n\n  /**\n   * Returns random number between 2 specified ones.\n   * @static\n   * @method getRandomInt\n   * @memberOf fabric.util\n   * @param {Number} min lower limit\n   * @param {Number} max upper limit\n   * @return {Number} random value (between min and max)\n   */\n  function getRandomInt(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  }\n\n  var PiBy180 = Math.PI / 180;\n\n  /**\n   * Transforms degrees to radians.\n   * @static\n   * @method degreesToRadians\n   * @memberOf fabric.util\n   * @param {Number} degrees value in degrees\n   * @return {Number} value in radians\n   */\n  function degreesToRadians(degrees) {\n    return degrees * PiBy180;\n  }\n\n  /**\n   * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n   * @static\n   * @method toFixed\n   * @memberOf fabric.util\n   * @param {Number | String} number number to operate on\n   * @param {Number} fractionDigits number of fraction digits to \"leave\"\n   * @return {Number}\n   */\n   function toFixed(number, fractionDigits) {\n     return parseFloat(Number(number).toFixed(fractionDigits));\n   }\n\n   /**\n    * Function which always returns `false`.\n    * @static\n    * @method falseFunction\n    * @memberOf fabric.util\n    * @return {Boolean}\n    */\n   function falseFunction() {\n     return false;\n   }\n\n   /**\n    * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n    * @method animate\n    * @memberOf fabric.util\n    * @param {Object} [options] Animation options\n    * @param {Function} [options.onChange] Callback; invoked on every value change\n    * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n    * @param {Number} [options.startValue=0] Starting value\n    * @param {Number} [options.endValue=100] Ending value\n    * @param {Number} [options.byValue=100] Value to modify the property by\n    * @param {Function} [options.easing] Easing function\n    * @param {Number} [options.duration=500] Duration of change\n    */\n  function animate(options) {\n\n    options || (options = { });\n\n    var start = +new Date(),\n      duration = options.duration || 500,\n      finish = start + duration, time, pos,\n      onChange = options.onChange || function() { },\n      abort = options.abort || function() { return false; },\n      easing = options.easing || function(t, b, c, d) {return -c * Math.cos(t/d * (Math.PI/2)) + c + b;},\n      startValue = 'startValue' in options ? options.startValue : 0,\n      endValue = 'endValue' in options ? options.endValue : 100;\n      byValue = options.byValue || endValue - startValue;\n\n    options.onStart && options.onStart();\n\n    (function tick() {\n      time = +new Date();\n      currentTime = time > finish ? duration : (time - start);\n      onChange(easing(currentTime, startValue, byValue, duration));\n      if (time > finish || abort()) {\n        options.onComplete && options.onComplete();\n        return;\n      }\n      requestAnimFrame(tick);\n    })();\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback, element) {\n                            fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n  /**\n    * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n    * @method requestAnimFrame\n    * @memberOf fabric.util\n    * @param {Function} callback Callback to invoke\n    * @param {DOMElement} element optional Element to associate with animation\n    */\n  var requestAnimFrame = function() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  };\n\n  /**\n    * Loads image element from given url and passes it to a callback\n    * @method loadImage\n    * @memberOf fabric.util\n    * @param {String} url URL representing an image\n    * @param {Function} callback Callback; invoked with loaded image\n    * @param {Any} context optional Context to invoke callback in\n    */\n  function loadImage(url, callback, context) {\n    if (url) {\n      var img = new Image();\n      /** @ignore */\n      img.onload = function () {\n        callback && callback.call(context, img);\n        img = img.onload = null;\n      };\n      img.src = url;\n    }\n    else {\n      callback && callback.call(context, url);\n    }\n  }\n\n  function enlivenObjects(objects, callback) {\n\n    function getKlass(type) {\n      return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(type))];\n    }\n\n    function onLoaded() {\n      if (++numLoadedObjects === numTotalObjects) {\n        if (callback) {\n          callback(enlivenedObjects);\n        }\n      }\n    }\n\n    var enlivenedObjects = [ ],\n        numLoadedObjects = 0,\n        numTotalObjects = objects.length;\n\n    objects.forEach(function (o, index) {\n      if (!o.type) {\n        return;\n      }\n      var klass = getKlass(o.type);\n      if (klass.async) {\n        klass.fromObject(o, function (o) {\n          enlivenedObjects[index] = o;\n          onLoaded();\n        });\n      }\n      else {\n        enlivenedObjects[index] = klass.fromObject(o);\n        onLoaded();\n      }\n    });\n  }\n\n  function groupSVGElements(elements, options, path) {\n    var object = elements.length > 1\n      ? new fabric.PathGroup(elements, options)\n      : elements[0];\n\n    if (typeof path !== 'undefined') {\n      object.setSourcePath(path);\n    }\n    return object;\n  }\n\n  fabric.util.removeFromArray = removeFromArray;\n  fabric.util.degreesToRadians = degreesToRadians;\n  fabric.util.toFixed = toFixed;\n  fabric.util.getRandomInt = getRandomInt;\n  fabric.util.falseFunction = falseFunction;\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.loadImage = loadImage;\n  fabric.util.enlivenObjects = enlivenObjects;\n  fabric.util.groupSVGElements = groupSVGElements;\n})();\n(function() {\n  \n  var slice = Array.prototype.slice;\n  \n  if (!Array.prototype.indexOf) {\n    Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\n      if (this === void 0 || this === null) {\n        throw new TypeError();\n      }\n      var t = Object(this), len = t.length >>> 0;\n      if (len === 0) {\n        return -1;\n      }\n      var n = 0;\n      if (arguments.length > 0) {\n        n = Number(arguments[1]);\n        if (n !== n) { // shortcut for verifying if it's NaN\n          n = 0;\n        }\n        else if (n !== 0 && n !== (1 / 0) && n !== -(1 / 0)) {\n          n = (n > 0 || -1) * Math.floor(Math.abs(n));\n        }\n      }\n      if (n >= len) {\n        return -1;\n      }\n      var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\n      for (; k < len; k++) {\n        if (k in t && t[k] === searchElement) {\n          return k;\n        }\n      }\n      return -1;\n    }\n  }\n\n  if (!Array.prototype.forEach) {\n    Array.prototype.forEach = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          fn.call(context, this[i], i, this);\n        }  \n      }\n    };\n  }\n\n  if (!Array.prototype.map) {\n    Array.prototype.map = function(fn, context) {\n      var result = [ ];\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          result[i] = fn.call(context, this[i], i, this);\n        }\n      }\n      return result;\n    };\n  }\n\n  if (!Array.prototype.every) {\n    Array.prototype.every = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this && !fn.call(context, this[i], i, this)) {\n          return false;\n        }\n      }\n      return true;\n    };\n  }\n\n  if (!Array.prototype.some) {\n    Array.prototype.some = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this && fn.call(context, this[i], i, this)) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }\n\n  if (!Array.prototype.filter) {\n    Array.prototype.filter = function(fn, context) {\n      var result = [ ], val;\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          val = this[i]; // in case fn mutates this\n          if (fn.call(context, val, i, this)) {\n            result.push(val);\n          }\n        }\n      }\n      return result;\n    };\n  }\n\n  if (!Array.prototype.reduce) {\n    Array.prototype.reduce = function(fn /*, initial*/) {\n      var len = this.length >>> 0,\n          i = 0,\n          rv;\n\n      if (arguments.length > 1) {\n        rv = arguments[1];\n      }\n      else {\n        do {\n          if (i in this) {\n            rv = this[i++];\n            break;\n          }\n          // if array contains no values, no initial value to return\n          if (++i >= len) {\n            throw new TypeError();\n          }\n        }\n        while (true);\n      }\n      for (; i < len; i++) {\n        if (i in this) {\n          rv = fn.call(null, rv, this[i], i, this);\n        }\n      }\n      return rv;\n    };\n  }\n\n  /**\n   * Invokes method on all items in a given array\n   * @method invoke\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [ ];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @method max\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   */\n  function max(array, byProperty) {\n    if (!array || array.length === 0) return undefined;\n    \n    var i = array.length - 1, \n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (array[i][byProperty] >= result) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (array[i] >= result) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @method min\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   */\n  function min(array, byProperty) {\n    if (!array || array.length === 0) return undefined;\n    \n    var i = array.length - 1, \n        result = byProperty ? array[i][byProperty] : array[i];\n\n    if (byProperty) {\n      while (i--) {\n        if (array[i][byProperty] < result) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (array[i] < result) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /** @namespace */\n  fabric.util.array = {\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n  \n})();\n(function(){\n  \n  /**\n   * Copies all enumerable properties of one object to another\n   * @memberOf fabric.util.object\n   * @method extend\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   */\n  function extend(destination, source) {\n    // JScript DontEnum bug is not taken care of\n    for (var property in source) {\n      destination[property] = source[property];\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @method clone\n   * @memberOf fabric.util.object\n   * @param {Object} object Object to clone\n   */\n  function clone(object) {\n    return extend({ }, object);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n  \n})();\n(function() {\n\nif (!String.prototype.trim) {\n  /**\n   * Trims a string (removing whitespace from the beginning and the end)\n   * @method trim\n   * @see <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/Trim\">String#trim on MDN</a>\n   */\n  String.prototype.trim = function () {\n    // this trim is not fully ES3 or ES5 compliant, but it should cover most cases for now\n    return this.replace(/^[\\s\\xA0]+/, '').replace(/[\\s\\xA0]+$/, '');\n  };\n}\n\n/**\n * Camelizes a string\n * @memberOf fabric.util.string\n * @method camelize\n * @param {String} string String to camelize\n * @return {String} Camelized version of a string\n */\nfunction camelize(string) {\n  return string.replace(/-+(.)?/g, function(match, character) {\n    return character ? character.toUpperCase() : '';\n  });\n}\n\n/**\n * Capitalizes a string\n * @memberOf fabric.util.string\n * @method capitalize\n * @param {String} string String to capitalize\n * @return {String} Capitalized version of a string\n */\nfunction capitalize(string) {\n  return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n}\n\nfunction escapeXml(string) {\n  return string.replace(/&/g, '&amp;')\n     .replace(/\"/g, '&quot;')\n     .replace(/'/g, '&apos;')\n     .replace(/</g, '&lt;')\n     .replace(/>/g, '&gt;');\n}\n\n/** @namespace */\nfabric.util.string = {\n  camelize: camelize,\n  capitalize: capitalize,\n  escapeXml: escapeXml\n};\n}());\n\n(function() {\n  \n  var slice = Array.prototype.slice,\n      apply = Function.prototype.apply,\n      dummy = function() { };\n  \n  if (!Function.prototype.bind) {\n    /**\n     * Cross-browser approximation of ES5 Function.prototype.bind (not fully spec conforming)\n     * @see <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind\">Function#bind on MDN</a>\n     * @param {Object} thisArg Object to bind function to\n     * @param {Any[]} [...] Values to pass to a bound function\n     * @return {Function}\n     */\n     Function.prototype.bind = function(thisArg) {\n       var fn = this, args = slice.call(arguments, 1), bound;\n       if (args.length) {\n         bound = function() { \n           return apply.call(fn, this instanceof dummy ? this : thisArg, args.concat(slice.call(arguments))); \n         };\n       }\n       else {\n         bound = function() { \n           return apply.call(fn, this instanceof dummy ? this : thisArg, arguments);\n         };\n       }\n       dummy.prototype = this.prototype;\n       bound.prototype = new dummy;\n       \n       return bound;\n     };\n  }\n  \n})();\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { };\n\n  var IS_DONTENUM_BUGGY = (function(){\n    for (var p in { toString: 1 }) {\n      if (p === 'toString') return false;\n    }\n    return true;\n  })();\n\n  /** @ignore */\n  var addMethods = function(klass, source, parent) {\n    for (var property in source) {\n\n      if (property in klass.prototype && typeof klass.prototype[property] == 'function') {\n\n        klass.prototype[property] = (function(property) {\n          return function() {\n\n            var superclass = this.constructor.superclass;\n            this.constructor.superclass = parent;\n            var returnValue = source[property].apply(this, arguments);\n            this.constructor.superclass = superclass;\n\n            if (property !== 'initialize') {\n              return returnValue;\n            }\n          }\n        })(property);\n      }\n      else {\n        klass.prototype[property] = source[property];\n      }\n\n      if (IS_DONTENUM_BUGGY) {\n        if (source.toString !== Object.prototype.toString) {\n          klass.prototype.toString = source.toString;\n        }\n        if (source.valueOf !== Object.prototype.valueOf) {\n          klass.prototype.valueOf = source.valueOf;\n        }\n      }\n    }\n  };\n\n  function subclass() { };\n\n  /**\n   * Helper for creation of \"classes\"\n   * @method createClass\n   * @memberOf fabric.util\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [ ];\n\n    if (parent) {\n      subclass.prototype = parent.prototype;\n      klass.prototype = new subclass;\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n(function (global) {\n\n  /* EVENT HANDLING */\n\n  function areHostMethods(object) {\n    var methodNames = Array.prototype.slice.call(arguments, 1),\n        t, i, len = methodNames.length;\n    for (i = 0; i < len; i++) {\n      t = typeof object[methodNames[i]];\n      if (!(/^(?:function|object|unknown)$/).test(t)) return false;\n    }\n    return true;\n  }\n  var getUniqueId = (function () {\n    if (typeof fabric.document.documentElement.uniqueID !== 'undefined') {\n      return function (element) {\n        return element.uniqueID;\n      };\n    }\n    var uid = 0;\n    return function (element) {\n      return element.__uniqueID || (element.__uniqueID = 'uniqueID__' + uid++);\n    };\n  })();\n\n  /** @ignore */\n  var getElement, setElement;\n\n  (function () {\n    var elements = { };\n    /** @ignore */\n    getElement = function (uid) {\n      return elements[uid];\n    };\n    /** @ignore */\n    setElement = function (uid, element) {\n      elements[uid] = element;\n    };\n  })();\n\n  function createListener(uid, handler) {\n    return {\n      handler: handler,\n      wrappedHandler: createWrappedHandler(uid, handler)\n    };\n  }\n\n  function createWrappedHandler(uid, handler) {\n    return function (e) {\n      handler.call(getElement(uid), e || fabric.window.event);\n    };\n  }\n\n  function createDispatcher(uid, eventName) {\n    return function (e) {\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          handlersForEvent[i].call(this, e || fabric.window.event);\n        }\n      }\n    };\n  }\n\n  var shouldUseAddListenerRemoveListener = (\n        areHostMethods(fabric.document.documentElement, 'addEventListener', 'removeEventListener') &&\n        areHostMethods(fabric.window, 'addEventListener', 'removeEventListener')),\n\n      shouldUseAttachEventDetachEvent = (\n        areHostMethods(fabric.document.documentElement, 'attachEvent', 'detachEvent') &&\n        areHostMethods(fabric.window, 'attachEvent', 'detachEvent')),\n\n      // IE branch\n      listeners = { },\n\n      // DOM L0 branch\n      handlers = { },\n\n      addListener, removeListener;\n\n  if (shouldUseAddListenerRemoveListener) {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      element.addEventListener(eventName, handler, false);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      element.removeEventListener(eventName, handler, false);\n    };\n  }\n\n  else if (shouldUseAttachEventDetachEvent) {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element);\n      setElement(uid, element);\n      if (!listeners[uid]) {\n        listeners[uid] = { };\n      }\n      if (!listeners[uid][eventName]) {\n        listeners[uid][eventName] = [ ];\n\n      }\n      var listener = createListener(uid, handler);\n      listeners[uid][eventName].push(listener);\n      element.attachEvent('on' + eventName, listener.wrappedHandler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element), listener;\n      if (listeners[uid] && listeners[uid][eventName]) {\n        for (var i = 0, len = listeners[uid][eventName].length; i < len; i++) {\n          listener = listeners[uid][eventName][i];\n          if (listener && listener.handler === handler) {\n            element.detachEvent('on' + eventName, listener.wrappedHandler);\n            listeners[uid][eventName][i] = null;\n          }\n        }\n      }\n    };\n  }\n  else {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element);\n      if (!handlers[uid]) {\n        handlers[uid] = { };\n      }\n      if (!handlers[uid][eventName]) {\n        handlers[uid][eventName] = [ ];\n        var existingHandler = element['on' + eventName];\n        if (existingHandler) {\n          handlers[uid][eventName].push(existingHandler);\n        }\n        element['on' + eventName] = createDispatcher(uid, eventName);\n      }\n      handlers[uid][eventName].push(handler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element);\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          if (handlersForEvent[i] === handler) {\n            handlersForEvent.splice(i, 1);\n          }\n        }\n      }\n    };\n  }\n\n  /**\n   * Adds an event listener to an element\n   * @mthod addListener\n   * @memberOf fabric.util\n   * @function\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = addListener;\n\n  /**\n   * Removes an event listener from an element\n   * @mthod removeListener\n   * @memberOf fabric.util\n   * @function\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = removeListener;\n\n  /**\n   * Cross-browser wrapper for getting event's coordinates\n   * @method getPointer\n   * @memberOf fabric.util\n   * @param {Event} event\n   */\n  function getPointer(event) {\n    // TODO (kangax): this method needs fixing\n    return { x: pointerX(event), y: pointerY(event) };\n  }\n\n  function pointerX(event) {\n    var docElement = fabric.document.documentElement,\n        body = fabric.document.body || { scrollLeft: 0 };\n\n    // looks like in IE (<9) clientX at certain point (apparently when mouseup fires on VML element)\n    // is represented as COM object, with all the consequences, like \"unknown\" type and error on [[Get]]\n    // need to investigate later\n    return event.pageX || ((typeof event.clientX != 'unknown' ? event.clientX : 0) +\n      (docElement.scrollLeft || body.scrollLeft) -\n      (docElement.clientLeft || 0));\n  }\n\n  function pointerY(event) {\n    var docElement = fabric.document.documentElement,\n        body = fabric.document.body || { scrollTop: 0 };\n\n    return  event.pageY || ((typeof event.clientY != 'unknown' ? event.clientY : 0) +\n       (docElement.scrollTop || body.scrollTop) -\n       (docElement.clientTop || 0));\n  }\n\n  if (fabric.isTouchSupported) {\n    pointerX = function(event) {\n      return event.touches && event.touches[0] && event.touches[0].pageX || event.clientX;\n    };\n    pointerY = function(event) {\n      return event.touches && event.touches[0] && event.touches[0].pageY || event.clientY;\n    };\n  }\n\n  fabric.util.getPointer = getPointer;\n\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n\n})(this);\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @method setStyle\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style, match;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      view = fabric.document.defaultView,\n      supportsGCS = view && typeof view.getComputedStyle !== 'undefined',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n(function() {\n  \n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @method getById\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  /**\n   * Converts an array-like object (e.g. arguments or NodeList) to an array\n   * @method toArray\n   * @memberOf fabric.util\n   * @param {Object} arrayLike\n   * @return {Array}\n   */\n  function toArray(arrayLike) {\n    return _slice.call(arrayLike, 0);\n  }\n\n  try {\n    var sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch(err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @method makeElement\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @method addClass\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if ((' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }  \n  }\n\n  /**\n   * Wraps element with another element\n   * @method wrapElement\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns offset for a given element\n   * @method getElementOffset\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    // TODO (kangax): need to fix this method\n    var valueT = 0, valueL = 0;\n    do {\n      valueT += element.offsetTop  || 0;\n      valueL += element.offsetLeft || 0;\n      element = element.offsetParent;\n    } \n    while (element);\n    return ({ left: valueL, top: valueT });\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style;\n\n    var selectProp = 'userSelect' in style\n      ? 'userSelect'\n      : 'MozUserSelect' in style \n        ? 'MozUserSelect' \n        : 'WebkitUserSelect' in style \n          ? 'WebkitUserSelect' \n          : 'KhtmlUserSelect' in style \n            ? 'KhtmlUserSelect' \n            : '';\n\n    /**\n     * Makes element unselectable\n     * @method makeElementUnselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable == 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @method makeElementSelectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable == 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  (function() {\n\n    /**\n     * Inserts a script element with a given url into a document; invokes callback, when that script is finished loading\n     * @method getScript\n     * @memberOf fabric.util\n     * @param {String} url URL of a script to load\n     * @param {Function} callback Callback to execute when script is finished loading\n     */\n    function getScript(url, callback) {\n    \tvar headEl = fabric.document.getElementsByTagName(\"head\")[0],\n    \t    scriptEl = fabric.document.createElement('script'), \n    \t    loading = true;\n\n    \tscriptEl.type = 'text/javascript';\n    \tscriptEl.setAttribute('runat', 'server');\n\n    \t/** @ignore */\n    \tscriptEl.onload = /** @ignore */ scriptEl.onreadystatechange = function(e) {\n    \t  if (loading) {\n    \t    if (typeof this.readyState == 'string' && \n    \t        this.readyState !== 'loaded' && \n    \t        this.readyState !== 'complete') return;\n      \t  loading = false;\n      \t\tcallback(e || fabric.window.event);\n      \t\tscriptEl = scriptEl.onload = scriptEl.onreadystatechange = null;\n      \t}\n    \t};\n    \tscriptEl.src = url;\n    \theadEl.appendChild(scriptEl);\n    \t// causes issue in Opera\n    \t// headEl.removeChild(scriptEl);\n    }\n\n    fabric.util.getScript = getScript;\n  })();\n\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.makeElement = makeElement;\n  fabric.util.addClass = addClass;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getElementOffset = getElementOffset;\n  \n})();\n(function(){\n  \n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n  \n  var makeXHR = (function() {\n    var factories = [\n      function() { return new ActiveXObject(\"Microsoft.XMLHTTP\"); },\n      function() { return new ActiveXObject(\"Msxml2.XMLHTTP\"); },\n      function() { return new ActiveXObject(\"Msxml2.XMLHTTP.3.0\"); },\n      function() { return new XMLHttpRequest(); }\n    ];\n    for (var i = factories.length; i--; ) {\n      try {\n        var req = factories[i]();\n        if (req) {\n          return factories[i];\n        }\n      }\n      catch (err) { }\n    }\n  })();\n\n  function emptyFn() { };\n  \n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @method request\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        request = makeXHR(),\n        body;\n        \n    /** @ignore */\n    request.onreadystatechange = function() {\n      if (request.readyState === 4) {\n        onComplete(request);\n        request.onreadystatechange = emptyFn;\n      }\n    };\n    \n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters == 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    request.open(method, url, true);\n    \n    if (method === 'POST' || method === 'PUT') {\n      request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    request.send(body);\n    return request;\n  };\n  \n  fabric.util.request = request;\n})();\n(function() {\n\n  /**\n   * @method easeInQuad\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuad(t, b, c, d) {\n      return c*(t/=d)*t + b;\n  }\n\n  /**\n   * @method easeOutQuad\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuad(t, b, c, d) {\n    return -c *(t/=d)*(t-2) + b;\n  }\n\n  /**\n   * @method easeInOutQuad\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuad(t, b, c, d) {\n    if ((t/=d/2) < 1) return c/2*t*t + b;\n    return -c/2 * ((--t)*(t-2) - 1) + b;\n  }\n\n  /**\n   * @method easeInCubic\n   * @memberOf fabric.util.ease\n   */\n  function easeInCubic(t, b, c, d) {\n    return c*(t/=d)*t*t + b;\n  }\n\n  /**\n   * @method easeOutCubic\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c*((t=t/d-1)*t*t + 1) + b;\n  }\n\n  /**\n   * @method easeInOutCubic\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    if ((t/=d/2) < 1) return c/2*t*t*t + b;\n    return c/2*((t-=2)*t*t + 2) + b;\n  }\n\n  /**\n   * @method easeInQuart\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c*(t/=d)*t*t*t + b;\n  }\n\n  /**\n   * @method easeOutQuart\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t=t/d-1)*t*t*t - 1) + b;\n  }\n\n  /**\n   * @method easeInOutQuart\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    if ((t/=d/2) < 1) return c/2*t*t*t*t + b;\n    return -c/2 * ((t-=2)*t*t*t - 2) + b;\n  }\n\n  /**\n   * @method easeInQuint\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c*(t/=d)*t*t*t*t + b;\n  }\n\n  /**\n   * @method easeOutQuint\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c*((t=t/d-1)*t*t*t*t + 1) + b;\n  }\n\n  /**\n   * @method easeInOutQuint\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;\n    return c/2*((t-=2)*t*t*t*t + 2) + b;\n  }\n\n  /**\n   * @method easeInSine\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t/d * (Math.PI/2)) + c + b;\n  }\n\n  /**\n   * @method easeOutSine\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t/d * (Math.PI/2)) + b;\n  }\n\n  /**\n   * @method easeInOutSine\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;\n  }\n\n  /**\n   * @method easeInExpo\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;\n  }\n\n  /**\n   * @method easeOutExpo\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;\n  }\n\n  /**\n   * @method easeInOutExpo\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t==0) return b;\n    if (t==d) return b+c;\n    if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;\n    return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * @method easeInCirc\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;\n  }\n\n  /**\n   * @method easeOutCirc\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t=t/d-1)*t) + b;\n  }\n\n  /**\n   * @method easeInOutCirc\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;\n    return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;\n  }\n\n  /**\n   * @method easeInElastic\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s=1.70158;var p=0;var a=c;\n    if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;\n    if (a < Math.abs(c)) { a=c; var s=p/4; }\n    else var s = p/(2*Math.PI) * Math.asin (c/a);\n    return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;\n  }\n\n  /**\n   * @method easeOutElastic\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s=1.70158;var p=0;var a=c;\n    if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;\n    if (a < Math.abs(c)) { a=c; var s=p/4; }\n    else var s = p/(2*Math.PI) * Math.asin (c/a);\n    return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;\n  }\n\n  /**\n   * @method easeInOutElastic\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s=1.70158;var p=0;var a=c;\n    if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);\n    if (a < Math.abs(c)) { a=c; var s=p/4; }\n    else var s = p/(2*Math.PI) * Math.asin (c/a);\n    if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;\n    return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;\n  }\n\n  /**\n   * @method easeInBack\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s == undefined) s = 1.70158;\n    return c*(t/=d)*t*((s+1)*t - s) + b;\n  }\n\n  /**\n   * @method easeOutBack\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s == undefined) s = 1.70158;\n    return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;\n  }\n\n  /**\n   * @method easeInOutBack\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s == undefined) s = 1.70158;\n    if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;\n    return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;\n  }\n\n  /**\n   * @method easeInBounce\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d-t, 0, c, d) + b;\n  }\n\n  /**\n   * @method easeOutBounce\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t/=d) < (1/2.75)) {\n      return c*(7.5625*t*t) + b;\n    } else if (t < (2/2.75)) {\n      return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;\n    } else if (t < (2.5/2.75)) {\n      return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;\n    } else {\n      return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;\n    }\n  }\n\n  /**\n   * @method easeInOutBounce\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d/2) return easeInBounce (t*2, 0, c, d) * .5 + b;\n    return easeOutBounce (t*2-d, 0, c, d) * .5 + c*.5 + b;\n  }\n\n  /** @namespace fabric.util.ease */\n  fabric.util.ease = {\n    easeInQuad: easeInQuad,\n    easeOutQuad: easeOutQuad,\n    easeInOutQuad: easeInOutQuad,\n    easeInCubic: easeInCubic,\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n}());\n(function(global) {\n\n  \"use strict\";\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      capitalize = fabric.util.string.capitalize,\n      clone = fabric.util.object.clone;\n\n  var attributesMap = {\n    'cx':               'left',\n    'x':                'left',\n    'cy':               'top',\n    'y':                'top',\n    'r':                'radius',\n    'fill-opacity':     'opacity',\n    'fill-rule':        'fillRule',\n    'stroke-width':     'strokeWidth',\n    'transform':        'transformMatrix',\n    'text-decoration':  'textDecoration',\n    'font-size':        'fontSize',\n    'font-weight':      'fontWeight',\n    'font-style':       'fontStyle',\n    'font-family':      'fontFamily'\n  };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  /**\n   * Returns an object of attributes' name/value, given element and an array of attribute names;\n   * Parses parent \"g\" nodes recursively upwards.\n   * @static\n   * @memberOf fabric\n   * @method parseAttributes\n   * @param {DOMElement} element Element to parse\n   * @param {Array} attributes Array of attributes to parse\n   * @return {Object} object containing parsed attributes' names/values\n   */\n  function parseAttributes(element, attributes) {\n\n    if (!element) {\n      return;\n    }\n\n    var value,\n        parsed,\n        parentAttributes = { };\n\n    // if there's a parent container (`g` node), parse its attributes recursively upwards\n    if (element.parentNode && /^g$/i.test(element.parentNode.nodeName)) {\n      parentAttributes = fabric.parseAttributes(element.parentNode, attributes);\n    }\n\n    var ownAttributes = attributes.reduce(function(memo, attr) {\n      value = element.getAttribute(attr);\n      parsed = parseFloat(value);\n      if (value) {\n        // \"normalize\" attribute values\n        if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n          value = '';\n        }\n        if (attr === 'fill-rule') {\n          value = (value === 'evenodd') ? 'destination-over' : value;\n        }\n        if (attr === 'transform') {\n          value = fabric.parseTransformAttribute(value);\n        }\n        attr = normalizeAttr(attr);\n        memo[attr] = isNaN(parsed) ? value : parsed;\n      }\n      return memo;\n    }, { });\n\n    // add values parsed from style, which take precedence over attributes\n    // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n\n    ownAttributes = extend(ownAttributes, extend(getGlobalStylesForElement(element), fabric.parseStyleAttribute(element)));\n    return extend(parentAttributes, ownAttributes);\n  };\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @method parseTransformAttribute\n   * @param attributeValue {String} string containing attribute value\n   * @return {Array} array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var angle = args[0];\n\n      matrix[0] = Math.cos(angle);\n      matrix[1] = Math.sin(angle);\n      matrix[2] = -Math.sin(angle);\n      matrix[3] = Math.cos(angle);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewXMatrix(matrix, args) {\n      matrix[2] = args[0];\n    }\n\n    function skewYMatrix(matrix, args) {\n      matrix[1] = args[0];\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = [\n          1, // a\n          0, // b\n          0, // c\n          1, // d\n          0, // e\n          0  // f\n        ],\n\n        // == begin transform regexp\n        number = '(?:[-+]?\\\\d+(?:\\\\.\\\\d+)?(?:e[-+]?\\\\d+)?)',\n        comma_wsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)',\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' + comma_wsp + '(' + number + ')' + comma_wsp + '(' + number + '))?\\\\s*\\\\))',\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' + comma_wsp + '(' + number + '))?\\\\s*\\\\))',\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' + comma_wsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + comma_wsp +\n                  '(' + number + ')' + comma_wsp +\n                  '(' + number + ')' + comma_wsp +\n                  '(' + number + ')' + comma_wsp +\n                  '(' + number + ')' + comma_wsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + comma_wsp + transform + ')*' + ')',\n\n        transform_list = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transform_list),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform);\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat();\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              return (match !== '' && match != null);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch(operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewXMatrix(matrix, args);\n            break;\n          case 'skewY':\n            skewYMatrix(matrix, args);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n      })\n      return matrix;\n    }\n  })();\n\n  /**\n   * Parses \"points\" attribute, returning an array of values\n   * @static\n   * @memberOf fabric\n   * @method parsePointsAttribute\n   * @param points {String} points attribute string\n   * @return {Array} array of points\n   */\n  function parsePointsAttribute(points) {\n\n    // points attribute is required and must not be empty\n    if (!points) return null;\n\n    points = points.trim();\n    var asPairs = points.indexOf(',') > -1;\n\n    points = points.split(/\\s+/);\n    var parsedPoints = [ ];\n\n    // points could look like \"10,20 30,40\" or \"10 20 30 40\"\n    if (asPairs) {\n     for (var i = 0, len = points.length; i < len; i++) {\n       var pair = points[i].split(',');\n       parsedPoints.push({ x: parseFloat(pair[0]), y: parseFloat(pair[1]) });\n     }\n    }\n    else {\n      for (var i = 0, len = points.length; i < len; i+=2) {\n        parsedPoints.push({ x: parseFloat(points[i]), y: parseFloat(points[i+1]) });\n      }\n    }\n\n    // odd number of points is an error\n    if (parsedPoints.length % 2 !== 0) {\n      // return null;\n    }\n\n    return parsedPoints;\n  };\n\n  /**\n   * Parses \"style\" attribute, retuning an object with values\n   * @static\n   * @memberOf fabric\n   * @method parseStyleAttribute\n   * @param {SVGElement} element Element to parse\n   * @return {Object} Objects with values parsed from style attribute of an element\n   */\n  function parseStyleAttribute(element) {\n    var oStyle = { },\n        style = element.getAttribute('style');\n    if (style) {\n      if (typeof style == 'string') {\n        style = style.replace(/;$/, '').split(';').forEach(function (current) {\n            var attr = current.split(':');\n            oStyle[normalizeAttr(attr[0].trim().toLowerCase())] = attr[1].trim();\n        });\n      } else {\n        for (var prop in style) {\n          if (typeof style[prop] !== 'undefined') {\n            oStyle[normalizeAttr(prop.toLowerCase())] = style[prop];\n          }\n        }\n      }\n    }\n    return oStyle;\n  };\n\n  function resolveGradients(instances) {\n    for (var i = instances.length; i--; ) {\n      var instanceFillValue = instances[i].get('fill');\n\n      if (/^url\\(/.test(instanceFillValue)) {\n\n        var gradientId = instanceFillValue.slice(5, instanceFillValue.length - 1);\n\n        if (fabric.gradientDefs[gradientId]) {\n          instances[i].set('fill',\n            fabric.Gradient.fromElement(fabric.gradientDefs[gradientId], instances[i]));\n        }\n      }\n    }\n  }\n\n  /**\n   * Transforms an array of svg elements to corresponding fabric.* instances\n   * @static\n   * @memberOf fabric\n   * @method parseElements\n   * @param {Array} elements Array of elements to parse\n   * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n   * @param {Object} options Options object\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   */\n  function parseElements(elements, callback, options, reviver) {\n    var instances = Array(elements.length), i = elements.length;\n\n    function checkIfDone() {\n      if (--i === 0) {\n        instances = instances.filter(function(el) {\n          return el != null;\n        });\n        resolveGradients(instances);\n        callback(instances);\n      }\n    }\n\n    for (var index = 0, el, len = elements.length; index < len; index++) {\n      el = elements[index];\n      var klass = fabric[capitalize(el.tagName)];\n      if (klass && klass.fromElement) {\n        try {\n          if (klass.async) {\n            klass.fromElement(el, (function(index, el) {\n              return function(obj) {\n                reviver && reviver(el, obj);\n                instances.splice(index, 0, obj);\n                checkIfDone();\n              };\n            })(index), options);\n          }\n          else {\n            var obj = klass.fromElement(el, options);\n            reviver && reviver(el, obj);\n            instances.splice(index, 0, obj);\n            checkIfDone();\n          }\n        }\n        catch(e) {\n          fabric.log(e.message || e);\n        }\n      }\n      else {\n        checkIfDone();\n      }\n    }\n  };\n\n  /**\n   * Returns CSS rules for a given SVG document\n   * @static\n   * @function\n   * @memberOf fabric\n   * @method getCSSRules\n   * @param {SVGDocument} doc SVG document to parse\n   * @return {Object} CSS rules of this document\n   */\n  function getCSSRules(doc) {\n    var styles = doc.getElementsByTagName('style'),\n        allRules = { },\n        rules;\n\n    // very crude parsing of style contents\n    for (var i = 0, len = styles.length; i < len; i++) {\n      var styleContents = styles[0].textContent;\n\n      // remove comments\n      styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n\n      rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n      rules = rules.map(function(rule) { return rule.trim() });\n\n      rules.forEach(function(rule) {\n        var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n            rule = match[1],\n            declaration = match[2].trim(),\n            propertyValuePairs = declaration.replace(/;$/, '').split(/\\s*;\\s*/);\n\n        if (!allRules[rule]) {\n          allRules[rule] = { };\n        }\n\n        for (var i = 0, len = propertyValuePairs.length; i < len; i++) {\n          var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n              property = pair[0],\n              value = pair[1];\n\n          allRules[rule][property] = value;\n        }\n      });\n    }\n\n    return allRules;\n  }\n\n  function getGlobalStylesForElement(element) {\n    var nodeName = element.nodeName,\n        className = element.getAttribute('class'),\n        id = element.getAttribute('id'),\n        styles = { };\n\n    for (var rule in fabric.cssRules) {\n      var ruleMatchesElement = (className && new RegExp('^\\\\.' + className).test(rule)) ||\n                               (id && new RegExp('^#' + id).test(rule)) ||\n                               (new RegExp('^' + nodeName).test(rule));\n\n      if (ruleMatchesElement) {\n        for (var property in fabric.cssRules[rule]) {\n          styles[property] = fabric.cssRules[rule][property];\n        }\n      }\n    }\n\n    return styles;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @method parseSVGDocument\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished; It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   */\n  fabric.parseSVGDocument = (function() {\n\n    var reAllowedSVGTagNames = /^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/;\n\n    // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n    // \\d doesn't quite cut it (as we need to match an actual float number)\n\n    // matches, e.g.: +14.56e-12, etc.\n    var reNum = '(?:[-+]?\\\\d+(?:\\\\.\\\\d+)?(?:e[-+]?\\\\d+)?)';\n\n    var reViewBoxAttrValue = new RegExp(\n      '^' +\n      '\\\\s*(' + reNum + '+)\\\\s*,?' +\n      '\\\\s*(' + reNum + '+)\\\\s*,?' +\n      '\\\\s*(' + reNum + '+)\\\\s*,?' +\n      '\\\\s*(' + reNum + '+)\\\\s*' +\n      '$'\n    );\n\n    function hasAncestorWithNodeName(element, nodeName) {\n      while (element && (element = element.parentNode)) {\n        if (nodeName.test(element.nodeName)) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    return function(doc, callback, reviver) {\n      if (!doc) return;\n\n      var startTime = new Date(),\n          descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n\n      if (descendants.length === 0) {\n        // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n        // https://github.com/ajaxorg/node-o3-xml/issues/21\n        descendants = doc.selectNodes(\"//*[name(.)!='svg']\");\n        var arr = [ ];\n        for (var i = 0, len = descendants.length; i < len; i++) {\n          arr[i] = descendants[i];\n        }\n        descendants = arr;\n      }\n\n      var elements = descendants.filter(function(el) {\n        return reAllowedSVGTagNames.test(el.tagName) &&\n              !hasAncestorWithNodeName(el, /^(?:pattern|defs)$/); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n      });\n\n      if (!elements || (elements && !elements.length)) return;\n\n      var viewBoxAttr = doc.getAttribute('viewBox'),\n          widthAttr = doc.getAttribute('width'),\n          heightAttr = doc.getAttribute('height'),\n          width = null,\n          height = null,\n          minX,\n          minY;\n\n      if (viewBoxAttr && (viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))) {\n        minX = parseInt(viewBoxAttr[1], 10);\n        minY = parseInt(viewBoxAttr[2], 10);\n        width = parseInt(viewBoxAttr[3], 10);\n        height = parseInt(viewBoxAttr[4], 10);\n      }\n\n      // values of width/height attributes overwrite those extracted from viewbox attribute\n      width = widthAttr ? parseFloat(widthAttr) : width;\n      height = heightAttr ? parseFloat(heightAttr) : height;\n\n      var options = {\n        width: width,\n        height: height\n      };\n\n      fabric.gradientDefs = fabric.getGradientDefs(doc);\n      fabric.cssRules = getCSSRules(doc);\n\n      // Precedence of rules:   style > class > attribute\n\n      fabric.parseElements(elements, function(instances) {\n        fabric.documentParsingTime = new Date() - startTime;\n        if (callback) {\n          callback(instances, options);\n        }\n      }, clone(options), reviver);\n    };\n  })();\n\n  /**\n    * Used for caching SVG documents (loaded via `fabric.Canvas#loadSVGFromURL`)\n    * @property\n    * @namespace\n    */\n   var svgCache = {\n\n     /**\n      * @method has\n      * @param {String} name\n      * @param {Function} callback\n      */\n     has: function (name, callback) {\n       callback(false);\n     },\n\n     /**\n      * @method get\n      * @param {String} url\n      * @param {Function} callback\n      */\n     get: function (url, callback) {\n       /* NOOP */\n     },\n\n     /**\n      * @method set\n      * @param {String} url\n      * @param {Object} object\n      */\n     set: function (url, object) {\n       /* NOOP */\n     }\n   };\n\n   /**\n    * Takes url corresponding to an SVG document, and parses it into a set of fabric objects\n    * @method loadSVGFromURL\n    * @param {String} url\n    * @param {Function} callback\n    * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n    */\n   function loadSVGFromURL(url, callback, reviver) {\n\n     url = url.replace(/^\\n\\s*/, '').trim();\n\n     svgCache.has(url, function (hasUrl) {\n       if (hasUrl) {\n         svgCache.get(url, function (value) {\n           var enlivedRecord = _enlivenCachedObject(value);\n           callback(enlivedRecord.objects, enlivedRecord.options);\n         });\n       }\n       else {\n         new fabric.util.request(url, {\n           method: 'get',\n           onComplete: onComplete\n         });\n       }\n     });\n\n     function onComplete(r) {\n\n       var xml = r.responseXML;\n       if (!xml.documentElement && fabric.window.ActiveXObject && r.responseText) {\n         xml = new ActiveXObject('Microsoft.XMLDOM');\n         xml.async = 'false';\n         //IE chokes on DOCTYPE\n         xml.loadXML(r.responseText.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i,''));\n       }\n       if (!xml.documentElement) return;\n\n       fabric.parseSVGDocument(xml.documentElement, function (results, options) {\n         svgCache.set(url, {\n           objects: fabric.util.array.invoke(results, 'toObject'),\n           options: options\n         });\n         callback(results, options);\n       }, reviver);\n     }\n   }\n\n  /**\n  * @method _enlivenCachedObject\n  */\n  function _enlivenCachedObject(cachedObject) {\n\n   var objects = cachedObject.objects,\n       options = cachedObject.options;\n\n   objects = objects.map(function (o) {\n     return fabric[capitalize(o.type)].fromObject(o);\n   });\n\n   return ({ objects: objects, options: options });\n  }\n\n  /**\n    * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n    * @method loadSVGFromString\n    * @param {String} string\n    * @param {Function} callback\n    * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n    */\n  function loadSVGFromString(string, callback, reviver) {\n    string = string.trim();\n    var doc;\n    if (typeof DOMParser !== 'undefined') {\n      var parser = new DOMParser();\n      if (parser && parser.parseFromString) {\n        doc = parser.parseFromString(string, 'text/xml');\n      }\n    }\n    else if (fabric.window.ActiveXObject) {\n      var doc = new ActiveXObject('Microsoft.XMLDOM');\n      doc.async = 'false';\n      //IE chokes on DOCTYPE\n      doc.loadXML(string.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i,''));\n    }\n\n    fabric.parseSVGDocument(doc.documentElement, function (results, options) {\n      callback(results, options);\n    }, reviver);\n  }\n\n  function createSVGFontFacesMarkup(objects) {\n    var markup = '';\n\n    for (var i = 0, len = objects.length; i < len; i++) {\n      if (objects[i].type !== 'text' || !objects[i].path) continue;\n\n      markup += [\n        '@font-face {',\n          'font-family: ', objects[i].fontFamily, '; ',\n          'src: url(\\'', objects[i].path, '\\')',\n        '}'\n      ].join('');\n    }\n\n    if (markup) {\n      markup = [\n        '<defs>',\n          '<style type=\"text/css\">',\n            '<![CDATA[',\n              markup,\n            ']]>',\n          '</style>',\n        '</defs>'\n      ].join('');\n    }\n\n    return markup;\n  }\n\n  extend(fabric, {\n\n    parseAttributes:          parseAttributes,\n    parseElements:            parseElements,\n    parseStyleAttribute:      parseStyleAttribute,\n    parsePointsAttribute:     parsePointsAttribute,\n    getCSSRules:              getCSSRules,\n\n    loadSVGFromURL:           loadSVGFromURL,\n    loadSVGFromString:        loadSVGFromString,\n\n    createSVGFontFacesMarkup: createSVGFontFacesMarkup\n  });\n\n})(typeof exports != 'undefined' ? exports : this);\n\n(function() {\n\n  function getColorStopFromStyle(el) {\n    var style = el.getAttribute('style');\n\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length-1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (var i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          return value;\n        }\n      }\n    }\n  }\n\n  /**\n   * @class Object\n   * @memberOf fabric\n   */\n  fabric.Gradient = fabric.util.createClass(/** @scope fabric.Gradient.prototype */ {\n\n    initialize: function(options) {\n\n      options || (options = { });\n\n      this.x1 = options.x1 || 0;\n      this.y1 = options.y1 || 0;\n      this.x2 = options.x2 || 0;\n      this.y2 = options.y2 || 0;\n\n      this.colorStops = options.colorStops;\n    },\n\n    toObject: function() {\n      return {\n        x1: this.x1,\n        x2: this.x2,\n        y1: this.y1,\n        y2: this.y2,\n        colorStops: this.colorStops\n      };\n    },\n\n    toLiveGradient: function(ctx) {\n      var gradient = ctx.createLinearGradient(\n        this.x1, this.y1, this.x2 || ctx.canvas.width, this.y2);\n\n      for (var position in this.colorStops) {\n        var colorValue = this.colorStops[position];\n        gradient.addColorStop(parseFloat(position), colorValue);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /**\n     * @method fromElement\n     * @static\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     */\n    fromElement: function(el, instance) {\n\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"grad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"grad1\">\n       *    <stop offset=\"0%\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"100%\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       */\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          el,\n          offset,\n          colorStops = { },\n          colorStopFromStyle,\n          coords = {\n            x1: el.getAttribute('x1') || 0,\n            y1: el.getAttribute('y1') || 0,\n            x2: el.getAttribute('x2') || '100%',\n            y2: el.getAttribute('y2') || 0\n          };\n\n      for (var i = colorStopEls.length; i--; ) {\n        el = colorStopEls[i];\n        offset = el.getAttribute('offset');\n\n        // convert percents to absolute values\n        offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n        colorStops[offset] = getColorStopFromStyle(el) || el.getAttribute('stop-color');\n      }\n\n      _convertPercentUnitsToValues(instance, coords);\n\n      return new fabric.Gradient({\n        x1: coords.x1,\n        y1: coords.y1,\n        x2: coords.x2,\n        y2: coords.y2,\n        colorStops: colorStops\n      });\n    },\n\n    /**\n     * @method forObject\n     * @static\n     */\n    forObject: function(obj, options) {\n      options || (options = { });\n      _convertPercentUnitsToValues(obj, options);\n      return new fabric.Gradient(options);\n    }\n  });\n\n  function _convertPercentUnitsToValues(object, options) {\n    for (var prop in options) {\n      if (typeof options[prop] === 'string' && /^\\d+%$/.test(options[prop])) {\n        var percents = parseFloat(options[prop], 10);\n        if (prop === 'x1' || prop === 'x2') {\n          options[prop] = object.width * percents / 100;\n        }\n        else if (prop === 'y1' || prop === 'y2') {\n          options[prop] = object.height * percents / 100;\n        }\n      }\n      // normalize rendering point (should be from top/left corner rather than center of the shape)\n      if (prop === 'x1' || prop === 'x2') {\n        options[prop] -= object.width / 2;\n      }\n      else if (prop === 'y1' || prop === 'y2') {\n        options[prop] -= object.height / 2;\n      }\n    }\n  }\n\n  /**\n   * Parses an SVG document, returning all of the gradient declarations found in it\n   * @static\n   * @function\n   * @memberOf fabric\n   * @method getGradientDefs\n   * @param {SVGDocument} doc SVG document to parse\n   * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n   */\n  function getGradientDefs(doc) {\n    var linearGradientEls = doc.getElementsByTagName('linearGradient'),\n        radialGradientEls = doc.getElementsByTagName('radialGradient'),\n        el,\n        gradientDefs = { };\n\n    for (var i = linearGradientEls.length; i--; ) {\n      el = linearGradientEls[i];\n      gradientDefs[el.getAttribute('id')] = el;\n    }\n\n    for (var i = radialGradientEls.length; i--; ) {\n      el = radialGradientEls[i];\n      gradientDefs[el.getAttribute('id')] = el;\n    }\n\n    return gradientDefs;\n  }\n\n  fabric.getGradientDefs = getGradientDefs;\n\n})();\n(function(global) {\n  \n  \"use strict\";\n  \n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  \n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {    \n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n  \n  /**\n   * @name Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    if (arguments.length > 0) {\n      this.init(x, y);\n    }\n  }\n  \n  Point.prototype = /** @scope fabric.Point.prototype */ {\n    \n    constructor: Point,\n    \n    /**\n     * @method init\n     * @param {Number} x\n     * @param {Number} y\n     */\n    init: function (x, y) {\n      this.x = x;\n      this.y = y;\n    },\n    \n    /**\n     * @method add\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n    \n    /**\n     * @method addEquals\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n    \n    /**\n     * @method scalarAdd\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n    \n    /**\n     * @method scalarAddEquals\n     * @param {Number} scalar\n     * @param {fabric.Point} thisArg\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n    \n    /**\n     * @method subtract\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n    \n    /**\n     * @method subtractEquals\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n    \n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n    \n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n    \n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n    \n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n    \n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n    \n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n    \n    eq: function (that) {\n      return (this.x == that.x && this.y == that.y);\n    },\n    \n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n    \n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n    \n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n    \n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n    \n    lerp: function (that, t) {\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n    \n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n    \n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n    \n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n    \n    toString: function () {\n      return this.x + \",\" + this.y;\n    },\n    \n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n    },\n    \n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n    },\n    \n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    }\n  };\n  \n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * @class Intersection\n   * @memberOf fabric\n   */\n  function Intersection(status) {\n    if (arguments.length > 0) {\n      this.init(status);\n    }\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @scope fabric.Intersection.prototype */ {\n\n    /**\n     * @method init\n     * @param {String} status\n     */\n    init: function (status) {\n      this.status = status;\n      this.points = [];\n    },\n\n    /**\n     * @method appendPoint\n     * @param {String} status\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n    },\n\n    /**\n     * @method appendPoints\n     * @param {String} status\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n    }\n  };\n\n  /**\n   * @static\n   * @method intersectLineLine\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        ua_t = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ub_t = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        u_b = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (u_b != 0) {\n      var ua = ua_t / u_b,\n          ub = ub_t / u_b;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection(\"Intersection\");\n        result.points.push(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection(\"No Intersection\");\n      }\n    }\n    else {\n      if (ua_t == 0 || ub_t == 0) {\n        result = new Intersection(\"Coincident\");\n      }\n      else {\n        result = new Intersection(\"Parallel\");\n      }\n    }\n    return result;\n  };\n\n  /**\n   * @method intersectLinePolygon\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1,a2,points){\n    var result = new Intersection(\"No Intersection\"),\n        length = points.length;\n\n    for (var i = 0; i < length; i++) {\n      var b1 = points[i],\n          b2 = points[(i+1) % length],\n          inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = \"Intersection\";\n    }\n    return result;\n  };\n\n  /**\n   * @method intersectPolygonPolygon\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(\"No Intersection\"),\n        length = points1.length;\n\n    for (var i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i+1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = \"Intersection\";\n    }\n    return result;\n  };\n\n  /**\n   * @method intersectPolygonRectangle\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection(\"No Intersection\");\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n    if (result.points.length > 0) {\n      result.status=\"Intersection\";\n    }\n    return result;\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n  \n  \"use strict\";\n  \n  var fabric = global.fabric || (global.fabric = { });\n  \n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n  \n  /**\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class Color\n   * @memberOf fabric\n   * @param {String} color (optional) in hex or rgb(a) format\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n  \n  fabric.Color = Color;\n  \n  fabric.Color.prototype = /** @scope fabric.Color.prototype */ {\n    \n    /**\n     * @private\n     * @method _tryParsingColor\n     */\n    _tryParsingColor: function(color) {\n      var source = Color.sourceFromHex(color);\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @method getSource\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @method setSource\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color represenation in RGB format\n     * @method toRgb\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color represenation in RGBA format\n     * @method toRgba\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color represenation in HEX format\n     * @method toHex\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource();\n\n      var r = source[0].toString(16);\n      r = (r.length == 1) ? ('0' + r) : r;\n\n      var g = source[1].toString(16);\n      g = (g.length == 1) ? ('0' + g) : g;\n\n      var b = source[2].toString(16);\n      b = (b.length == 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color \n     * @method getAlpha\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @method setAlpha\n     * @param {Number} 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @method toGrayscale\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @method toGrayscale\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3],\n          threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @method overlayWith\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource();\n\n      for (var i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n  \n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgb(255, 100, 10, 0.5), rgb(1,1,1))\n   * @static\n   * @field\n   */\n  fabric.Color.reRGBa = /^rgba?\\((\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})(?:\\s*,\\s*(\\d+(?:\\.\\d+)?))?\\)$/;\n  \n  /**\n   * Regex matching color in HEX format (ex: #FF5555, 010155, aff)\n   * @static\n   * @field\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @method fromRgb\n   * @param {String} color ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n  \n  /**\n   * Returns array represenatation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @method sourceFromRgb\n   * @param {String} color ex: rgb(0-255,0-255,0-255)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      return [\n        parseInt(match[1], 10),\n        parseInt(match[2], 10),\n        parseInt(match[3], 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @method fromRgba\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @method fromHex\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n  \n  /**\n   * Returns array represenatation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @method sourceFromHex\n   * @param {String} color ex: FF5555\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6);\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        1\n      ];\n    }\n  };\n  \n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @method fromSource\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function (global) {\n\n  \"use strict\";\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      removeListener = fabric.util.removeListener,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * @class fabric.StaticCanvas\n   * @constructor\n   * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n   * @param {Object} [options] Options object\n   */\n  fabric.StaticCanvas = function (el, options) {\n    options || (options = { });\n\n    this._initStatic(el, options);\n    fabric.StaticCanvas.activeInstance = this;\n  };\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n\n  extend(fabric.StaticCanvas.prototype, /** @scope fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Background color of canvas instance\n     * @property\n     * @type String\n     */\n    backgroundColor: 'rgba(0, 0, 0, 0)',\n\n    /**\n     * Background image of canvas instance\n     * Should be set via `setBackgroundImage`\n     * @property\n     * @type String\n     */\n    backgroundImage: '',\n\n    /**\n     * Opacity of the background image of the canvas instance\n     * @property\n     * @type Float\n     */\n    backgroundImageOpacity: 1.0,\n\n    /**\n     * Indicatus whether the background image should be stretched to fit the\n     * dimensions of the canvas instance.\n     * @property\n     * @type Boolean\n     */\n    backgroundImageStretch: true,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * @property\n     * @type Boolean\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @property\n     * @type Boolean\n     */\n    stateful: true,\n\n    /**\n     * Indicates whether fabric.Canvas#add should also re-render canvas.\n     * Disabling this option could give a great performance boost when adding a lot of objects to canvas at once\n     * (followed by a manual rendering after addition)\n     */\n    renderOnAddition: true,\n\n    /**\n     * Function that determines clipping of entire canvas area\n     * Being passed context as first argument. See clipping canvas area in https://github.com/kangax/fabric.js/wiki/FAQ\n     * @property\n     * @type Function\n     */\n    clipTo: null,\n\n    /**\n     * Indicates whether object controls (borders/corners) are rendered above overlay image\n     * @property\n     * @type Boolean\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Callback; invoked right before object is about to be scaled/rotated\n     * @method onBeforeScaleRotate\n     * @param {fabric.Object} target Object that's about to be scaled/rotated\n     */\n    onBeforeScaleRotate: function (target) {\n      /* NOOP */\n    },\n\n    /**\n     * Callback; invoked on every redraw of canvas and is being passed a number indicating current fps\n     * @method onFpsUpdate\n     * @param {Number} fps\n     */\n    onFpsUpdate: null,\n\n    _initStatic: function(el, options) {\n      this._objects = [];\n\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, this.renderAll.bind(this));\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, this.renderAll.bind(this));\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @method calcOffset\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets overlay image for this canvas\n     * @method setOverlayImage\n     * @param {String} url url of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setOverlayImage: function (url, callback) { // TODO (kangax): test callback\n      fabric.util.loadImage(url, function(img) {\n        this.overlayImage = img;\n        callback && callback();\n      }, this);\n      return this;\n    },\n\n    /**\n     * Sets background image for this canvas\n     * @method setBackgroundImage\n     * @param {String} url url of an image to set background to\n     * @param {Function} callback callback to invoke when image is loaded and set as background\n     * @param {Object} options optional options to set for the background image\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setBackgroundImage: function (url, callback, options) {\n      return fabric.util.loadImage(url, function(img) {\n        this.backgroundImage = img;\n        if (options && ('backgroundImageOpacity' in options)) {\n            this.backgroundImageOpacity = options.backgroundImageOpacity;\n        }\n        if (options && ('backgroundImageStretch' in options)) {\n            this.backgroundImageStretch = options.backgroundImageStretch;\n        }\n        callback && callback();\n      }, this);\n    },\n\n    /**\n     * @private\n     * @method _createCanvasElement\n     * @param {Element} element\n     */\n    _createCanvasElement: function() {\n      var element = fabric.document.createElement('canvas');\n      if (!element.style) {\n        element.style = { };\n      }\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      this._initCanvasElement(element);\n      return element;\n    },\n\n    _initCanvasElement: function(element) {\n      if (typeof element.getContext === 'undefined' &&\n          typeof G_vmlCanvasManager !== 'undefined' &&\n          G_vmlCanvasManager.initElement) {\n\n        G_vmlCanvasManager.initElement(element);\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n    },\n\n    /**\n     * @method _initOptions\n     * @param {Object} options\n     */\n    _initOptions: function (options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.width = parseInt(this.lowerCanvasEl.width, 10) || 0;\n      this.height = parseInt(this.lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) return;\n\n      this.lowerCanvasEl.style.width = this.width + 'px';\n      this.lowerCanvasEl.style.height = this.height + 'px';\n    },\n\n    /**\n     * Creates a secondary canvas\n     * @method _createLowerCanvas\n     */\n    _createLowerCanvas: function (canvasEl) {\n      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\n      this._initCanvasElement(this.lowerCanvasEl);\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width\n     * @method getWidth\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height\n     * @method getHeight\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @method setWidth\n     * @param {Number} width value to set width to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value) {\n      return this._setDimension('width', value);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @method setHeight\n     * @param {Number} height value to set height to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value) {\n      return this._setDimension('height', value);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance\n     * @method setDimensions\n     * @param {Object} dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function(dimensions) {\n      for (var prop in dimensions) {\n        this._setDimension(prop, dimensions[prop]);\n      }\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @method _setDimensions\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n      this.lowerCanvasEl.style[prop] = value + 'px';\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n        this.upperCanvasEl.style[prop] = value + 'px';\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value + 'px';\n      }\n\n      this[prop] = value;\n\n      this.calcOffset();\n      this.renderAll();\n\n      return this;\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @method getElement\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    // placeholder\n    getActiveObject: function() {\n      return null;\n    },\n\n    // placeholder\n    getActiveGroup: function() {\n      return null;\n    },\n\n    /**\n     * Given a context, renders an object on that context\n     * @param ctx {Object} context to render object on\n     * @param object {Object} object to render\n     * @private\n     */\n    _draw: function (ctx, object) {\n      if (!object) return;\n\n      if (this.controlsAboveOverlay) {\n        var hasBorders = object.hasBorders, hasCorners = object.hasCorners;\n        object.hasBorders = object.hasCorners = false;\n        object.render(ctx);\n        object.hasBorders = hasBorders;\n        object.hasCorners = hasCorners;\n      }\n      else {\n        object.render(ctx);\n      }\n    },\n\n    /**\n     * Adds objects to canvas, then renders canvas;\n     * Objects should be instances of (or inherit from) fabric.Object\n     * @method add\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    add: function () {\n      this._objects.push.apply(this._objects, arguments);\n      for (var i = arguments.length; i--; ) {\n        this._initObject(arguments[i]);\n      }\n      this.renderOnAddition && this.renderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     * @method _initObject\n     */\n    _initObject: function(obj) {\n      this.stateful && obj.setupState();\n      obj.setCoords();\n      obj.canvas = this;\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * Inserts an object to canvas at specified index and renders canvas.\n     * An object should be an instance of (or inherit from) fabric.Object\n     * @method insertAt\n     * @param object {Object} Object to insert\n     * @param index {Number} index to insert object at\n     * @param nonSplicing {Boolean} when `true`, no splicing (shifting) of objects occurs\n     * @return {fabric.Canvas} instance\n     */\n    insertAt: function (object, index, nonSplicing) {\n      if (nonSplicing) {\n        this._objects[index] = object;\n      }\n      else {\n        this._objects.splice(index, 0, object);\n      }\n      this._initObject(object);\n      this.renderOnAddition && this.renderAll();\n      return this;\n    },\n\n    /**\n     * Returns an array of objects this instance has\n     * @method getObjects\n     * @return {Array}\n     */\n    getObjects: function () {\n      return this._objects;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @method clearContext\n     * @param context {Object} ctx context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @method getContext\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @method clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this._objects.length = 0;\n      this.clearContext(this.contextContainer);\n      if (this.contextTop) {\n        this.clearContext(this.contextTop);\n      }\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @method renderAll\n     * @param allOnTop {Boolean} optional Whether we want to force all images to be rendered on the top canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function (allOnTop) {\n\n      var canvasToDrawOn = this[(allOnTop === true && this.interactive) ? 'contextTop' : 'contextContainer'];\n\n      if (this.contextTop) {\n        this.clearContext(this.contextTop);\n      }\n\n      if (allOnTop === false || (typeof allOnTop === 'undefined')) {\n        this.clearContext(canvasToDrawOn);\n      }\n\n      var length = this._objects.length,\n          activeGroup = this.getActiveGroup(),\n          startTime = new Date();\n\n      if (this.clipTo) {\n        canvasToDrawOn.save();\n        canvasToDrawOn.beginPath();\n        this.clipTo(canvasToDrawOn);\n        canvasToDrawOn.clip();\n      }\n\n      canvasToDrawOn.fillStyle = this.backgroundColor;\n      canvasToDrawOn.fillRect(0, 0, this.width, this.height);\n\n      if (typeof this.backgroundImage == 'object') {\n        canvasToDrawOn.save();\n        canvasToDrawOn.globalAlpha = this.backgroundImageOpacity;\n\n        if (this.backgroundImageStretch) {\n            canvasToDrawOn.drawImage(this.backgroundImage, 0, 0, this.width, this.height);\n        }\n        else {\n            canvasToDrawOn.drawImage(this.backgroundImage, 0, 0);\n        }\n        canvasToDrawOn.restore();\n      }\n\n      if (length) {\n        for (var i = 0; i < length; ++i) {\n          if (!activeGroup ||\n              (activeGroup && this._objects[i] && !activeGroup.contains(this._objects[i]))) {\n            this._draw(canvasToDrawOn, this._objects[i]);\n          }\n        }\n      }\n\n      if (this.clipTo) {\n        canvasToDrawOn.restore();\n      }\n\n      // delegate rendering to group selection (if one exists)\n      if (activeGroup) {\n        this._draw(this.contextTop, activeGroup);\n      }\n\n      if (this.overlayImage) {\n        this.contextContainer.drawImage(this.overlayImage, 0, 0);\n      }\n\n      if (this.controlsAboveOverlay) {\n        this.drawControls(this.contextContainer);\n      }\n\n      if (this.onFpsUpdate) {\n        var elapsedTime = new Date() - startTime;\n        this.onFpsUpdate(~~(1000 / elapsedTime));\n      }\n\n      this.fire('after:render');\n\n      return this;\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @method renderTop\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      this.clearContext(this.contextTop || this.contextContainer);\n\n      if (this.overlayImage) {\n        this.contextContainer.drawImage(this.overlayImage, 0, 0);\n      }\n\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection();\n      }\n\n      // delegate rendering to group selection if one exists\n      // used for drawing selection borders/corners\n      var activeGroup = this.getActiveGroup();\n      if (activeGroup) {\n        activeGroup.render(this.contextTop);\n      }\n\n      this.fire('after:render');\n\n      return this;\n    },\n\n    /**\n     * Draws objects' controls (borders/corners)\n     * @method drawControls\n     * @param {Object} ctx context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeGroup = this.getActiveGroup();\n      if (activeGroup) {\n        ctx.save();\n        fabric.Group.prototype.transform.call(activeGroup, ctx);\n        activeGroup.drawBorders(ctx).drawCorners(ctx);\n        ctx.restore();\n      }\n      else {\n        for (var i = 0, len = this._objects.length; i < len; ++i) {\n          if (!this._objects[i].active) continue;\n\n          ctx.save();\n          fabric.Object.prototype.transform.call(this._objects[i], ctx);\n          this._objects[i].drawBorders(ctx).drawCorners(ctx);\n          ctx.restore();\n        }\n      }\n    },\n\n    /**\n     * Exports canvas element to a dataurl image.\n     * @method toDataURL\n     * @param {String} format the format of the output image. Either \"jpeg\" or \"png\".\n     * @param {Number} quality quality level (0..1)\n     * @return {String}\n     */\n    toDataURL: function (format, quality) {\n      var canvasEl = this.upperCanvasEl || this.lowerCanvasEl;\n\n      this.renderAll(true);\n      var data = (fabric.StaticCanvas.supports('toDataURLWithQuality'))\n                   ? canvasEl.toDataURL('image/' + format, quality)\n                   : canvasEl.toDataURL('image/' + format);\n      this.renderAll();\n      return data;\n    },\n\n    /**\n     * Exports canvas element to a dataurl image (allowing to change image size via multiplier).\n     * @method toDataURLWithMultiplier\n     * @param {String} format (png|jpeg)\n     * @param {Number} multiplier\n     * @param {Number} quality (0..1)\n     * @return {String}\n     */\n    toDataURLWithMultiplier: function (format, multiplier, quality) {\n\n      var origWidth = this.getWidth(),\n          origHeight = this.getHeight(),\n          scaledWidth = origWidth * multiplier,\n          scaledHeight = origHeight * multiplier,\n          activeObject = this.getActiveObject(),\n          activeGroup = this.getActiveGroup();\n\n      this.setWidth(scaledWidth).setHeight(scaledHeight);\n      this.contextTop.scale(multiplier, multiplier);\n\n      if (activeGroup) {\n        // not removing group due to complications with restoring it with correct state afterwords\n        this._tempRemoveBordersCornersFromGroup(activeGroup);\n      }\n      else if (activeObject) {\n        this.deactivateAll();\n      }\n\n      // restoring width, height for `renderAll` to draw\n      // background properly (while context is scaled)\n      this.width = origWidth;\n      this.height = origHeight;\n\n      this.renderAll(true);\n\n      var dataURL = this.toDataURL(format, quality);\n\n      this.contextTop.scale(1 / multiplier,  1 / multiplier);\n      this.setWidth(origWidth).setHeight(origHeight);\n\n      if (activeGroup) {\n        this._restoreBordersCornersOnGroup(activeGroup);\n      }\n      else if (activeObject) {\n        this.setActiveObject(activeObject);\n      }\n\n      this.renderAll();\n\n      return dataURL;\n    },\n\n    _tempRemoveBordersCornersFromGroup: function(group) {\n      group.origHideCorners = group.hideCorners;\n      group.origBorderColor = group.borderColor;\n\n      group.hideCorners = true;\n      group.borderColor = 'rgba(0,0,0,0)';\n\n      group.forEachObject(function(o) {\n        o.origBorderColor = o.borderColor;\n        o.borderColor = 'rgba(0,0,0,0)';\n      });\n    },\n    _restoreBordersCornersOnGroup: function(group) {\n      group.hideCorners = group.origHideCorners;\n      group.borderColor = group.origBorderColor;\n\n      group.forEachObject(function(o) {\n        o.borderColor = o.origBorderColor;\n        delete o.origBorderColor;\n      });\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @method getCenter\n     * @return {Object} object with \"top\" and \"left\" number values\n     */\n    getCenter: function () {\n      return {\n        top: this.getHeight() / 2,\n        left: this.getWidth() / 2\n      };\n    },\n\n    /**\n     * Centers object horizontally.\n     * @method centerObjectH\n     * @param {fabric.Object} object Object to center\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      object.set('left', this.getCenter().left);\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Centers object vertically.\n     * @method centerObjectH\n     * @param {fabric.Object} object Object to center\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      object.set('top', this.getCenter().top);\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally.\n     * @method centerObject\n     * @param {fabric.Object} object Object to center\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function (object) {\n      return this.centerObjectH(object).centerObjectV(object);\n    },\n\n    /**\n     * Returs dataless JSON representation of canvas\n     * @method toDatalessJSON\n     * @return {String} json string\n     */\n    toDatalessJSON: function () {\n      return this.toDatalessObject();\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @method toObject\n     * @return {Object}\n     */\n    toObject: function () {\n      return this._toObjectMethod('toObject');\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @method toDatalessObject\n     * @return {Object}\n     */\n    toDatalessObject: function () {\n      return this._toObjectMethod('toDatalessObject');\n    },\n\n    /**\n     * @private\n     * @method _toObjectMethod\n     */\n    _toObjectMethod: function (methodName) {\n      var data = {\n        objects: this._objects.map(function (instance) {\n          // TODO (kangax): figure out how to clean this up\n          if (!this.includeDefaultValues) {\n            var originalValue = instance.includeDefaultValues;\n            instance.includeDefaultValues = false;\n          }\n          var object = instance[methodName]();\n          if (!this.includeDefaultValues) {\n            instance.includeDefaultValues = originalValue;\n          }\n          return object;\n        }, this),\n        background: this.backgroundColor\n      };\n      if (this.backgroundImage) {\n        data.backgroundImage = this.backgroundImage.src;\n        data.backgroundImageOpacity = this.backgroundImageOpacity;\n        data.backgroundImageStretch = this.backgroundImageStretch;\n      }\n      return data;\n    },\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @method toSVG\n     * @return {String}\n     */\n    toSVG: function() {\n      var markup = [\n        '<?xml version=\"1.0\" standalone=\"no\" ?>',\n          '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 20010904//EN\" ',\n            '\"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd\">',\n          '<svg ',\n            'xmlns=\"http://www.w3.org/2000/svg\" ',\n            'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n            'version=\"1.1\" ',\n            'width=\"', this.width, '\" ',\n            'height=\"', this.height, '\" ',\n            'xml:space=\"preserve\">',\n          '<desc>Created with Fabric.js ', fabric.version, '</desc>',\n          fabric.createSVGFontFacesMarkup(this.getObjects())\n      ];\n\n      if (this.backgroundImage) {\n        markup.push(\n          '<image x=\"0\" y=\"0\" ',\n            'width=\"', this.width,\n            '\" height=\"', this.height,\n            '\" preserveAspectRatio=\"', (this.backgroundImageStretch ? 'none' : 'defer'),\n            '\" xlink:href=\"', this.backgroundImage.src,\n            '\" style=\"opacity:', this.backgroundImageOpacity,\n          '\"></image>'\n        );\n      }\n\n      for (var i = 0, objects = this.getObjects(), len = objects.length; i < len; i++) {\n        markup.push(objects[i].toSVG());\n      }\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * Returns true if canvas contains no objects\n     * @method isEmpty\n     * @return {Boolean} true if canvas is empty\n     */\n    isEmpty: function () {\n      return this._objects.length === 0;\n    },\n\n    /**\n     * Removes an object from canvas and returns it\n     * @method remove\n     * @param object {Object} Object to remove\n     * @return {Object} removed object\n     */\n    remove: function (object) {\n      removeFromArray(this._objects, object);\n      if (this.getActiveObject() === object) {\n\n        // removing active object should fire \"selection:cleared\" events\n        this.fire('before:selection:cleared', { target: object });\n        this.discardActiveObject();\n        this.fire('selection:cleared');\n      }\n      this.renderAll();\n      return object;\n    },\n\n    /**\n     * Moves an object to the bottom of the stack of drawn objects\n     * @method sendToBack\n     * @param object {fabric.Object} Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      removeFromArray(this._objects, object);\n      this._objects.unshift(object);\n      return this.renderAll();\n    },\n\n    /**\n     * Moves an object to the top of the stack of drawn objects\n     * @method bringToFront\n     * @param object {fabric.Object} Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      removeFromArray(this._objects, object);\n      this._objects.push(object);\n      return this.renderAll();\n    },\n\n    /**\n     * Moves an object one level down in stack of drawn objects\n     * @method sendBackwards\n     * @param object {fabric.Object} Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object) {\n      var idx = this._objects.indexOf(object),\n          nextIntersectingIdx = idx;\n\n      // if object is not on the bottom of stack\n      if (idx !== 0) {\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (var i=idx-1; i>=0; --i) {\n          if (object.intersectsWithObject(this._objects[i]) || object.isContainedWithinObject(this._objects[i])) {\n            nextIntersectingIdx = i;\n            break;\n          }\n        }\n        removeFromArray(this._objects, object);\n        this._objects.splice(nextIntersectingIdx, 0, object);\n      }\n      return this.renderAll();\n    },\n\n    /**\n     * Moves an object one level up in stack of drawn objects\n     * @method bringForward\n     * @param object {fabric.Object} Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object) {\n      var objects = this.getObjects(),\n          idx = objects.indexOf(object),\n          nextIntersectingIdx = idx;\n\n\n      // if object is not on top of stack (last item in an array)\n      if (idx !== objects.length-1) {\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (var i = idx + 1, l = this._objects.length; i < l; ++i) {\n          if (object.intersectsWithObject(objects[i]) || object.isContainedWithinObject(this._objects[i])) {\n            nextIntersectingIdx = i;\n            break;\n          }\n        }\n        removeFromArray(objects, object);\n        objects.splice(nextIntersectingIdx, 0, object);\n      }\n      this.renderAll();\n    },\n\n    /**\n     * Returns object at specified index\n     * @method item\n     * @param {Number} index\n     * @return {fabric.Object}\n     */\n    item: function (index) {\n      return this.getObjects()[index];\n    },\n\n    /**\n     * Returns number representation of an instance complexity\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function () {\n      return this.getObjects().reduce(function (memo, current) {\n        memo += current.complexity ? current.complexity() : 0;\n        return memo;\n      }, 0);\n    },\n\n    /**\n     * Iterates over all objects, invoking callback for each one of them\n     * @method forEachObject\n     * @return {fabric.Canvas} thisArg\n     */\n    forEachObject: function(callback, context) {\n      var objects = this.getObjects(),\n          i = objects.length;\n      while (i--) {\n        callback.call(context, objects[i], i, objects);\n      }\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event handlers.\n     * @method dispose\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      this.clear();\n      if (this.interactive) {\n        removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n        removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n        removeListener(fabric.window, 'resize', this._onResize);\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @method _resizeImageToFit\n     * @param {HTMLImageElement} imgEl\n     */\n    _resizeImageToFit: function (imgEl) {\n\n      var imageWidth = imgEl.width || imgEl.offsetWidth,\n          widthScaleFactor = this.getWidth() / imageWidth;\n\n      // scale image down so that it has original dimensions when printed in large resolution\n      if (imageWidth) {\n        imgEl.width = imageWidth * widthScaleFactor;\n      }\n    }\n  });\n\n  /**\n   * Returns a string representation of an instance\n   * @method toString\n   * @return {String} string representation of an instance\n   */\n  fabric.StaticCanvas.prototype.toString = function () { // Assign explicitly since `extend` doesn't take care of DontEnum bug yet\n    return '#<fabric.Canvas (' + this.complexity() + '): '+\n           '{ objects: ' + this.getObjects().length + ' }>';\n  };\n\n  extend(fabric.StaticCanvas, /** @scope fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @property EMPTY_JSON\n     * @type String\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Takes <canvas> element and transforms its data in such way that it becomes grayscale\n     * @static\n     * @method toGrayscale\n     * @param {HTMLCanvasElement} canvasEl\n     */\n    toGrayscale: function (canvasEl) {\n       var context = canvasEl.getContext('2d'),\n           imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n           data = imageData.data,\n           iLen = imageData.width,\n           jLen = imageData.height,\n           index, average, i, j;\n\n       for (i = 0; i < iLen; i++) {\n         for (j = 0; j < jLen; j++) {\n\n           index = (i * 4) * jLen + (j * 4);\n           average = (data[index] + data[index + 1] + data[index + 2]) / 3;\n\n           data[index]     = average;\n           data[index + 1] = average;\n           data[index + 2] = average;\n         }\n       }\n\n       context.putImageData(imageData, 0, 0);\n     },\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @method supports\n     * @param methodName {String} Method to check support for;\n     *                            Could be one of \"getImageData\", \"toDataURL\" or \"toDataURLWithQuality\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = fabric.document.createElement('canvas');\n\n      if (typeof G_vmlCanvasManager !== 'undefined') {\n        G_vmlCanvasManager.initElement(el);\n      }\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'getImageData':\n          return typeof ctx.getImageData !== 'undefined';\n\n        case 'toDataURL':\n          return typeof el.toDataURL !== 'undefined';\n\n        case 'toDataURLWithQuality':\n          try {\n            el.toDataURL('image/jpeg', 0);\n            return true;\n          } catch (e) {\n            return false;\n          }\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returs JSON representation of canvas\n   * @function\n   * @method toJSON\n   * @return {String} json string\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n})(typeof exports != 'undefined' ? exports : this);\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      getPointer = fabric.util.getPointer,\n      addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      cursorMap = {\n        'tr': 'ne-resize',\n        'br': 'se-resize',\n        'bl': 'sw-resize',\n        'tl': 'nw-resize',\n        'ml': 'w-resize',\n        'mt': 'n-resize',\n        'mr': 'e-resize',\n        'mb': 's-resize'\n      },\n\n      utilMin = fabric.util.array.min,\n      utilMax = fabric.util.array.max,\n\n      sqrt = Math.sqrt,\n      pow = Math.pow,\n      atan2 = Math.atan2,\n      abs = Math.abs,\n      min = Math.min,\n      max = Math.max,\n\n      STROKE_OFFSET = 0.5;\n\n  /**\n   * @class fabric.Canvas\n   * @constructor\n   * @extends fabric.StaticCanvas\n   * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n   * @param {Object} [options] Options object\n   */\n  fabric.Canvas = function(el, options) {\n    options || (options = { });\n\n    this._initStatic(el, options);\n    this._initInteractive();\n    this._createCacheCanvas();\n\n    fabric.Canvas.activeInstance = this;\n  };\n\n  function ProtoProxy(){ }\n  ProtoProxy.prototype = fabric.StaticCanvas.prototype;\n  fabric.Canvas.prototype = new ProtoProxy;\n\n  var InteractiveMethods = /** @scope fabric.Canvas.prototype */ {\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @property\n     * @type Boolean\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @property\n     * @type Boolean\n     */\n    selection:              true,\n\n    /**\n     * Color of selection\n     * @property\n     * @type String\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @property\n     * @type String\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @property\n     * @type Number\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Color of the line used in free drawing mode\n     * @property\n     * @type String\n     */\n    freeDrawingColor:       'rgb(0, 0, 0)',\n\n    /**\n     * Width of a line used in free drawing mode\n     * @property\n     * @type Number\n     */\n    freeDrawingLineWidth:   1,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @property\n     * @type String\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @property\n     * @type String\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @property\n     * @type String\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used for rotation point\n     * @property\n     * @type String\n     */\n    rotationCursor:         'crosshair',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @property\n     * @type String\n     */\n    containerClass:        'canvas-container',\n\n    perPixelTargetFind:     false,\n\n    targetFindTolerance: 0,\n\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._freeDrawingXPoints = [ ];\n      this._freeDrawingYPoints = [ ];\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEvents();\n      this.calcOffset();\n    },\n\n    /**\n     * Adds mouse listeners to  canvas\n     * @method _initEvents\n     * @private\n     * See configuration documentation for more details.\n     */\n    _initEvents: function () {\n      var _this = this;\n\n      this._onMouseDown = function (e) {\n        _this.__onMouseDown(e);\n\n        addListener(fabric.document, 'mouseup', _this._onMouseUp);\n        fabric.isTouchSupported && addListener(fabric.document, 'touchend', _this._onMouseUp);\n\n        addListener(fabric.document, 'mousemove', _this._onMouseMove);\n        fabric.isTouchSupported && addListener(fabric.document, 'touchmove', _this._onMouseMove);\n\n        removeListener(_this.upperCanvasEl, 'mousemove', _this._onMouseMove);\n        fabric.isTouchSupported && removeListener(_this.upperCanvasEl, 'touchmove', _this._onMouseMove);\n      };\n\n      this._onMouseUp = function (e) {\n        _this.__onMouseUp(e);\n\n        removeListener(fabric.document, 'mouseup', _this._onMouseUp);\n        fabric.isTouchSupported && removeListener(fabric.document, 'touchend', _this._onMouseUp);\n\n        removeListener(fabric.document, 'mousemove', _this._onMouseMove);\n        fabric.isTouchSupported && removeListener(fabric.document, 'touchmove', _this._onMouseMove);\n\n        addListener(_this.upperCanvasEl, 'mousemove', _this._onMouseMove);\n        fabric.isTouchSupported && addListener(_this.upperCanvasEl, 'touchmove', _this._onMouseMove);\n      };\n\n      this._onMouseMove = function (e) {\n        e.preventDefault && e.preventDefault();\n        _this.__onMouseMove(e);\n      };\n\n      this._onResize = function (e) {\n        _this.calcOffset();\n      };\n\n\n      addListener(fabric.window, 'resize', this._onResize);\n\n      if (fabric.isTouchSupported) {\n        addListener(this.upperCanvasEl, 'touchstart', this._onMouseDown);\n        addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);\n      }\n      else {\n        addListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n        addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      }\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @method __onMouseUp\n     * @param {Event} e Event object fired on mouseup\n     *\n     */\n    __onMouseUp: function (e) {\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._finalizeDrawingPath();\n        this.fire('mouse:up', { e: e });\n        return;\n      }\n\n      if (this._currentTransform) {\n\n        var transform = this._currentTransform,\n            target = transform.target;\n\n        if (target._scaling) {\n          target._scaling = false;\n        }\n\n        // determine the new coords everytime the image changes its position\n        var i = this._objects.length;\n        while (i--) {\n          this._objects[i].setCoords();\n        }\n\n        // only fire :modified event if target coordinates were changed during mousedown-mouseup\n        if (this.stateful && target.hasStateChanged()) {\n          target.isMoving = false;\n          this.fire('object:modified', { target: target });\n          target.fire('modified');\n        }\n      }\n\n      this._currentTransform = null;\n\n      if (this._groupSelector) {\n        // group selection was completed, determine its bounds\n        this._findSelectedObjects(e);\n      }\n      var activeGroup = this.getActiveGroup();\n      if (activeGroup) {\n        activeGroup.setObjectsCoords();\n        activeGroup.set('isMoving', false);\n        this._setCursor(this.defaultCursor);\n      }\n\n      // clear selection\n      this._groupSelector = null;\n      this.renderAll();\n\n      this._setCursorFromEvent(e, target);\n\n      // fix for FF\n      this._setCursor('');\n\n      var _this = this;\n      setTimeout(function () {\n        _this._setCursorFromEvent(e, target);\n      }, 50);\n\n      this.fire('mouse:up', { target: target, e: e });\n      target && target.fire('mouseup', { e: e })\n    },\n\n    /**\n     * Method that defines the actions when mouse is clic ked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @method __onMouseDown\n     * @param e {Event} Event object fired on mousedown\n     *\n     */\n    __onMouseDown: function (e) {\n\n      // accept only left clicks\n      var isLeftClick  = 'which' in e ? e.which == 1 : e.button == 1;\n      if (!isLeftClick && !fabric.isTouchSupported) return;\n\n      if (this.isDrawingMode) {\n        this._prepareForDrawing(e);\n\n        // capture coordinates immediately; this allows to draw dots (when movement never occurs)\n        this._captureDrawingPath(e);\n        this.fire('mouse:down', { e: e });\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) return;\n\n      var target = this.findTarget(e),\n          pointer = this.getPointer(e),\n          activeGroup = this.getActiveGroup(),\n          corner;\n\n      if (this._shouldClearSelection(e)) {\n\n        this._groupSelector = {\n          ex: pointer.x,\n          ey: pointer.y,\n          top: 0,\n          left: 0\n        };\n\n        this.deactivateAllWithDispatch();\n      }\n      else {\n        // determine if it's a drag or rotate case\n        // rotate and scale will happen at the same time\n        this.stateful && target.saveState();\n\n        if (corner = target._findTargetCorner(e, this._offset)) {\n          this.onBeforeScaleRotate(target);\n        }\n\n        this._setupCurrentTransform(e, target);\n\n        var shouldHandleGroupLogic = e.shiftKey && (activeGroup || this.getActiveObject()) && this.selection;\n        if (shouldHandleGroupLogic) {\n          this._handleGroupLogic(e, target);\n        }\n        else {\n          if (target !== this.getActiveGroup()) {\n            this.deactivateAll();\n          }\n          this.setActiveObject(target, e);\n        }\n      }\n      // we must renderAll so that active image is placed on the top canvas\n      this.renderAll();\n\n      this.fire('mouse:down', { target: target, e: e });\n      target && target.fire('mousedown', { e: e });\n    },\n\n    /**\n      * Method that defines the actions when mouse is hovering the canvas.\n      * The currentTransform parameter will definde whether the user is rotating/scaling/translating\n      * an image or neither of them (only hovering). A group selection is also possible and would cancel\n      * all any other type of action.\n      * In case of an image transformation only the top canvas will be rendered.\n      * @method __onMouseMove\n      * @param e {Event} Event object fired on mousemove\n      *\n      */\n    __onMouseMove: function (e) {\n\n      if (this.isDrawingMode) {\n        if (this._isCurrentlyDrawing) {\n          this._captureDrawingPath(e);\n        }\n        this.fire('mouse:move', { e: e });\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection.\n      if (groupSelector !== null) {\n        var pointer = getPointer(e);\n        groupSelector.left = pointer.x - this._offset.left - groupSelector.ex;\n        groupSelector.top = pointer.y - this._offset.top - groupSelector.ey;\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n\n        // alias style to elimintate unnecessary lookup\n        var style = this.upperCanvasEl.style;\n\n        // Here we are hovering the canvas then we will determine\n        // what part of the pictures we are hovering to change the caret symbol.\n        // We won't do that while dragging or rotating in order to improve the\n        // performance.\n        var target = this.findTarget(e);\n\n        if (!target) {\n          // image/text was hovered-out from, we remove its borders\n          for (var i = this._objects.length; i--; ) {\n            if (this._objects[i] && !this._objects[i].active) {\n              this._objects[i].setActive(false);\n            }\n          }\n          style.cursor = this.defaultCursor;\n        }\n        else {\n          // set proper cursor\n          this._setCursorFromEvent(e, target);\n          if (target.isActive()) {\n            // display corners when hovering over an image\n            target.setCornersVisibility && target.setCornersVisibility(true);\n          }\n        }\n      }\n      else {\n        // object is being transformed (scaled/rotated/moved/etc.)\n        var pointer = getPointer(e),\n            x = pointer.x,\n            y = pointer.y;\n\n        this._currentTransform.target.isMoving = true;\n\n        if (this._currentTransform.action === 'rotate') {\n          // rotate object only if shift key is not pressed\n          // and if it is not a group we are transforming\n\n          if (!e.shiftKey) {\n            this._rotateObject(x, y);\n\n            this.fire('object:rotating', {\n              target: this._currentTransform.target\n            });\n            this._currentTransform.target.fire('rotating');\n          }\n          if (!this._currentTransform.target.hasRotatingPoint) {\n            this._scaleObject(x, y);\n            this.fire('object:scaling', {\n              target: this._currentTransform.target\n            });\n            this._currentTransform.target.fire('scaling');\n          }\n        }\n        else if (this._currentTransform.action === 'scale') {\n          this._scaleObject(x, y);\n          this.fire('object:scaling', {\n            target: this._currentTransform.target\n          });\n          this._currentTransform.target.fire('scaling');\n        }\n        else if (this._currentTransform.action === 'scaleX') {\n          this._scaleObject(x, y, 'x');\n\n          this.fire('object:scaling', {\n            target: this._currentTransform.target\n          });\n          this._currentTransform.target.fire('scaling');\n        }\n        else if (this._currentTransform.action === 'scaleY') {\n          this._scaleObject(x, y, 'y');\n\n          this.fire('object:scaling', {\n            target: this._currentTransform.target\n          });\n          this._currentTransform.target.fire('scaling');\n        }\n        else {\n          this._translateObject(x, y);\n\n          this.fire('object:moving', {\n            target: this._currentTransform.target\n          });\n\n          this._setCursor(this.moveCursor);\n\n          this._currentTransform.target.fire('moving');\n        }\n        // only commit here. when we are actually moving the pictures\n        this.renderAll();\n      }\n      this.fire('mouse:move', { target: target, e: e });\n      target && target.fire('mousemove', { e: e });\n    },\n\n    /**\n     * Applies one implementation of 'point inside polygon' algorithm\n     * @method containsPoint\n     * @param e { Event } event object\n     * @param target { fabric.Object } object to test against\n     * @return {Boolean} true if point contains within area of given object\n     */\n    containsPoint: function (e, target) {\n      var pointer = this.getPointer(e),\n          xy = this._normalizePointer(target, pointer),\n          x = xy.x,\n          y = xy.y;\n\n      // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n      // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n\n      // we iterate through each object. If target found, return it.\n      var iLines = target._getImageLines(target.oCoords),\n          xpoints = target._findCrossPoints(x, y, iLines);\n\n      // if xcount is odd then we clicked inside the object\n      // For the specific case of square images xcount === 1 in all true cases\n      if ((xpoints && xpoints % 2 === 1) || target._findTargetCorner(e, this._offset)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @method _normalizePointer\n     */\n    _normalizePointer: function (object, pointer) {\n\n      var activeGroup = this.getActiveGroup(),\n          x = pointer.x,\n          y = pointer.y;\n\n      var isObjectInGroup = (\n        activeGroup &&\n        object.type !== 'group' &&\n        activeGroup.contains(object)\n      );\n\n      if (isObjectInGroup) {\n        x -= activeGroup.left;\n        y -= activeGroup.top;\n      }\n      return { x: x, y: y };\n    },\n\n    _isTargetTransparent: function (target, x, y) {\n        var cacheContext = this.contextCache;\n\n        var hasBorders = target.hasBorders, transparentCorners = target.transparentCorners;\n        target.hasBorders = target.transparentCorners = false;\n\n        this._draw(cacheContext, target);\n\n        target.hasBorders = hasBorders;\n        target.transparentCorners = transparentCorners;\n\n        // If tolerance is > 0 adjust start coords to take into account. If moves off Canvas fix to 0\n        if (this.targetFindTolerance > 0) {\n          if (x > this.targetFindTolerance) {\n            x -= this.targetFindTolerance;\n          }\n          else {\n            x = 0;\n          }\n          if (y > this.targetFindTolerance) {\n            y -= this.targetFindTolerance;\n          }\n          else {\n            y = 0;\n          }\n        }\n\n        var isTransparent = true;\n        var imageData = cacheContext.getImageData(\n          x, y, (this.targetFindTolerance * 2) || 1, (this.targetFindTolerance * 2) || 1);\n\n        // Split image data - for tolerance > 1, pixelDataSize = 4;\n        for (var i = 3; i < imageData.data.length; i += 4) {\n            var temp = imageData.data[i];\n            isTransparent = temp <= 0;\n            if (isTransparent === false) break; //Stop if colour found\n        }\n\n        imageData = null;\n        this.clearContext(cacheContext);\n        return isTransparent;\n    },\n\n    /**\n     * @private\n     * @method _shouldClearSelection\n     */\n    _shouldClearSelection: function (e) {\n      var target = this.findTarget(e),\n          activeGroup = this.getActiveGroup();\n      return (\n        !target || (\n          target &&\n          activeGroup &&\n          !activeGroup.contains(target) &&\n          activeGroup !== target &&\n          !e.shiftKey\n        )\n      );\n    },\n\n    /**\n     * @private\n     * @method _setupCurrentTransform\n     */\n    _setupCurrentTransform: function (e, target) {\n      var action = 'drag',\n          corner,\n          pointer = getPointer(e);\n\n      if (corner = target._findTargetCorner(e, this._offset)) {\n        action = (corner === 'ml' || corner === 'mr')\n          ? 'scaleX'\n          : (corner === 'mt' || corner === 'mb')\n            ? 'scaleY'\n            : corner === 'mtr'\n              ? 'rotate'\n              : (target.hasRotatingPoint)\n                ? 'scale'\n                : 'rotate';\n      }\n\n      this._currentTransform = {\n        target: target,\n        action: action,\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        offsetX: pointer.x - target.left,\n        offsetY: pointer.y - target.top,\n        ex: pointer.x,\n        ey: pointer.y,\n        left: target.left,\n        top: target.top,\n        theta: target._theta,\n        width: target.width * target.scaleX\n      };\n\n      this._currentTransform.original = {\n        left: target.left,\n        top: target.top\n      };\n    },\n\n    _handleGroupLogic: function (e, target) {\n      if (target === this.getActiveGroup()) {\n        // if it's a group, find target again, this time skipping group\n        target = this.findTarget(e, true);\n        // if even object is not found, bail out\n        if (!target || target.isType('group')) {\n          return;\n        }\n      }\n      var activeGroup = this.getActiveGroup();\n      if (activeGroup) {\n        if (activeGroup.contains(target)) {\n          activeGroup.removeWithUpdate(target);\n          target.setActive(false);\n          if (activeGroup.size() === 1) {\n            // remove group alltogether if after removal it only contains 1 object\n            this.discardActiveGroup();\n          }\n        }\n        else {\n          activeGroup.addWithUpdate(target);\n        }\n        this.fire('selection:created', { target: activeGroup, e: e });\n        activeGroup.setActive(true);\n      }\n      else {\n        // group does not exist\n        if (this._activeObject) {\n          // only if there's an active object\n          if (target !== this._activeObject) {\n            // and that object is not the actual target\n            var group = new fabric.Group([ this._activeObject, target ]);\n            this.setActiveGroup(group);\n            activeGroup = this.getActiveGroup();\n          }\n        }\n        // activate target object in any case\n        target.setActive(true);\n      }\n\n      if (activeGroup) {\n        activeGroup.saveCoords();\n      }\n    },\n\n    /**\n     * @private\n     * @method _prepareForDrawing\n     */\n    _prepareForDrawing: function(e) {\n\n      this._isCurrentlyDrawing = true;\n\n      this.discardActiveObject().renderAll();\n\n      var pointer = this.getPointer(e);\n\n      this._freeDrawingXPoints.length = this._freeDrawingYPoints.length = 0;\n\n      this._freeDrawingXPoints.push(pointer.x);\n      this._freeDrawingYPoints.push(pointer.y);\n\n      this.contextTop.beginPath();\n      this.contextTop.moveTo(pointer.x, pointer.y);\n      this.contextTop.strokeStyle = this.freeDrawingColor;\n      this.contextTop.lineWidth = this.freeDrawingLineWidth;\n      this.contextTop.lineCap = this.contextTop.lineJoin = 'round';\n    },\n\n    /**\n     * @private\n     * @method _captureDrawingPath\n     */\n    _captureDrawingPath: function(e) {\n      var pointer = this.getPointer(e);\n\n      this._freeDrawingXPoints.push(pointer.x);\n      this._freeDrawingYPoints.push(pointer.y);\n\n      this.contextTop.lineTo(pointer.x, pointer.y);\n      this.contextTop.stroke();\n    },\n\n    /**\n     * @private\n     * @method _finalizeDrawingPath\n     */\n    _finalizeDrawingPath: function() {\n\n      this.contextTop.closePath();\n\n      this._isCurrentlyDrawing = false;\n\n      var minX = utilMin(this._freeDrawingXPoints),\n          minY = utilMin(this._freeDrawingYPoints),\n          maxX = utilMax(this._freeDrawingXPoints),\n          maxY = utilMax(this._freeDrawingYPoints),\n          ctx = this.contextTop,\n          path = [ ],\n          xPoint,\n          yPoint,\n          xPoints = this._freeDrawingXPoints,\n          yPoints = this._freeDrawingYPoints;\n\n      path.push('M ', xPoints[0] - minX, ' ', yPoints[0] - minY, ' ');\n\n      for (var i = 1; xPoint = xPoints[i], yPoint = yPoints[i]; i++) {\n        path.push('L ', xPoint - minX, ' ', yPoint - minY, ' ');\n      }\n\n      // TODO (kangax): maybe remove Path creation from here, to decouple fabric.Canvas from fabric.Path,\n      // and instead fire something like \"drawing:completed\" event with path string\n\n      path = path.join('');\n\n      if (path === \"M 0 0 L 0 0 \") {\n        // do not create 0 width/height paths, as they are rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot, whereas Chrome 10 renders nothing\n        this.renderAll();\n        return;\n      }\n\n      var p = new fabric.Path(path);\n\n      p.fill = null;\n      p.stroke = this.freeDrawingColor;\n      p.strokeWidth = this.freeDrawingLineWidth;\n      this.add(p);\n      p.set(\"left\", minX + (maxX - minX) / 2).set(\"top\", minY + (maxY - minY) / 2).setCoords();\n      this.renderAll();\n      this.fire('path:created', { path: p });\n    },\n\n    /**\n     * Translates object by \"setting\" its left/top\n     * @method _translateObject\n     * @param x {Number} pointer's x coordinate\n     * @param y {Number} pointer's y coordinate\n     */\n    _translateObject: function (x, y) {\n      var target = this._currentTransform.target;\n      target.lockMovementX || target.set('left', x - this._currentTransform.offsetX);\n      target.lockMovementY || target.set('top', y - this._currentTransform.offsetY);\n    },\n\n    /**\n     * Scales object by invoking its scaleX/scaleY methods\n     * @method _scaleObject\n     * @param x {Number} pointer's x coordinate\n     * @param y {Number} pointer's y coordinate\n     * @param by {String} Either 'x' or 'y' - specifies dimension constraint by which to scale an object.\n     *                    When not provided, an object is scaled by both dimensions equally\n     */\n    _scaleObject: function (x, y, by) {\n      var t = this._currentTransform,\n          offset = this._offset,\n          target = t.target;\n\n      if (target.lockScalingX && target.lockScalingY) return;\n\n      var lastLen = sqrt(pow(t.ey - t.top - offset.top, 2) + pow(t.ex - t.left - offset.left, 2)),\n          curLen = sqrt(pow(y - t.top - offset.top, 2) + pow(x - t.left - offset.left, 2));\n\n      target._scaling = true;\n\n      if (!by) {\n        target.lockScalingX || target.set('scaleX', t.scaleX * curLen/lastLen);\n        target.lockScalingY || target.set('scaleY', t.scaleY * curLen/lastLen);\n      }\n      else if (by === 'x' && !target.lockUniScaling) {\n        target.lockScalingX || target.set('scaleX', t.scaleX * curLen/lastLen);\n      }\n      else if (by === 'y' && !target.lockUniScaling) {\n        target.lockScalingY || target.set('scaleY', t.scaleY * curLen/lastLen);\n      }\n    },\n\n    /**\n     * Rotates object by invoking its rotate method\n     * @method _rotateObject\n     * @param x {Number} pointer's x coordinate\n     * @param y {Number} pointer's y coordinate\n     */\n    _rotateObject: function (x, y) {\n\n      var t = this._currentTransform,\n          o = this._offset;\n\n      if (t.target.lockRotation) return;\n\n      var lastAngle = atan2(t.ey - t.top - o.top, t.ex - t.left - o.left),\n          curAngle = atan2(y - t.top - o.top, x - t.left - o.left);\n\n      t.target._theta = (curAngle - lastAngle) + t.theta;\n    },\n\n    /**\n     * @method _setCursor\n     */\n    _setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @method _setCursorFromEvent\n     * @param e {Event} Event object\n     * @param target {Object} Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      var s = this.upperCanvasEl.style;\n      if (!target) {\n        s.cursor = this.defaultCursor;\n        return false;\n      }\n      else {\n        var activeGroup = this.getActiveGroup();\n        // only show proper corner when group selection is not active\n        var corner = !!target._findTargetCorner\n                      && (!activeGroup || !activeGroup.contains(target))\n                      && target._findTargetCorner(e, this._offset);\n\n        if (!corner) {\n          s.cursor = this.hoverCursor;\n        }\n        else {\n          if (corner in cursorMap) {\n            s.cursor = cursorMap[corner];\n          } else if (corner === 'mtr' && target.hasRotatingPoint) {\n            s.cursor = this.rotationCursor;\n          } else {\n            s.cursor = this.defaultCursor;\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @method _drawSelection\n     * @private\n     */\n    _drawSelection: function () {\n      var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n      this.contextTop.fillStyle = this.selectionColor;\n\n      this.contextTop.fillRect(\n        groupSelector.ex - ((left > 0) ? 0 : -left),\n        groupSelector.ey - ((top > 0) ? 0 : -top),\n        aleft,\n        atop\n      );\n\n      this.contextTop.lineWidth = this.selectionLineWidth;\n      this.contextTop.strokeStyle = this.selectionBorderColor;\n\n      this.contextTop.strokeRect(\n        groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n        groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),\n        aleft,\n        atop\n      );\n    },\n\n    _findSelectedObjects: function (e) {\n      var target,\n          targetRegion,\n          group = [ ],\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          currentObject,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2));\n\n      for (var i = 0, len = this._objects.length; i < len; ++i) {\n        currentObject = this._objects[i];\n\n        if (!currentObject) continue;\n\n        if (currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2)) {\n\n          if (this.selection && currentObject.selectable) {\n            currentObject.setActive(true);\n            group.push(currentObject);\n          }\n        }\n      }\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        var group = new fabric.Group(group);\n        this.setActiveGroup(group);\n        group.saveCoords();\n        this.fire('selection:created', { target: group });\n      }\n\n      this.renderAll();\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * @method findTarget\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, group is skipped and only objects are traversed through\n     */\n    findTarget: function (e, skipGroup) {\n\n      var target,\n          pointer = this.getPointer(e);\n\n      // first check current group (if one exists)\n      var activeGroup = this.getActiveGroup();\n\n      if (activeGroup && !skipGroup && this.containsPoint(e, activeGroup)) {\n        target = activeGroup;\n        return target;\n      }\n\n      // then check all of the objects on canvas\n      // Cache all targets where their bounding box contains point.\n      var possibleTargets = [];\n      for (var i = this._objects.length; i--; ) {\n        if (this._objects[i] && this.containsPoint(e, this._objects[i])) {\n          if (this.perPixelTargetFind || this._objects[i].perPixelTargetFind) {\n            possibleTargets[possibleTargets.length] = this._objects[i];\n          }\n          else {\n            target = this._objects[i];\n            this.relatedTarget = target;\n            break;\n          }\n        }\n      }\n      for (var i = 0, len = possibleTargets.length; i < len; i++) {\n        var pointer = this.getPointer(e);\n        var isTransparent = this._isTargetTransparent(possibleTargets[i], pointer.x, pointer.y);\n        if (!isTransparent) {\n          target = possibleTargets[i];\n          this.relatedTarget = target;\n          break;\n        }\n      }\n      if (target && target.selectable) {\n        return target;\n      }\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * @method getPointer\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e) {\n      var pointer = getPointer(e);\n      return {\n        x: pointer.x - this._offset.left,\n        y: pointer.y - this._offset.top\n      };\n    },\n\n    /**\n     * @method _createUpperCanvas\n     * @param {HTMLElement|String} canvasEl Canvas element\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      this.upperCanvasEl = this._createCanvasElement();\n      this.upperCanvasEl.className = 'upper-canvas';\n\n      this.wrapperEl.appendChild(this.upperCanvasEl);\n\n      this._applyCanvasStyle(this.upperCanvasEl);\n      this.contextTop = this.upperCanvasEl.getContext('2d');\n    },\n\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     * @method _initWrapperElement\n     * @param {Number} width\n     * @param {Number} height\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.getWidth() + 'px',\n        height: this.getHeight() + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @method _applyCanvasStyle\n     * @param {Element} element\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.getWidth() || element.width,\n          height = this.getHeight() || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @method getSelectionContext\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @method getSelectionElement\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * Sets given object as active\n     * @method setActiveObject\n     * @param object {fabric.Object} Object to set as an active one\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      if (this._activeObject) {\n        this._activeObject.setActive(false);\n      }\n      this._activeObject = object;\n      object.setActive(true);\n\n      this.renderAll();\n\n      this.fire('object:selected', { target: object, e: e });\n      object.fire('selected', { e: e });\n      return this;\n    },\n\n    /**\n     * Returns currently active object\n     * @method getActiveObject\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * Discards currently active object\n     * @method discardActiveObject\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function () {\n      if (this._activeObject) {\n        this._activeObject.setActive(false);\n      }\n      this._activeObject = null;\n      return this;\n    },\n\n    /**\n     * Sets active group to a speicified one\n     * @method setActiveGroup\n     * @param {fabric.Group} group Group to set as a current one\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveGroup: function (group) {\n      this._activeGroup = group;\n      group && group.setActive(true);\n      return this;\n    },\n\n    /**\n     * Returns currently active group\n     * @method getActiveGroup\n     * @return {fabric.Group} Current group\n     */\n    getActiveGroup: function () {\n      return this._activeGroup;\n    },\n\n    /**\n     * Removes currently active group\n     * @method discardActiveGroup\n     * @return {fabric.Canvas} thisArg\n     */\n    discardActiveGroup: function () {\n      var g = this.getActiveGroup();\n      if (g) {\n        g.destroy();\n      }\n      return this.setActiveGroup(null);\n    },\n\n    /**\n     * Deactivates all objects by calling their setActive(false)\n     * @method deactivateAll\n     * @return {fabric.Canvas} thisArg\n     */\n    deactivateAll: function () {\n      var allObjects = this.getObjects(),\n          i = 0,\n          len = allObjects.length;\n      for ( ; i < len; i++) {\n        allObjects[i].setActive(false);\n      }\n      this.discardActiveGroup();\n      this.discardActiveObject();\n      return this;\n    },\n\n    /**\n     * Deactivates all objects and dispatches appropriate events\n     * @method deactivateAllWithDispatch\n     * @return {fabric.Canvas} thisArg\n     */\n    deactivateAllWithDispatch: function () {\n      var activeObject = this.getActiveGroup() || this.getActiveObject();\n      if (activeObject) {\n        this.fire('before:selection:cleared', { target: activeObject });\n      }\n      this.deactivateAll();\n      if (activeObject) {\n        this.fire('selection:cleared');\n      }\n      return this;\n    }\n  };\n\n  fabric.Canvas.prototype.toString = fabric.StaticCanvas.prototype.toString;\n  extend(fabric.Canvas.prototype, InteractiveMethods);\n\n  // iterating manually to workaround Opera's bug\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n\n  if (fabric.isTouchSupported) {\n    fabric.Canvas.prototype._setCursorFromEvent = function() { };\n  }\n\n  /**\n   * @class fabric.Element\n   * @alias fabric.Canvas\n   * @deprecated\n   * @constructor\n   */\n  fabric.Element = fabric.Canvas;\n})();\nfabric.util.object.extend(fabric.StaticCanvas.prototype, {\n\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @method fxCenterObjectH\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('left'),\n      endValue: this.getCenter().left,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @method fxCenterObjectV\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('top'),\n      endValue: this.getCenter().top,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @method fxRemove\n   * @param {fabric.Object} object Object to remove\n   * @param {Function} callback Callback, invoked on effect completion\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('opacity'),\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onStart: function() {\n        object.setActive(false);\n      },\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n\n    return this;\n  }\n});\nfabric.util.object.extend(fabric.StaticCanvas.prototype, {\n\n  /**\n   * Populates canvas with data from the specified dataless JSON\n   * JSON format must conform to the one of `fabric.Canvas#toDatalessJSON`\n   * @method loadFromDatalessJSON\n   * @param {String} json JSON string\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: fabric.Image)\n   *                            are initialized\n   * @return {fabric.Canvas} instance\n   * @chainable\n   */\n  loadFromDatalessJSON: function (json, callback) {\n\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : json;\n\n    if (!serialized || (serialized && !serialized.objects)) return;\n\n    this.clear();\n\n    // TODO: test this\n    this.backgroundColor = serialized.background;\n    this._enlivenDatalessObjects(serialized.objects, callback);\n  },\n\n  /**\n   * @method _enlivenDatalessObjects\n   * @param {Array} objects\n   * @param {Function} callback\n   */\n  _enlivenDatalessObjects: function (objects, callback) {\n\n    /** @ignore */\n    function onObjectLoaded(object, index) {\n      _this.insertAt(object, index, true);\n      object.setCoords();\n      if (++numLoadedObjects === numTotalObjects) {\n        callback && callback();\n      }\n    }\n\n    var _this = this,\n        numLoadedObjects = 0,\n        numTotalObjects = objects.length;\n\n    if (numTotalObjects === 0 && callback) {\n      callback();\n    }\n\n    try {\n      objects.forEach(function (obj, index) {\n\n        var pathProp = obj.paths ? 'paths' : 'path';\n        var path = obj[pathProp];\n\n        delete obj[pathProp];\n\n        if (typeof path !== 'string') {\n          switch (obj.type) {\n            case 'image':\n              fabric[fabric.util.string.capitalize(obj.type)].fromObject(obj, function (o) {\n                onObjectLoaded(o, index);\n              });\n              break;\n            default:\n              var klass = fabric[fabric.util.string.camelize(fabric.util.string.capitalize(obj.type))];\n              if (klass && klass.fromObject) {\n                // restore path\n                if (path) {\n                  obj[pathProp] = path;\n                }\n                onObjectLoaded(klass.fromObject(obj), index);\n              }\n              break;\n          }\n        }\n        else {\n          if (obj.type === 'image') {\n            fabric.util.loadImage(path, function (image) {\n              var oImg = new fabric.Image(image);\n\n              oImg.setSourcePath(path);\n\n              fabric.util.object.extend(oImg, obj);\n              oImg.setAngle(obj.angle);\n\n              onObjectLoaded(oImg, index);\n            });\n          }\n          else if (obj.type === 'text') {\n\n            if (obj.useNative) {\n              onObjectLoaded(fabric.Text.fromObject(obj), index);\n            }\n            else {\n              obj.path = path;\n              var object = fabric.Text.fromObject(obj);\n              var onscriptload = function () {\n                // TODO (kangax): find out why Opera refuses to work without this timeout\n                if (Object.prototype.toString.call(fabric.window.opera) === '[object Opera]') {\n                  setTimeout(function () {\n                    onObjectLoaded(object, index);\n                  }, 500);\n                }\n                else {\n                  onObjectLoaded(object, index);\n                }\n              }\n\n              fabric.util.getScript(path, onscriptload);\n            }\n          }\n          else {\n            fabric.loadSVGFromURL(path, function (elements, options) {\n              var object = fabric.util.groupSVGElements(elements, obj, path);\n\n              // copy parameters from serialied json to object (left, top, scaleX, scaleY, etc.)\n              // skip this step if an object is a PathGroup, since we already passed it options object before\n              if (!(object instanceof fabric.PathGroup)) {\n                fabric.util.object.extend(object, obj);\n                if (typeof obj.angle !== 'undefined') {\n                  object.setAngle(obj.angle);\n                }\n              }\n\n              onObjectLoaded(object, index);\n            });\n          }\n        }\n      }, this);\n    }\n    catch(e) {\n      fabric.log(e.message);\n    }\n  },\n\n  /**\n   * Populates canvas with data from the specified JSON\n   * JSON format must conform to the one of `fabric.Canvas#toJSON`\n   * @method loadFromJSON\n   * @param {String} json JSON string\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: fabric.Image)\n   *                            are initialized\n   * @return {fabric.Canvas} instance\n   * @chainable\n   */\n  loadFromJSON: function (json, callback) {\n    if (!json) return;\n\n    var serialized = JSON.parse(json);\n    if (!serialized || (serialized && !serialized.objects)) return;\n\n    this.clear();\n    var _this = this;\n    this._enlivenObjects(serialized.objects, function () {\n      _this.backgroundColor = serialized.background;\n\n      if (serialized.backgroundImage) {\n        _this.setBackgroundImage(serialized.backgroundImage, function() {\n\n          _this.backgroundImageOpacity = serialized.backgroundImageOpacity;\n          _this.backgroundImageStretch = serialized.backgroundImageStretch;\n\n          _this.renderAll();\n\n          callback && callback();\n        });\n      }\n      else {\n        callback && callback();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * @method _enlivenObjects\n   * @param {Array} objects\n   * @param {Function} callback\n   */\n  _enlivenObjects: function (objects, callback) {\n    var _this = this;\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      enlivenedObjects.forEach(function(obj, index) {\n        _this.insertAt(obj, index, true);\n      });\n      callback && callback();\n    });\n  },\n\n  /**\n   * @private\n   * @method _toDataURL\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @method _toDataURLWithMultiplier\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @method clone\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  clone: function (callback) {\n    var data = JSON.stringify(this);\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @method cloneWithoutData\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.document.createElement('canvas');\n\n    el.width = this.getWidth();\n    el.height = this.getHeight();\n\n    var clone = new fabric.Canvas(el);\n    clone.clipTo = this.clipTo;\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      slice = Array.prototype.slice;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * @class Object\n   * @memberOf fabric\n   */\n  fabric.Object = fabric.util.createClass(/** @scope fabric.Object.prototype */ {\n\n    /**\n     * Type of an object (rect, circle, path, etc)\n     * @property\n     * @type String\n     */\n    type:                       'object',\n\n    /**\n     * @property\n     * @type Number\n     */\n    top:                      0,\n\n    /**\n     * @property\n     * @type Number\n     */\n    left:                     0,\n\n    /**\n     * @property\n     * @type Number\n     */\n    width:                    0,\n\n    /**\n     * @property\n     * @type Number\n     */\n    height:                   0,\n\n    /**\n     * @property\n     * @type Number\n     */\n    scaleX:                   1,\n\n    /**\n     * @property\n     * @type Number\n     */\n    scaleY:                   1,\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    flipX:                    false,\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    flipY:                    false,\n\n    /**\n     * @property\n     * @type Number\n     */\n    opacity:                  1,\n\n    /**\n     * @property\n     * @type Number\n     */\n    angle:                    0,\n\n    /**\n     * @property\n     * @type Number\n     */\n    cornersize:               12,\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    transparentCorners:       true,\n\n    /**\n     * @property\n     * @type Number\n     */\n    padding:                  0,\n\n    /**\n     * @property\n     * @type String\n     */\n    borderColor:              'rgba(102,153,255,0.75)',\n\n    /**\n     * @property\n     * @type String\n     */\n    cornerColor:              'rgba(102,153,255,0.5)',\n\n    /**\n     * @property\n     * @type String\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * @property\n     * @type String\n     */\n    fillRule:                 'source-over',\n\n    /**\n     * @property\n     * @type String\n     */\n    overlayFill:              null,\n\n    /**\n     * @property\n     * @type String\n     */\n    stroke:                   null,\n\n    /**\n     * @property\n     * @type Number\n     */\n    strokeWidth:              1,\n\n    /**\n     * @property\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * @property\n     * @type Number\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * @property\n     * @type Number\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Transform matrix\n     * @property\n     * @type Array\n     */\n    transformMatrix:          null,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection)\n     * @property\n     * @type Boolean\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @property\n     * @type Boolean\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's borders are not rendered\n     * @property\n     * @type Boolean\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `false`, object's rotating point will not be visible or selectable\n     * @property\n     * @type Boolean\n     */\n    hasRotatingPoint:         false,\n\n    /**\n     * Offset for object's rotating point (when enabled)\n     * @property\n     * @type Number\n     */\n    rotatingPointOffset:      40,\n\n    /**\n     * @private\n     * @property\n     * @type Number\n     */\n    _theta:                   0,\n\n    perPixelTargetFind:       false,\n\n    includeDefaultValues:     true,\n\n    /**\n     * List of properties to consider when checking if state of an object is changed (fabric.Object#hasStateChanged);\n     * as well as for history (undo/redo) purposes\n     * @property\n     * @type Array\n     */\n    stateProperties:  (\n      'top left width height scaleX scaleY flipX flipY ' +\n      'theta angle opacity cornersize fill overlayFill ' +\n      'stroke strokeWidth strokeDashArray fillRule ' +\n      'borderScaleFactor transformMatrix selectable'\n    ).split(' '),\n\n    /**\n     * @method callSuper\n     * @param {String} methodName\n     */\n    callSuper: function(methodName) {\n      var fn = this.constructor.superclass.prototype[methodName];\n      return (arguments.length > 1)\n        ? fn.apply(this, slice.call(arguments, 1))\n        : fn.call(this);\n    },\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      if (options) {\n        this.setOptions(options);\n        this._initGradient(options);\n      }\n    },\n\n    /**\n     * @method initGradient\n     */\n    _initGradient: function(options) {\n      if (options.fill && typeof options.fill == 'object' && !(options.fill instanceof fabric.Gradient)) {\n        this.set('fill', new fabric.Gradient(options.fill));\n      }\n    },\n\n    /**\n     * @method setOptions\n     * @param {Object} [options]\n     */\n    setOptions: function(options) {\n      var i = this.stateProperties.length, prop;\n      while (i--) {\n        prop = this.stateProperties[i];\n        if (prop in options) {\n          this.set(prop, options[prop]);\n        }\n      }\n    },\n\n    /**\n     * @method transform\n     * @param {CanvasRenderingContext2D} ctx Context\n     */\n    transform: function(ctx) {\n      ctx.globalAlpha = this.opacity;\n      ctx.translate(this.left, this.top);\n      ctx.rotate(this._theta);\n      ctx.scale(\n        this.scaleX * (this.flipX ? -1 : 1),\n        this.scaleY * (this.flipY ? -1 : 1)\n      );\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @method toObject\n     * @return {Object}\n     */\n    toObject: function() {\n\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      var object = {\n        type:             this.type,\n        left:             toFixed(this.left, NUM_FRACTION_DIGITS),\n        top:              toFixed(this.top, NUM_FRACTION_DIGITS),\n        width:            toFixed(this.width, NUM_FRACTION_DIGITS),\n        height:           toFixed(this.height, NUM_FRACTION_DIGITS),\n        fill:             (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n        overlayFill:      this.overlayFill,\n        stroke:           this.stroke,\n        strokeWidth:      this.strokeWidth,\n        strokeDashArray:  this.strokeDashArray,\n        scaleX:           toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n        scaleY:           toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n        angle:            toFixed(this.getAngle(), NUM_FRACTION_DIGITS),\n        flipX:            this.flipX,\n        flipY:            this.flipY,\n        opacity:          toFixed(this.opacity, NUM_FRACTION_DIGITS),\n        selectable:       this.selectable,\n        hasControls:      this.hasControls,\n        hasBorders:       this.hasBorders,\n        hasRotatingPoint: this.hasRotatingPoint,\n        transparentCorners: this.transparentCorners,\n        perPixelTargetFind: this.perPixelTargetFind\n      };\n\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @method toDatalessObject\n     */\n    toDatalessObject: function() {\n      // will be overwritten by subclasses\n      return this.toObject();\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @method getSvgStyles\n     * @return {string}\n     */\n    getSvgStyles: function() {\n      return [\n        \"stroke: \", (this.stroke ? this.stroke : 'none'), \"; \",\n        \"stroke-width: \", (this.strokeWidth ? this.strokeWidth : '0'), \"; \",\n        \"stroke-dasharray: \", (this.strokeDashArray ? this.strokeDashArray.join(' ') : \"; \"),\n        \"fill: \", (this.fill ? this.fill : 'none'), \"; \",\n        \"opacity: \", (this.opacity ? this.opacity : '1'), \";\"\n      ].join(\"\");\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @method getSvgTransform\n     * @return {string}\n     */\n    getSvgTransform: function() {\n      var angle = this.getAngle();\n      return [\n        \"translate(\", toFixed(this.left, 2), \" \", toFixed(this.top, 2), \")\",\n        angle !== 0 ? (\" rotate(\" + toFixed(angle, 2) + \")\") : '',\n        (this.scaleX === 1 && this.scaleY === 1) ? '' : (\" scale(\" + toFixed(this.scaleX, 2) + \" \" + toFixed(this.scaleY, 2) + \")\")\n      ].join('');\n    },\n\n    /**\n     * @private\n     * @method _removeDefaultValues\n     */\n    _removeDefaultValues: function(object) {\n      var defaultOptions = fabric.Object.prototype.options;\n      if (defaultOptions) {\n        this.stateProperties.forEach(function(prop) {\n          if (object[prop] === defaultOptions[prop]) {\n            delete object[prop];\n          }\n        });\n      }\n      return object;\n    },\n\n    /**\n     * Returns true if an object is in its active state\n     * @return {Boolean} true if an object is in its active state\n     */\n    isActive: function() {\n      return !!this.active;\n    },\n\n    /**\n     * Sets state of an object - `true` makes it active, `false` - inactive\n     * @param {Boolean} active\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setActive: function(active) {\n      this.active = !!active;\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return \"#<fabric.\" + capitalize(this.type) + \">\";\n    },\n\n    /**\n     * Sets property to a given value\n     * @method set\n     * @param {String} name\n     * @param {Object|Function} value\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    set: function(key, value) {\n      if (typeof key === 'object') {\n        for (var prop in key) {\n          this._set(prop, key[prop]);\n        }\n      }\n      else {\n        if (typeof value === 'function') {\n          this._set(key, value(this.get(key)));\n        }\n        else {\n          this._set(key, value);\n        }\n      }\n      return this;\n    },\n\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY') &&\n                                  value < fabric.Object.MIN_SCALE_LIMIT;\n\n      if (shouldConstrainValue) {\n        value = fabric.Object.MIN_SCALE_LIMIT;\n      }\n      if (key === 'angle') {\n        this.setAngle(value);\n      }\n      else {\n        this[key] = value;\n      }\n    },\n\n    /**\n     * Toggles specified property from `true` to `false` or from `false` to `true`\n     * @method toggle\n     * @param {String} property property to toggle\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    toggle: function(property) {\n      var value = this.get(property);\n      if (typeof value === 'boolean') {\n        this.set(property, !value);\n      }\n      return this;\n    },\n\n    /**\n     * @method setSourcePath\n     * @param {String} value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setSourcePath: function(value) {\n      this.sourcePath = value;\n      return this;\n    },\n\n    /**\n     * Basic getter\n     * @method get\n     * @param {Any} property\n     * @return {Any} value of a property\n     */\n    get: function(property) {\n      return (property === 'angle')\n        ? this.getAngle()\n        : this[property];\n    },\n\n    /**\n     * @method render\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     * @param {Boolean} noTransform\n     */\n    render: function(ctx, noTransform) {\n\n      // do not render if width or height are zeros\n      if (this.width === 0 || this.height === 0) return;\n\n      ctx.save();\n\n      var m = this.transformMatrix;\n      if (m && !this.group) {\n        ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n\n      if (!noTransform) {\n        this.transform(ctx);\n      }\n\n      if (this.stroke || this.strokeDashArray) {\n        ctx.lineWidth = this.strokeWidth;\n        ctx.strokeStyle = this.stroke;\n      }\n\n      if (this.overlayFill) {\n        ctx.fillStyle = this.overlayFill;\n      }\n      else if (this.fill) {\n        ctx.fillStyle = this.fill.toLiveGradient\n          ? this.fill.toLiveGradient(ctx)\n          : this.fill;\n      }\n\n      if (m && this.group) {\n        ctx.translate(-this.group.width/2, -this.group.height/2);\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n\n      this._render(ctx, noTransform);\n\n      if (this.active && !noTransform) {\n        this.drawBorders(ctx);\n        this.drawCorners(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Returns width of an object\n     * @method getWidth\n     * @return {Number} width value\n     */\n    getWidth: function() {\n      return this.width * this.scaleX;\n    },\n\n    /**\n     * Returns height of an object\n     * @method getHeight\n     * @return {Number} height value\n     */\n    getHeight: function() {\n      return this.height * this.scaleY;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @method scale\n     * @param value {Number} scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      this.scaleX = value;\n      this.scaleY = value;\n      this.setCoords();\n      return this;\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @method scaleToWidth\n     * @param value {Number} new width value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRectWidth() / this.getWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @method scaleToHeight\n     * @param value {Number} new height value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRectHeight() / this.getHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    /**\n     * Sets object opacity\n     * @method setOpacity\n     * @param value {Number} value 0-1\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setOpacity: function(value) {\n      this.set('opacity', value);\n      return this;\n    },\n\n    /**\n     * Returns object's angle value\n     * @method getAngle\n     * @return {Number} angle value\n     */\n    getAngle: function() {\n      return this._theta * 180 / Math.PI;\n    },\n\n    /**\n     * Sets object's angle\n     * @method setAngle\n     * @param value {Number} angle value\n     * @return {Object} thisArg\n     */\n    setAngle: function(value) {\n      this._theta = value / 180 * Math.PI;\n      this.angle = value;\n      return this;\n    },\n\n    /**\n     * Sets corner position coordinates based on current angle, width and height.\n     * @method setCoords\n     * return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function() {\n\n      var strokeWidth = this.strokeWidth > 1 ? this.strokeWidth : 0,\n          padding = this.padding;\n\n      this.currentWidth = (this.width + strokeWidth) * this.scaleX + padding * 2;\n      this.currentHeight = (this.height + strokeWidth) * this.scaleY + padding * 2;\n\n      this._hypotenuse = Math.sqrt(\n        Math.pow(this.currentWidth / 2, 2) +\n        Math.pow(this.currentHeight / 2, 2));\n\n      this._angle = Math.atan(this.currentHeight / this.currentWidth);\n\n      // offset added for rotate and scale actions\n      var offsetX = Math.cos(this._angle + this._theta) * this._hypotenuse,\n          offsetY = Math.sin(this._angle + this._theta) * this._hypotenuse,\n          theta = this._theta,\n          sinTh = Math.sin(theta),\n          cosTh = Math.cos(theta);\n\n      var tl = {\n        x: this.left - offsetX,\n        y: this.top - offsetY\n      };\n      var tr = {\n        x: tl.x + (this.currentWidth * cosTh),\n        y: tl.y + (this.currentWidth * sinTh)\n      };\n      var br = {\n        x: tr.x - (this.currentHeight * sinTh),\n        y: tr.y + (this.currentHeight * cosTh)\n      };\n      var bl = {\n        x: tl.x - (this.currentHeight * sinTh),\n        y: tl.y + (this.currentHeight * cosTh)\n      };\n      var ml = {\n        x: tl.x - (this.currentHeight/2 * sinTh),\n        y: tl.y + (this.currentHeight/2 * cosTh)\n      };\n      var mt = {\n        x: tl.x + (this.currentWidth/2 * cosTh),\n        y: tl.y + (this.currentWidth/2 * sinTh)\n      };\n      var mr = {\n        x: tr.x - (this.currentHeight/2 * sinTh),\n        y: tr.y + (this.currentHeight/2 * cosTh)\n      };\n      var mb = {\n        x: bl.x + (this.currentWidth/2 * cosTh),\n        y: bl.y + (this.currentWidth/2 * sinTh)\n      };\n      var mtr = {\n        x: tl.x + (this.currentWidth/2 * cosTh),\n        y: tl.y + (this.currentWidth/2 * sinTh)\n      };\n\n      // debugging\n\n      // setTimeout(function() {\n      //         canvas.contextTop.fillStyle = 'green';\n      //         canvas.contextTop.fillRect(mb.x, mb.y, 3, 3);\n      //         canvas.contextTop.fillRect(bl.x, bl.y, 3, 3);\n      //         canvas.contextTop.fillRect(br.x, br.y, 3, 3);\n      //         canvas.contextTop.fillRect(tl.x, tl.y, 3, 3);\n      //         canvas.contextTop.fillRect(tr.x, tr.y, 3, 3);\n      //         canvas.contextTop.fillRect(ml.x, ml.y, 3, 3);\n      //         canvas.contextTop.fillRect(mr.x, mr.y, 3, 3);\n      //         canvas.contextTop.fillRect(mt.x, mt.y, 3, 3);\n      //       }, 50);\n\n      // clockwise\n      this.oCoords = { tl: tl, tr: tr, br: br, bl: bl, ml: ml, mt: mt, mr: mr, mb: mb, mtr: mtr };\n\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      this._setCornerCoords();\n\n      return this;\n    },\n\n     /**\n     * Returns width of an object's bounding rectangle\n     * @method getBoundingRectWidth\n     * @return {Number} width value\n     */\n    getBoundingRectWidth: function() {\n      this.oCoords || this.setCoords();\n      var xCoords = [this.oCoords.tl.x, this.oCoords.tr.x, this.oCoords.br.x, this.oCoords.bl.x];\n      var minX = fabric.util.array.min(xCoords);\n      var maxX = fabric.util.array.max(xCoords);\n      return Math.abs(minX - maxX);\n    },\n\n    /**\n     * Returns height of an object's bounding rectangle\n     * @method getBoundingRectHeight\n     * @return {Number} height value\n     */\n    getBoundingRectHeight: function() {\n      this.oCoords || this.setCoords();\n      var yCoords = [this.oCoords.tl.y, this.oCoords.tr.y, this.oCoords.br.y, this.oCoords.bl.y];\n      var minY = fabric.util.array.min(yCoords);\n      var maxY = fabric.util.array.max(yCoords);\n      return Math.abs(minY - maxY);\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @method drawBorders\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx) {\n      if (!this.hasBorders) return;\n\n      var MIN_SCALE_LIMIT = fabric.Object.MIN_SCALE_LIMIT,\n          padding = this.padding,\n          padding2 = padding * 2,\n          strokeWidth = this.strokeWidth > 1 ? this.strokeWidth : 0;\n\n      ctx.save();\n\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      ctx.strokeStyle = this.borderColor;\n\n      var scaleX = 1 / (this.scaleX < MIN_SCALE_LIMIT ? MIN_SCALE_LIMIT : this.scaleX),\n          scaleY = 1 / (this.scaleY < MIN_SCALE_LIMIT ? MIN_SCALE_LIMIT : this.scaleY);\n\n      ctx.lineWidth = 1 / this.borderScaleFactor;\n\n      ctx.scale(scaleX, scaleY);\n\n      var w = this.getWidth(),\n          h = this.getHeight();\n\n      ctx.strokeRect(\n        ~~(-(w / 2) - padding - strokeWidth / 2 * this.scaleX) + 0.5, // offset needed to make lines look sharper\n        ~~(-(h / 2) - padding - strokeWidth / 2 * this.scaleY) + 0.5,\n        ~~(w + padding2 + strokeWidth * this.scaleX),\n        ~~(h + padding2 + strokeWidth * this.scaleY)\n      );\n\n      if (this.hasRotatingPoint && !this.lockRotation && this.hasControls) {\n\n        var rotateHeight = (\n          this.flipY\n            ? h + (strokeWidth * this.scaleY) + (padding * 2)\n            : -h - (strokeWidth * this.scaleY) - (padding * 2)\n        ) / 2;\n\n        var rotateWidth = (-w/2);\n\n        ctx.beginPath();\n        ctx.moveTo(0, rotateHeight);\n        ctx.lineTo(0, rotateHeight + (this.flipY ? this.rotatingPointOffset : -this.rotatingPointOffset));\n        ctx.closePath();\n        ctx.stroke();\n      }\n\n      ctx.restore();\n      return this;\n    },\n\n    _renderDashedStroke: function(ctx) {\n\n      if (1 & this.strokeDashArray.length /* if odd number of items */) {\n        /* duplicate items */\n        this.strokeDashArray.push.apply(this.strokeDashArray, this.strokeDashArray);\n      }\n\n      var i = 0,\n          x = -this.width/2, y = -this.height/2,\n          _this = this,\n          padding = this.padding,\n          width = this.getWidth(),\n          height = this.getHeight(),\n          dashedArrayLength = this.strokeDashArray.length;\n\n      ctx.save();\n      ctx.beginPath();\n\n      function renderSide(xMultiplier, yMultiplier) {\n\n        var lineLength = 0,\n            sideLength = (yMultiplier ? _this.height : _this.width) + padding * 2;\n\n        while (lineLength < sideLength) {\n\n          var lengthOfSubPath = _this.strokeDashArray[i++];\n          lineLength += lengthOfSubPath;\n\n          if (lineLength > sideLength) {\n            var lengthDiff = lineLength - sideLength;\n          }\n\n          // track coords\n          if (xMultiplier) {\n            x += (lengthOfSubPath * xMultiplier) - (lengthDiff * xMultiplier || 0);\n          }\n          else {\n            y += (lengthOfSubPath * yMultiplier) - (lengthDiff * yMultiplier || 0);\n          }\n\n          ctx[1 & i /* odd */ ? 'moveTo' : 'lineTo'](x, y);\n          if (i >= dashedArrayLength) {\n            i = 0;\n          }\n        }\n      }\n\n      renderSide(1, 0);\n      renderSide(0, 1);\n      renderSide(-1, 0);\n      renderSide(0, -1);\n\n      ctx.stroke();\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height, scaleX, scaleY\n     * Requires public options: cornersize, padding\n     * @method drawCorners\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawCorners: function(ctx) {\n      if (!this.hasControls) return;\n\n      var size = this.cornersize,\n          size2 = size / 2,\n          strokeWidth2 = this.strokeWidth / 2,\n          left = -(this.width / 2),\n          top = -(this.height / 2),\n          _left,\n          _top,\n          sizeX = size / this.scaleX,\n          sizeY = size / this.scaleY,\n          paddingX = this.padding / this.scaleX,\n          paddingY = this.padding / this.scaleY,\n          scaleOffsetY = size2 / this.scaleY,\n          scaleOffsetX = size2 / this.scaleX,\n          scaleOffsetSizeX = (size2 - size) / this.scaleX,\n          scaleOffsetSizeY = (size2 - size) / this.scaleY,\n          height = this.height,\n          width = this.width,\n          methodName = this.transparentCorners ? 'strokeRect' : 'fillRect';\n\n      ctx.save();\n\n      ctx.lineWidth = 1 / Math.max(this.scaleX, this.scaleY);\n\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      ctx.strokeStyle = ctx.fillStyle = this.cornerColor;\n\n      // top-left\n      _left = left - scaleOffsetX - strokeWidth2 - paddingX;\n      _top = top - scaleOffsetY - strokeWidth2 - paddingY;\n\n      ctx.clearRect(_left, _top, sizeX, sizeY);\n      ctx[methodName](_left, _top, sizeX, sizeY);\n\n      // top-right\n      _left = left + width - scaleOffsetX + strokeWidth2 + paddingX;\n      _top = top - scaleOffsetY - strokeWidth2 - paddingY;\n\n      ctx.clearRect(_left, _top, sizeX, sizeY);\n      ctx[methodName](_left, _top, sizeX, sizeY);\n\n      // bottom-left\n      _left = left - scaleOffsetX - strokeWidth2 - paddingX;\n      _top = top + height + scaleOffsetSizeY + strokeWidth2 + paddingY;\n\n      ctx.clearRect(_left, _top, sizeX, sizeY);\n      ctx[methodName](_left, _top, sizeX, sizeY);\n\n      // bottom-right\n      _left = left + width + scaleOffsetSizeX + strokeWidth2 + paddingX;\n      _top = top + height + scaleOffsetSizeY + strokeWidth2 + paddingY;\n\n      ctx.clearRect(_left, _top, sizeX, sizeY);\n      ctx[methodName](_left, _top, sizeX, sizeY);\n\n      if (!this.lockUniScaling) {\n        // middle-top\n        _left = left + width/2 - scaleOffsetX;\n        _top = top - scaleOffsetY - strokeWidth2 - paddingY;\n\n        ctx.clearRect(_left, _top, sizeX, sizeY);\n        ctx[methodName](_left, _top, sizeX, sizeY);\n\n        // middle-bottom\n        _left = left + width/2 - scaleOffsetX;\n        _top = top + height + scaleOffsetSizeY + strokeWidth2 + paddingY;\n\n        ctx.clearRect(_left, _top, sizeX, sizeY);\n        ctx[methodName](_left, _top, sizeX, sizeY);\n\n        // middle-right\n        _left = left + width + scaleOffsetSizeX + strokeWidth2 + paddingX;\n        _top = top + height/2 - scaleOffsetY;\n\n        ctx.clearRect(_left, _top, sizeX, sizeY);\n        ctx[methodName](_left, _top, sizeX, sizeY);\n\n        // middle-left\n        _left = left - scaleOffsetX - strokeWidth2 - paddingX;\n        _top = top + height/2 - scaleOffsetY;\n\n        ctx.clearRect(_left, _top, sizeX, sizeY);\n        ctx[methodName](_left, _top, sizeX, sizeY);\n      }\n\n      // middle-top-rotate\n      if (this.hasRotatingPoint) {\n\n        _left = left + width/2 - scaleOffsetX;\n\n        _top = this.flipY ?\n          (top + height + (this.rotatingPointOffset / this.scaleY) - sizeY/2 + strokeWidth2 + paddingY)\n          : (top - (this.rotatingPointOffset / this.scaleY) - sizeY/2 - strokeWidth2 - paddingY);\n\n        ctx.clearRect(_left, _top, sizeX, sizeY);\n        ctx[methodName](_left, _top, sizeX, sizeY);\n      }\n\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * Clones an instance\n     * @method clone\n     * @param {Object} options object\n     * @return {fabric.Object} clone of an instance\n     */\n    clone: function(options) {\n      if (this.constructor.fromObject) {\n        return this.constructor.fromObject(this.toObject(), options);\n      }\n      return new fabric.Object(this.toObject());\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * @method cloneAsImage\n     * @param callback {Function} callback, invoked with an instance as a first argument\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    cloneAsImage: function(callback) {\n      if (fabric.Image) {\n        var i = new Image();\n\n        /** @ignore */\n        i.onload = function() {\n          if (callback) {\n            callback(new fabric.Image(i), orig);\n          }\n          i = i.onload = null;\n        };\n\n        var orig = {\n          angle: this.get('angle'),\n          flipX: this.get('flipX'),\n          flipY: this.get('flipY')\n        };\n\n        // normalize angle\n        this.set('angle', 0).set('flipX', false).set('flipY', false);\n        this.toDataURL(function(dataURL) {\n          i.src = dataURL;\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @method toDataURL\n     * @return {String} string of data\n     */\n    toDataURL: function(callback) {\n      var el = fabric.document.createElement('canvas');\n      if (!el.getContext && typeof G_vmlCanvasManager != 'undefined') {\n        G_vmlCanvasManager.initElement(el);\n      }\n\n      el.width = this.getBoundingRectWidth();\n      el.height = this.getBoundingRectHeight();\n\n      fabric.util.wrapElement(el, 'div');\n\n      var canvas = new fabric.Canvas(el);\n      canvas.backgroundColor = 'transparent';\n      canvas.renderAll();\n\n      if (this.constructor.async) {\n        this.clone(proceed);\n      }\n      else {\n        proceed(this.clone());\n      }\n\n      function proceed(clone) {\n        clone.left = el.width / 2;\n        clone.top = el.height / 2;\n\n        clone.setActive(false);\n\n        canvas.add(clone);\n        var data = canvas.toDataURL('png');\n\n        canvas.dispose();\n        canvas = clone = null;\n\n        callback && callback(data);\n      }\n    },\n\n    /**\n     * @method hasStateChanged\n     * @return {Boolean} true if instance' state has changed\n     */\n    hasStateChanged: function() {\n      return this.stateProperties.some(function(prop) {\n        return this[prop] !== this.originalState[prop];\n      }, this);\n    },\n\n    /**\n     * @method saveState\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    saveState: function() {\n      this.stateProperties.forEach(function(prop) {\n        this.originalState[prop] = this.get(prop);\n      }, this);\n      return this;\n    },\n\n    /**\n     * @method setupState\n     */\n    setupState: function() {\n      this.originalState = { };\n      this.saveState();\n    },\n\n    /**\n     * Returns true if object intersects with an area formed by 2 points\n     * @method intersectsWithRect\n     * @param {Object} selectionTL\n     * @param {Object} selectionBR\n     * @return {Boolean}\n     */\n    intersectsWithRect: function(selectionTL, selectionBR) {\n      var oCoords = this.oCoords,\n          tl = new fabric.Point(oCoords.tl.x, oCoords.tl.y),\n          tr = new fabric.Point(oCoords.tr.x, oCoords.tr.y),\n          bl = new fabric.Point(oCoords.bl.x, oCoords.bl.y),\n          br = new fabric.Point(oCoords.br.x, oCoords.br.y);\n\n      var intersection = fabric.Intersection.intersectPolygonRectangle(\n        [tl, tr, br, bl],\n        selectionTL,\n        selectionBR\n      );\n      return (intersection.status === 'Intersection');\n    },\n\n    /**\n     * Returns true if object intersects with another object\n     * @method intersectsWithObject\n     * @param {Object} other Object to test\n     * @return {Boolean}\n     */\n    intersectsWithObject: function(other) {\n      // extracts coords\n      function getCoords(oCoords) {\n        return {\n          tl: new fabric.Point(oCoords.tl.x, oCoords.tl.y),\n          tr: new fabric.Point(oCoords.tr.x, oCoords.tr.y),\n          bl: new fabric.Point(oCoords.bl.x, oCoords.bl.y),\n          br: new fabric.Point(oCoords.br.x, oCoords.br.y)\n        }\n      }\n      var thisCoords = getCoords(this.oCoords),\n          otherCoords = getCoords(other.oCoords);\n\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n        [thisCoords.tl, thisCoords.tr, thisCoords.br, thisCoords.bl],\n        [otherCoords.tl, otherCoords.tr, otherCoords.br, otherCoords.bl]\n      );\n\n      return (intersection.status === 'Intersection');\n    },\n\n    /**\n     * Returns true if object is fully contained within area of another object\n     * @method isContainedWithinObject\n     * @param {Object} other Object to test\n     * @return {Boolean}\n     */\n    isContainedWithinObject: function(other) {\n      return this.isContainedWithinRect(other.oCoords.tl, other.oCoords.br);\n    },\n\n    /**\n     * Returns true if object is fully contained within area formed by 2 points\n     * @method isContainedWithinRect\n     * @param {Object} selectionTL\n     * @param {Object} selectionBR\n     * @return {Boolean}\n     */\n    isContainedWithinRect: function(selectionTL, selectionBR) {\n      var oCoords = this.oCoords,\n          tl = new fabric.Point(oCoords.tl.x, oCoords.tl.y),\n          tr = new fabric.Point(oCoords.tr.x, oCoords.tr.y),\n          bl = new fabric.Point(oCoords.bl.x, oCoords.bl.y),\n          br = new fabric.Point(oCoords.br.x, oCoords.br.y);\n\n      return tl.x > selectionTL.x\n        && tr.x < selectionBR.x\n        && tl.y > selectionTL.y\n        && bl.y < selectionBR.y;\n    },\n\n    /**\n     * @method isType\n     * @param type {String} type to check against\n     * @return {Boolean} true if specified type is identical to the type of instance\n     */\n    isType: function(type) {\n      return this.type === type;\n    },\n\n    /**\n     * Determines which one of the four corners has been clicked\n     * @method _findTargetCorner\n     * @private\n     * @param e {Event} event object\n     * @param offset {Object} canvas offset\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(e, offset) {\n      if (!this.hasControls || !this.active) return false;\n\n      var pointer = getPointer(e),\n          ex = pointer.x - offset.left,\n          ey = pointer.y - offset.top,\n          xpoints,\n          lines;\n\n      for (var i in this.oCoords) {\n\n        if (i === 'mtr' && !this.hasRotatingPoint) {\n          continue;\n        }\n\n        if (this.lockUniScaling && (i === 'mt' || i === 'mr' || i === 'mb' || i === 'ml')) {\n          continue;\n        }\n\n        lines = this._getImageLines(this.oCoords[i].corner, i);\n\n        // debugging\n\n        // canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xpoints = this._findCrossPoints(ex, ey, lines);\n        if (xpoints % 2 == 1 && xpoints != 0) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 image edges\n     * and the horizontal line determined by the position of our mouse when clicked on canvas\n     * @method _findCrossPoints\n     * @private\n     * @param ex {Number} x coordinate of the mouse\n     * @param ey {Number} y coordinate of the mouse\n     * @param oCoords {Object} Coordinates of the image being evaluated\n     */\n    _findCrossPoints: function(ex, ey, oCoords) {\n      var b1, b2, a1, a2, xi, yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in oCoords) {\n        iLine = oCoords[lineKey];\n        // optimisation 1: line below dot. no cross\n        if ((iLine.o.y < ey) && (iLine.d.y < ey)) {\n          continue;\n        }\n        // optimisation 2: line above dot. no cross\n        if ((iLine.o.y >= ey) && (iLine.d.y >= ey)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x == iLine.d.x) && (iLine.o.x >= ex)) {\n          xi = iLine.o.x;\n          yi = ey;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x);\n          a1 = ey-b1*ex;\n          a2 = iLine.o.y-b2*iLine.o.x;\n\n          xi = - (a1-a2)/(b1-b2);\n          yi = a1+b1*xi;\n        }\n        // dont count xi < ex cases\n        if (xi >= ex) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount == 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Method that returns an object with the image lines in it given the coordinates of the corners\n     * @method _getImageLines\n     * @private\n     * @param oCoords {Object} coordinates of the image corners\n     */\n    _getImageLines: function(oCoords, i) {\n      return {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      }\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * @method _setCornerCoords\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords,\n          theta = degreesToRadians(45 - this.getAngle()),\n          cornerHypotenuse = Math.sqrt(2 * Math.pow(this.cornersize, 2)) / 2,\n          cosHalfOffset = cornerHypotenuse * Math.cos(theta),\n          sinHalfOffset = cornerHypotenuse * Math.sin(theta),\n          sinTh = Math.sin(this._theta),\n          cosTh = Math.cos(this._theta);\n\n      coords.tl.corner = {\n        tl: {\n          x: coords.tl.x - sinHalfOffset,\n          y: coords.tl.y - cosHalfOffset\n        },\n        tr: {\n          x: coords.tl.x + cosHalfOffset,\n          y: coords.tl.y - sinHalfOffset\n        },\n        bl: {\n          x: coords.tl.x - cosHalfOffset,\n          y: coords.tl.y + sinHalfOffset\n        },\n        br: {\n          x: coords.tl.x + sinHalfOffset,\n          y: coords.tl.y + cosHalfOffset\n        }\n      };\n\n      coords.tr.corner = {\n        tl: {\n          x: coords.tr.x - sinHalfOffset,\n          y: coords.tr.y - cosHalfOffset\n        },\n        tr: {\n          x: coords.tr.x + cosHalfOffset,\n          y: coords.tr.y - sinHalfOffset\n        },\n        br: {\n          x: coords.tr.x + sinHalfOffset,\n          y: coords.tr.y + cosHalfOffset\n        },\n        bl: {\n          x: coords.tr.x - cosHalfOffset,\n          y: coords.tr.y + sinHalfOffset\n        }\n      };\n\n      coords.bl.corner = {\n        tl: {\n          x: coords.bl.x - sinHalfOffset,\n          y: coords.bl.y - cosHalfOffset\n        },\n        bl: {\n          x: coords.bl.x - cosHalfOffset,\n          y: coords.bl.y + sinHalfOffset\n        },\n        br: {\n          x: coords.bl.x + sinHalfOffset,\n          y: coords.bl.y + cosHalfOffset\n        },\n        tr: {\n          x: coords.bl.x + cosHalfOffset,\n          y: coords.bl.y - sinHalfOffset\n        }\n      };\n\n      coords.br.corner = {\n        tr: {\n          x: coords.br.x + cosHalfOffset,\n          y: coords.br.y - sinHalfOffset\n        },\n        bl: {\n          x: coords.br.x - cosHalfOffset,\n          y: coords.br.y + sinHalfOffset\n        },\n        br: {\n          x: coords.br.x + sinHalfOffset,\n          y: coords.br.y + cosHalfOffset\n        },\n        tl: {\n          x: coords.br.x - sinHalfOffset,\n          y: coords.br.y - cosHalfOffset\n        }\n      };\n\n      coords.ml.corner = {\n        tl: {\n          x: coords.ml.x - sinHalfOffset,\n          y: coords.ml.y - cosHalfOffset\n        },\n        tr: {\n          x: coords.ml.x + cosHalfOffset,\n          y: coords.ml.y - sinHalfOffset\n        },\n        bl: {\n          x: coords.ml.x - cosHalfOffset,\n          y: coords.ml.y + sinHalfOffset\n        },\n        br: {\n          x: coords.ml.x + sinHalfOffset,\n          y: coords.ml.y + cosHalfOffset\n        }\n      };\n\n      coords.mt.corner = {\n        tl: {\n          x: coords.mt.x - sinHalfOffset,\n          y: coords.mt.y - cosHalfOffset\n        },\n        tr: {\n          x: coords.mt.x + cosHalfOffset,\n          y: coords.mt.y - sinHalfOffset\n        },\n        bl: {\n          x: coords.mt.x - cosHalfOffset,\n          y: coords.mt.y + sinHalfOffset\n        },\n        br: {\n          x: coords.mt.x + sinHalfOffset,\n          y: coords.mt.y + cosHalfOffset\n        }\n      };\n\n      coords.mr.corner = {\n        tl: {\n          x: coords.mr.x - sinHalfOffset,\n          y: coords.mr.y - cosHalfOffset\n        },\n        tr: {\n          x: coords.mr.x + cosHalfOffset,\n          y: coords.mr.y - sinHalfOffset\n        },\n        bl: {\n          x: coords.mr.x - cosHalfOffset,\n          y: coords.mr.y + sinHalfOffset\n        },\n        br: {\n          x: coords.mr.x + sinHalfOffset,\n          y: coords.mr.y + cosHalfOffset\n        }\n      };\n\n      coords.mb.corner = {\n        tl: {\n          x: coords.mb.x - sinHalfOffset,\n          y: coords.mb.y - cosHalfOffset\n        },\n        tr: {\n          x: coords.mb.x + cosHalfOffset,\n          y: coords.mb.y - sinHalfOffset\n        },\n        bl: {\n          x: coords.mb.x - cosHalfOffset,\n          y: coords.mb.y + sinHalfOffset\n        },\n        br: {\n          x: coords.mb.x + sinHalfOffset,\n          y: coords.mb.y + cosHalfOffset\n        }\n      };\n\n      coords.mtr.corner = {\n        tl: {\n          x: coords.mtr.x - sinHalfOffset + (sinTh * this.rotatingPointOffset),\n          y: coords.mtr.y - cosHalfOffset - (cosTh * this.rotatingPointOffset)\n        },\n        tr: {\n          x: coords.mtr.x + cosHalfOffset + (sinTh * this.rotatingPointOffset),\n          y: coords.mtr.y - sinHalfOffset - (cosTh * this.rotatingPointOffset)\n        },\n        bl: {\n          x: coords.mtr.x - cosHalfOffset + (sinTh * this.rotatingPointOffset),\n          y: coords.mtr.y + sinHalfOffset - (cosTh * this.rotatingPointOffset)\n        },\n        br: {\n          x: coords.mtr.x + sinHalfOffset + (sinTh * this.rotatingPointOffset),\n          y: coords.mtr.y + cosHalfOffset - (cosTh * this.rotatingPointOffset)\n        }\n      };\n    },\n\n    /**\n     * Makes object's color grayscale\n     * @method toGrayscale\n     * @return {fabric.Object} thisArg\n     */\n    toGrayscale: function() {\n      var fillValue = this.get('fill');\n      if (fillValue) {\n        this.set('overlayFill', new fabric.Color(fillValue).toGrayscale().toRgb());\n      }\n      return this;\n    },\n\n    /**\n     * @method complexity\n     * @return {Number}\n     */\n    complexity: function() {\n      return 0;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @method toJSON\n     * @return {String} json\n     */\n    toJSON: function() {\n      // delegate, not alias\n      return this.toObject();\n    },\n\n    /**\n     * @method setGradientFill\n     */\n    setGradientFill: function(options) {\n      this.set('fill', fabric.Gradient.forObject(this, options));\n    },\n\n    /**\n     * @method animate\n     *\n     * As object — multiple properties\n     *\n     * object.animate({ left: ..., top: ... });\n     * object.animate({ left: ..., top: ... }, { duration: ... });\n     *\n     * As string — one property\n     *\n     * object.animate('left', ...);\n     * object.animate('left', { duration: ... });\n     *\n     */\n    animate: function() {\n      if (arguments[0] && typeof arguments[0] == 'object') {\n        for (var prop in arguments[0]) {\n          this._animate(prop, arguments[0][prop], arguments[1]);\n        }\n      }\n      else {\n        this._animate.apply(this, arguments);\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @method _animate\n     */\n    _animate: function(property, to, options) {\n      var obj = this;\n\n      options || (options = { });\n\n      if (!('from' in options)) {\n        options.from = this.get(property);\n      }\n\n      if (/[+-]/.test((to + '').charAt(0))) {\n        to = this.get(property) + parseFloat(to);\n      }\n\n      fabric.util.animate({\n        startValue: options.from,\n        endValue: to,\n        byValue: options.by,\n        easing: options.easing,\n        duration: options.duration,\n        onChange: function(value) {\n          obj.set(property, value);\n          options.onChange && options.onChange();\n        },\n        onComplete: function() {\n          obj.setCoords();\n          options.onComplete && options.onComplete();\n        }\n      });\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last\n     * @method centerH\n     * @return {fabric.Object} thisArg\n     */\n    centerH: function () {\n      this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last\n     * @method centerV\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * @method center\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      return this.centerH().centerV();\n    },\n\n    /**\n     * Removes object from canvas to which it was added last\n     * @method remove\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    remove: function() {\n      return this.canvas.remove(this);\n    },\n\n    /**\n     * Moves an object to the bottom of the stack of drawn objects\n     * @method sendToBack\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    sendToBack: function() {\n      this.canvas.sendToBack(this);\n      return this;\n    },\n\n    /**\n     * Moves an object to the top of the stack of drawn objects\n     * @method bringToFront\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    bringToFront: function() {\n      this.canvas.bringToFront(this);\n      return this;\n    },\n\n    /**\n     * Moves an object one level down in stack of drawn objects\n     * @method sendBackwards\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    sendBackwards: function() {\n      this.canvas.sendBackwards(this);\n      return this;\n    },\n\n    /**\n     * Moves an object one level up in stack of drawn objects\n     * @method bringForward\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    bringForward: function() {\n      this.canvas.bringForward(this);\n      return this;\n    }\n  });\n\n  /**\n   * @alias rotate -> setAngle\n   */\n  fabric.Object.prototype.rotate = fabric.Object.prototype.setAngle;\n\n  var proto = fabric.Object.prototype;\n  for (var i = proto.stateProperties.length; i--; ) {\n\n    var propName = proto.stateProperties[i],\n        capitalizedPropName = propName.charAt(0).toUpperCase() + propName.slice(1),\n        setterName = 'set' + capitalizedPropName,\n        getterName = 'get' + capitalizedPropName;\n\n    // using `new Function` for better introspection\n    if (!proto[getterName]) {\n      proto[getterName] = (function(property) {\n        return new Function('return this.get(\"' + property + '\")');\n      })(propName);\n    }\n    if (!proto[setterName]) {\n      proto[setterName] = (function(property) {\n        return new Function('value', 'return this.set(\"' + property + '\", value)');\n      })(propName);\n    }\n  }\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  extend(fabric.Object, {\n\n    /**\n     * @static\n     * @constant\n     * @type Number\n     */\n    NUM_FRACTION_DIGITS:        2,\n\n    /**\n     * @static\n     * @constant\n     * @type Number\n     */\n    MIN_SCALE_LIMIT:            0.1\n\n  });\n\n})(typeof exports != 'undefined' ? exports : this);\n\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      parentSet = fabric.Object.prototype.set,\n      coordProps = { 'x1': 1, 'x2': 1, 'y1': 1, 'y2': 1 };\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  /**\n   * @class Line\n   * @extends fabric.Object\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @scope fabric.Line.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'line',\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Array} points Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @method _setWidthHeight\n     * @param {Object} options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.set('width', (this.x2 - this.x1) || 1);\n      this.set('height', (this.y2 - this.y1) || 1);\n\n      this.set('left', 'left' in options ? options.left : (this.x1 + this.width / 2));\n      this.set('top', 'top' in options ? options.top : (this.y1 + this.height / 2));\n    },\n\n    /**\n     * @private\n     * @method _set\n     * @param {String} key\n     * @param {Any} value\n     */\n    _set: function(key, value) {\n      this[key] = value;\n      if (key in coordProps) {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n\n      if (this.group) {\n        ctx.translate(-this.group.width/2 + this.left, -this.group.height / 2 + this.top);\n      }\n\n      // move from center (of virtual box) to its left/top corner\n      ctx.moveTo(this.width === 1 ? 0 : (-this.width / 2), this.height === 1 ? 0 : (-this.height / 2));\n      ctx.lineTo(this.width === 1 ? 0 : (this.width / 2), this.height === 1 ? 0 : (this.height / 2));\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = ctx.fillStyle;\n      ctx.stroke();\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @methd toObject\n     * @return {Object}\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        x1: this.get('x1'),\n        y1: this.get('y1'),\n        x2: this.get('x2'),\n        y2: this.get('y2')\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      return [\n        '<line ',\n          'x1=\"', this.get('x1'), '\" ',\n          'y1=\"', this.get('y1'), '\" ',\n          'x2=\"', this.get('x2'), '\" ',\n          'y2=\"', this.get('y2'), '\" ',\n          'style=\"', this.getSvgStyles(), '\" ',\n        '/>'\n      ].join('');\n    }\n  });\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Line.fromElement`)\n   * @static\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = 'x1 y1 x2 y2 stroke stroke-width transform'.split(' ');\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @method fabric.Line.fromElement\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Line} instance of fabric.Line\n   */\n  fabric.Line.fromElement = function(element, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES);\n    var points = [\n      parsedAttributes.x1 || 0,\n      parsedAttributes.y1 || 0,\n      parsedAttributes.x2 || 0,\n      parsedAttributes.y2 || 0\n    ];\n    return new fabric.Line(points, extend(parsedAttributes, options));\n  };\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @method fabric.Line.fromObject\n   * @param {Object} object Object to create an instance from\n   * @return {fabric.Line} instance of fabric.Line\n   */\n  fabric.Line.fromObject = function(object) {\n    var points = [object.x1, object.y1, object.x2, object.y2];\n    return new fabric.Line(points, object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2,\n      extend = fabric.util.object.extend;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  /**\n   * @class Circle\n   * @extends fabric.Object\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @scope fabric.Circle.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'circle',\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Object} [options] Options object\n     * @return {fabric.Circle} thisArg\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.set('radius', options.radius || 0);\n      this.callSuper('initialize', options);\n\n      var diameter = this.get('radius') * 2;\n      this.set('width', diameter).set('height', diameter);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        radius: this.get('radius')\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      return ('<circle ' +\n        'cx=\"0\" cy=\"0\" ' +\n        'r=\"' + this.radius + '\" ' +\n        'style=\"' + this.getSvgStyles() + '\" ' +\n        'transform=\"' + this.getSvgTransform() + '\" ' +\n        '/>');\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param ctx {CanvasRenderingContext2D} context to render on\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n      // multiply by currently set alpha (the one that was set by path group where this object is contained, for example)\n      ctx.globalAlpha *= this.opacity;\n      ctx.arc(noTransform ? this.left : 0, noTransform ? this.top : 0, this.radius, 0, piBy2, false);\n      ctx.closePath();\n      if (this.fill) {\n        ctx.fill();\n      }\n      if (this.stroke) {\n        ctx.stroke();\n      }\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @method getRadiusX\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @method getRadiusY\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @method setRadius\n     * @return {Number}\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      this.set('width', value * 2).set('height', value * 2);\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = 'cx cy r fill fill-opacity opacity stroke stroke-width transform'.split(' ');\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @method fabric.Circle.fromElement\n   * @param element {SVGElement} element to parse\n   * @param options {Object} options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   * @return {Object} instance of fabric.Circle\n   */\n  fabric.Circle.fromElement = function(element, options) {\n    options || (options = { });\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n    if (!isValidRadius(parsedAttributes)) {\n      throw Error('value of `r` attribute is required and can not be negative');\n    }\n    if ('left' in parsedAttributes) {\n      parsedAttributes.left -= (options.width / 2) || 0;\n    }\n    if ('top' in parsedAttributes) {\n      parsedAttributes.top -= (options.height / 2) || 0;\n    }\n    return new fabric.Circle(extend(parsedAttributes, options));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius > 0));\n  }\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @method fabric.Circle.fromObject\n   * @param {Object} object Object to create an instance from\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function(object) {\n    return new fabric.Circle(object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n  \n  \"use strict\";\n  \n  var fabric = global.fabric || (global.fabric = { });\n  \n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n  \n  /** \n   * @class Triangle\n   * @extends fabric.Object\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @scope fabric.Triangle.prototype */ {\n    \n    /**\n     * @property\n     * @type String\n     */\n    type: 'triangle',\n    \n    /**\n     * Constructor\n     * @method initialize\n     * @param options {Object} options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      options = options || { };\n      \n      this.callSuper('initialize', options);\n      \n      this.set('width', options.width || 100)\n          .set('height', options.height || 100);\n    },\n    \n    /**\n     * @private\n     * @method _render\n     * @param ctx {CanvasRenderingContext2D} Context to render on\n     */\n    _render: function(ctx) {      \n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n      \n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n      \n      if (this.fill) {\n        ctx.fill();\n      }\n      if (this.stroke) {\n        ctx.stroke();\n      }\n    },\n    \n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return 1;\n    },\n    \n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      var points = [\n        -widthBy2 + \" \" + heightBy2,\n        \"0 \" + -heightBy2,\n        widthBy2 + \" \" + heightBy2\n      ].join(\",\");\n\n      return '<polygon ' +\n              'points=\"' + points + '\" ' +\n              'style=\"' + this.getSvgStyles() + '\" ' +\n              'transform=\"' + this.getSvgTransform() + '\" ' +\n              '/>';\n    }\n  });\n  \n  /**\n   * Returns fabric.Triangle instance from an object representation\n   * @static\n   * @method Canvas.Trangle.fromObject\n   * @param object {Object} object to create an instance from\n   * @return {Object} instance of Canvas.Triangle\n   */\n  fabric.Triangle.fromObject = function(object) {\n    return new fabric.Triangle(object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global){\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2,\n      extend = fabric.util.object.extend;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  /**\n   * @class Ellipse\n   * @extends fabric.Object\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @scope fabric.Ellipse.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'ellipse',\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.callSuper('initialize', options);\n\n      this.set('rx', options.rx || 0);\n      this.set('ry', options.ry || 0);\n\n      this.set('width', this.get('rx') * 2);\n      this.set('height', this.get('ry') * 2);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        rx: this.get('rx'),\n        ry: this.get('ry')\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      return [\n        '<ellipse ',\n          'rx=\"', this.get('rx'), '\" ',\n          'ry=\"', this.get('ry'), '\" ',\n          'style=\"', this.getSvgStyles(), '\" ',\n          'transform=\"', this.getSvgTransform(), '\" ',\n        '/>'\n      ].join('');\n    },\n\n    /**\n     * Renders this instance on a given context\n     * @method render\n     * @param ctx {CanvasRenderingContext2D} context to render on\n     * @param noTransform {Boolean} context is not transformed when set to true\n     */\n    render: function(ctx, noTransform) {\n      // do not use `get` for perf. reasons\n      if (this.rx === 0 || this.ry === 0) return;\n      return this.callSuper('render', ctx, noTransform);\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param ctx {CanvasRenderingContext2D} context to render on\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.globalAlpha *= this.opacity;\n      if (this.transformMatrix && this.group) {\n        ctx.translate(this.cx, this.cy);\n      }\n      ctx.transform(1, 0, 0, this.ry/this.rx, 0, 0);\n      ctx.arc(noTransform ? this.left : 0, noTransform ? this.top : 0, this.rx, 0, piBy2, false);\n      if (this.stroke) {\n        ctx.stroke();\n      }\n      if (this.fill) {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = 'cx cy rx ry fill fill-opacity opacity stroke stroke-width transform'.split(' ');\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @method fabric.Ellipse.fromElement\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, options) {\n    options || (options = { });\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n    var cx = parsedAttributes.left;\n    var cy = parsedAttributes.top;\n\n    if ('left' in parsedAttributes) {\n      parsedAttributes.left -= (options.width / 2) || 0;\n    }\n    if ('top' in parsedAttributes) {\n      parsedAttributes.top -= (options.height / 2) || 0;\n    }\n\n    var ellipse = new fabric.Ellipse(extend(parsedAttributes, options));\n\n    ellipse.cx = cx || 0;\n    ellipse.cy = cy || 0;\n\n    return ellipse;\n  };\n\n  /**\n   * Returns fabric.Ellipse instance from an object representation\n   * @static\n   * @method fabric.Ellipse.fromObject\n   * @param {Object} object Object to create an instance from\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function(object) {\n    return new fabric.Ellipse(object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Rect) {\n    console.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  /**\n   * @class Rect\n   * @extends fabric.Object\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @scope fabric.Rect.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'rect',\n\n    /**\n     * @property\n     * @type Number\n     */\n    rx: 0,\n\n    /**\n     * @property\n     * @type Number\n     */\n    ry: 0,\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param options {Object} options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this._initStateProperties();\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Creates `stateProperties` list on an instance, and adds `fabric.Rect` -specific ones to it\n     * (such as \"rx\", \"ry\", etc.)\n     * @private\n     * @method _initStateProperties\n     */\n    _initStateProperties: function() {\n      this.stateProperties = this.stateProperties.concat(['rx', 'ry']);\n    },\n\n    /**\n     * @private\n     * @method _initRxRy\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param ctx {CanvasRenderingContext2D} context to render on\n     */\n    _render: function(ctx) {\n      var rx = this.rx || 0,\n          ry = this.ry || 0,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.beginPath();\n      ctx.globalAlpha *= this.opacity;\n\n      if (this.transformMatrix && this.group) {\n        ctx.translate(\n          this.width / 2 + this.x,\n          this.height / 2 + this.y);\n      }\n      if (!this.transformMatrix && this.group) {\n        ctx.translate(\n          -this.group.width / 2 + this.width / 2 + this.x,\n          -this.group.height / 2 + this.height / 2 + this.y);\n      }\n\n      ctx.moveTo(x+rx, y);\n      ctx.lineTo(x+w-rx, y);\n      ctx.quadraticCurveTo(x+w, y, x+w, y+ry, x+w, y+ry);\n      ctx.lineTo(x+w, y+h-ry);\n      ctx.quadraticCurveTo(x+w,y+h,x+w-rx,y+h,x+w-rx,y+h);\n      ctx.lineTo(x+rx,y+h);\n      ctx.quadraticCurveTo(x,y+h,x,y+h-ry,x,y+h-ry);\n      ctx.lineTo(x,y+ry);\n      ctx.quadraticCurveTo(x,y,x+rx,y,x+rx,y);\n      ctx.closePath();\n\n      if (this.fill) {\n        ctx.fill();\n      }\n\n      if (this.strokeDashArray) {\n        this._renderDashedStroke(ctx);\n      }\n      else if (this.stroke) {\n        ctx.stroke();\n      }\n    },\n\n    // since our coordinate system differs from that of SVG\n    _normalizeLeftTopProperties: function(parsedAttributes) {\n      if (parsedAttributes.left) {\n        this.set('left', parsedAttributes.left + this.getWidth() / 2);\n      }\n      this.set('x', parsedAttributes.left || 0);\n      if (parsedAttributes.top) {\n        this.set('top', parsedAttributes.top + this.getHeight() / 2);\n      }\n      this.set('y', parsedAttributes.top || 0);\n      return this;\n    },\n\n    /**\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} object representation of an instance\n     */\n    toObject: function() {\n      return fabric.util.object.extend(this.callSuper('toObject'), {\n        rx: this.get('rx') || 0,\n        ry: this.get('ry') || 0\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      return '<rect ' +\n              'x=\"' + (-1 * this.width / 2) + '\" y=\"' + (-1 * this.height / 2) + '\" ' +\n              'rx=\"' + this.get('rx') + '\" ry=\"' + this.get('ry') + '\" ' +\n              'width=\"' + this.width + '\" height=\"' + this.height + '\" ' +\n              'style=\"' + this.getSvgStyles() + '\" ' +\n              'transform=\"' + this.getSvgTransform() + '\" ' +\n              '/>';\n    }\n  });\n\n  // TODO (kangax): implement rounded rectangles (both parsing and rendering)\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = 'x y width height rx ry fill fill-opacity opacity stroke stroke-width transform'.split(' ');\n\n  /**\n   * @private\n   */\n  function _setDefaultLeftTopValues(attributes) {\n    attributes.left = attributes.left || 0;\n    attributes.top  = attributes.top  || 0;\n    return attributes;\n  }\n\n  /**\n   * Returns fabric.Rect instance from an SVG element\n   * @static\n   * @method fabric.Rect.fromElement\n   * @param element {SVGElement} element to parse\n   * @param options {Object} options object\n   * @return {fabric.Rect} instance of fabric.Rect\n   */\n  fabric.Rect.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n    parsedAttributes = _setDefaultLeftTopValues(parsedAttributes);\n\n    var rect = new fabric.Rect(fabric.util.object.extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect._normalizeLeftTopProperties(parsedAttributes);\n\n    return rect;\n  };\n\n  /**\n   * Returns fabric.Rect instance from an object representation\n   * @static\n   * @method fabric.Rect.fromObject\n   * @param object {Object} object to create an instance from\n   * @return {Object} instance of fabric.Rect\n   */\n  fabric.Rect.fromObject = function(object) {\n    return new fabric.Rect(object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  /**\n   * @class Polyline\n   * @extends fabric.Object\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @scope fabric.Polyline.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'polyline',\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Array} points array of points\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(points, options) {\n      options = options || { };\n      this.set('points', points);\n      this.callSuper('initialize', options);\n      this._calcDimensions();\n    },\n\n    /**\n     * @private\n     * @method _calcDimensions\n     */\n    _calcDimensions: function() {\n      return fabric.Polygon.prototype._calcDimensions.call(this);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return fabric.Polygon.prototype.toObject.call(this);\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      var points = [];\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(toFixed(this.points[i].x, 2), ',', toFixed(this.points[i].y, 2), ' ');\n      }\n\n      return [\n        '<polyline ',\n          'points=\"', points.join(''), '\" ',\n          'style=\"', this.getSvgStyles(), '\" ',\n          'transform=\"', this.getSvgTransform(), '\" ',\n        '/>'\n      ].join('');\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var point;\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x, this.points[0].y);\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x, point.y);\n      }\n      if (this.fill) {\n        ctx.fill();\n      }\n      if (this.stroke) {\n        ctx.stroke();\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polyline.fromElement`)\n   * @static\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = 'fill fill-opacity opacity stroke stroke-width transform'.split(' ');\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @method fabric.Polyline.fromElement\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {Object} instance of fabric.Polyline\n   */\n  fabric.Polyline.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polyline.ATTRIBUTE_NAMES);\n\n    for (var i = 0, len = points.length; i < len; i++) {\n      // normalize coordinates, according to containing box (dimensions of which are passed via `options`)\n      points[i].x -= (options.width / 2) || 0;\n      points[i].y -= (options.height / 2) || 0;\n    }\n\n    return new fabric.Polyline(points, fabric.util.object.extend(parsedAttributes, options));\n  };\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @method fabric.Polyline.fromObject\n   * @param {Object} [object] Object to create an instance from\n   * @return {fabric.Polyline}\n   */\n  fabric.Polyline.fromObject = function(object) {\n    var points = object.points;\n    return new fabric.Polyline(points, object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  function byX(p) { return p.x; }\n  function byY(p) { return p.y; }\n\n  /**\n   * @class Polygon\n   * @extends fabric.Object\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Object, /** @scope fabric.Polygon.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'polygon',\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Array} points Array of points\n     * @param {Object} options Options object\n     * @return {fabric.Polygon} thisArg\n     */\n    initialize: function(points, options) {\n      options = options || { };\n      this.points = points;\n      this.callSuper('initialize', options);\n      this._calcDimensions();\n    },\n\n    /**\n     * @private\n     * @method _calcDimensions\n     */\n    _calcDimensions: function() {\n\n      var points = this.points,\n          minX = min(points, 'x'),\n          minY = min(points, 'y'),\n          maxX = max(points, 'x'),\n          maxY = max(points, 'y');\n\n      this.width = (maxX - minX) || 1;\n      this.height = (maxY - minY) || 1;\n\n      this.minX = minX;\n      this.minY = minY;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        points: this.points.concat()\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      var points = [];\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(toFixed(this.points[i].x, 2), ',', toFixed(this.points[i].y, 2), ' ');\n      }\n\n      return [\n        '<polygon ',\n          'points=\"', points.join(''), '\" ',\n          'style=\"', this.getSvgStyles(), '\" ',\n          'transform=\"', this.getSvgTransform(), '\" ',\n        '/>'\n      ].join('');\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param ctx {CanvasRenderingContext2D} context to render on\n     */\n    _render: function(ctx) {\n      var point;\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x, this.points[0].y);\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x, point.y);\n      }\n      if (this.fill) {\n        ctx.fill();\n      }\n      if (this.stroke) {\n        ctx.closePath();\n        ctx.stroke();\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.points.length;\n    }\n  });\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = 'fill fill-opacity opacity stroke stroke-width transform'.split(' ');\n\n  /**\n   * Returns fabric.Polygon instance from an SVG element\n   * @static\n   * @method fabric.Polygon.fromElement\n   * @param {SVGElement} element Element to parse\n   * @param {Object} options Options object\n   * @return {fabric.Polygon}\n   */\n  fabric.Polygon.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polygon.ATTRIBUTE_NAMES);\n\n    for (var i = 0, len = points.length; i < len; i++) {\n      // normalize coordinates, according to containing box (dimensions of which are passed via `options`)\n      points[i].x -= (options.width / 2) || 0;\n      points[i].y -= (options.height / 2) || 0;\n    }\n\n    return new fabric.Polygon(points, extend(parsedAttributes, options));\n  };\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @method fabric.Polygon.fromObject\n   * @param {Object} object Object to create an instance from\n   * @return {fabric.Polygon}\n   */\n  fabric.Polygon.fromObject = function(object) {\n    return new fabric.Polygon(object.points, object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  var commandLengths = {\n    m: 2,\n    l: 2,\n    h: 1,\n    v: 1,\n    c: 6,\n    s: 4,\n    q: 4,\n    t: 2,\n    a: 7\n  };\n\n  function drawArc(ctx, x, y, coords) {\n    var rx = coords[0];\n    var ry = coords[1];\n    var rot = coords[2];\n    var large = coords[3];\n    var sweep = coords[4];\n    var ex = coords[5];\n    var ey = coords[6];\n    var segs = arcToSegments(ex, ey, rx, ry, large, sweep, rot, x, y);\n    for (var i=0; i<segs.length; i++) {\n     var bez = segmentToBezier.apply(this, segs[i]);\n     ctx.bezierCurveTo.apply(ctx, bez);\n    }\n  }\n\n  var arcToSegmentsCache = { },\n      segmentToBezierCache = { },\n      _join = Array.prototype.join,\n      argsString;\n\n  // Copied from Inkscape svgtopdf, thanks!\n  function arcToSegments(x, y, rx, ry, large, sweep, rotateX, ox, oy) {\n    argsString = _join.call(arguments);\n    if (arcToSegmentsCache[argsString]) {\n      return arcToSegmentsCache[argsString];\n    }\n\n    var th = rotateX * (Math.PI/180);\n    var sin_th = Math.sin(th);\n    var cos_th = Math.cos(th);\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n    var px = cos_th * (ox - x) * 0.5 + sin_th * (oy - y) * 0.5;\n    var py = cos_th * (oy - y) * 0.5 - sin_th * (ox - x) * 0.5;\n    var pl = (px*px) / (rx*rx) + (py*py) / (ry*ry);\n    if (pl > 1) {\n      pl = Math.sqrt(pl);\n      rx *= pl;\n      ry *= pl;\n    }\n\n    var a00 = cos_th / rx;\n    var a01 = sin_th / rx;\n    var a10 = (-sin_th) / ry;\n    var a11 = (cos_th) / ry;\n    var x0 = a00 * ox + a01 * oy;\n    var y0 = a10 * ox + a11 * oy;\n    var x1 = a00 * x + a01 * y;\n    var y1 = a10 * x + a11 * y;\n\n    var d = (x1-x0) * (x1-x0) + (y1-y0) * (y1-y0);\n    var sfactor_sq = 1 / d - 0.25;\n    if (sfactor_sq < 0) sfactor_sq = 0;\n    var sfactor = Math.sqrt(sfactor_sq);\n    if (sweep == large) sfactor = -sfactor;\n    var xc = 0.5 * (x0 + x1) - sfactor * (y1-y0);\n    var yc = 0.5 * (y0 + y1) + sfactor * (x1-x0);\n\n    var th0 = Math.atan2(y0-yc, x0-xc);\n    var th1 = Math.atan2(y1-yc, x1-xc);\n\n    var th_arc = th1-th0;\n    if (th_arc < 0 && sweep == 1){\n      th_arc += 2*Math.PI;\n    } else if (th_arc > 0 && sweep == 0) {\n      th_arc -= 2 * Math.PI;\n    }\n\n    var segments = Math.ceil(Math.abs(th_arc / (Math.PI * 0.5 + 0.001)));\n    var result = [];\n    for (var i=0; i<segments; i++) {\n      var th2 = th0 + i * th_arc / segments;\n      var th3 = th0 + (i+1) * th_arc / segments;\n      result[i] = [xc, yc, th2, th3, rx, ry, sin_th, cos_th];\n    }\n\n    return (arcToSegmentsCache[argsString] = result);\n  }\n\n  function segmentToBezier(cx, cy, th0, th1, rx, ry, sin_th, cos_th) {\n    argsString = _join.call(arguments);\n    if (segmentToBezierCache[argsString]) {\n      return segmentToBezierCache[argsString];\n    }\n\n    var a00 = cos_th * rx;\n    var a01 = -sin_th * ry;\n    var a10 = sin_th * rx;\n    var a11 = cos_th * ry;\n\n    var th_half = 0.5 * (th1 - th0);\n    var t = (8/3) * Math.sin(th_half * 0.5) * Math.sin(th_half * 0.5) / Math.sin(th_half);\n    var x1 = cx + Math.cos(th0) - t * Math.sin(th0);\n    var y1 = cy + Math.sin(th0) + t * Math.cos(th0);\n    var x3 = cx + Math.cos(th1);\n    var y3 = cy + Math.sin(th1);\n    var x2 = x3 + t * Math.sin(th1);\n    var y2 = y3 - t * Math.cos(th1);\n\n    return (segmentToBezierCache[argsString] = [\n      a00 * x1 + a01 * y1,      a10 * x1 + a11 * y1,\n      a00 * x2 + a01 * y2,      a10 * x2 + a11 * y2,\n      a00 * x3 + a01 * y3,      a10 * x3 + a11 * y3\n    ]);\n  }\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      _toString = Object.prototype.toString;\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n  if (!fabric.Object) {\n    fabric.warn('fabric.Path requires fabric.Object');\n    return;\n  }\n\n  /**\n   * @private\n   */\n  function getX(item) {\n    if (item[0] === 'H') {\n      return item[1];\n    }\n    return item[item.length - 2];\n  }\n\n  /**\n   * @private\n   */\n  function getY(item) {\n    if (item[0] === 'V') {\n      return item[1];\n    }\n    return item[item.length - 1];\n  }\n\n  /**\n   * @class Path\n   * @extends fabric.Object\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @scope fabric.Path.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'path',\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     */\n    initialize: function(path, options) {\n      options = options || { };\n\n      this.setOptions(options);\n\n      if (!path) {\n        throw Error('`path` argument is required');\n      }\n\n      var fromArray = _toString.call(path) === '[object Array]';\n\n      this.path = fromArray\n        ? path\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        : path.match && path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n      if (!this.path) return;\n\n      if (!fromArray) {\n        this._initializeFromString(options);\n      }\n\n      if (options.sourcePath) {\n        this.setSourcePath(options.sourcePath);\n      }\n    },\n\n    /**\n     * @private\n     * @method _initializeFromString\n     */\n    _initializeFromString: function(options) {\n      var isWidthSet = 'width' in options,\n          isHeightSet = 'height' in options;\n\n      this.path = this._parsePath();\n\n      if (!isWidthSet || !isHeightSet) {\n        extend(this, this._parseDimensions());\n        if (isWidthSet) {\n          this.width = options.width;\n        }\n        if (isHeightSet) {\n          this.height = options.height;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @method _render\n     */\n    _render: function(ctx) {\n      var current, // current instruction\n          previous = null,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          tempControlX,\n          tempControlY,\n          l = -(this.width / 2),\n          t = -(this.height / 2);\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            ctx.bezierCurveTo(\n              x + current[1] + l, // x1\n              y + current[2] + t, // y1\n              controlX + l, // x2\n              controlY + t, // y2\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n            // calculate reflection of previous control points\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              x + current[1] + l,\n              y + current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            // calculate reflection of previous control points\n            controlX = 2*x - controlX;\n            controlY = 2*y - controlY;\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be the reflection of the second control point on the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else if (previous[0] === 't') {\n              // calculate reflection of previous control points for t\n              controlX = 2 * x - tempControlX;\n              controlY = 2 * y - tempControlY;\n            }\n            else if (previous[0] === 'q') {\n              // calculate reflection of previous control points for q\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            tempControlX = controlX;\n            tempControlY = controlY;\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            controlX = x + current[1];\n            controlY = y + current[2];\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            // calculate reflection of previous control points\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x + l,\n              current[7] + y + t\n            ]);\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + l,\n              current[7] + t\n            ]);\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            ctx.closePath();\n            break;\n        }\n        previous = current;\n      }\n    },\n\n    /**\n     * Renders path on a specified context\n     * @method render\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     * @param {Boolean} noTransform When true, context is not transformed\n     */\n    render: function(ctx, noTransform) {\n      ctx.save();\n      var m = this.transformMatrix;\n      if (m) {\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      if (!noTransform) {\n        this.transform(ctx);\n      }\n      // ctx.globalCompositeOperation = this.fillRule;\n\n      if (this.overlayFill) {\n        ctx.fillStyle = this.overlayFill;\n      }\n      else if (this.fill) {\n        ctx.fillStyle = this.fill.toLiveGradient\n          ? this.fill.toLiveGradient(ctx)\n          : this.fill;\n      }\n\n      if (this.stroke) {\n        ctx.strokeStyle = this.stroke;\n      }\n      ctx.beginPath();\n\n      this._render(ctx);\n\n      if (this.fill) {\n        ctx.fill();\n      }\n      if (this.stroke) {\n        ctx.strokeStyle = this.stroke;\n        ctx.lineWidth = this.strokeWidth;\n        ctx.lineCap = ctx.lineJoin = 'round';\n        ctx.stroke();\n      }\n      if (!noTransform && this.active) {\n        this.drawBorders(ctx);\n        this.hideCorners || this.drawCorners(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @method toString\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object}\n     */\n    toObject: function() {\n      var o = extend(this.callSuper('toObject'), {\n        path: this.path\n      });\n      if (this.sourcePath) {\n        o.sourcePath = this.sourcePath;\n      }\n      if (this.transformMatrix) {\n        o.transformMatrix = this.transformMatrix;\n      }\n      return o;\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @method toDatalessObject\n     * @return {Object}\n     */\n    toDatalessObject: function() {\n      var o = this.toObject();\n      if (this.sourcePath) {\n        o.path = this.sourcePath;\n      }\n      delete o.sourcePath;\n      return o;\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      var chunks = [];\n      for (var i = 0, len = this.path.length; i < len; i++) {\n        chunks.push(this.path[i].join(' '));\n      }\n      var path = chunks.join(' ');\n\n      return [\n        '<g transform=\"', this.getSvgTransform(), '\">',\n          '<path ',\n            'width=\"', this.width, '\" height=\"', this.height, '\" ',\n            'd=\"', path, '\" ',\n            'style=\"', this.getSvgStyles(), '\" ',\n            'transform=\"translate(', (-this.width / 2), ' ', (-this.height/2), ')\" />',\n        '</g>'\n      ].join('');\n    },\n\n    /**\n     * Returns number representation of an instance complexity\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     * @method _parsePath\n     */\n    _parsePath: function() {\n      var result = [ ],\n          currentPath,\n          chunks,\n          parsed;\n\n      for (var i = 0, j, chunksParsed, len = this.path.length; i < len; i++) {\n        currentPath = this.path[i];\n        chunks = currentPath.slice(1).trim().replace(/(\\d)-/g, '$1###-').split(/\\s|,|###/);\n        chunksParsed = [ currentPath.charAt(0) ];\n\n        for (var j = 0, jlen = chunks.length; j < jlen; j++) {\n          parsed = parseFloat(chunks[j]);\n          if (!isNaN(parsed)) {\n            chunksParsed.push(parsed);\n          }\n        }\n\n        var command = chunksParsed[0].toLowerCase(),\n            commandLength = commandLengths[command];\n\n        if (chunksParsed.length - 1 > commandLength) {\n          for (var k = 1, klen = chunksParsed.length; k < klen; k += commandLength) {\n            result.push([ chunksParsed[0] ].concat(chunksParsed.slice(k, k + commandLength)));\n          }\n        }\n        else {\n          result.push(chunksParsed);\n        }\n      }\n\n      return result;\n    },\n\n    /**\n     * @method _parseDimensions\n     */\n    _parseDimensions: function() {\n      var aX = [],\n          aY = [],\n          previousX,\n          previousY,\n          isLowerCase = false,\n          x,\n          y;\n\n      this.path.forEach(function(item, i) {\n        if (item[0] !== 'H') {\n          previousX = (i === 0) ? getX(item) : getX(this.path[i-1]);\n        }\n        if (item[0] !== 'V') {\n          previousY = (i === 0) ? getY(item) : getY(this.path[i-1]);\n        }\n\n        // lowercased letter denotes relative position;\n        // transform to absolute\n        if (item[0] === item[0].toLowerCase()) {\n          isLowerCase = true;\n        }\n\n        // last 2 items in an array of coordinates are the actualy x/y (except H/V);\n        // collect them\n\n        // TODO (kangax): support relative h/v commands\n\n        x = isLowerCase\n          ? previousX + getX(item)\n          : item[0] === 'V'\n            ? previousX\n            : getX(item);\n\n        y = isLowerCase\n          ? previousY + getY(item)\n          : item[0] === 'H'\n            ? previousY\n            : getY(item);\n\n        var val = parseInt(x, 10);\n        if (!isNaN(val)) aX.push(val);\n\n        val = parseInt(y, 10);\n        if (!isNaN(val)) aY.push(val);\n\n      }, this);\n\n      var minX = min(aX),\n          minY = min(aY),\n          deltaX = 0,\n          deltaY = 0;\n\n      var o = {\n        top: minY - deltaY,\n        left: minX - deltaX,\n        bottom: max(aY) - deltaY,\n        right: max(aX) - deltaX\n      };\n\n      o.width = o.right - o.left;\n      o.height = o.bottom - o.top;\n\n      return o;\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @method fabric.Path.fromObject\n   * @return {fabric.Path} Instance of fabric.Path\n   */\n  fabric.Path.fromObject = function(object) {\n    return new fabric.Path(object.path, object);\n  };\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = 'd fill fill-opacity opacity fill-rule stroke stroke-width transform'.split(' ');\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @method fabric.Path.fromElement\n   * @param {SVGElement} element to parse\n   * @param {Object} options object\n   * @return {fabric.Path} Instance of fabric.Path\n   */\n  fabric.Path.fromElement = function(element, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    return new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options));\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      invoke = fabric.util.array.invoke,\n      parentSet = fabric.Object.prototype.set,\n      parentToObject = fabric.Object.prototype.toObject,\n      camelize = fabric.util.string.camelize,\n      capitalize = fabric.util.string.capitalize;\n\n  if (fabric.PathGroup) {\n    fabric.warn('fabric.PathGroup is already defined');\n    return;\n  }\n\n  /**\n   * @class PathGroup\n   * @extends fabric.Path\n   */\n  fabric.PathGroup = fabric.util.createClass(fabric.Path, /** @scope fabric.PathGroup.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'path-group',\n\n    /**\n     * @property\n     * @type String\n     */\n    fill: '',\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    forceFillOverwrite: false,\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {Array} paths\n     * @param {Object} [options] Options object\n     * @return {fabric.PathGroup} thisArg\n     */\n    initialize: function(paths, options) {\n\n      options = options || { };\n      this.paths = paths || [ ];\n\n      for (var i = this.paths.length; i--; ) {\n        this.paths[i].group = this;\n      }\n\n      this.setOptions(options);\n      this.setCoords();\n\n      if (options.sourcePath) {\n        this.setSourcePath(options.sourcePath);\n      }\n    },\n\n    /**\n     * Renders this group on a specified context\n     * @method render\n     * @param {CanvasRenderingContext2D} ctx Context to render this instance on\n     */\n    render: function(ctx) {\n      ctx.save();\n\n      var m = this.transformMatrix;\n      if (m) {\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n\n      this.transform(ctx);\n      for (var i = 0, l = this.paths.length; i < l; ++i) {\n        this.paths[i].render(ctx, true);\n      }\n      if (this.active) {\n        this.drawBorders(ctx);\n        this.hideCorners || this.drawCorners(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Sets certain property to a certain value\n     * @method _set\n     * @param {String} prop\n     * @param {Any} value\n     * @return {fabric.PathGroup} thisArg\n     */\n    _set: function(prop, value) {\n\n      if ((prop === 'fill' || prop === 'overlayFill') && value && this.isSameColor()) {\n        var i = this.paths.length;\n        while (i--) {\n          this.paths[i]._set(prop, value);\n        }\n      }\n\n      return this.callSuper('_set', prop, value);\n    },\n\n    /**\n     * Returns object representation of this path group\n     * @method toObject\n     * @return {Object} object representation of an instance\n     */\n    toObject: function() {\n      return extend(parentToObject.call(this), {\n        paths: invoke(this.getObjects(), 'clone'),\n        sourcePath: this.sourcePath\n      });\n    },\n\n    /**\n     * Returns dataless object representation of this path group\n     * @method toDatalessObject\n     * @return {Object} dataless object representation of an instance\n     */\n    toDatalessObject: function() {\n      var o = this.toObject();\n      if (this.sourcePath) {\n        o.paths = this.sourcePath;\n      }\n      return o;\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      var objects = this.getObjects();\n      var markup = [\n        '<g ',\n          'width=\"', this.width, '\" ',\n          'height=\"', this.height, '\" ',\n          'style=\"', this.getSvgStyles(), '\" ',\n          'transform=\"', this.getSvgTransform(), '\" ',\n        '>'\n      ];\n\n      for (var i = 0, len = objects.length; i < len; i++) {\n        markup.push(objects[i].toSVG());\n      }\n      markup.push('</g>');\n\n      return markup.join('');\n    },\n\n     /**\n      * Returns a string representation of this path group\n      * @method toString\n      * @return {String} string representation of an object\n      */\n    toString: function() {\n      return '#<fabric.PathGroup (' + this.complexity() +\n        '): { top: ' + this.top + ', left: ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns true if all paths in this group are of same color\n     * @method isSameColor\n     * @return {Boolean} true if all paths are of the same color (`fill`)\n     */\n    isSameColor: function() {\n      var firstPathFill = this.getObjects()[0].get('fill');\n      return this.getObjects().every(function(path) {\n        return path.get('fill') === firstPathFill;\n      });\n    },\n\n    /**\n      * Returns number representation of object's complexity\n      * @method complexity\n      * @return {Number} complexity\n      */\n    complexity: function() {\n      return this.paths.reduce(function(total, path) {\n        return total + ((path && path.complexity) ? path.complexity() : 0);\n      }, 0);\n    },\n\n    /**\n      * Makes path group grayscale\n      * @method toGrayscale\n      * @return {fabric.PathGroup} thisArg\n      */\n    toGrayscale: function() {\n      var i = this.paths.length;\n      while (i--) {\n        this.paths[i].toGrayscale();\n      }\n      return this;\n    },\n\n    /**\n     * Returns all paths in this path group\n     * @method getObjects\n     * @return {Array} array of path objects included in this path group\n     */\n    getObjects: function() {\n      return this.paths;\n    }\n  });\n\n  /**\n   * @private\n   * @method instantiatePaths\n   */\n  function instantiatePaths(paths) {\n    for (var i = 0, len = paths.length; i < len; i++) {\n      if (!(paths[i] instanceof fabric.Object)) {\n        var klassName = camelize(capitalize(paths[i].type));\n        paths[i] = fabric[klassName].fromObject(paths[i]);\n      }\n    }\n    return paths;\n  }\n\n  /**\n   * Creates fabric.Triangle instance from an object representation\n   * @static\n   * @method fabric.PathGroup.fromObject\n   * @param {Object} object\n   * @return {fabric.PathGroup}\n   */\n  fabric.PathGroup.fromObject = function(object) {\n    var paths = instantiatePaths(object.paths);\n    return new fabric.PathGroup(paths, object);\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global){\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      invoke = fabric.util.array.invoke,\n      removeFromArray = fabric.util.removeFromArray;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * @class Group\n   * @extends fabric.Object\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, /** @scope fabric.Group.prototype */ {\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'group',\n\n    /**\n     * Constructor\n     * @method initialized\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options) {\n      this.objects = objects || [];\n      this.originalState = { };\n\n      this.callSuper('initialize');\n\n      this._calcBounds();\n      this._updateObjectsCoords();\n\n      if (options) {\n        extend(this, options);\n      }\n      this._setOpacityIfSame();\n\n      // group is active by default\n      this.setCoords(true);\n      this.saveCoords();\n\n      //this.activateAllObjects();\n    },\n\n    /**\n     * @private\n     * @method _updateObjectsCoords\n     */\n    _updateObjectsCoords: function() {\n      var groupDeltaX = this.left,\n          groupDeltaY = this.top;\n\n      this.forEachObject(function(object) {\n\n        var objectLeft = object.get('left'),\n            objectTop = object.get('top');\n\n        object.set('originalLeft', objectLeft);\n        object.set('originalTop', objectTop);\n\n        object.set('left', objectLeft - groupDeltaX);\n        object.set('top', objectTop - groupDeltaY);\n\n        object.setCoords();\n\n        // do not display corners of objects enclosed in a group\n        object.hideCorners = true;\n      }, this);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @method toString\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Returns an array of all objects in this group\n     * @method getObjects\n     * @return {Array} group objects\n     */\n    getObjects: function() {\n      return this.objects;\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @method addWithUpdate\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      this._restoreObjectsState();\n      this.objects.push(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      return this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @method removeWithUpdate\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      removeFromArray(this.objects, object);\n      object.setActive(false);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      return this;\n    },\n\n    /**\n     * Adds an object to a group\n     * @method add\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    add: function(object) {\n      this.objects.push(object);\n      return this;\n    },\n\n    /**\n     * Removes an object from a group\n     * @method remove\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    remove: function(object) {\n      removeFromArray(this.objects, object);\n      return this;\n    },\n\n    /**\n     * Returns a size of a group (i.e: length of an array containing its objects)\n     * @return {Number} Group size\n     */\n    size: function() {\n      return this.getObjects().length;\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      if (key === 'fill' || key === 'opacity') {\n        var i = this.objects.length;\n        this[key] = value;\n        while (i--) {\n          this.objects[i].set(key, value);\n        }\n      }\n      else {\n        this[key] = value;\n      }\n    },\n\n    /**\n     * Returns true if a group contains an object\n     * @method contains\n     * @param {Object} object Object to check against\n     * @return {Boolean} `true` if group contains an object\n     */\n    contains: function(object) {\n      return this.objects.indexOf(object) > -1;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        objects: invoke(this.objects, 'toObject')\n      });\n    },\n\n    /**\n     * Renders instance on a given context\n     * @method render\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx, noTransform) {\n      ctx.save();\n      this.transform(ctx);\n\n      var groupScaleFactor = Math.max(this.scaleX, this.scaleY);\n\n      for (var i = 0, len = this.objects.length, object; object = this.objects[i]; i++) {\n        var originalScaleFactor = object.borderScaleFactor;\n        object.borderScaleFactor = groupScaleFactor;\n        object.render(ctx);\n        object.borderScaleFactor = originalScaleFactor;\n      }\n      if (!noTransform && this.active) {\n        this.drawBorders(ctx);\n        this.hideCorners || this.drawCorners(ctx);\n      }\n      ctx.restore();\n      this.setCoords();\n    },\n\n    /**\n     * Returns object from the group at the specified index\n     * @method item\n     * @param index {Number} index of item to get\n     * @return {fabric.Object}\n     */\n    item: function(index) {\n      return this.getObjects()[index];\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return this.getObjects().reduce(function(total, object) {\n        total += (typeof object.complexity == 'function') ? object.complexity() : 0;\n        return total;\n      }, 0);\n    },\n\n    /**\n     * Retores original state of each of group objects (original state is that which was before group was created).\n     * @private\n     * @method _restoreObjectsState\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      this.objects.forEach(this._restoreObjectState, this);\n      return this;\n    },\n\n    /**\n     * Restores original state of a specified object in group\n     * @private\n     * @method _restoreObjectState\n     * @param {fabric.Object} object\n     * @return {fabric.Group} thisArg\n     */\n    _restoreObjectState: function(object) {\n\n      var groupLeft = this.get('left'),\n          groupTop = this.get('top'),\n          groupAngle = this.getAngle() * (Math.PI / 180),\n          objectLeft = object.get('originalLeft'),\n          objectTop = object.get('originalTop'),\n          rotatedTop = Math.cos(groupAngle) * object.get('top') + Math.sin(groupAngle) * object.get('left'),\n          rotatedLeft = -Math.sin(groupAngle) * object.get('top') + Math.cos(groupAngle) * object.get('left');\n\n      object.setAngle(object.getAngle() + this.getAngle());\n\n      object.set('left', groupLeft + rotatedLeft * this.get('scaleX'));\n      object.set('top', groupTop + rotatedTop * this.get('scaleY'));\n\n      object.set('scaleX', object.get('scaleX') * this.get('scaleX'));\n      object.set('scaleY', object.get('scaleY') * this.get('scaleY'));\n\n      object.setCoords();\n      object.hideCorners = false;\n      object.setActive(false);\n      object.setCoords();\n\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @method destroy\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Saves coordinates of this instance (to be used together with `hasMoved`)\n     * @saveCoords\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    saveCoords: function() {\n      this._originalLeft = this.get('left');\n      this._originalTop = this.get('top');\n      return this;\n    },\n\n    /**\n     * Checks whether this group was moved (since `saveCoords` was called last)\n     * @method hasMoved\n     * @return {Boolean} true if an object was moved (since fabric.Group#saveCoords was called)\n     */\n    hasMoved: function() {\n      return this._originalLeft !== this.get('left') ||\n             this._originalTop !== this.get('top');\n    },\n\n    /**\n     * Sets coordinates of all group objects\n     * @method setObjectsCoords\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      this.forEachObject(function(object) {\n        object.setCoords();\n      });\n      return this;\n    },\n\n    /**\n     * Activates (makes active) all group objects\n     * @method activateAllObjects\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    activateAllObjects: function() {\n      this.forEachObject(function(object) {\n        object.setActive();\n      });\n      return this;\n    },\n\n    /**\n     * Executes given function for each object in this group\n     * @method forEachObject\n     * @param {Function} callback\n     *                   Callback invoked with current object as first argument,\n     *                   index - as second and an array of all objects - as third.\n     *                   Iteration happens in reverse order (for performance reasons).\n     *                   Callback is invoked in a context of Global Object (e.g. `window`)\n     *                   when no `context` argument is given\n     *\n     * @param {Object} context Context (aka thisObject)\n     *\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    forEachObject: fabric.StaticCanvas.prototype.forEachObject,\n\n    /**\n     * @private\n     * @method _setOpacityIfSame\n     */\n    _setOpacityIfSame: function() {\n      var objects = this.getObjects(),\n          firstValue = objects[0] ? objects[0].get('opacity') : 1;\n\n      var isSameOpacity = objects.every(function(o) {\n        return o.get('opacity') === firstValue;\n      });\n\n      if (isSameOpacity) {\n        this.opacity = firstValue;\n      }\n    },\n\n    /**\n     * @private\n     * @method _calcBounds\n     */\n    _calcBounds: function() {\n      var aX = [],\n          aY = [],\n          minX, minY, maxX, maxY, o, width, height,\n          i = 0,\n          len = this.objects.length;\n\n      for (; i < len; ++i) {\n        o = this.objects[i];\n        o.setCoords();\n        for (var prop in o.oCoords) {\n          aX.push(o.oCoords[prop].x);\n          aY.push(o.oCoords[prop].y);\n        }\n      };\n\n      minX = min(aX);\n      maxX = max(aX);\n      minY = min(aY);\n      maxY = max(aY);\n\n      width = (maxX - minX) || 0;\n      height = (maxY - minY) || 0;\n\n      this.width = width;\n      this.height = height;\n\n      this.left = (minX + width / 2) || 0;\n      this.top = (minY + height / 2) || 0;\n    },\n\n    /**\n     * Checks if point is contained within the group\n     * @method containsPoint\n     * @param {fabric.Point} point point with `x` and `y` properties\n     * @return {Boolean} true if point is contained within group\n     */\n    containsPoint: function(point) {\n\n      var halfWidth = this.get('width') / 2,\n          halfHeight = this.get('height') / 2,\n          centerX = this.get('left'),\n          centerY = this.get('top');\n\n      return  centerX - halfWidth < point.x &&\n              centerX + halfWidth > point.x &&\n              centerY - halfHeight < point.y &&\n              centerY + halfHeight > point.y;\n    },\n\n    /**\n     * Makes all of this group's objects grayscale (i.e. calling `toGrayscale` on them)\n     * @method toGrayscale\n     */\n    toGrayscale: function() {\n      var i = this.objects.length;\n      while (i--) {\n        this.objects[i].toGrayscale();\n      }\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      var objectsMarkup = [ ];\n      for (var i = 0, len = this.objects.length; i < len; i++) {\n        objectsMarkup.push(this.objects[i].toSVG());\n      }\n\n      return (\n        '<g transform=\"' + this.getSvgTransform() + '\">' +\n          objectsMarkup.join('') +\n        '</g>');\n    }\n  });\n\n  /**\n   * Returns fabric.Group instance from an object representation\n   * @static\n   * @method fabric.Group.fromObject\n   * @param object {Object} object to create a group from\n   * @param options {Object} options object\n   * @return {fabric.Group} an instance of fabric.Group\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.Group(enlivenedObjects, object));\n    });\n  };\n\n  fabric.Group.async = true;\n\n})(typeof exports != 'undefined' ? exports : this);\n(function(global) {\n\n  \"use strict\";\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  };\n\n  if (!fabric.Object) {\n    fabric.warn('fabric.Object is required for fabric.Image initialization');\n    return;\n  }\n\n  /**\n   * @class Image\n   * @extends fabric.Object\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @scope fabric.Image.prototype */ {\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    active: false,\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    bordervisibility: false,\n\n    /**\n     * @property\n     * @type Boolean\n     */\n    cornervisibility: false,\n\n    /**\n     * @property\n     * @type String\n     */\n    type: 'image',\n\n    /**\n     * Constructor\n     * @param {HTMLImageElement | String} element Image element\n     * @param {Object} options optional\n     */\n    initialize: function(element, options) {\n      options || (options = { });\n\n      this.callSuper('initialize', options);\n      this._initElement(element);\n      this._originalImage = this.getElement();\n      this._initConfig(options);\n\n      this.filters = [ ];\n\n      if (options.filters) {\n        this.filters = options.filters;\n        this.applyFilters();\n      }\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @method getElement\n     * @return {HTMLImageElement} image element\n     */\n    getElement: function() {\n      return this._element;\n    },\n\n    /**\n     * Sets image element for this instance to a specified one\n     * @method setElement\n     * @param {HTMLImageElement} element\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element) {\n      this._element = element;\n      this._initConfig();\n      return this;\n    },\n\n    /**\n     * Returns original size of an image\n     * @method getOriginalSize\n     * @return {Object} object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.width,\n        height: element.height\n      };\n    },\n\n    /**\n     * Sets border visibility\n     * @method setBorderVisibility\n     * @param {Boolean} visible When true, border is set to be visible\n     */\n    setBorderVisibility: function(visible) {\n      this._resetWidthHeight();\n      this._adjustWidthHeightToBorders(showBorder);\n      this.setCoords();\n    },\n\n    /**\n     * Sets corner visibility\n     * @method setCornersVisibility\n     * @param {Boolean} visible When true, corners are set to be visible\n     */\n    setCornersVisibility: function(visible) {\n      this.cornervisibility = !!visible;\n    },\n\n    /**\n     * Renders image on a specified context\n     * @method render\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx, noTransform) {\n      ctx.save();\n      var m = this.transformMatrix;\n      this._resetWidthHeight();\n      if (this.group) {\n        ctx.translate(-this.group.width/2 + this.width/2, -this.group.height/2 + this.height/2);\n      }\n      if (m) {\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      if (!noTransform) {\n        this.transform(ctx);\n      }\n      this._render(ctx);\n      if (this.active && !noTransform) {\n        this.drawBorders(ctx);\n        this.hideCorners || this.drawCorners(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        src: this._originalImage.src || this._originalImage._src,\n        filters: this.filters.concat()\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n      return '<g transform=\"' + this.getSvgTransform() + '\">'+\n                '<image xlink:href=\"' + this.getSvgSrc() + '\" '+\n                  'style=\"' + this.getSvgStyles() + '\" ' +\n                  // we're essentially moving origin of transformation from top/left corner to the center of the shape\n                  // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n                  // so that object's center aligns with container's left/top\n                  'transform=\"translate('+ (-this.width/2) + ' ' + (-this.height/2) + ')\" ' +\n                  'width=\"' + this.width + '\" ' +\n                  'height=\"' + this.height + '\"' + '/>'+\n              '</g>';\n    },\n\n    /**\n     * Returns source of an image\n     * @method getSrc\n     * @return {String} Source of an image\n     */\n    getSrc: function() {\n      return this.getElement().src || this.getElement()._src;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @method toString\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    /**\n     * Returns a clone of an instance\n     * @mthod clone\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     */\n    clone: function(callback) {\n      this.constructor.fromObject(this.toObject(), callback);\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array)\n     * @mthod applyFilters\n     * @param {Function} callback Callback is invoked when all filters have been applied and new image is generated\n     */\n    applyFilters: function(callback) {\n\n      if (this.filters.length === 0) {\n        this.setElement(this._originalImage);\n        callback && callback();\n        return;\n      }\n\n      var isLikelyNode = typeof Buffer !== 'undefined' && typeof window === 'undefined',\n          imgEl = this._originalImage,\n          canvasEl = fabric.document.createElement('canvas'),\n          replacement = isLikelyNode ? new (require('canvas').Image) : fabric.document.createElement('img'),\n          _this = this;\n\n        if (!canvasEl.getContext && typeof G_vmlCanvasManager != 'undefined') {\n          G_vmlCanvasManager.initElement(canvasEl);\n        }\n\n      canvasEl.width = imgEl.width;\n      canvasEl.height = imgEl.height;\n\n      canvasEl.getContext('2d').drawImage(imgEl, 0, 0, imgEl.width, imgEl.height);\n\n      this.filters.forEach(function(filter) {\n        filter && filter.applyTo(canvasEl);\n      });\n\n       /** @ignore */\n      replacement.onload = function() {\n        _this._element = replacement;\n        callback && callback();\n        replacement.onload = canvasEl = imgEl = null;\n      };\n      replacement.width = imgEl.width;\n      replacement.height = imgEl.height;\n\n      if (isLikelyNode) {\n        var base64str = canvasEl.toDataURL('image/png').replace(/data:image\\/png;base64,/, '');\n        replacement.src = new Buffer(base64str, 'base64');\n        _this._element = replacement;\n\n        // onload doesn't fire in node, so we invoke callback manually\n        callback && callback();\n      }\n      else {\n        replacement.src = canvasEl.toDataURL('image/png');\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _render: function(ctx) {\n      ctx.drawImage(\n        this.getElement(),\n        - this.width / 2,\n        -this.height / 2,\n        this.width,\n        this.height\n      );\n    },\n\n    /**\n     * @private\n     */\n    _adjustWidthHeightToBorders: function(showBorder) {\n      if (showBorder) {\n        this.currentBorder = this.borderwidth;\n        this.width += (2 * this.currentBorder);\n        this.height += (2 * this.currentBorder);\n      }\n      else {\n        this.currentBorder = 0;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      var element = this.getElement();\n\n      this.set('width', element.width);\n      this.set('height', element.height);\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @method _initElement\n     * @param {HTMLImageElement|String} el The element representing the image\n     */\n    _initElement: function(element) {\n      this.setElement(fabric.util.getById(element));\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @method _initConfig\n     * @param {Object} options Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setBorder();\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @method _initFilters\n     * @param {Object} object Object with filters property\n     */\n    _initFilters: function(object) {\n      if (object.filters && object.filters.length) {\n        this.filters = object.filters.map(function(filterObj) {\n          return filterObj && fabric.Image.filters[filterObj.type].fromObject(filterObj);\n        });\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setBorder: function() {\n      if (this.bordervisibility) {\n        this.currentBorder = this.borderwidth;\n      }\n      else {\n        this.currentBorder = 0;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setWidthHeight: function(options) {\n      var sidesBorderWidth = 2 * this.currentBorder;\n\n      this.width = 'width' in options\n        ? options.width\n        : ((this.getElement().width || 0) + sidesBorderWidth);\n\n      this.height = 'height' in options\n        ? options.height\n        : ((this.getElement().height || 0) + sidesBorderWidth);\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @method complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   */\n  fabric.Image.CSS_CANVAS = \"canvas-img\";\n\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @method fromObject\n   * @param object {Object}\n   * @param callback {Function} optional\n   */\n  fabric.Image.fromObject = function(object, callback) {\n    var img = fabric.document.createElement('img'),\n        src = object.src;\n\n    if (object.width) {\n      img.width = object.width;\n    }\n    if (object.height) {\n      img.height = object.height;\n    }\n\n    /** @ignore */\n    img.onload = function() {\n      fabric.Image.prototype._initFilters.call(object, object);\n\n      var instance = new fabric.Image(img, object);\n      callback && callback(instance);\n      img = img.onload = null;\n    };\n    img.src = src;\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @method fromURL\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument)\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    var img = fabric.document.createElement('img');\n\n    /** @ignore */\n    img.onload = function() {\n      if (callback) {\n        callback(new fabric.Image(img, imgOptions));\n      }\n      img = img.onload = null;\n    };\n    img.src = url;\n  };\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see http://www.w3.org/TR/SVG/struct.html#ImageElement\n   */\n  fabric.Image.ATTRIBUTE_NAMES = 'x y width height fill fill-opacity opacity stroke stroke-width transform xlink:href'.split(' ');\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @method fabric.Image.fromElement\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @param {Object} [options] Options object\n   * @return {fabric.Image}\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    options || (options = { });\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\n\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback, extend(parsedAttributes, options));\n  };\n\n  fabric.Image.async = true;\n\n})(typeof exports != 'undefined' ? exports : this);\n\nfabric.util.object.extend(fabric.Object.prototype, {\n\n  /**\n   * @method _getAngleValueForStraighten\n   * @return {Number} angle value\n   * @private\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.get('angle');\n\n    // TODO (kangax): can this be simplified?\n\n    if      (angle > -225 && angle <= -135) { return -180;  }\n    else if (angle > -135 && angle <= -45)  { return  -90;  }\n    else if (angle > -45  && angle <= 45)   { return    0;  }\n    else if (angle > 45   && angle <= 135)  { return   90;  }\n    else if (angle > 135  && angle <= 225 ) { return  180;  }\n    else if (angle > 225  && angle <= 315)  { return  270;  }\n    else if (angle > 315)                   { return  360;  }\n\n    return 0;\n  },\n\n  /**\n   * @method straighten\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    var angle = this._getAngleValueForStraighten();\n    this.setAngle(angle);\n    return this;\n  },\n\n  /**\n   * @method fxStraighten\n   * @param {Object} callbacks\n   *                  - onComplete: invoked on completion\n   *                  - onChange: invoked on every step of animation\n   *\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.setAngle(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n      onStart: function() {\n        _this.setActive(false);\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @method straightenObject\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.renderAll();\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#straightenObject`, but animated\n   * @method fxStraightenObject\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxStraightenObject: function (object) {\n    object.fxStraighten({\n      onChange: this.renderAll.bind(this)\n    });\n    return this;\n  }\n});\n/**\n * @namespace\n */\nfabric.Image.filters = { };\n\n/**\n * @class fabric.Image.filters.Grayscale\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Grayscale = fabric.util.createClass( /** @scope fabric.Image.filters.Grayscale.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Grayscale\",\n\n  /**\n   * @method applyTo\n   * @memberOf fabric.Image.filters.Grayscale.prototype\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        iLen = imageData.width,\n        jLen = imageData.height,\n        index, average, i, j;\n\n     for (i = 0; i < iLen; i++) {\n       for (j = 0; j < jLen; j++) {\n\n         index = (i * 4) * jLen + (j * 4);\n         average = (data[index] + data[index + 1] + data[index + 2]) / 3;\n\n         data[index]     = average;\n         data[index + 1] = average;\n         data[index + 2] = average;\n       }\n     }\n\n     context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return { type: this.type };\n  }\n});\n\nfabric.Image.filters.Grayscale.fromObject = function() {\n  return new fabric.Image.filters.Grayscale();\n};\n\n/**\n * @class fabric.Image.filters.RemoveWhite\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.RemoveWhite = fabric.util.createClass( /** @scope fabric.Image.filters.RemoveWhite.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"RemoveWhite\",\n\n  /**\n   * @memberOf fabric.Image.filters.RemoveWhite.prototype\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    options || (options = { });\n    this.threshold = options.threshold || 30;\n    this.distance = options.distance || 20;\n  },\n\n  /**\n   * @method applyTo\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        threshold = this.threshold,\n        distance = this.distance,\n        limit = 255 - threshold,\n        abs = Math.abs,\n        r, g, b;\n\n    for (var i = 0, len = data.length; i < len; i += 4) {\n\n      r = data[i];\n      g = data[i+1];\n      b = data[i+2];\n\n      if (r > limit &&\n          g > limit &&\n          b > limit &&\n          abs(r-g) < distance &&\n          abs(r-b) < distance &&\n          abs(g-b) < distance) {\n\n        data[i+3] = 1;\n      }\n    }\n\n    context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return {\n      type: this.type,\n      threshold: this.threshold,\n      distance: this.distance\n    };\n  }\n});\n\nfabric.Image.filters.RemoveWhite.fromObject = function(object) {\n  return new fabric.Image.filters.RemoveWhite(object);\n};\n\n/**\n * @class fabric.Image.filters.Invert\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Invert = fabric.util.createClass( /** @scope fabric.Image.filters.Invert.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Invert\",\n\n  /**\n   * @method applyTo\n   * @memberOf fabric.Image.filters.Invert.prototype\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        iLen = data.length, i;\n\n     for (i = 0; i < iLen; i+=4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n     }\n\n     context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return { type: this.type };\n  }\n});\n\nfabric.Image.filters.Invert.fromObject = function() {\n  return new fabric.Image.filters.Invert();\n};\n\n/**\n * @class fabric.Image.filters.Sepia\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Sepia = fabric.util.createClass( /** @scope fabric.Image.filters.Sepia.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Sepia\",\n\n  /**\n   * @method applyTo\n   * @memberOf fabric.Image.filters.Sepia.prototype\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        iLen = data.length, i, avg;\n\n     for (i = 0; i < iLen; i+=4) {\n        avg = 0.3  * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];\n        data[i] = avg + 100;\n        data[i + 1] = avg + 50;\n        data[i + 2] = avg + 255;\n     }\n\n     context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return { type: this.type };\n  }\n});\n\nfabric.Image.filters.Sepia.fromObject = function() {\n  return new fabric.Image.filters.Sepia();\n};\n\n/**\n * @class fabric.Image.filters.Sepia2\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Sepia2 = fabric.util.createClass( /** @scope fabric.Image.filters.Sepia2.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Sepia2\",\n\n  /**\n   * @method applyTo\n   * @memberOf fabric.Image.filters.Sepia.prototype\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        iLen = data.length, i, r, g, b;\n\n     for (i = 0; i < iLen; i+=4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        data[i] = (r * 0.393 + g * 0.769 + b * 0.189 ) / 1.351;\n        data[i + 1] = (r * 0.349 + g * 0.686 + b * 0.168 ) / 1.203;\n        data[i + 2] = (r * 0.272 + g * 0.534 + b * 0.131 ) / 2.140;\n     }\n\n     context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return { type: this.type };\n  }\n});\n\nfabric.Image.filters.Sepia2.fromObject = function() {\n  return new fabric.Image.filters.Sepia2();\n};\n\n/**\n * @class fabric.Image.filters.Brightness\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Brightness = fabric.util.createClass( /** @scope fabric.Image.filters.Brightness.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Brightness\",\n\n  /**\n   * @memberOf fabric.Image.filters.Brightness.prototype\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    options || (options = { });\n    this.brightness = options.brightness || 100;\n  },\n\n  /**\n   * @method applyTo\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        brightness = this.brightness;\n\n    for (var i = 0, len = data.length; i < len; i += 4) {\n      data[i] += brightness;\n      data[i + 1] += brightness;\n      data[i + 2] += brightness;\n    }\n\n    context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return {\n      type: this.type,\n      brightness: this.brightness\n    };\n  }\n});\n\nfabric.Image.filters.Brightness.fromObject = function(object) {\n  return new fabric.Image.filters.Brightness(object);\n};\n\n/**\n * @class fabric.Image.filters.Brightness\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Noise = fabric.util.createClass( /** @scope fabric.Image.filters.Noise.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Noise\",\n\n  /**\n   * @memberOf fabric.Image.filters.Brightness.prototype\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    options || (options = { });\n    this.noise = options.noise || 100;\n  },\n\n  /**\n   * @method applyTo\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        noise = this.noise, rand;\n\n    for (var i = 0, len = data.length; i < len; i += 4) {\n\n      rand = (0.5 - Math.random()) * noise;\n\n      data[i] += rand;\n      data[i + 1] += rand;\n      data[i + 2] += rand;\n    }\n\n    context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return {\n      type: this.type,\n      noise: this.noise\n    };\n  }\n});\n\nfabric.Image.filters.Noise.fromObject = function(object) {\n  return new fabric.Image.filters.Noise(object);\n};\n\n/**\n * @class fabric.Image.filters.Brightness\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.GradientTransparency = fabric.util.createClass( /** @scope fabric.Image.filters.GradientTransparency.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"GradientTransparency\",\n\n  /**\n   * @memberOf fabric.Image.filters.GradientTransparency.prototype\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    options || (options = { });\n    this.threshold = options.threshold || 100;\n  },\n\n  /**\n   * @method applyTo\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        threshold = this.threshold,\n        total = data.length;\n\n    for (var i = 0, len = data.length; i < len; i += 4) {\n      data[i + 3] = threshold + 255 * (total - i) / total;\n    }\n\n    context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return {\n      type: this.type,\n      threshold: this.threshold\n    };\n  }\n});\n\nfabric.Image.filters.GradientTransparency.fromObject = function(object) {\n  return new fabric.Image.filters.GradientTransparency(object);\n};\n\n/**\n * @class fabric.Image.filters.Tint\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.Tint = fabric.util.createClass( /** @scope fabric.Image.filters.Tint.prototype */ {\n\n  /**\n   * @param {String} type\n   */\n  type: \"Tint\",\n\n  /**\n   * @memberOf fabric.Image.filters.RemoveWhite.prototype\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    options || (options = { });\n    this.color = options.color || 0;\n  },\n\n  /**\n   * @method applyTo\n   * @param {Object} canvasEl Canvas element to apply filter to\n   */\n  applyTo: function(canvasEl) {\n    \n    var context = canvasEl.getContext('2d'),\n        imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n        data = imageData.data,\n        iLen = data.length, i,\n        r, g, b, a;\n  \n\tvar rgb = parseInt(this.color).toString(16);\n\tvar cr = parseInt('0x'+rgb.substr(0, 2));\n\tvar cg = parseInt('0x'+rgb.substr(2, 2));\n\tvar cb = parseInt('0x'+rgb.substr(4, 2)); \n\t\n    for (i = 0; i < iLen; i+=4) {\n\n      a = data[i+3];\n      \n      if (a > 0){\t\t\n        data[i] = cr;\n        data[i+1] = cg;\n        data[i+2] = cb;      \n      }      \n    }\n    \n    context.putImageData(imageData, 0, 0);\n  },\n\n  /**\n   * @method toJSON\n   * @return {String} json representation of filter\n   */\n  toJSON: function() {\n    return {\n      type: this.type,\n      color: this.color\n    };\n  }\n});\n\nfabric.Image.filters.Tint.fromObject = function(object) {\n  return new fabric.Image.filters.Tint(object);\n};\n(function(global) {\n\n  \"use strict\";\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n  if (!fabric.Object) {\n    fabric.warn('fabric.Text requires fabric.Object');\n    return;\n  }\n\n  /**\n   * @class Text\n   * @extends fabric.Object\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @scope fabric.Text.prototype */ {\n\n    /**\n     * @property\n     * @type Number\n     */\n    fontSize:         40,\n\n    /**\n     * @property\n     * @type Number\n     */\n    fontWeight:       100,\n\n    /**\n     * @property\n     * @type String\n     */\n    fontFamily:       'Times New Roman',\n\n    /**\n     * @property\n     * @type String\n     */\n    textDecoration:   '',\n\n    /**\n     * @property\n     * @type String | null\n     */\n    textShadow:       '',\n\n    /**\n     * Determines text alignment. Possible values: \"left\", \"center\", or \"right\".\n     * @property\n     * @type String\n     */\n    textAlign:        'left',\n\n    /**\n     * @property\n     * @type String\n     */\n    fontStyle:        '',\n\n    /**\n     * @property\n     * @type Number\n     */\n    lineHeight:       1.3,\n\n    /**\n     * @property\n     * @type String\n     */\n    strokeStyle:      '',\n\n    /**\n     * @property\n     * @type Number\n     */\n    strokeWidth:      1,\n\n    /**\n     * @property\n     * @type String\n     */\n    backgroundColor:  '',\n\n\n    /**\n     * @property\n     * @type String | null\n     */\n    path:             null,\n\n    /**\n     * @property\n     * @type String\n     */\n    type:             'text',\n\n    /**\n     * Indicates whether canvas native text methods should be used to render text (otherwise, Cufon is used)\n     * @property\n     * @type Boolean\n     */\n     useNative:       true,\n\n    /**\n     * Constructor\n     * @method initialize\n     * @param {String} text\n     * @param {Object} [options]\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      this._initStateProperties();\n      this.text = text;\n      this.setOptions(options || { });\n      this._theta = this.angle * Math.PI / 180;\n      this._initDimensions();\n      this.setCoords();\n    },\n\n    /**\n     * Renders text object on offscreen canvas, so that it would get dimensions\n     * @private\n     * @method _initDimensions\n     */\n    _initDimensions: function() {\n      var canvasEl = fabric.document.createElement('canvas');\n\n      if (!canvasEl.getContext && typeof G_vmlCanvasManager != 'undefined') {\n        G_vmlCanvasManager.initElement(canvasEl);\n      }\n\n      this._render(canvasEl.getContext('2d'));\n    },\n\n    /**\n     * Creates `stateProperties` list on an instance, and adds `fabric.Text` -specific ones to it\n     * (such as \"fontFamily\", \"fontWeight\", etc.)\n     * @private\n     * @method _initStateProperties\n     */\n    _initStateProperties: function() {\n      this.stateProperties = this.stateProperties.concat();\n      this.stateProperties.push(\n        'fontFamily',\n        'fontWeight',\n        'fontSize',\n        'path',\n        'text',\n        'textDecoration',\n        'textShadow',\n        'textAlign',\n        'fontStyle',\n        'lineHeight',\n        'strokeStyle',\n        'strokeWidth',\n        'backgroundColor',\n        'useNative'\n      );\n      fabric.util.removeFromArray(this.stateProperties, 'width');\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @method toString\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * @private\n     * @method _render\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (typeof Cufon === 'undefined' || this.useNative === true) {\n        this._renderViaNative(ctx);\n      }\n      else {\n        this._renderViaCufon(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @method _renderViaCufon\n     */\n    _renderViaCufon: function(ctx) {\n      var o = Cufon.textOptions || (Cufon.textOptions = { });\n\n      // export options to be used by cufon.js\n      o.left = this.left;\n      o.top = this.top;\n      o.context = ctx;\n      o.color = this.fill;\n\n      var el = this._initDummyElementForCufon();\n\n      // set \"cursor\" to top/left corner\n      this.transform(ctx);\n\n      // draw text\n      Cufon.replaceElement(el, {\n        engine: 'canvas',\n        separate: 'none',\n        fontFamily: this.fontFamily,\n        fontWeight: this.fontWeight,\n        textDecoration: this.textDecoration,\n        textShadow: this.textShadow,\n        textAlign: this.textAlign,\n        fontStyle: this.fontStyle,\n        lineHeight: this.lineHeight,\n        strokeStyle: this.strokeStyle,\n        strokeWidth: this.strokeWidth,\n        backgroundColor: this.backgroundColor\n      });\n\n      // update width, height\n      this.width = o.width;\n      this.height = o.height;\n\n      this._totalLineHeight = o.totalLineHeight;\n      this._fontAscent = o.fontAscent;\n      this._boundaries = o.boundaries;\n      this._shadowOffsets = o.shadowOffsets;\n      this._shadows = o.shadows || [ ];\n\n      el = null;\n\n      // need to set coords _after_ the width/height was retreived from Cufon\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     * @method _render_native\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderViaNative: function(ctx) {\n\n      this.transform(ctx);\n      this._setTextStyles(ctx);\n\n      var textLines = this.text.split(/\\r?\\n/);\n\n      this.width = this._getTextWidth(ctx, textLines);\n      this.height = this._getTextHeight(ctx, textLines);\n\n      this._renderTextBackground(ctx, textLines);\n\n      if (this.textAlign !== 'left') {\n        ctx.save();\n        ctx.translate(this.textAlign === 'center' ? (this.width / 2) : this.width, 0);\n      }\n\n      this._setTextShadow(ctx);\n      this._renderTextFill(ctx, textLines);\n      this.textShadow && ctx.restore();\n\n      this._renderTextStroke(ctx, textLines);\n      if (this.textAlign !== 'left') {\n        ctx.restore();\n      }\n\n      this._renderTextDecoration(ctx, textLines);\n      this._setBoundaries(ctx, textLines);\n      this._totalLineHeight = 0;\n\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     * @method _setBoundaries\n     */\n    _setBoundaries: function(ctx, textLines) {\n      this._boundaries = [ ];\n\n      for (var i = 0, len = textLines.length; i < len; i++) {\n\n        var lineWidth = ctx.measureText(textLines[i]).width;\n        var lineLeftOffset = this._getLineLeftOffset(lineWidth);\n\n        this._boundaries.push({\n          height: this.fontSize,\n          width: lineWidth,\n          left: lineLeftOffset\n        });\n      }\n    },\n\n    /**\n     * @private\n     * @method _setTextStyles\n     */\n    _setTextStyles: function(ctx) {\n      ctx.fillStyle = this.fill;\n      ctx.strokeStyle = this.strokeStyle;\n      ctx.lineWidth = this.strokeWidth;\n      ctx.textBaseline = 'top';\n      ctx.textAlign = this.textAlign;\n      ctx.font = this._getFontDeclaration();\n    },\n\n    /**\n     * @private\n     * @method _getTextHeight\n     */\n    _getTextHeight: function(ctx, textLines) {\n      return this.fontSize * textLines.length * this.lineHeight;\n    },\n\n    /**\n     * @private\n     * @method _getTextWidth\n     */\n    _getTextWidth: function(ctx, textLines) {\n      var maxWidth = ctx.measureText(textLines[0]).width;\n\n      for (var i = 1, len = textLines.length; i < len; i++) {\n        var currentLineWidth = ctx.measureText(textLines[i]).width;\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @method _setTextShadow\n     */\n    _setTextShadow: function(ctx) {\n      if (this.textShadow) {\n\n        // \"rgba(0,0,0,0.2) 2px 2px 10px\"\n        // \"rgb(0, 100, 0) 0 0 5px\"\n        // \"red 2px 2px 1px\"\n        // \"#f55 123 345 567\"\n        var reOffsetsAndBlur = /\\s+(-?\\d+)(?:px)?\\s+(-?\\d+)(?:px)?\\s+(\\d+)(?:px)?\\s*/;\n\n        var shadowDeclaration = this.textShadow;\n        var offsetsAndBlur = reOffsetsAndBlur.exec(this.textShadow);\n        var shadowColor = shadowDeclaration.replace(reOffsetsAndBlur, '');\n\n        ctx.save();\n        ctx.shadowColor = shadowColor;\n        ctx.shadowOffsetX = parseInt(offsetsAndBlur[1], 10);\n        ctx.shadowOffsetY = parseInt(offsetsAndBlur[2], 10);\n        ctx.shadowBlur = parseInt(offsetsAndBlur[3], 10);\n\n        this._shadows = [{\n          blur: ctx.shadowBlur,\n          color: ctx.shadowColor,\n          offX: ctx.shadowOffsetX,\n          offY: ctx.shadowOffsetY\n        }];\n\n        this._shadowOffsets = [[\n          parseInt(ctx.shadowOffsetX, 10), parseInt(ctx.shadowOffsetY, 10)\n        ]];\n      }\n    },\n\n    _renderTextFill: function(ctx, textLines) {\n      this._boundaries = [ ];\n      for (var i = 0, len = textLines.length; i < len; i++) {\n        ctx.fillText(\n          textLines[i],\n          -this.width / 2,\n          (-this.height / 2) + (i * this.fontSize * this.lineHeight)\n        );\n      }\n    },\n\n    /**\n     * @private\n     * @method _renderTextStroke\n     */\n    _renderTextStroke: function(ctx, textLines) {\n      if (this.strokeStyle) {\n        for (var i = 0, len = textLines.length; i < len; i++) {\n          ctx.strokeText(\n            textLines[i],\n            -this.width / 2,\n            (-this.height / 2) + (i * this.fontSize * this.lineHeight)\n          );\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @_renderTextBackground\n     */\n    _renderTextBackground: function(ctx, textLines) {\n      if (this.backgroundColor) {\n        ctx.save();\n        ctx.fillStyle = this.backgroundColor;\n\n        for (var i = 0, len = textLines.length; i < len; i++) {\n\n          var lineWidth = ctx.measureText(textLines[i]).width;\n          var lineLeftOffset = this._getLineLeftOffset(lineWidth);\n\n          ctx.fillRect(\n            (-this.width / 2) + lineLeftOffset,\n            (-this.height / 2) + (i * this.fontSize * this.lineHeight),\n            lineWidth,\n            this.fontSize\n          );\n        }\n        ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @method _getLineLeftOffset\n     */\n    _getLineLeftOffset: function(lineWidth) {\n      if (this.textAlign === 'center') {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'right') {\n        return this.width - lineWidth;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     * @method _renderTextDecoration\n     */\n    _renderTextDecoration: function(ctx, textLines) {\n\n      var halfOfVerticalBox = this._getTextHeight(ctx, textLines) / 2;\n\n      function renderLinesAtOffset(offset) {\n        for (var i = 0, len = textLines.length; i < len; i++) {\n\n          var lineWidth = ctx.measureText(textLines[i]).width;\n          var lineLeftOffset = this._getLineLeftOffset(lineWidth);\n\n          ctx.fillRect(\n            (-this.width / 2) + lineLeftOffset,\n            (offset + (i * this.fontSize * this.lineHeight)) - halfOfVerticalBox,\n            lineWidth,\n            1);\n        }\n      }\n\n      if (this.textDecoration.indexOf('underline') > -1) {\n        renderLinesAtOffset.call(this, this.fontSize);\n      }\n      if (this.textDecoration.indexOf('line-through') > -1) {\n        renderLinesAtOffset.call(this, this.fontSize / 2);\n      }\n      if (this.textDecoration.indexOf('overline') > -1) {\n        renderLinesAtOffset.call(this, 0);\n      }\n    },\n\n    /**\n     * @private\n     * @method _getFontDeclaration\n     */\n    _getFontDeclaration: function() {\n      return [\n        this.fontStyle,\n        this.fontWeight,\n        this.fontSize + 'px',\n        (fabric.isLikelyNode ? ('\"' + this.fontFamily + '\"') : this.fontFamily)\n      ].join(' ');\n    },\n\n    /**\n     * @private\n     * @method _initDummyElement\n     */\n    _initDummyElementForCufon: function() {\n      var el = fabric.document.createElement('pre'),\n          container = fabric.document.createElement('div');\n\n      // Cufon doesn't play nice with textDecoration=underline if element doesn't have a parent\n      container.appendChild(el);\n\n      if (typeof G_vmlCanvasManager == 'undefined') {\n        el.innerHTML = this.text;\n      }\n      else {\n        // IE 7 & 8 drop newlines and white space on text nodes\n        // see: http://web.student.tuwien.ac.at/~e0226430/innerHtmlQuirk.html\n        // see: http://www.w3schools.com/dom/dom_mozilla_vs_ie.asp\n        el.innerText =  this.text.replace(/\\r?\\n/gi, '\\r');\n      }\n\n      el.style.fontSize = this.fontSize + 'px';\n      el.style.letterSpacing = 'normal';\n\n      return el;\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @method render\n     * @param ctx {CanvasRenderingContext2D} context to render on\n     */\n    render: function(ctx, noTransform) {\n      ctx.save();\n      this._render(ctx);\n      if (!noTransform && this.active) {\n        this.drawBorders(ctx);\n        this.hideCorners || this.drawCorners(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @return {Object} Object representation of text object\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        text:             this.text,\n        fontSize:         this.fontSize,\n        fontWeight:       this.fontWeight,\n        fontFamily:       this.fontFamily,\n        fontStyle:        this.fontStyle,\n        lineHeight:       this.lineHeight,\n        textDecoration:   this.textDecoration,\n        textShadow:       this.textShadow,\n        textAlign:        this.textAlign,\n        path:             this.path,\n        strokeStyle:      this.strokeStyle,\n        strokeWidth:      this.strokeWidth,\n        backgroundColor:  this.backgroundColor,\n        useNative:        this.useNative\n      });\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @method toSVG\n     * @return {string} svg representation of an instance\n     */\n    toSVG: function() {\n\n      var textLines = this.text.split(/\\r?\\n/),\n          lineTopOffset = this.useNative\n            ? this.fontSize * this.lineHeight\n            : (-this._fontAscent - ((this._fontAscent / 5) * this.lineHeight)),\n\n          textLeftOffset = -(this.width/2),\n          textTopOffset = this.useNative\n            ? this.fontSize - 1\n            : (this.height/2) - (textLines.length * this.fontSize) - this._totalLineHeight,\n\n          textAndBg = this._getSVGTextAndBg(lineTopOffset, textLeftOffset, textLines),\n          shadowSpans = this._getSVGShadows(lineTopOffset, textLines);\n\n      // move top offset by an ascent\n      textTopOffset += (this._fontAscent ? ((this._fontAscent / 5) * this.lineHeight) : 0);\n\n      return [\n        '<g transform=\"', this.getSvgTransform(), '\">',\n          textAndBg.textBgRects.join(''),\n          '<text ',\n            (this.fontFamily ? 'font-family=\"\\'' + this.fontFamily + '\\'\" ': ''),\n            (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ': ''),\n            (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ': ''),\n            (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ': ''),\n            (this.textDecoration ? 'text-decoration=\"' + this.textDecoration + '\" ': ''),\n            'style=\"', this.getSvgStyles(), '\" ',\n            /* svg starts from left/bottom corner so we normalize height */\n            'transform=\"translate(', toFixed(textLeftOffset, 2), ' ', toFixed(textTopOffset, 2), ')\">',\n            shadowSpans.join(''),\n            textAndBg.textSpans.join(''),\n          '</text>',\n        '</g>'\n      ].join('');\n    },\n\n    _getSVGShadows: function(lineTopOffset, textLines) {\n      var shadowSpans = [], j, i, jlen, ilen, lineTopOffsetMultiplier = 1;\n\n      if (!this._shadows || !this._boundaries) {\n        return shadowSpans;\n      }\n\n      for (j = 0, jlen = this._shadows.length; j < jlen; j++) {\n        for (i = 0, ilen = textLines.length; i < ilen; i++) {\n          if (textLines[i] !== '') {\n            var lineLeftOffset = (this._boundaries && this._boundaries[i]) ? this._boundaries[i].left : 0;\n            shadowSpans.push(\n              '<tspan x=\"',\n              toFixed((lineLeftOffset + lineTopOffsetMultiplier) + this._shadowOffsets[j][0], 2),\n              ((i === 0 || this.useNative) ? '\" y' : '\" dy'), '=\"',\n              toFixed(this.useNative\n                ? ((lineTopOffset * i) - this.height / 2 + this._shadowOffsets[j][1])\n                : (lineTopOffset + (i === 0 ? this._shadowOffsets[j][1] : 0)), 2),\n              '\" ',\n              this._getFillAttributes(this._shadows[j].color), '>',\n              fabric.util.string.escapeXml(textLines[i]),\n            '</tspan>');\n            lineTopOffsetMultiplier = 1;\n          } else {\n            // in some environments (e.g. IE 7 & 8) empty tspans are completely ignored, using a lineTopOffsetMultiplier\n            // prevents empty tspans\n            lineTopOffsetMultiplier++;\n          }\n        }\n      }\n      return shadowSpans;\n    },\n\n    _getSVGTextAndBg: function(lineTopOffset, textLeftOffset, textLines) {\n      var textSpans = [ ], textBgRects = [ ], i, lineLeftOffset, len, lineTopOffsetMultiplier = 1;\n\n      // text and background\n      for (i = 0, len = textLines.length; i < len; i++) {\n        if (textLines[i] !== '') {\n          lineLeftOffset = (this._boundaries && this._boundaries[i]) ? toFixed(this._boundaries[i].left, 2) : 0;\n          textSpans.push(\n            '<tspan x=\"',\n            lineLeftOffset, '\" ',\n            (i === 0 || this.useNative ? 'y' : 'dy'), '=\"',\n            toFixed(this.useNative ? ((lineTopOffset * i) - this.height / 2) : (lineTopOffset * lineTopOffsetMultiplier), 2) , '\" ',\n            // doing this on <tspan> elements since setting opacity on containing <text> one doesn't work in Illustrator\n            this._getFillAttributes(this.fill), '>',\n            fabric.util.string.escapeXml(textLines[i]),\n            '</tspan>'\n          );\n          lineTopOffsetMultiplier = 1;\n        } else {\n          // in some environments (e.g. IE 7 & 8) empty tspans are completely ignored, using a lineTopOffsetMultiplier\n          // prevents empty tspans\n          lineTopOffsetMultiplier++;\n        }\n\n        if (!this.backgroundColor || !this._boundaries) continue;\n\n        textBgRects.push(\n          '<rect ',\n            this._getFillAttributes(this.backgroundColor),\n            ' x=\"',\n            toFixed(textLeftOffset + this._boundaries[i].left, 2),\n            '\" y=\"',\n            /* an offset that seems to straighten things out */\n            toFixed((lineTopOffset * i) - this.height / 2, 2),\n            '\" width=\"',\n            toFixed(this._boundaries[i].width, 2),\n            '\" height=\"',\n            toFixed(this._boundaries[i].height, 2),\n          '\"></rect>');\n      }\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    // Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n    // we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n    _getFillAttributes: function(value) {\n      var fillColor = value ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n\n    /**\n     * Sets \"color\" of an instance (alias of `set('fill', &hellip;)`)\n     * @method setColor\n     * @param {String} value\n     * @return {fabric.Text} thisArg\n     * @chainable\n     */\n    setColor: function(value) {\n      this.set('fill', value);\n      return this;\n    },\n\n    /**\n     * Sets fontSize of an instance and updates its coordinates\n     * @method setFontsize\n     * @param {Number} value\n     * @return {fabric.Text} thisArg\n     * @chainable\n     */\n    setFontsize: function(value) {\n      this.set('fontSize', value);\n      this._initDimensions();\n      this.setCoords();\n      return this;\n    },\n\n    /**\n     * Returns actual text value of an instance\n     * @method getText\n     * @return {String}\n     */\n    getText: function() {\n      return this.text;\n    },\n\n    /**\n     * Sets text of an instance, and updates its coordinates\n     * @method setText\n     * @param {String} value\n     * @return {fabric.Text} thisArg\n     * @chainable\n     */\n    setText: function(value) {\n      this.set('text', value);\n      this._initDimensions();\n      this.setCoords();\n      return this;\n    },\n\n    /**\n     * Sets specified property to a specified value\n     * @method set\n     * @param {String} name\n     * @param {Any} value\n     * @return {fabric.Text} thisArg\n     * @chainable\n     */\n    _set: function(name, value) {\n      if (name === 'fontFamily' && this.path) {\n        this.path = this.path.replace(/(.*?)([^\\/]*)(\\.font\\.js)/, '$1' + value + '$3');\n      }\n      this.callSuper('_set', name, value);\n    }\n  });\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Text.fromElement`)\n   * @static\n   */\n  fabric.Text.ATTRIBUTE_NAMES =\n    ('x y fill fill-opacity opacity stroke stroke-width transform ' +\n     'font-family font-style font-weight font-size text-decoration').split(' ');\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @method fromObject\n   * @param {Object} object to create an instance from\n   * @return {fabric.Text} an instance\n   */\n  fabric.Text.fromObject = function(object) {\n    return new fabric.Text(object.text, clone(object));\n  };\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @method fabric.Text.fromElement\n   * @param element\n   * @param options\n   * @return {fabric.Text} an instance\n   */\n  fabric.Text.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES);\n    var options = fabric.util.object.extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes);\n    var text = new fabric.Text(element.textContent, options);\n\n    return text;\n  };\n\n})(typeof exports != 'undefined' ? exports : this);\n(function() {\n\n  if (typeof document != 'undefined' && typeof window != 'undefined') {\n    return;\n  }\n\n  var DOMParser = new require('xmldom').DOMParser,\n      URL = require('url'),\n      HTTP = require('http'),\n\n      Canvas = require('canvas'),\n      Image = require('canvas').Image;\n\n  function request(url, encoding, callback) {\n    var oURL = URL.parse(url),\n        client = HTTP.createClient(oURL.port, oURL.hostname),\n        request = client.request('GET', oURL.pathname, { 'host': oURL.hostname });\n\n    client.addListener('error', function(err) {\n      if (err.errno === process.ECONNREFUSED) {\n        fabric.log('ECONNREFUSED: connection refused to ' + client.host + ':' + client.port);\n      }\n      else {\n        fabric.log(err.message);\n      }\n    });\n\n    request.end();\n    request.on('response', function (response) {\n      var body = \"\";\n      if (encoding) {\n        response.setEncoding(encoding);\n      }\n      response.on('end', function () {\n        callback(body);\n      });\n      response.on('data', function (chunk) {\n        if (response.statusCode == 200) {\n          body += chunk;\n        }\n      });\n    });\n  }\n\n  fabric.util.loadImage = function(url, callback) {\n    request(url, 'binary', function(body) {\n      var img = new Image();\n      img.src = new Buffer(body, 'binary');\n      // preserving original url, which seems to be lost in node-canvas\n      img._src = url;\n      callback(img);\n    });\n  };\n\n  fabric.loadSVGFromURL = function(url, callback) {\n    url = url.replace(/^\\n\\s*/, '').replace(/\\?.*$/, '').trim();\n    request(url, '', function(body) {\n      fabric.loadSVGFromString(body, callback);\n    });\n  };\n\n  fabric.loadSVGFromString = function(string, callback) {\n    var doc = new DOMParser().parseFromString(string);\n    fabric.parseSVGDocument(doc.documentElement, function(results, options) {\n      callback(results, options);\n    });\n  };\n\n  fabric.util.getScript = function(url, callback) {\n    request(url, '', function(body) {\n      eval(body);\n      callback && callback();\n    });\n  };\n\n  fabric.Image.fromObject = function(object, callback) {\n    fabric.util.loadImage(object.src, function(img) {\n      var oImg = new fabric.Image(img);\n\n      oImg._initConfig(object);\n      oImg._initFilters(object);\n      callback(oImg);\n    });\n  };\n\n  /**\n   * Only available when running fabric on node.js\n   * @method createCanvasForNode\n   * @param width Canvas width\n   * @param height Canvas height\n   * @return {Object} wrapped canvas instance\n   */\n  fabric.createCanvasForNode = function(width, height) {\n\n    var canvasEl = fabric.document.createElement('canvas'),\n        nodeCanvas = new Canvas(width || 600, height || 600);\n\n    // jsdom doesn't create style on canvas element, so here be temp. workaround\n    canvasEl.style = { };\n\n    canvasEl.width = nodeCanvas.width;\n    canvasEl.height = nodeCanvas.height;\n\n    var canvas = fabric.Canvas || fabric.StaticCanvas;\n    var fabricCanvas = new canvas(canvasEl);\n    fabricCanvas.contextContainer = nodeCanvas.getContext('2d');\n    fabricCanvas.nodeCanvas = nodeCanvas;\n\n    return fabricCanvas;\n  };\n\n  fabric.StaticCanvas.prototype.createPNGStream = function() {\n    return this.nodeCanvas.createPNGStream();\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype.createPNGStream\n  }\n\n  var origSetWidth = fabric.StaticCanvas.prototype.setWidth;\n  fabric.StaticCanvas.prototype.setWidth = function(width) {\n    origSetWidth.call(this);\n    this.nodeCanvas.width = width;\n    return this;\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype.setWidth = fabric.StaticCanvas.prototype.setWidth;\n  }\n\n  var origSetHeight = fabric.StaticCanvas.prototype.setHeight;\n  fabric.StaticCanvas.prototype.setHeight = function(height) {\n    origSetHeight.call(this);\n    this.nodeCanvas.height = height;\n    return this;\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype.setHeight = fabric.StaticCanvas.prototype.setHeight;\n  }\n\n})();\n"]}]}